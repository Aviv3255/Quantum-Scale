<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Brand Moat | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #88da1c;
      --accent-dark: #6fb816;
      --accent-light: #a3e635;
      --accent-rgb: 136, 218, 28;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'brand-moat',
      title: 'The Brand Moat',
      description: 'Why brand is the only competitive advantage that compounds forever.',
      accentColor: '#88da1c',
      duration: '5 min',
      nextLesson: {
        id: 'performance-engine',
        title: 'The Performance Engine',
        teaser: 'How to optimize every page for speed and conversions.'
      }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; }
    });
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }
    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: [
        'Why competitors can copy everything except the feeling',
        'How Maglite spent 3x on lawsuits to protect their brand moat',
        'Building a brand that compounds like interest'
      ]},
      { type: 'hook', headline: 'Everything about your business can be copied. Except this one thing.', subtext: 'They can steal your product. Reverse-engineer your ads. Find your suppliers. Clone your website in a weekend. But they can\'t copy the FEELING your brand creates. Maglite knew this. They spent 3x their advertising budget on lawsuits - not to protect the flashlight, but to protect the brand. Because brand is the only moat that gets deeper over time.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/REI_logo.svg.png', brandName: 'REI'},
      { type: 'sankey-diagram' },
      { type: 'content', title: 'Products Are Temporary, Brand Is Forever', body: 'Your competitor launches tomorrow with the same product, same price, same features. What makes someone choose you? Brand. The accumulated feeling of every interaction. The trust built over time. The identity they adopt by choosing you. Products can be replicated in months. Brand takes years to build and seconds to recognize.' },
      { type: 'funnel-chart' },
      { type: 'example', scenario: 'Maglite: Defending The Moat', before: { label: 'The Product', text: 'Flashlight: Can be copied. Suppliers: Can be found. Design: Can be cloned. Easy to replicate.' }, after: { label: 'The Brand Defense', text: 'Maglite brand: Cannot be copied. Spent 3x ad budget on lawsuits. Protected logo, name, feeling. Result: 40 years of dominance.' }, insight: 'They knew the flashlight was replicable. The brand wasn\'t.' },
      { type: 'radar-chart' },
      { type: 'content', title: 'The Ford Model T Principle', body: 'Henry Ford: "Maximum effect, minimal package." Cluttered = cheap. Focused = premium. Your brand is not everything you do - it\'s the ONE thing you own in the customer\'s mind. Volvo = safety. Apple = simplicity. Tesla = innovation. What\'s your ONE thing? If it\'s not crystal clear, you have no moat.' },
      { type: 'pyramid-chart' },
      { type: 'cards', title: 'Building Your Brand Moat', items: [
        { title: 'Step 1: Define Your ONE Thing', description: 'What should your brand OWN in the customer\'s mind? Not 3 things. ONE. Volvo didn\'t say "safe, reliable, and stylish." They said SAFE. Period.' },
        { title: 'Step 2: Defend It Ruthlessly', description: 'Every decision either strengthens your ONE thing or dilutes it. Maglite defended "rugged professional flashlight" with lawsuits. How do you defend yours?' },
        { title: 'Step 3: Make It Feel-able', description: 'Your brand isn\'t a logo or a slogan. It\'s a FEELING. Apple feels simple. Harley feels rebellious. Nike feels victory. What does yours feel?' },
        { title: 'Step 4: Compound It Daily', description: 'Brand builds through consistency. Every email, every ad, every product - does it reinforce THE feeling? Consistency = compounding trust.' }
      ]},
      { type: 'donut-chart' },
      { type: 'treemap-chart' },
      { type: 'example', scenario: 'Apple vs Generic Tech', before: { label: 'Generic Tech Company', text: 'Product: Good laptop. Features: Competitive specs. Brand: None. Result: Price competition, low loyalty.' }, after: { label: 'Apple', text: 'Product: Good laptop. Features: Competitive specs. Brand: SIMPLICITY. Result: 40% margins, cult loyalty.' }, insight: 'Same product. One has a moat. One is a commodity.' },
      { type: 'gauge-chart' },
      { type: 'performance-matrix' },
      { type: 'content', title: 'Your Brand Is Your Territory', body: 'Defend it like Maglite did. Not with lawyers (unless necessary), but with consistency. Every product launch: does it fit THE feeling? Every partnership: does it strengthen THE position? Every word: does it reinforce THE moat? Competitors can copy features in weeks. They can\'t copy 10 years of consistent emotional territory. That\'s your unfair advantage.' },
      { type: 'quiz', question: 'Why did Maglite spend 3x their advertising budget on lawsuits to protect their brand?', options: ['Because they wanted to monopolize the flashlight market', 'Because competitors were making better products', 'Because brand is the only thing competitors can\'t copy and it compounds over time', 'Because they had extra legal budget to spend'], correctIndex: 2, feedback: { correct: 'Exactly! Maglite knew anyone could copy the flashlight design, find the same suppliers, and match the price. But they couldn\'t copy the FEELING and TRUST built over decades. Brand is the only moat that deepens with time. That\'s worth defending.', incorrect: 'Not quite. It wasn\'t about monopoly or competition - it was about protecting the only truly uncopiable asset: brand. Products can be cloned in months. Brand trust takes years to build and becomes your permanent competitive advantage. That\'s what they defended.' }},
      { type: 'completion' }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Star: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      ArrowDown: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
    };

    // ============ TIER 1: SANKEY DIAGRAM (FROM LIBRARY) ============
    const SankeyDiagramSlide = ({ data }) => {
      const nodes = [
        { id: 'brand-inputs', label: 'Brand Inputs', color: '#6B7280' },
        { id: 'consistency', label: 'Consistency', color: '#3B82F6' },
        { id: 'visual-identity', label: 'Visual Identity', color: '#F59E0B' },
        { id: 'voice', label: 'Voice & Tone', color: '#A855F7' },
        { id: 'trust', label: 'Trust', color: '#88da1c' },
        { id: 'recognition', label: 'Recognition', color: '#22C55E' },
        { id: 'moat', label: 'BRAND MOAT', color: '#88da1c' },
      ];

      const links = [
        { source: 'brand-inputs', target: 'consistency', value: 30 },
        { source: 'brand-inputs', target: 'visual-identity', value: 25 },
        { source: 'brand-inputs', target: 'voice', value: 20 },
        { source: 'consistency', target: 'trust', value: 25 },
        { source: 'consistency', target: 'recognition', value: 15 },
        { source: 'visual-identity', target: 'recognition', value: 30 },
        { source: 'voice', target: 'trust', value: 15 },
        { source: 'trust', target: 'moat', value: 40 },
        { source: 'recognition', target: 'moat', value: 35 },
      ];

      const width = 550;
      const height = 350;
      const padding = 40;
      const nodeWidth = 20;
      const colors = ['#88da1c', '#22C55E', '#3B82F6', '#A855F7', '#F59E0B', '#EF4444'];

      // Group nodes by column
      const sourceIds = new Set(links.map(l => l.source));
      const targetIds = new Set(links.map(l => l.target));
      const leftNodes = nodes.filter(n => sourceIds.has(n.id) && !targetIds.has(n.id));
      const middleNodes = nodes.filter(n => sourceIds.has(n.id) && targetIds.has(n.id));
      const rightNodes = nodes.filter(n => !sourceIds.has(n.id) && targetIds.has(n.id));

      const nodePositions = new Map();

      const positionColumn = (columnNodes, xPos) => {
        const totalValue = columnNodes.reduce((sum, node) => {
          const nodeValue = links.filter(l => l.source === node.id || l.target === node.id).reduce((s, l) => s + l.value, 0);
          return sum + nodeValue;
        }, 0);
        let currentY = padding;
        const availableHeight = height - 2 * padding;
        columnNodes.forEach((node, i) => {
          const nodeValue = links.filter(l => l.source === node.id || l.target === node.id).reduce((s, l) => s + l.value, 0);
          const nodeHeight = (nodeValue / totalValue) * availableHeight * 0.8;
          nodePositions.set(node.id, { x: xPos, y: currentY, height: nodeHeight });
          currentY += nodeHeight + 15;
        });
      };

      positionColumn(leftNodes, padding);
      positionColumn(middleNodes, width / 2 - nodeWidth / 2);
      positionColumn(rightNodes, width - padding - nodeWidth);

      const createLinkPath = (link) => {
        const sourcePos = nodePositions.get(link.source);
        const targetPos = nodePositions.get(link.target);
        if (!sourcePos || !targetPos) return '';

        const sourceLinks = links.filter(l => l.source === link.source);
        const targetLinks = links.filter(l => l.target === link.target);
        const sourceLinkIndex = sourceLinks.findIndex(l => l === link);
        const targetLinkIndex = targetLinks.findIndex(l => l === link);
        const sourceTotal = sourceLinks.reduce((s, l) => s + l.value, 0);
        const targetTotal = targetLinks.reduce((s, l) => s + l.value, 0);
        const sourceOffset = sourceLinks.slice(0, sourceLinkIndex).reduce((s, l) => s + l.value, 0);
        const targetOffset = targetLinks.slice(0, targetLinkIndex).reduce((s, l) => s + l.value, 0);
        const linkHeight = (link.value / sourceTotal) * sourcePos.height;
        const targetLinkHeight = (link.value / targetTotal) * targetPos.height;

        const x0 = sourcePos.x + nodeWidth;
        const y0 = sourcePos.y + (sourceOffset / sourceTotal) * sourcePos.height;
        const x1 = targetPos.x;
        const y1 = targetPos.y + (targetOffset / targetTotal) * targetPos.height;
        const xi = (x0 + x1) * 0.5;

        return `M ${x0} ${y0} C ${xi} ${y0}, ${xi} ${y1}, ${x1} ${y1} L ${x1} ${y1 + targetLinkHeight} C ${xi} ${y1 + targetLinkHeight}, ${xi} ${y0 + linkHeight}, ${x0} ${y0 + linkHeight} Z`;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Flow Visualization</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">How Brand Elements Build Your Moat</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {/* Links */}
              {links.map((link, i) => {
                const sourceNode = nodes.find(n => n.id === link.source);
                const color = sourceNode?.color || colors[i % colors.length];
                return (
                  <motion.path key={`link-${i}`} initial={{ opacity: 0 }} animate={{ opacity: 0.4 }} transition={{ delay: 0.3 + i * 0.05 }}
                    d={createLinkPath(link)} fill={color} />
                );
              })}

              {/* Nodes */}
              {nodes.map((node, i) => {
                const pos = nodePositions.get(node.id);
                if (!pos) return null;
                return (
                  <motion.g key={node.id}>
                    <motion.rect initial={{ scaleY: 0 }} animate={{ scaleY: 1 }} transition={{ delay: 0.1 + i * 0.03 }}
                      x={pos.x} y={pos.y} width={nodeWidth} height={pos.height} fill={node.color} rx="4"
                      style={{ transformOrigin: `${pos.x}px ${pos.y}px` }} />
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.03 }}
                      x={pos.x < width / 2 ? pos.x - 5 : pos.x + nodeWidth + 5} y={pos.y + pos.height / 2 + 4}
                      textAnchor={pos.x < width / 2 ? 'end' : 'start'} fill="rgba(255,255,255,0.8)" fontSize="11">
                      {node.label}
                    </motion.text>
                  </motion.g>
                );
              })}
            </svg>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 1: FUNNEL CHART (FROM LIBRARY) ============
    const FunnelChartSlide = ({ data }) => {
      const funnelData = [
        { label: 'Brand Awareness', value: 10000, color: '#88da1c' },
        { label: 'Recognition', value: 6500, color: '#6DD400' },
        { label: 'Consideration', value: 4200, color: '#52C41A' },
        { label: 'Trust', value: 2800, color: '#3B82F6' },
        { label: 'Loyalty (Moat)', value: 1900, color: '#8B5CF6' },
      ];

      const maxValue = funnelData[0].value;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Conversion Funnel</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">The Brand Building Funnel</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="max-w-md mx-auto space-y-2">
              {funnelData.map((stage, index) => {
                const widthPercent = (stage.value / maxValue) * 100;
                const prevValue = index > 0 ? funnelData[index - 1].value : stage.value;
                const conversionRate = ((stage.value / prevValue) * 100).toFixed(1);

                return (
                  <motion.div key={index} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: index * 0.15 }} className="relative">
                    <div className="flex justify-center">
                      <motion.div className="relative h-14 rounded-lg flex items-center justify-center overflow-hidden"
                        style={{ backgroundColor: stage.color }}
                        initial={{ width: 0 }} animate={{ width: `${widthPercent}%` }}
                        transition={{ duration: 0.8, delay: 0.2 + index * 0.15, ease: [0.22, 1, 0.36, 1] }}>
                        <div className="absolute inset-0 opacity-30" style={{ background: 'linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 50%, rgba(0,0,0,0.1) 100%)' }} />
                        <motion.div className="relative z-10 flex items-center gap-3 px-4" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 + index * 0.15 }}>
                          <span className="text-white font-bold text-lg drop-shadow-sm">{stage.value.toLocaleString()}</span>
                          <span className="text-white/90 text-sm font-medium drop-shadow-sm">{stage.label}</span>
                        </motion.div>
                      </motion.div>
                    </div>
                    {index > 0 && (
                      <motion.div className="flex justify-center items-center gap-2 py-1" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.7 + index * 0.15 }}>
                        <Icons.ArrowDown />
                        <span className={`text-xs font-medium ${parseFloat(conversionRate) >= 50 ? 'text-[#88da1c]' : 'text-amber-500'}`}>
                          {conversionRate}% conversion
                        </span>
                      </motion.div>
                    )}
                  </motion.div>
                );
              })}
            </div>

            <motion.div className="mt-6 text-center" initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 1.2 }}>
              <div className="text-sm text-white/50 mb-1">Overall Conversion</div>
              <div className="text-3xl font-bold text-[#88da1c]">
                {((funnelData[funnelData.length - 1].value / funnelData[0].value) * 100).toFixed(1)}%
              </div>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 1: RADAR CHART (FROM LIBRARY) ============
    const RadarChartSlide = ({ data }) => {
      const radarData = [
        { axis: 'Trust', value: 95 },
        { axis: 'Recognition', value: 90 },
        { axis: 'Loyalty', value: 85 },
        { axis: 'Emotion', value: 88 },
        { axis: 'Consistency', value: 92 },
        { axis: 'Premium', value: 78 },
      ];

      const size = 300;
      const center = size / 2;
      const radius = (size / 2) - 50;
      const levels = 5;
      const angleSlice = (Math.PI * 2) / radarData.length;
      const maxValue = 100;
      const accentColor = '#88da1c';

      const calculatePoint = (value, index) => {
        const normalizedValue = value / maxValue;
        const angle = angleSlice * index - Math.PI / 2;
        return { x: center + radius * normalizedValue * Math.cos(angle), y: center + radius * normalizedValue * Math.sin(angle) };
      };

      const dataPoints = radarData.map((d, i) => calculatePoint(d.value, i));
      const polygonPath = dataPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';

      const labelPoints = radarData.map((_, i) => {
        const angle = angleSlice * i - Math.PI / 2;
        const labelRadius = radius + 30;
        return { x: center + labelRadius * Math.cos(angle), y: center + labelRadius * Math.sin(angle) };
      });

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Multi-Axis Analysis</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Brand vs Commodity: The Gap</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width={size} height={size} className="overflow-visible">
                <defs>
                  <radialGradient id="radarGradient" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" stopColor={accentColor} stopOpacity="0.4" />
                    <stop offset="100%" stopColor={accentColor} stopOpacity="0.1" />
                  </radialGradient>
                  <filter id="radarGlow">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur" />
                    <feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge>
                  </filter>
                </defs>

                {/* Grid levels */}
                {Array.from({ length: levels }).map((_, levelIndex) => {
                  const levelRadius = (radius / levels) * (levelIndex + 1);
                  const levelPoints = radarData.map((_, i) => {
                    const angle = angleSlice * i - Math.PI / 2;
                    return { x: center + levelRadius * Math.cos(angle), y: center + levelRadius * Math.sin(angle) };
                  });
                  const levelPath = levelPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
                  return (
                    <motion.path key={levelIndex} d={levelPath} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={1}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: levelIndex * 0.1 }} />
                  );
                })}

                {/* Axis lines */}
                {radarData.map((_, i) => {
                  const angle = angleSlice * i - Math.PI / 2;
                  const endX = center + radius * Math.cos(angle);
                  const endY = center + radius * Math.sin(angle);
                  return (
                    <motion.line key={i} x1={center} y1={center} x2={endX} y2={endY} stroke="rgba(255,255,255,0.1)" strokeWidth={1}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.05 }} />
                  );
                })}

                {/* Data polygon - filled */}
                <motion.path d={polygonPath} fill="url(#radarGradient)"
                  initial={{ opacity: 0, scale: 0.5 }} animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.5, duration: 0.6, ease: 'backOut' }} style={{ transformOrigin: 'center' }} />

                {/* Data polygon - stroke */}
                <motion.path d={polygonPath} fill="none" stroke={accentColor} strokeWidth={2.5} strokeLinejoin="round" filter="url(#radarGlow)"
                  initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.3, duration: 1, ease: [0.22, 1, 0.36, 1] }} />

                {/* Data points */}
                {dataPoints.map((point, i) => (
                  <motion.circle key={i} cx={point.x} cy={point.y} r={5} fill={accentColor} stroke="#000" strokeWidth={2}
                    initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.8 + i * 0.08, type: 'spring', stiffness: 200 }} />
                ))}

                {/* Labels */}
                {labelPoints.map((point, i) => (
                  <motion.text key={i} x={point.x} y={point.y} textAnchor="middle" dominantBaseline="middle"
                    className="text-xs font-medium" style={{ fill: '#fff' }}
                    initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.6 + i * 0.05 }}>
                    {radarData[i].axis}
                  </motion.text>
                ))}
              </svg>
            </div>

            <div className="mt-6 flex flex-wrap justify-center gap-4">
              {radarData.map((item, i) => (
                <motion.div key={i} className="flex items-center gap-2"
                  initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.9 + i * 0.05 }}>
                  <span className="text-sm text-white/50">{item.axis}:</span>
                  <span className="text-sm font-bold text-white">{item.value}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 1: PYRAMID CHART (FROM LIBRARY) ============
    const PyramidChartSlide = ({ data }) => {
      const pyramidData = [
        { label: 'Brand Love', value: 15, color: '#88da1c' },
        { label: 'Emotional Connection', value: 25, color: '#22C55E' },
        { label: 'Trust & Reliability', value: 35, color: '#3B82F6' },
        { label: 'Recognition', value: 50, color: '#A855F7' },
        { label: 'Awareness', value: 100, color: '#F59E0B' },
      ];

      const width = 400;
      const height = 320;
      const padding = 40;
      const maxValue = Math.max(...pyramidData.map(d => d.value));
      const segmentHeight = (height - 2 * padding) / pyramidData.length;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Hierarchy</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">The Brand Building Hierarchy</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full max-w-lg mx-auto">
              {pyramidData.map((d, i) => {
                const widthRatio = d.value / maxValue;
                const topWidth = widthRatio * (width - 2 * padding) * (1 - i / pyramidData.length);
                const bottomWidth = widthRatio * (width - 2 * padding) * (1 - (i + 1) / pyramidData.length);
                const y = padding + i * segmentHeight;
                const cx = width / 2;
                const topLeft = cx - topWidth / 2;
                const topRight = cx + topWidth / 2;
                const bottomLeft = cx - bottomWidth / 2;
                const bottomRight = cx + bottomWidth / 2;
                const path = `M ${topLeft} ${y} L ${topRight} ${y} L ${bottomRight} ${y + segmentHeight} L ${bottomLeft} ${y + segmentHeight} Z`;

                return (
                  <motion.g key={i}>
                    <motion.path initial={{ scaleY: 0, opacity: 0 }} animate={{ scaleY: 1, opacity: 1 }}
                      transition={{ delay: 0.1 + i * 0.1, duration: 0.4 }} d={path} fill={d.color} stroke="black" strokeWidth="2"
                      style={{ transformOrigin: `${cx}px ${y}px` }} />
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.1 }}
                      x={width - padding + 10} y={y + segmentHeight / 2 + 4} fill="rgba(255,255,255,0.8)" fontSize="11">
                      {d.label}
                    </motion.text>
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.35 + i * 0.1 }}
                      x={cx} y={y + segmentHeight / 2 + 5} textAnchor="middle" fill="white" fontSize="14" fontWeight="bold">
                      {d.value}%
                    </motion.text>
                  </motion.g>
                );
              })}
            </svg>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 2: DONUT CHART (FROM LIBRARY) ============
    const DonutChartSlide = ({ data }) => {
      const donutData = [
        { label: 'Brand Equity', value: 40, color: '#88da1c' },
        { label: 'Customer Trust', value: 25, color: '#3B82F6' },
        { label: 'Recognition', value: 20, color: '#8B5CF6' },
        { label: 'Consistency', value: 15, color: '#F59E0B' },
      ];

      const size = 280;
      const thickness = 32;
      const total = donutData.reduce((sum, item) => sum + item.value, 0);
      const radius = (size - thickness) / 2;
      const circumference = 2 * Math.PI * radius;
      const centerVal = size / 2;

      let currentOffset = 0;
      const segments = donutData.map((item, index) => {
        const percentage = item.value / total;
        const strokeLength = percentage * circumference;
        const segment = { ...item, strokeLength, strokeOffset: currentOffset, percentage };
        currentOffset += strokeLength;
        return segment;
      });

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Distribution</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">What Makes A Brand Moat</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex flex-col lg:flex-row items-center justify-center gap-8">
              <div className="relative" style={{ width: size, height: size }}>
                <svg width={size} height={size} className="transform -rotate-90">
                  <circle cx={centerVal} cy={centerVal} r={radius} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={thickness} />
                  {segments.map((segment, index) => (
                    <motion.circle key={index} cx={centerVal} cy={centerVal} r={radius} fill="none" stroke={segment.color}
                      strokeWidth={thickness} strokeLinecap="round"
                      strokeDasharray={`${segment.strokeLength} ${circumference}`}
                      initial={{ strokeDashoffset: circumference }}
                      animate={{ strokeDashoffset: circumference - segment.strokeOffset - segment.strokeLength }}
                      transition={{ duration: 1, delay: 0.2 + index * 0.15, ease: [0.22, 1, 0.36, 1] }}
                      style={{ filter: `drop-shadow(0 0 8px ${segment.color}40)` }} />
                  ))}
                </svg>
                <motion.div className="absolute inset-0 flex flex-col items-center justify-center"
                  initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.6, duration: 0.4 }}>
                  <span className="text-4xl font-bold text-white">100%</span>
                  <span className="text-sm text-white/50">Brand Moat</span>
                </motion.div>
              </div>

              <div className="space-y-3">
                {segments.map((segment, index) => (
                  <motion.div key={index} className="flex items-center gap-3"
                    initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + index * 0.1 }}>
                    <div className="w-3 h-3 rounded-full" style={{ backgroundColor: segment.color }} />
                    <span className="text-sm text-white">{segment.label}</span>
                    <span className="text-sm font-semibold ml-auto text-white/50">{(segment.percentage * 100).toFixed(0)}%</span>
                  </motion.div>
                ))}
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 2: TREEMAP CHART (FROM LIBRARY) ============
    const TreeMapChartSlide = ({ data }) => {
      const treemapData = [
        { label: 'Consistency', value: 35, color: '#88da1c' },
        { label: 'Visual ID', value: 25, color: '#22C55E' },
        { label: 'Voice', value: 20, color: '#3B82F6' },
        { label: 'Experience', value: 15, color: '#A855F7' },
        { label: 'Story', value: 5, color: '#F59E0B' },
      ];

      const width = 500;
      const height = 280;
      const padding = 20;
      const total = treemapData.reduce((sum, d) => sum + d.value, 0);
      const sortedData = [...treemapData].sort((a, b) => b.value - a.value);

      const rects = [];
      let x = padding;
      let y = padding;
      let availableWidth = width - 2 * padding;
      let availableHeight = height - 2 * padding;
      let remainingValue = total;

      sortedData.forEach((item, i) => {
        const ratio = item.value / remainingValue;
        if (i % 2 === 0) {
          const h = availableHeight * ratio;
          rects.push({ x, y, w: availableWidth, h, item });
          y += h;
          availableHeight -= h;
        } else {
          const w = availableWidth * ratio;
          rects.push({ x, y, w, h: availableHeight, item });
          x += w;
          availableWidth -= w;
        }
        remainingValue -= item.value;
      });

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Investment Map</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Where to Invest Your Brand Building</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {rects.map((rect, i) => (
                <motion.g key={i}>
                  <motion.rect initial={{ scale: 0, opacity: 0 }} animate={{ scale: 1, opacity: 1 }}
                    transition={{ delay: 0.1 + i * 0.05, type: 'spring' }}
                    x={rect.x} y={rect.y} width={rect.w} height={rect.h}
                    fill={rect.item.color} stroke="black" strokeWidth="2" rx="4" />
                  {rect.w > 60 && rect.h > 40 && (
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.05 }}
                      x={rect.x + rect.w / 2} y={rect.y + rect.h / 2} textAnchor="middle" dominantBaseline="middle"
                      fill="white" fontSize={Math.min(14, rect.w / 6)} fontWeight="bold"
                      style={{ textShadow: '0 1px 2px rgba(0,0,0,0.5)' }}>
                      {rect.item.label}
                    </motion.text>
                  )}
                  {rect.w > 60 && rect.h > 50 && (
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.35 + i * 0.05 }}
                      x={rect.x + rect.w / 2} y={rect.y + rect.h / 2 + 16} textAnchor="middle" dominantBaseline="middle"
                      fill="rgba(255,255,255,0.8)" fontSize={Math.min(11, rect.w / 8)}
                      style={{ textShadow: '0 1px 2px rgba(0,0,0,0.5)' }}>
                      {((rect.item.value / total) * 100).toFixed(0)}%
                    </motion.text>
                  )}
                </motion.g>
              ))}
            </svg>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 2: GAUGE CHART (FROM LIBRARY) ============
    const GaugeChartSlide = ({ data }) => {
      const value = 78;
      const maxValue = 100;
      const size = 240;
      const strokeWidth = 20;
      const radius = (size - strokeWidth) / 2;
      const circumference = Math.PI * radius;
      const percentage = Math.min(value / maxValue, 1);
      const strokeDashoffset = circumference - (percentage * circumference);
      const accentColor = '#88da1c';

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Performance Meter</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Brand Moat Strength Score</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <div className="relative" style={{ width: size, height: size / 2 + 40 }}>
                <svg width={size} height={size / 2 + 20} className="overflow-visible">
                  <path d={`M ${strokeWidth / 2} ${size / 2} A ${radius} ${radius} 0 0 1 ${size - strokeWidth / 2} ${size / 2}`}
                    fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={strokeWidth} strokeLinecap="round" />
                  <motion.path d={`M ${strokeWidth / 2} ${size / 2} A ${radius} ${radius} 0 0 1 ${size - strokeWidth / 2} ${size / 2}`}
                    fill="none" stroke={accentColor} strokeWidth={strokeWidth} strokeLinecap="round"
                    strokeDasharray={circumference}
                    initial={{ strokeDashoffset: circumference }} animate={{ strokeDashoffset }}
                    transition={{ duration: 1.5, ease: [0.22, 1, 0.36, 1] }}
                    style={{ filter: `drop-shadow(0 0 10px ${accentColor}50)` }} />

                  {[0, 25, 50, 75, 100].map((tick, i) => {
                    const angle = (tick / 100) * 180 - 180;
                    const rad = (angle * Math.PI) / 180;
                    const x1 = size / 2 + (radius - 30) * Math.cos(rad);
                    const y1 = size / 2 + (radius - 30) * Math.sin(rad);
                    const x2 = size / 2 + (radius - 40) * Math.cos(rad);
                    const y2 = size / 2 + (radius - 40) * Math.sin(rad);
                    return (
                      <g key={i}>
                        <line x1={x1} y1={y1} x2={x2} y2={y2} stroke="rgba(255,255,255,0.3)" strokeWidth={2} />
                        <text x={size / 2 + (radius - 55) * Math.cos(rad)} y={size / 2 + (radius - 55) * Math.sin(rad)}
                          textAnchor="middle" dominantBaseline="middle" className="text-xs" style={{ fill: 'rgba(255,255,255,0.5)' }}>
                          {tick}
                        </text>
                      </g>
                    );
                  })}
                </svg>

                <motion.div className="absolute left-1/2 -translate-x-1/2 text-center" style={{ bottom: 0 }}
                  initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.8 }}>
                  <div className="text-4xl font-bold text-white">{value}</div>
                  <div className="text-sm mt-1 text-white/50">Brand Strength</div>
                </motion.div>
              </div>
            </div>

            <motion.p className="text-center text-white/60 text-sm mt-4 max-w-md mx-auto"
              initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }}>
              Strong brands consistently score 70+ on moat strength. Your competitors need years to catch up.
            </motion.p>
          </motion.div>
        </div>
      );
    };

    // ============ TIER 1: PERFORMANCE MATRIX (FROM LIBRARY) ============
    const PerformanceMatrixSlide = ({ data }) => {
      const items = [
        { label: 'Consistency', x: 80, y: 90, size: 24, color: '#88da1c' },
        { label: 'Storytelling', x: 70, y: 85, size: 20, color: '#22C55E' },
        { label: 'Visual ID', x: 60, y: 75, size: 18, color: '#3B82F6' },
        { label: 'Social Proof', x: 40, y: 60, size: 16, color: '#A855F7' },
        { label: 'Packaging', x: 30, y: 40, size: 14, color: '#F59E0B' },
      ];

      const size = 320;
      const padding = 40;
      const chartSize = size - padding * 2;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Strategic Matrix</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Brand Tactics: Impact vs Effort</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width={size} height={size} className="overflow-visible">
                <rect x={padding} y={padding} width={chartSize} height={chartSize} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={1} />

                <line x1={padding + chartSize / 2} y1={padding} x2={padding + chartSize / 2} y2={padding + chartSize}
                  stroke="rgba(255,255,255,0.3)" strokeWidth={1} strokeDasharray="4 4" />
                <line x1={padding} y1={padding + chartSize / 2} x2={padding + chartSize} y2={padding + chartSize / 2}
                  stroke="rgba(255,255,255,0.3)" strokeWidth={1} strokeDasharray="4 4" />

                {['Low Priority', 'Quick Wins', 'Avoid', 'Major Projects'].map((label, i) => {
                  const positions = [
                    { x: padding + chartSize * 0.25, y: padding + chartSize * 0.25 },
                    { x: padding + chartSize * 0.75, y: padding + chartSize * 0.25 },
                    { x: padding + chartSize * 0.25, y: padding + chartSize * 0.75 },
                    { x: padding + chartSize * 0.75, y: padding + chartSize * 0.75 },
                  ];
                  return (
                    <motion.text key={i} x={positions[i].x} y={positions[i].y} textAnchor="middle" dominantBaseline="middle"
                      className="text-xs" style={{ fill: 'rgba(255,255,255,0.3)' }}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.1 }}>
                      {label}
                    </motion.text>
                  );
                })}

                {items.map((item, i) => {
                  const cx = padding + (item.x / 100) * chartSize;
                  const cy = padding + ((100 - item.y) / 100) * chartSize;
                  return (
                    <motion.g key={i}>
                      <motion.circle cx={cx} cy={cy} r={item.size} fill={item.color} fillOpacity={0.3}
                        stroke={item.color} strokeWidth={2}
                        initial={{ scale: 0, opacity: 0 }} animate={{ scale: 1, opacity: 1 }}
                        transition={{ delay: 0.5 + i * 0.1, type: 'spring', stiffness: 200 }} />
                      <motion.text x={cx} y={cy} textAnchor="middle" dominantBaseline="middle"
                        className="text-xs font-medium" style={{ fill: '#fff' }}
                        initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.7 + i * 0.1 }}>
                        {item.label}
                      </motion.text>
                    </motion.g>
                  );
                })}

                <motion.text x={size / 2} y={size - 5} textAnchor="middle" className="text-sm" style={{ fill: '#fff' }}
                  initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>
                  Effort Required 
                </motion.text>
                <motion.text x={15} y={size / 2} textAnchor="middle" className="text-sm" style={{ fill: '#fff' }}
                  transform={`rotate(-90, 15, ${size / 2})`}
                  initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>
                  Impact on Moat 
                </motion.text>
              </svg>
            </div>

            <motion.div className="mt-6 flex flex-wrap justify-center gap-4"
              initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 1 }}>
              {items.map((item, i) => (
                <div key={i} className="flex items-center gap-2">
                  <div className="w-3 h-3 rounded-full" style={{ backgroundColor: item.color }} />
                  <span className="text-sm text-white/50">{item.label}</span>
                </div>
              ))}
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ STANDARD SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data }) => {
      const userName = getUserName();
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>{LESSON_CONFIG.duration} lesson</span>
            </div>
            <h1 className="text-4xl md:text-5xl text-black mb-4 title-font">{LESSON_CONFIG.title}</h1>
            <p className="text-lg text-gray-600">{window.getGreeting ? window.getGreeting(userName) : `Hey ${userName}!`}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl p-6 md:p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <h3 className="text-white font-semibold mb-4 flex items-center gap-2">
              <Icons.Star />
              <span>What you'll learn</span>
            </h3>
            <ul className="space-y-3">
              {data.learningGoals.map((goal, i) => (
                <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.4 + i * 0.1 }} className="flex items-start gap-3 text-white/80">
                  <div className="w-5 h-5 rounded-full flex items-center justify-center mt-0.5" style={{ background: 'var(--accent)' }}>
                    <Icons.Check />
                  </div>
                  <span>{goal}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="text-center">
          <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }}
            className="text-3xl md:text-4xl lg:text-5xl text-black mb-6 title-font leading-tight">
            {data.headline}
          </motion.h1>
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="text-lg text-gray-600 leading-relaxed max-w-2xl mx-auto">
            {data.subtext}
          </motion.p>
        </motion.div>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="text-3xl md:text-4xl text-black title-font">{data.title}</h2>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
          className="rounded-2xl p-6 md:p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
          <p className="text-white/90 text-lg leading-relaxed">{data.body}</p>
        </motion.div>
      </div>
    );

    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
            <Icons.Zap />
            <span>Real Example</span>
          </div>
          <h2 className="text-2xl md:text-3xl text-black title-font">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <div className="text-red-400 font-semibold mb-3 flex items-center gap-2">
              <Icons.X />
              <span>{data.before.label}</span>
            </div>
            <p className="text-white/80">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid var(--accent)' }}>
            <div className="font-semibold mb-3 flex items-center gap-2" style={{ color: 'var(--accent)' }}>
              <Icons.Check />
              <span>{data.after.label}</span>
            </div>
            <p className="text-white/80">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
          className="mt-4 text-center">
          <p className="text-gray-600 italic"> {data.insight}</p>
        </motion.div>
      </div>
    );

    const CardsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="text-2xl md:text-3xl text-black title-font">{data.title}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4">
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <h3 className="text-white font-semibold mb-2">{item.title}</h3>
              <p className="text-white/70 text-sm">{item.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const isCorrect = selected === data.correctIndex;

      const handleSelect = (index) => {
        if (showFeedback) return;
        setSelected(index);
        setShowFeedback(true);
        setTimeout(() => onAnswer?.(index === data.correctIndex), 2000);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Quick Check</span>
            </div>
            <h2 className="text-xl md:text-2xl text-black title-font">{data.question}</h2>
          </motion.div>
          <div className="space-y-3">
            {data.options.map((option, i) => {
              let borderColor = '#333';
              let bg = 'linear-gradient(135deg, #1a1a1a, #2d2d2d)';
              if (showFeedback && i === data.correctIndex) {
                borderColor = '#22C55E';
                bg = 'linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))';
              } else if (showFeedback && i === selected && !isCorrect) {
                borderColor = '#EF4444';
                bg = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))';
              }
              return (
                <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }} onClick={() => handleSelect(i)}
                  className="w-full text-left rounded-xl p-4 text-white transition-all"
                  style={{ background: bg, border: `2px solid ${borderColor}` }}>
                  <span className="flex items-center gap-3">
                    <span className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold"
                      style={{ background: 'rgba(255,255,255,0.1)' }}>
                      {String.fromCharCode(65 + i)}
                    </span>
                    <span>{option}</span>
                  </span>
                </motion.button>
              );
            })}
          </div>
          {showFeedback && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
              className="mt-6 rounded-xl p-4" style={{ background: isCorrect ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                border: `1px solid ${isCorrect ? '#22C55E' : '#EF4444'}` }}>
              <p className={`text-sm ${isCorrect ? 'text-green-400' : 'text-red-400'}`}>
                {isCorrect ? data.feedback.correct : data.feedback.incorrect}
              </p>
            </motion.div>
          )}
        </div>
      );
    };

    const CompletionSlide = ({ data }) => {
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      return (
        <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-4xl mx-auto py-6 text-center">
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', stiffness: 200 }}
            className="w-32 h-32 rounded-full flex items-center justify-center mb-6" style={{ background: 'var(--accent)' }}>
            <Icons.Check />
          </motion.div>
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="text-3xl md:text-4xl text-black title-font mb-4">
            Lesson Complete!
          </motion.h2>
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="text-gray-600 mb-8">
            You now understand why brand is the only competitive advantage that compounds forever.
          </motion.p>
          <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.4 }}
            className="w-48 h-48 rounded-2xl overflow-hidden">
            <video src={celebrationGif} autoPlay loop muted playsInline className="w-full h-full object-cover" />
          </motion.div>
        </div>
      );
    };

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(() => {
        const params = new URLSearchParams(window.location.search);
        return parseInt(params.get('slide')) || 0;
      });

      const goNext = useCallback(() => {
        if (currentSlide < slides.length - 1) setCurrentSlide(prev => prev + 1);
      }, [currentSlide]);

      const goPrev = useCallback(() => {
        if (currentSlide > 0) setCurrentSlide(prev => prev - 1);
      }, [currentSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') goNext();
          if (e.key === 'ArrowLeft') goPrev();
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [goNext, goPrev]);

      const renderSlide = (slide, index) => {
        const slideComponents = {
          'welcome': WelcomeSlide,
          'hook': HookSlide,
          'content': ContentSlide,
          'example': ExampleSlide,
          'cards': CardsSlide,
          'quiz': QuizSlide,
          'completion': CompletionSlide,
          'sankey-diagram': SankeyDiagramSlide,
          'funnel-chart': FunnelChartSlide,
          'radar-chart': RadarChartSlide,
          'pyramid-chart': PyramidChartSlide,
          'donut-chart': DonutChartSlide,
          'treemap-chart': TreeMapChartSlide,
          'gauge-chart': GaugeChartSlide,
          'performance-matrix': PerformanceMatrixSlide,
        };
        const Component = slideComponents[slide.type];
        return Component ? <Component data={slide} onAnswer={goNext} /> : null;
      };

      const slide = slides[currentSlide];
      const progress = ((currentSlide + 1) / slides.length) * 100;

      return (
        <div className="h-screen flex flex-col bg-white relative">
          {/* Progress bar */}
          <div className="absolute top-0 left-0 right-0 h-1 bg-gray-200 z-50">
            <motion.div className="h-full" style={{ background: 'var(--accent)' }}
              initial={{ width: 0 }} animate={{ width: `${progress}%` }} transition={{ duration: 0.3 }} />
          </div>

          {/* Slide content */}
          <div className="flex-1 overflow-auto slide-scroll relative">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.3 }} className="h-full">
                {renderSlide(slide, currentSlide)}
              </motion.div>
            </AnimatePresence>
            {__isAdmin && <AdminSlideReportButton slideIndex={currentSlide} slideType={slide.type} />}
          </div>

          {/* Navigation */}
          <div className="flex items-center justify-between px-6 py-4 border-t border-gray-100">
            <button onClick={goPrev} disabled={currentSlide === 0}
              className="flex items-center gap-2 px-4 py-2 rounded-lg transition-all disabled:opacity-30"
              style={{ background: currentSlide > 0 ? 'rgba(136, 218, 28, 0.1)' : 'transparent' }}>
              <Icons.ArrowLeft />
              <span className="text-sm font-medium">Back</span>
            </button>
            <span className="text-sm text-gray-400">{currentSlide + 1} / {slides.length}</span>
            <button onClick={goNext} disabled={currentSlide === slides.length - 1}
              className="flex items-center gap-2 px-4 py-2 rounded-lg transition-all disabled:opacity-30"
              style={{ background: 'var(--accent)', color: 'black' }}>
              <span className="text-sm font-medium">Next</span>
              <Icons.ArrowRight />
            </button>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
