<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Smallest Viable Market | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #10b981;
      --accent-dark: #059669;
      --accent-light: #34d399;
      --accent-rgb: 16, 185, 129;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'smallest-viable-market',
      title: 'The Smallest Viable Market',
      description: 'Why trying to sell to everyone means you sell to no one - and how to choose who to ignore.',
      accentColor: '#10b981',
      duration: '5 min',
      nextLesson: {
        id: 'nine-trust-levers',
        title: 'The 9 Trust Levers',
        teaser: 'Why customers can\'t tell you why they don\'t trust a site - but their wallet knows.'
      }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; }
    });
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{
            position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px',
            borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white',
            border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center',
            justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s'
          }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/>
            <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/>
            <path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/>
            <path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER ============

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Users: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Heart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      XCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>,
      CheckCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      Filter: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
      Mountain: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 3 4 8 5-5 5 15H2L8 3z"/></svg>,
      Megaphone: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m3 11 18-5v12L3 13v-2z"/><path d="M11.6 16.8a3 3 0 1 1-5.8-1.6"/></svg>,
      DollarSign: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Crown: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7z"/><path d="M4 16c0 2 1.5 4 8 4s8-2 8-4"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Quote: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/></svg>,
      Shuffle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="16 3 21 3 21 8"/><line x1="4" y1="20" x2="21" y2="3"/><polyline points="21 16 21 21 16 21"/><line x1="15" y1="15" x2="21" y2="21"/><line x1="4" y1="4" x2="9" y2="9"/></svg>
    };

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ value, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      const numericValue = parseFloat(value.toString().replace(/[^0-9.]/g, ''));
      const hasDecimal = value.toString().includes('.');

      useEffect(() => {
        let startTime;
        const animate = (currentTime) => {
          if (!startTime) startTime = currentTime;
          const progress = Math.min((currentTime - startTime) / duration, 1);
          const easeOut = 1 - Math.pow(1 - progress, 3);
          setCount(numericValue * easeOut);
          if (progress < 1) requestAnimationFrame(animate);
        };
        requestAnimationFrame(animate);
      }, [numericValue, duration]);

      return <span>{prefix}{hasDecimal ? count.toFixed(1) : Math.floor(count)}{suffix}</span>;
    };

    // ============ SLIDES DATA ============
    const slides = [
      { type: 'welcome', learningGoals: [
        'Why "for everyone" kills your conversion rate',
        'How Patagonia and Nike chose their smallest viable market',
        'The generous act of positioning: choosing who to ignore'
      ]},
      { type: 'hook', headline: 'Your fear of niching down is costing you millions.', subtext: 'Seth Godin said it best: "It\'s better to matter to a few than be ignored by many." Yet most entrepreneurs build stores that try to sell to everyone. Generic messaging. Broad positioning. No clear customer. The result? You matter to no one. Your store becomes invisible. Being for everyone means being for no one.', personImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/seth-godin-brian-bloom-xl.jpg', personName: 'Seth Godin' },
      { type: 'dilution-visual' },
      { type: 'patagonia-case' },
      { type: 'nike-timeline' },
      { type: 'conversion-math' },
      { type: 'positioning-flow' },
      { type: 'svm-framework' },
      { type: 'wallet-case' },
      { type: 'focus-math' },
      { type: 'elite-insight' },
      { type: 'quiz', question: 'What is the "smallest viable market"?', options: ['The absolute minimum number of customers to break even', 'The smallest group you can matter to enough to sustain your business', 'Your first 100 customers', 'People who can\'t afford your competitors'], correctIndex: 1, feedback: { correct: 'Exactly! It\'s the minimum number of people you need to matter deeply to. Not maximum reach - minimum depth of impact. That focus is what creates loyalty and word-of-mouth.', incorrect: 'Not quite. The smallest viable market isn\'t about breaking even or first customers - it\'s the smallest GROUP you can focus on mattering deeply to, rather than trying to appeal broadly to everyone.' }},
      { type: 'completion' }
    ];

    // ============ UNIQUE SLIDE COMPONENTS ============

    // Dilution Visual Slide - "For Everyone" vs "For Them"
    const DilutionVisualSlide = () => {
      const [showResult, setShowResult] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowResult(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <h2 className="slide-title text-2xl md:text-4xl text-black">The Smallest Viable Market</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-6">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
              <div className="text-center mb-4">
                <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold" style={{ background: 'rgba(239, 68, 68, 0.2)', color: '#ef4444' }}>
                  <Icons.Shuffle /> FOR EVERYONE
                </div>
              </div>
              <div className="flex justify-center gap-1 mb-4">
                {[...Array(20)].map((_, i) => (
                  <motion.div key={i} initial={{ opacity: 0 }} animate={{ opacity: 0.2 }} transition={{ delay: 0.3 + i * 0.02 }}
                    style={{ width: '12px', height: '12px', borderRadius: '50%', background: '#94a3b8' }} />
                ))}
              </div>
              <div className="text-center">
                <div className="text-neutral-400 text-sm mb-2">Scattered attention</div>
                <div className="text-2xl font-bold" style={{ color: '#ef4444' }}>INVISIBLE</div>
              </div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              <div className="text-center mb-4">
                <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-sm font-semibold" style={{ background: 'rgba(16, 185, 129, 0.2)', color: '#10b981' }}>
                  <Icons.Target /> FOR THEM
                </div>
              </div>
              <div className="flex justify-center gap-1 mb-4">
                {[...Array(5)].map((_, i) => (
                  <motion.div key={i} initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.5 + i * 0.1 }}
                    style={{ width: '24px', height: '24px', borderRadius: '50%', background: '#10b981', boxShadow: '0 0 20px rgba(16, 185, 129, 0.5)' }} />
                ))}
              </div>
              <div className="text-center">
                <div className="text-neutral-400 text-sm mb-2">Deep connection</div>
                <div className="text-2xl font-bold" style={{ color: '#10b981' }}>UNFORGETTABLE</div>
              </div>
            </motion.div>
          </div>

          <AnimatePresence>
            {showResult && (
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
                className="mt-6 text-center">
                <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold" style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981' }}>
                  <Icons.Lightbulb />
                  The minimum number of people you need to matter to in order to sustain your business
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // Patagonia Case Slide
    const PatagoniaCaseSlide = () => {
      const [showResult, setShowResult] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowResult(true), 2500);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981' }}>Case Study</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Patagonia's Choice</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4 mb-6">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
              <div className="flex items-center gap-2 mb-3">
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: 'rgba(239, 68, 68, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#ef4444' }}>
                  <Icons.XCircle />
                </div>
                <span className="text-white font-semibold text-sm">Generic Positioning</span>
              </div>
              <p className="text-neutral-400 text-sm leading-relaxed mb-3">"Quality outdoor clothing for everyone who loves nature."</p>
              <div style={{ background: 'rgba(239, 68, 68, 0.1)', borderRadius: '8px', padding: '12px', border: '1px solid rgba(239, 68, 68, 0.2)' }}>
                <div className="text-xs text-neutral-500">Result</div>
                <div className="text-sm" style={{ color: '#ef4444' }}>Ignored in a crowded market</div>
              </div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              <div className="flex items-center gap-2 mb-3">
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: 'rgba(16, 185, 129, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#10b981' }}>
                  <Icons.CheckCircle />
                </div>
                <span className="text-white font-semibold text-sm">Smallest Viable Market</span>
              </div>
              <p className="text-neutral-400 text-sm leading-relaxed mb-3">"For people who climb. Who care about the planet more than profit."</p>
              <div style={{ background: 'rgba(16, 185, 129, 0.1)', borderRadius: '8px', padding: '12px', border: '1px solid rgba(16, 185, 129, 0.2)' }}>
                <div className="text-xs text-neutral-500">Result</div>
                <div className="text-sm" style={{ color: '#10b981' }}>Rabid loyalty, premium pricing</div>
              </div>
            </motion.div>
          </div>

          <AnimatePresence>
            {showResult && (
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
                style={{ background: 'linear-gradient(135deg, #10b981, #059669)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                <div className="flex items-center justify-center gap-3">
                  <div className="text-white">
                    <div className="text-3xl font-bold"><AnimatedCounter value={1} prefix="$" suffix="B+" /></div>
                    <div className="text-xs text-white/80">Annual Revenue</div>
                  </div>
                  <div className="text-white/50">|</div>
                  <div className="text-white text-sm font-semibold">By choosing to ignore everyone else</div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // Nike Timeline Slide
    const NikeTimelineSlide = () => {
      const [activePhase, setActivePhase] = useState(0);
      const phases = [
        { year: '1964', title: 'Elite Runners', desc: 'Started with obsessive athletes who cared about milliseconds', size: '100s', color: '#10b981' },
        { year: '1970s', title: 'Running Clubs', desc: 'Word spread through clubs and coaches', size: '1,000s', color: '#14b8a6' },
        { year: '1980s', title: 'Athletes', desc: 'Expanded to all serious athletes', size: '100,000s', color: '#06b6d4' },
        { year: 'Today', title: 'Everyone', desc: 'Permission earned to serve the masses', size: '$200B', color: '#8b5cf6' }
      ];

      useEffect(() => {
        const timer = setInterval(() => setActivePhase(i => (i + 1) % phases.length), 2500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981' }}>Nike's Journey</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Start Small, Then Expand</h2>
          </motion.div>

          <div className="grid grid-cols-4 gap-2 mb-6">
            {phases.map((phase, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setActivePhase(i)}
                style={{
                  background: i === activePhase ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                  borderRadius: '12px', padding: '16px', cursor: 'pointer', position: 'relative', overflow: 'hidden',
                  textAlign: 'center', transition: 'all 0.3s ease',
                  boxShadow: i === activePhase ? `0 0 30px ${phase.color}30` : 'none'
                }}>
                {i === activePhase && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${phase.color}, transparent)` }} />}
                <div className="text-xs font-bold mb-1" style={{ color: i === activePhase ? phase.color : '#737373' }}>{phase.year}</div>
                <div className="text-sm font-bold mb-1" style={{ color: i === activePhase ? 'white' : '#171717' }}>{phase.title}</div>
                <div className="text-lg font-bold" style={{ color: phase.color }}>{phase.size}</div>
              </motion.div>
            ))}
          </div>

          <motion.div key={activePhase} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${phases[activePhase].color}, transparent)` }} />
            <p className="text-neutral-400">{phases[activePhase].desc}</p>
            <div className="mt-3 text-xs" style={{ color: phases[activePhase].color }}>
              {activePhase === 0 ? 'They earned permission to expand by MATTERING to a few hundred runners first' :
               activePhase === 3 ? 'They earned the right to serve everyone AFTER dominating small markets' :
               'Each expansion was earned, not assumed'}
            </div>
          </motion.div>
        </div>
      );
    };

    // Conversion Math Slide
    const ConversionMathSlide = () => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <h2 className="slide-title text-2xl md:text-4xl text-black">The Positioning Paradox</h2>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-4">
            {[
              { value: '3', suffix: '%', label: 'Conversion', subtext: 'Generic "for everyone" stores', color: '#94a3b8' },
              { value: '12', suffix: '%', label: 'Conversion', subtext: 'Smallest viable market focus', color: '#10b981' },
              { value: '4', suffix: 'x', label: 'Better Results', subtext: 'By choosing who to ignore', color: '#8b5cf6' }
            ].map((stat, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }}
                style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '28px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${stat.color}, transparent)` }} />
                <div className="text-5xl md:text-6xl font-bold mb-2" style={{ color: stat.color }}>
                  <AnimatedCounter value={stat.value} suffix={stat.suffix} />
                </div>
                <div className="text-white font-semibold mb-1">{stat.label}</div>
                <div className="text-neutral-400 text-xs">{stat.subtext}</div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // Positioning Flow Slide
    const PositioningFlowSlide = () => {
      const [activeStep, setActiveStep] = useState(0);
      const steps = [
        { label: 'VISITOR', icon: <Icons.Users />, color: '#94a3b8' },
        { label: 'ASK: Is this for me?', icon: <Icons.Filter />, color: '#f59e0b' },
        { label: 'NOT FOR YOU', result: 'Point elsewhere', icon: <Icons.XCircle />, color: '#ef4444' },
        { label: 'FOR YOU', result: 'Speak directly', icon: <Icons.CheckCircle />, color: '#10b981' }
      ];

      useEffect(() => {
        const timer = setInterval(() => setActiveStep(i => (i + 1) % steps.length), 2000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981' }}>The Generous Act</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Positioning Is Generous</h2>
          </motion.div>

          <div className="flex items-center justify-center gap-2 mb-6">
            {steps.map((step, i) => (
              <React.Fragment key={i}>
                <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 + i * 0.1 }}
                  onClick={() => setActiveStep(i)}
                  style={{
                    background: i === activeStep ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                    borderRadius: '12px', padding: '16px', cursor: 'pointer', position: 'relative', overflow: 'hidden',
                    textAlign: 'center', minWidth: '80px', transition: 'all 0.3s ease',
                    boxShadow: i === activeStep ? `0 0 20px ${step.color}30` : 'none'
                  }}>
                  {i === activeStep && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${step.color}, transparent)` }} />}
                  <div style={{ color: step.color, marginBottom: '4px' }}>{step.icon}</div>
                  <div className="text-xs font-bold" style={{ color: i === activeStep ? 'white' : '#171717' }}>{step.label}</div>
                  {step.result && <div className="text-xs mt-1" style={{ color: i === activeStep ? step.color : '#737373' }}>{step.result}</div>}
                </motion.div>
                {i < steps.length - 1 && <div style={{ color: '#d4d4d4' }}><Icons.ArrowRight /></div>}
              </React.Fragment>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
            <p className="text-neutral-400 text-sm mb-2">When you say "This isn't for you, here's who IS" - you're respecting people's time.</p>
            <div className="text-xs" style={{ color: '#10b981' }}>That honesty builds TRUST with your real customers</div>
          </motion.div>
        </div>
      );
    };

    // SVM Framework Slide
    const SVMFrameworkSlide = () => {
      const [activeStep, setActiveStep] = useState(0);
      const steps = [
        { num: 1, title: "Who CAN'T you help?", desc: "List everyone your product ISN'T for. Be brutal. If you sell premium skincare, you're not for people who want $5 drugstore creams.", icon: <Icons.XCircle />, color: '#ef4444', bgRgba: 'rgba(239, 68, 68, 0.2)' },
        { num: 2, title: "Who are you BEST for?", desc: "Who gets 10x value from your product? Who sees it as a no-brainer? That's your smallest viable market.", icon: <Icons.Target />, color: '#f59e0b', bgRgba: 'rgba(245, 158, 11, 0.2)' },
        { num: 3, title: "Speak ONLY to them", desc: "Rewrite your homepage, ads, and emails. Speak directly to that one group. Use their language.", icon: <Icons.Megaphone />, color: '#10b981', bgRgba: 'rgba(16, 185, 129, 0.2)' },
        { num: 4, title: "Ignore everyone else", desc: "When someone outside your market asks 'Is this for me?', the answer is no. Point them elsewhere.", icon: <Icons.Filter />, color: '#8b5cf6', bgRgba: 'rgba(139, 92, 246, 0.2)' }
      ];

      useEffect(() => {
        const timer = setInterval(() => setActiveStep(i => (i + 1) % steps.length), 3500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black">How To Find Your SVM</h2>
          </motion.div>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4">
            {steps.map((step, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setActiveStep(i)}
                style={{
                  background: i === activeStep ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                  borderRadius: '12px', padding: '16px', cursor: 'pointer', position: 'relative', overflow: 'hidden',
                  textAlign: 'center', transition: 'all 0.3s ease',
                  boxShadow: i === activeStep ? `0 0 30px ${step.color}20` : 'none'
                }}>
                {i === activeStep && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${step.color}, transparent)` }} />}
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: i === activeStep ? step.bgRgba : 'transparent', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 8px', color: step.color }}>
                  {step.icon}
                </div>
                <div className="text-xs font-bold mb-1" style={{ color: step.color }}>Step {step.num}</div>
                <div className="text-xs font-semibold" style={{ color: i === activeStep ? 'white' : '#171717' }}>{step.title}</div>
              </motion.div>
            ))}
          </div>

          <motion.div key={activeStep} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${steps[activeStep].color}, transparent)` }} />
            <div className="text-white font-bold mb-2">{steps[activeStep].title}</div>
            <p className="text-neutral-400 text-sm">{steps[activeStep].desc}</p>
          </motion.div>
        </div>
      );
    };

    // Wallet Case Study Slide
    const WalletCaseSlide = () => {
      const [showLift, setShowLift] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowLift(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(16, 185, 129, 0.1)', color: '#10b981' }}>Real Example</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Minimalist Wallets Store</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4 mb-4">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
              <div className="flex items-center gap-2 mb-3">
                <div style={{ width: '28px', height: '28px', borderRadius: '8px', background: 'rgba(239, 68, 68, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#ef4444' }}>
                  <Icons.XCircle />
                </div>
                <span className="text-white font-semibold text-sm">Before</span>
              </div>
              <p className="text-neutral-400 text-sm mb-3">"Premium wallets for modern professionals"</p>
              <div className="text-3xl font-bold" style={{ color: '#ef4444' }}>2.1%</div>
              <div className="text-xs text-neutral-500">conversion rate</div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              <div className="flex items-center gap-2 mb-3">
                <div style={{ width: '28px', height: '28px', borderRadius: '8px', background: 'rgba(16, 185, 129, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#10b981' }}>
                  <Icons.CheckCircle />
                </div>
                <span className="text-white font-semibold text-sm">After</span>
              </div>
              <p className="text-neutral-400 text-sm mb-3">"For designers and architects who carry 3 cards, not 30. If you love George Costanza's wallet, we're not for you."</p>
              <div className="text-3xl font-bold" style={{ color: '#10b981' }}>8.7%</div>
              <div className="text-xs text-neutral-500">conversion rate</div>
            </motion.div>
          </div>

          <AnimatePresence>
            {showLift && (
              <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
                style={{ background: 'linear-gradient(135deg, #10b981, #059669)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}>
                <div className="flex items-center justify-center gap-2">
                  <Icons.TrendingUp />
                  <span className="text-white font-bold text-xl">+<AnimatedCounter value={314} suffix="%" /> Lift</span>
                </div>
                <div className="text-white/80 text-sm mt-1">They chose to ignore people who want bulky wallets. Sales quadrupled.</div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // Focus Math Slide
    const FocusMathSlide = () => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black">The Niche Math</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4 mb-4">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: '#f5f5f5', borderRadius: '16px', padding: '24px', textAlign: 'center' }}>
              <div className="text-4xl font-bold text-neutral-400 mb-2">10,000</div>
              <div className="text-sm font-semibold text-neutral-700 mb-2">Broad Market</div>
              <div className="text-neutral-500 text-xs">2% convert = 200 customers</div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              <div className="text-4xl font-bold mb-2" style={{ color: '#10b981' }}>1,000</div>
              <div className="text-sm font-semibold text-white mb-2">Smallest Market</div>
              <div className="text-neutral-400 text-xs">15% convert = 150 customers</div>
            </motion.div>
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, #10b981, #8b5cf6, #10b981)' }} />
            <div className="text-5xl font-bold mb-2" style={{ color: '#10b981' }}><AnimatedCounter value={75} suffix="%" /></div>
            <div className="text-white font-semibold mb-1">Nearly Same Customers</div>
            <div className="text-neutral-400 text-sm">With 10x less noise, 10x less ad spend, 10x more loyalty</div>
          </motion.div>
        </div>
      );
    };

    // Elite Insight Slide
    const EliteInsightSlide = () => {
      return (
        <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '32px', width: '100%', position: 'relative', overflow: 'hidden', boxShadow: '0 0 60px rgba(16, 185, 129, 0.15)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, #10b981, #8b5cf6, #10b981)' }} />

            <div className="text-center mb-6">
              <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold" style={{ background: 'rgba(16, 185, 129, 0.2)', color: '#10b981' }}>
                <Icons.Lightbulb />
                The SVM Insight
              </div>
            </div>

            <blockquote className="text-xl md:text-2xl text-white text-center font-medium mb-6 leading-relaxed">
              "Strategy is choosing what NOT to do. Your smallest viable market forces that choice."
            </blockquote>

            <div className="grid grid-cols-4 gap-3">
              {[
                { icon: <Icons.XCircle />, label: 'Ignore', subtext: 'Most people' },
                { icon: <Icons.Target />, label: 'Focus', subtext: 'The few' },
                { icon: <Icons.Heart />, label: 'Matter', subtext: 'Deeply' },
                { icon: <Icons.Crown />, label: 'Dominate', subtext: 'Then expand' }
              ].map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 + i * 0.1 }}
                  style={{ background: 'rgba(255,255,255,0.05)', borderRadius: '12px', padding: '12px', textAlign: 'center' }}>
                  <div style={{ color: '#10b981', marginBottom: '4px' }}>{item.icon}</div>
                  <div className="text-white font-bold text-sm">{item.label}</div>
                  <div className="text-neutral-500 text-xs">{item.subtext}</div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ STANDARD SLIDES ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.personImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '52%', maxHeight: '400px', marginRight: '5%', marginBottom: '5%' }}>
            <img src={data.personImage} alt={data.personName || ''} className="h-full w-auto object-contain rounded-xl" style={{ opacity: 0.9 }} />
          </motion.div>
        )}
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">You now understand the power of the smallest viable market. Choose who you're NOT for. Speak directly to who you ARE for. Ignore the rest.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'dilution-visual': return <DilutionVisualSlide />;
          case 'patagonia-case': return <PatagoniaCaseSlide />;
          case 'nike-timeline': return <NikeTimelineSlide />;
          case 'conversion-math': return <ConversionMathSlide />;
          case 'positioning-flow': return <PositioningFlowSlide />;
          case 'svm-framework': return <SVMFrameworkSlide />;
          case 'wallet-case': return <WalletCaseSlide />;
          case 'focus-math': return <FocusMathSlide />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<LessonApp />);
  </script>
</body>
</html>
