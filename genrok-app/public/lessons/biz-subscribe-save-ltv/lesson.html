<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Subscribe & Save Cheat Code | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #8B5CF6; --accent-dark: #7C3AED; --accent-light: #A78BFA; --accent-rgb: 139, 92, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'biz-subscribe-save-ltv',
      title: 'The Subscribe & Save Cheat Code',
      description: 'Turn one-time buyers into recurring revenue',
      accentColor: '#8B5CF6',
      duration: '8 min',
      nextLesson: { id: 'biz-velocity-advantage', title: 'The Velocity Advantage', teaser: 'Why speed to value determines LTV destiny.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why frequency is the #1 LTV multiplier', 'The Subscribe & Save model that creates 12x revenue', 'How to turn ANY product into recurring revenue'] },
      { type: 'hook', headline: 'What if every customer automatically came back?', subtext: 'Most businesses fight for every sale. Smart businesses make the sale automatic. Instead of convincing customers to buy again and again, you convince them ONCE to subscribe. Then the revenue keeps flowing.' },
      { type: 'ltv-formula', title: 'The LTV Formula: Frequency is the Multiplier', formula: { aov: 'AOV', frequency: 'Frequency', margin: 'Margin' }, insight: 'Increasing AOV requires better products. Improving margin requires negotiating costs. But increasing FREQUENCY? That\'s pure leverage. 2x frequency = 2x LTV.' },
      { type: 'subscription-battle', title: 'One-Time vs Subscribe & Save', oneTime: { label: 'One-Time Purchase', amount: '$100', subtext: 'Customer buys once. You hope they come back.', color: '#6B7280' }, subscription: { label: 'Subscribe & Save', amount: '$1,200', subtext: '$100/month x 12 months = Automatic revenue.', color: '#8B5CF6' }, multiplier: '12x' },
      { type: 'compounding-effect', title: 'The Compounding Effect', scenario: '100 subscribers/month at $50/month (90% retention)', months: [
        { month: 1, mrr: 5000 }, { month: 3, mrr: 13500 }, { month: 6, mrr: 27000 }, { month: 12, mrr: 54000 }
      ], insight: 'Every new subscriber ADDS to your MRR. Old subscribers keep paying. Growth compounds month over month.' },
      { type: 'subscription-ideas', title: 'Beyond Consumables', traditional: [
        { name: 'Skincare', usage: 'Runs out monthly', icon: 'Droplet' },
        { name: 'Coffee', usage: 'Daily consumption', icon: 'Coffee' },
        { name: 'Supplements', usage: 'Daily use', icon: 'Pill' },
        { name: 'Pet Food', usage: 'Weekly refill', icon: 'PawPrint' }
      ], creative: [
        { name: 'Clothing', model: 'Seasonal refresh boxes', icon: 'Shirt' },
        { name: 'Electronics', model: 'Accessory subscriptions', icon: 'Smartphone' },
        { name: 'Fitness', model: 'Equipment + content', icon: 'Dumbbell' },
        { name: 'Home Decor', model: 'Seasonal updates', icon: 'Home' }
      ] },
      { type: 'subscription-benefits', title: 'Why Subscriptions Win', benefits: [
        { stat: '70-90%', label: 'Retention Rate', description: 'Once they subscribe, they stay' },
        { stat: '3-5x', label: 'Higher LTV', description: 'Compounding purchases over time' },
        { stat: '0', label: 'CAC for Renewals', description: 'No acquisition cost for repeat revenue' },
        { stat: 'Predictable', label: 'Revenue', description: 'Know exactly what\'s coming each month' }
      ] },
      { type: 'implementation-steps', title: 'Launch Subscribe & Save in 3 Steps', steps: [
        { number: 1, title: 'Identify Subscription Candidates', description: 'Products with regular replenishment cycles or ongoing value delivery', examples: ['Consumables that run out', 'Products with accessories', 'Services with content'] },
        { number: 2, title: 'Create Irresistible Incentives', description: 'Make subscribing feel like a no-brainer', examples: ['10-15% discount vs one-time', 'Free shipping for subscribers', 'Exclusive subscriber perks'] },
        { number: 3, title: 'Reduce Friction', description: 'Make subscribing effortless', examples: ['Easy skip/pause options', 'Flexible delivery schedules', 'Simple cancellation (builds trust)'] }
      ] },
      { type: 'quiz', question: 'Why is Subscribe & Save the most powerful LTV lever?', options: ['It increases average order value', 'It eliminates CAC for repeat purchases and locks in recurring revenue', 'It improves profit margins', 'It reduces product returns'], correctIndex: 1, feedback: { correct: 'Exactly. Subscriptions eliminate acquisition costs for repeat revenue and create predictable, compounding MRR. One sale becomes 12+ sales automatically.', incorrect: 'Not quite. While subscriptions can affect AOV and margins, the real power is eliminating CAC for repeat purchases and locking in recurring, predictable revenue.' } },
      { type: 'mindset-shift', title: 'The Subscription Mindset', insight: 'Stop thinking about single transactions. Start thinking about lifetime relationships. Every product you sell has subscription potential if you\'re creative enough. The question isn\'t "can I sell subscriptions?" It\'s "how do I make subscribing irresistible?"' },
      { type: 'completion', sources: ['Amazon Subscribe & Save Case Study', 'SaaS Metrics for Ecommerce', 'Subscription Economy Report'] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      RefreshCw: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
      DollarSign: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      BarChart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      Lock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>,
      Calendar: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      Repeat: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Multiply: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      Equal: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/></svg>,
    };

    // AnimatedCounter Component
    const AnimatedCounter = ({ value, prefix = '', suffix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseInt(value);
        if (isNaN(end)) { setCount(value); return; }
        const increment = end / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{prefix}{typeof count === 'number' ? count.toLocaleString() : count}{suffix}</span>;
    };

    // ============ WELCOME SLIDE ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    // ============ HOOK SLIDE ============
    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed mb-8">{data.subtext}</motion.p>

          {/* Traditional vs Subscription Flow */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />
            <div style={{ display: 'flex', flexDirection: 'column', gap: '20px' }}>
              <div>
                <div style={{ color: '#6B7280', fontSize: '11px', fontWeight: '600', letterSpacing: '0.05em', marginBottom: '8px' }}>TRADITIONAL</div>
                <div style={{ color: '#9CA3AF', fontSize: '14px' }}>Convince <span style={{ color: '#6B7280' }}>→</span> Buy <span style={{ color: '#6B7280' }}>→</span> Repeat <span style={{ color: '#6B7280' }}>→</span> Convince <span style={{ color: '#6B7280' }}>→</span> Buy <span style={{ color: '#6B7280' }}>→</span> Repeat...</div>
              </div>
              <div>
                <div style={{ color: '#8B5CF6', fontSize: '11px', fontWeight: '600', letterSpacing: '0.05em', marginBottom: '8px' }}>SUBSCRIPTION</div>
                <div style={{ color: '#FAFAFA', fontSize: '14px', fontWeight: '500' }}>Convince <span style={{ color: '#8B5CF6' }}>→</span> Subscribe <span style={{ color: '#10B981' }}>→</span> Buy <span style={{ color: '#10B981' }}>→</span> Buy <span style={{ color: '#10B981' }}>→</span> Buy <span style={{ color: '#10B981' }}>→</span> Buy...</div>
              </div>
            </div>
          </motion.div>
        </div>
      </div>
    );

    // ============ LTV FORMULA SLIDE ============
    const LTVFormulaSlide = ({ data }) => {
      const [activeElement, setActiveElement] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveElement(prev => (prev + 1) % 3);
        }, 2000);
        return () => clearInterval(timer);
      }, []);

      const elements = [
        { key: 'aov', label: 'AOV', description: 'How much they spend', icon: <Icons.DollarSign /> },
        { key: 'frequency', label: 'Frequency', description: 'How often they buy', icon: <Icons.RefreshCw />, highlight: true },
        { key: 'margin', label: 'Margin', description: 'How much you keep', icon: <Icons.BarChart /> }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          {/* Formula */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '32px', marginBottom: '32px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />

            <div style={{ textAlign: 'center', marginBottom: '32px' }}>
              <div style={{ fontFamily: 'Fraunces, serif', fontSize: '36px', fontWeight: '700', color: '#FAFAFA' }}>
                LTV = <span style={{ color: activeElement === 0 ? '#8B5CF6' : '#FAFAFA' }}>AOV</span> <span style={{ color: '#6B7280' }}>x</span> <span style={{ color: activeElement === 1 ? '#8B5CF6' : '#FAFAFA', textDecoration: activeElement === 1 ? 'underline' : 'none' }}>Frequency</span> <span style={{ color: '#6B7280' }}>x</span> <span style={{ color: activeElement === 2 ? '#8B5CF6' : '#FAFAFA' }}>Margin</span>
              </div>
            </div>

            <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '16px' }}>
              {elements.map((el, i) => (
                <motion.div key={el.key} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }}
                  style={{
                    background: activeElement === i ? (el.highlight ? 'rgba(139, 92, 246, 0.2)' : 'rgba(139, 92, 246, 0.1)') : 'rgba(255, 255, 255, 0.05)',
                    borderRadius: '12px',
                    padding: '20px',
                    textAlign: 'center',
                    border: activeElement === i ? '1px solid rgba(139, 92, 246, 0.4)' : '1px solid transparent',
                    transition: 'all 0.3s ease',
                    boxShadow: el.highlight && activeElement === i ? '0 0 30px rgba(139, 92, 246, 0.3)' : 'none'
                  }}>
                  <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: el.highlight ? '#8B5CF6' : 'rgba(255, 255, 255, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 12px', color: el.highlight ? 'white' : '#9CA3AF' }}>{el.icon}</div>
                  <div style={{ color: el.highlight ? '#A78BFA' : '#FAFAFA', fontSize: '16px', fontWeight: '600', marginBottom: '4px' }}>{el.label}</div>
                  <div style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '12px' }}>{el.description}</div>
                </motion.div>
              ))}
            </div>
          </motion.div>

          {/* Insight */}
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            style={{ background: 'rgba(139, 92, 246, 0.05)', borderRadius: '12px', padding: '20px', borderLeft: '4px solid #8B5CF6' }}>
            <p style={{ color: '#374151', fontSize: '15px', lineHeight: '1.7' }}>{data.insight}</p>
          </motion.div>
        </div>
      );
    };

    // ============ SUBSCRIPTION BATTLE SLIDE ============
    const SubscriptionBattleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

        <div style={{ display: 'grid', gridTemplateColumns: '1fr auto 1fr', gap: '24px', alignItems: 'center' }}>
          {/* One-Time */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
            style={{ background: 'linear-gradient(135deg, #374151, #1f2937)', borderRadius: '20px', padding: '32px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #6B7280, transparent)' }} />
            <div style={{ color: '#9CA3AF', fontSize: '11px', fontWeight: '600', letterSpacing: '0.05em', marginBottom: '16px' }}>{data.oneTime.label.toUpperCase()}</div>
            <div style={{ fontFamily: 'Fraunces, serif', fontSize: '48px', fontWeight: '900', color: '#9CA3AF', marginBottom: '12px' }}>{data.oneTime.amount}</div>
            <p style={{ color: 'rgba(255, 255, 255, 0.6)', fontSize: '14px' }}>{data.oneTime.subtext}</p>
          </motion.div>

          {/* VS */}
          <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            style={{ width: '60px', height: '60px', borderRadius: '50%', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: '#FAFAFA', fontSize: '14px', fontWeight: '700', border: '2px solid rgba(139, 92, 246, 0.3)' }}>
            VS
          </motion.div>

          {/* Subscription */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.15 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '32px', textAlign: 'center', position: 'relative', overflow: 'hidden', boxShadow: '0 0 40px rgba(139, 92, 246, 0.2)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />
            <div style={{ color: '#8B5CF6', fontSize: '11px', fontWeight: '600', letterSpacing: '0.05em', marginBottom: '16px' }}>{data.subscription.label.toUpperCase()}</div>
            <div style={{ fontFamily: 'Fraunces, serif', fontSize: '48px', fontWeight: '900', color: '#FAFAFA', marginBottom: '12px' }}>{data.subscription.amount}</div>
            <p style={{ color: 'rgba(255, 255, 255, 0.8)', fontSize: '14px' }}>{data.subscription.subtext}</p>
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
              style={{ marginTop: '16px', background: 'rgba(139, 92, 246, 0.2)', borderRadius: '8px', padding: '8px 16px', display: 'inline-block' }}>
              <span style={{ color: '#A78BFA', fontSize: '20px', fontWeight: '700' }}>{data.multiplier}</span>
              <span style={{ color: '#A78BFA', fontSize: '12px', marginLeft: '4px' }}>MORE REVENUE</span>
            </motion.div>
          </motion.div>
        </div>
      </div>
    );

    // ============ COMPOUNDING EFFECT SLIDE ============
    const CompoundingEffectSlide = ({ data }) => {
      const maxMRR = Math.max(...data.months.map(m => m.mrr));

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} style={{ textAlign: 'center', color: '#6B7280', fontSize: '14px', marginBottom: '32px' }}>{data.scenario}</motion.p>

          {/* Bar Chart */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '32px', marginBottom: '24px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />

            <div style={{ display: 'flex', justifyContent: 'space-around', alignItems: 'flex-end', height: '200px', paddingTop: '20px' }}>
              {data.months.map((month, i) => (
                <motion.div key={month.month} initial={{ height: 0 }} animate={{ height: `${(month.mrr / maxMRR) * 160}px` }} transition={{ delay: 0.3 + i * 0.15, duration: 0.8, ease: 'easeOut' }}
                  style={{ display: 'flex', flexDirection: 'column', alignItems: 'center' }}>
                  <div style={{ fontFamily: 'Fraunces, serif', fontSize: '16px', fontWeight: '700', color: '#FAFAFA', marginBottom: '8px' }}>
                    <AnimatedCounter value={month.mrr} prefix="$" suffix="" />
                  </div>
                  <motion.div
                    style={{
                      width: '60px',
                      height: '100%',
                      background: `linear-gradient(180deg, #8B5CF6, #7C3AED)`,
                      borderRadius: '8px 8px 0 0',
                      boxShadow: '0 0 20px rgba(139, 92, 246, 0.4)'
                    }}
                  />
                  <div style={{ color: '#9CA3AF', fontSize: '12px', marginTop: '8px' }}>Month {month.month}</div>
                </motion.div>
              ))}
            </div>
          </motion.div>

          {/* Insight */}
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.8 }}
            style={{ background: 'rgba(139, 92, 246, 0.05)', borderRadius: '12px', padding: '20px', borderLeft: '4px solid #8B5CF6' }}>
            <p style={{ color: '#374151', fontSize: '15px', lineHeight: '1.7' }}>{data.insight}</p>
          </motion.div>
        </div>
      );
    };

    // ============ SUBSCRIPTION IDEAS SLIDE ============
    const SubscriptionIdeasSlide = ({ data }) => {
      const [activeTab, setActiveTab] = useState(0);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          {/* Tab Toggle */}
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }}
            style={{ display: 'flex', justifyContent: 'center', gap: '12px', marginBottom: '24px' }}>
            {['Traditional', 'Creative'].map((tab, i) => (
              <button key={tab} onClick={() => setActiveTab(i)}
                style={{
                  padding: '10px 24px',
                  borderRadius: '10px',
                  border: 'none',
                  cursor: 'pointer',
                  fontSize: '14px',
                  fontWeight: '600',
                  background: activeTab === i ? 'linear-gradient(135deg, #8B5CF6, #7C3AED)' : '#F3F4F6',
                  color: activeTab === i ? 'white' : '#6B7280',
                  transition: 'all 0.3s ease'
                }}>
                {tab}
              </button>
            ))}
          </motion.div>

          {/* Content Grid */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />

            <AnimatePresence mode="wait">
              <motion.div key={activeTab} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }}
                style={{ display: 'grid', gridTemplateColumns: 'repeat(4, 1fr)', gap: '16px' }}>
                {(activeTab === 0 ? data.traditional : data.creative).map((item, i) => (
                  <motion.div key={item.name} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: i * 0.08 }}
                    style={{ background: 'rgba(139, 92, 246, 0.1)', borderRadius: '12px', padding: '20px', textAlign: 'center' }}>
                    <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: 'rgba(139, 92, 246, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 12px', color: '#A78BFA' }}>
                      <Icons.Repeat />
                    </div>
                    <h4 style={{ color: '#FAFAFA', fontSize: '14px', fontWeight: '600', marginBottom: '4px' }}>{item.name}</h4>
                    <p style={{ color: '#9CA3AF', fontSize: '11px' }}>{item.usage || item.model}</p>
                  </motion.div>
                ))}
              </motion.div>
            </AnimatePresence>
          </motion.div>
        </div>
      );
    };

    // ============ SUBSCRIPTION BENEFITS SLIDE ============
    const SubscriptionBenefitsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px' }}>
          {data.benefits.map((benefit, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />
              <div style={{ fontFamily: 'Fraunces, serif', fontSize: '32px', fontWeight: '900', color: '#8B5CF6', marginBottom: '4px' }}>{benefit.stat}</div>
              <div style={{ color: '#FAFAFA', fontSize: '14px', fontWeight: '600', marginBottom: '8px' }}>{benefit.label}</div>
              <p style={{ color: '#9CA3AF', fontSize: '13px' }}>{benefit.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // ============ IMPLEMENTATION STEPS SLIDE ============
    const ImplementationStepsSlide = ({ data }) => {
      const [activeStep, setActiveStep] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveStep(prev => (prev + 1) % data.steps.length);
        }, 4000);
        return () => clearInterval(timer);
      }, [data.steps.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>
            {data.steps.map((step, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setActiveStep(i)}
                style={{
                  background: activeStep === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white',
                  borderRadius: '16px',
                  padding: '20px 24px',
                  border: activeStep === i ? '1px solid rgba(139, 92, 246, 0.3)' : '1px solid #e5e7eb',
                  cursor: 'pointer',
                  transition: 'all 0.3s ease',
                  position: 'relative',
                  overflow: 'hidden'
                }}>
                {activeStep === i && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8B5CF6, transparent)' }} />}

                <div style={{ display: 'flex', gap: '16px' }}>
                  <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: activeStep === i ? '#8B5CF6' : 'rgba(139, 92, 246, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: activeStep === i ? 'white' : '#8B5CF6', fontWeight: '700', fontSize: '16px', flexShrink: 0 }}>{step.number}</div>
                  <div style={{ flex: 1 }}>
                    <h3 style={{ color: activeStep === i ? '#FAFAFA' : '#374151', fontSize: '16px', fontWeight: '700', marginBottom: '6px' }}>{step.title}</h3>
                    <p style={{ color: activeStep === i ? '#9CA3AF' : '#6B7280', fontSize: '13px', marginBottom: '12px' }}>{step.description}</p>
                    {activeStep === i && (
                      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }}
                        style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                        {step.examples.map((ex, j) => (
                          <span key={j} style={{ background: 'rgba(139, 92, 246, 0.1)', color: '#A78BFA', fontSize: '11px', padding: '4px 10px', borderRadius: '6px' }}>{ex}</span>
                        ))}
                      </motion.div>
                    )}
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // ============ MINDSET SHIFT SLIDE ============
    const MindsetShiftSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-8 md:px-16 max-w-3xl mx-auto text-center">
        <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }}
          style={{ width: '64px', height: '64px', borderRadius: '16px', background: 'linear-gradient(135deg, #8B5CF6, #7C3AED)', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '24px', boxShadow: '0 0 40px rgba(139, 92, 246, 0.3)' }}>
          <Icons.Repeat />
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-2xl md:text-3xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
          style={{ color: '#4B5563', fontSize: '16px', lineHeight: '1.8', maxWidth: '600px' }}>
          {data.insight}
        </motion.p>
      </div>
    );

    // ============ QUIZ SLIDE ============
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // ============ COMPLETION SLIDE ============
    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand the power of Subscribe & Save. Turn one-time buyers into recurring revenue machines.</motion.p>
        <motion.a initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} href={`/lessons/${LESSON_CONFIG.nextLesson.id}/lesson.html`} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4 block text-left hover:bg-neutral-800 transition-colors">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.a>
        {data.sources && data.sources.length > 0 && (
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.45 }} className="text-neutral-400 text-xs">Sources: {data.sources.join(', ')}</motion.p>
        )}
      </div>
    );

    // ============ RENDER SLIDE ============
    const renderSlide = (slide, index, onStart, userName, onShowGif, onHideGif) => {
      switch (slide.type) {
        case 'welcome': return <WelcomeSlide data={slide} onStart={onStart} userName={userName} onShowGif={onShowGif} onHideGif={onHideGif} />;
        case 'hook': return <HookSlide data={slide} />;
        case 'ltv-formula': return <LTVFormulaSlide data={slide} />;
        case 'subscription-battle': return <SubscriptionBattleSlide data={slide} />;
        case 'compounding-effect': return <CompoundingEffectSlide data={slide} />;
        case 'subscription-ideas': return <SubscriptionIdeasSlide data={slide} />;
        case 'subscription-benefits': return <SubscriptionBenefitsSlide data={slide} />;
        case 'implementation-steps': return <ImplementationStepsSlide data={slide} />;
        case 'mindset-shift': return <MindsetShiftSlide data={slide} />;
        case 'quiz': return <QuizSlide data={slide} onShowGif={onShowGif} onHideGif={onHideGif} />;
        case 'completion': return <CompletionSlide data={slide} />;
        default: return <div className="h-full flex items-center justify-center"><p>Unknown slide type: {slide.type}</p></div>;
      }
    };

    // ============ MAIN APP ============
    const App = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [gifState, setGifState] = useState({ visible: false, gif: null, height: '50%', side: 'right' });
      const userName = getUserName();

      const goNext = useCallback(() => { if (currentSlide < slides.length - 1) setCurrentSlide(prev => prev + 1); }, [currentSlide]);
      const goPrev = useCallback(() => { if (currentSlide > 0) setCurrentSlide(prev => prev - 1); }, [currentSlide]);

      const handleKeyDown = useCallback((e) => {
        if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); goNext(); }
        if (e.key === 'ArrowLeft') { e.preventDefault(); goPrev(); }
      }, [goNext, goPrev]);

      useEffect(() => { window.addEventListener('keydown', handleKeyDown); return () => window.removeEventListener('keydown', handleKeyDown); }, [handleKeyDown]);
      useEffect(() => { const url = new URL(window.location); url.searchParams.set('slide', currentSlide.toString()); window.history.replaceState({}, '', url); }, [currentSlide]);

      const showGif = useCallback((gif, height = '50%', side = 'right') => setGifState({ visible: true, gif, height, side }), []);
      const hideGif = useCallback(() => setGifState(prev => ({ ...prev, visible: false })), []);

      return (
        <div className="h-screen w-screen bg-white relative overflow-hidden">
          <AnimatePresence mode="wait">
            <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.3 }} className="h-full w-full">
              {renderSlide(slides[currentSlide], currentSlide, goNext, userName, showGif, hideGif)}
            </motion.div>
          </AnimatePresence>

          {currentSlide > 0 && (
            <>
              <button onClick={goPrev} className="absolute left-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/80 hover:bg-white shadow-lg transition-all z-50" style={{ backdropFilter: 'blur(8px)' }}><Icons.ArrowLeft /></button>
              <button onClick={goNext} className="absolute right-4 top-1/2 -translate-y-1/2 p-3 rounded-full bg-white/80 hover:bg-white shadow-lg transition-all z-50" style={{ backdropFilter: 'blur(8px)' }}><Icons.ArrowRight /></button>
            </>
          )}

          <div className="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-1.5 z-50">
            {slides.map((_, i) => (
              <button key={i} onClick={() => setCurrentSlide(i)} className={`w-2 h-2 rounded-full transition-all ${i === currentSlide ? 'w-6' : ''}`} style={{ background: i === currentSlide ? 'var(--accent)' : '#D1D5DB' }} />
            ))}
          </div>

          <AnimatePresence>
            {gifState.visible && gifState.gif && (
              <motion.div initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 50 }} transition={{ duration: 0.4 }}
                className={`absolute bottom-0 ${gifState.side === 'left' ? 'left-4' : 'right-4'} z-10 pointer-events-none`}
                style={{ height: gifState.height, maxHeight: '500px' }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
                  <source src={gifState.gif} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
