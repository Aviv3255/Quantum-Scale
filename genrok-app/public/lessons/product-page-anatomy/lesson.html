<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The 5-Element Product Page That Converts | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #0ea5e9;
      --accent-dark: #0284c7;
      --accent-light: #38bdf8;
      --accent-rgb: 14, 165, 233;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'product-page-anatomy',
      title: 'The 5-Element Product Page That Converts',
      description: 'Hero section, consolidated offer, clear benefits, integrated trust, objection handling. Get all 5 elements right and watch your CVR skyrocket.',
      accentColor: '#0ea5e9',
      duration: '6 min',
      nextLesson: {
        id: 'leaky-bucket-audit',
        title: 'The $50,000 Hole in Your Funnel',
        teaser: 'Run the 4-step funnel audit. Find where visitors leak. Plug the holes. Watch revenue explode.'
      }
    };

    // ============ CONFIGURATION ARRAYS ============
    const PAGE_ELEMENTS = [
      {
        id: 1,
        name: 'Hero Section',
        icon: 'Image',
        color: '#0ea5e9',
        description: 'Clear headline, compelling sub-headline, high-quality imagery. First impression is everything.',
        tactics: ['Clear promise headline', 'Credibility sub-headline', 'In-context imagery', 'Above the fold']
      },
      {
        id: 2,
        name: 'Consolidated Offer',
        icon: 'Package',
        color: '#10b981',
        description: 'Variants, quantity bumps, subscribe & save - all visible at once. Don\'t hide behind dropdowns.',
        tactics: ['All variants visible', 'Quantity tiers shown', 'Subscribe toggle', 'Price savings highlighted']
      },
      {
        id: 3,
        name: 'Clear Benefits',
        icon: 'CheckCircle',
        color: '#f59e0b',
        description: 'Icons + punchy lines. Benefits not features. Scannable wins over walls of text.',
        tactics: ['Icon-based benefits', 'Outcomes not specs', 'Expandable accordions', 'Top 3 prioritized']
      },
      {
        id: 4,
        name: 'Integrated Trust',
        icon: 'Shield',
        color: '#8b5cf6',
        description: 'Reviews above fold, UGC photos, policy badges - all integrated, not scattered.',
        tactics: ['Featured reviews up top', 'Real customer photos', 'Policy trust badges', 'Social proof numbers']
      },
      {
        id: 5,
        name: 'Objection Handling',
        icon: 'HelpCircle',
        color: '#ec4899',
        description: 'Answer "How would I use this?" with recipes, tutorials, styling tips.',
        tactics: ['Usage examples', 'Recipe cards', 'Tutorial content', 'Styling guides']
      }
    ];

    const HERO_STATS = [
      { value: 70, suffix: '%', label: 'Bounce if Unclear', subtext: 'Within first 3 seconds' },
      { value: 3, suffix: 'x', label: 'Higher Attention', subtext: 'With in-context imagery' },
      { value: 91, suffix: '%', label: 'Judge by Visuals', subtext: 'Before reading copy' }
    ];

    const FRAMEWORK_STATS = [
      { value: 127, prefix: '+', suffix: '%', label: 'Average CVR Lift', subtext: 'When all 5 elements optimized' },
      { value: 3, suffix: ' sec', label: 'Decision Window', subtext: 'Get it right or they bounce' },
      { value: 5, suffix: '/5', label: 'Elements Needed', subtext: 'Miss one, conversion suffers' }
    ];

    const OFFER_COMPARISON = {
      scattered: {
        variants: 'Hidden in dropdown',
        quantity: 'Tiny +/- buttons',
        subscribe: 'Mentioned in fine print',
        savings: 'Not highlighted',
        cvr: '2.1%',
        aov: '$42'
      },
      consolidated: {
        variants: 'All visible as tiles',
        quantity: 'Tiered pricing (Buy 2 Save 15%)',
        subscribe: 'Toggle switch, saves 20%',
        savings: '"$12 saved!" in green',
        cvr: '3.8%',
        aov: '$61'
      }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') {
        __isAdmin = e.data.isAdmin;
      }
    });
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button
          onClick={handleReport}
          title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{
            position: 'absolute',
            top: '12px',
            right: '12px',
            width: '32px',
            height: '32px',
            borderRadius: '8px',
            backgroundColor: 'rgba(239, 68, 68, 0.9)',
            color: 'white',
            border: 'none',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            opacity: 0.6,
            transition: 'opacity 0.2s, transform 0.2s',
            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
          }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/>
            <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/>
            <path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/>
            <path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Image: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><circle cx="9" cy="9" r="2"/><path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"/></svg>,
      Package: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
      CheckCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      Shield: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      HelpCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><path d="M12 17h.01"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      Layout: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></svg>,
    };

    const ElementIcons = {
      Image: Icons.Image,
      Package: Icons.Package,
      CheckCircle: Icons.CheckCircle,
      Shield: Icons.Shield,
      HelpCircle: Icons.HelpCircle
    };

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ value, prefix = '', suffix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let startTime;
        const animate = (timestamp) => {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / duration, 1);
          setCount(Math.floor(progress * value));
          if (progress < 1) requestAnimationFrame(animate);
        };
        requestAnimationFrame(animate);
      }, [value, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // ============ SLIDES DATA ============
    const slides = [
      { type: 'welcome', learningGoals: [
        'The 5 essential elements every high-converting product page must have',
        'How to consolidate variants, upsells, and subscriptions into one visible offer',
        'Why scattered trust signals kill conversion (and how to integrate them properly)'
      ]},
      { type: 'hook', headline: 'Your product page has 3 seconds to convince someone to stay. Most fail in 1.5.', subtext: 'Why? They bury the offer. Hide the variants. Scatter reviews at the bottom. Make benefits vague. Force visitors to hunt for answers. High-converting pages don\'t make you work. They guide you through 5 critical elements in perfect order. Miss one? Conversion tanks.' },
      { type: 'mentor', title: 'The 5 Elements of a Converting Product Page', body: 'Element 1: Hero Section (clear headline, compelling sub-headline, high-quality imagery). Element 2: Consolidated Offer Block (variants, quantity bumps, subscribe & save - all visible). Element 3: Clear Benefits (icons, punchy lines, expandable accordions). Element 4: Integrated Trust (top reviews using "At first I thought" framework, UGC, policy info). Element 5: Objection Handling (recipes/tutorials answering "How would I use this?"). Get all 5 right and CVR soars.' },
      { type: 'five-elements-overview' },
      { type: 'element-detail', elementIndex: 0 },
      { type: 'hero-stats' },
      { type: 'element-detail', elementIndex: 1 },
      { type: 'offer-comparison' },
      { type: 'element-detail', elementIndex: 2 },
      { type: 'element-detail', elementIndex: 3 },
      { type: 'element-detail', elementIndex: 4 },
      { type: 'example', scenario: 'Before/After: Protein Powder Page', before: { label: 'Missing Elements', text: 'Hero: Generic "Premium Protein" headline\nOffer: Flavors in dropdown, no subscribe option\nBenefits: Listed as bullet points (boring)\nTrust: Reviews buried at bottom\nObjection: No usage examples\n\nCVR: 1.9%' }, after: { label: 'All 5 Elements Optimized', text: 'Hero: "Protein That Actually Tastes Good"\nOffer: Flavor tiles, subscribe saves 20%, buy 3 save 25%\nBenefits: Icons (25g protein, No chalky taste, Vegan options)\nTrust: 3 featured reviews above fold, 4.9 from 18K\nObjection: 5 recipe cards shown\n\nCVR: 4.7% (+147%)' }, insight: 'Same product. 5 elements optimized. Conversion more than doubled.' },
      { type: 'framework-stats' },
      { type: 'elite-insight' },
      { type: 'quiz', question: 'Which element is most commonly missing from product pages that hurts conversion?', options: ['High-quality hero images', 'Consolidated offer block showing all variants/options visibly', 'Detailed product specifications', 'Multiple color schemes'], correctIndex: 1, feedback: { correct: 'Exactly! Most stores hide variants in dropdowns, bury subscribe options, and scatter the offer. Consolidating everything into ONE visible offer block can double CVR instantly.', incorrect: 'Not quite. The most common miss is the consolidated offer block. Most stores hide variants in dropdowns, bury quantity discounts, and make subscribe & save an afterthought. Show it all at once and watch conversion soar.' }},
      { type: 'completion' }
    ];

    // ============ SLIDE COMPONENTS ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    const MentorSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    // ============ FIVE ELEMENTS OVERVIEW SLIDE ============
    const FiveElementsOverviewSlide = () => {
      const [activeIndex, setActiveIndex] = useState(0);

      useEffect(() => {
        const interval = setInterval(() => {
          setActiveIndex(prev => (prev + 1) % 5);
        }, 2000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">
            The 5-Element Framework
          </motion.h2>

          <div className="grid grid-cols-1 md:grid-cols-5 gap-3">
            {PAGE_ELEMENTS.map((element, i) => {
              const IconComponent = ElementIcons[element.icon];
              const isActive = activeIndex === i;
              return (
                <motion.div
                  key={element.id}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.08 }}
                  style={{
                    background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white',
                    borderRadius: '16px',
                    padding: '20px 16px',
                    border: isActive ? `2px solid ${element.color}` : '2px solid #e5e5e5',
                    boxShadow: isActive ? `0 0 30px ${element.color}30` : 'none',
                    transition: 'all 0.4s ease',
                    position: 'relative',
                    textAlign: 'center'
                  }}
                >
                  {/* Top accent line */}
                  <div style={{
                    position: 'absolute',
                    top: 0, left: 0, right: 0, height: '3px',
                    background: isActive ? `linear-gradient(90deg, transparent, ${element.color}, transparent)` : 'transparent',
                    borderRadius: '16px 16px 0 0'
                  }} />

                  <div style={{
                    width: '48px', height: '48px', borderRadius: '12px',
                    background: isActive ? `linear-gradient(135deg, ${element.color}, ${element.color}dd)` : '#f5f5f5',
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    margin: '0 auto 12px',
                    color: isActive ? 'white' : '#6b7280'
                  }}>
                    {IconComponent && <IconComponent />}
                  </div>

                  <div style={{
                    background: isActive ? element.color : '#d4d4d4',
                    color: 'white',
                    width: '24px', height: '24px', borderRadius: '6px',
                    display: 'flex', alignItems: 'center', justifyContent: 'center',
                    fontSize: '12px', fontWeight: 700,
                    margin: '0 auto 8px'
                  }}>
                    {element.id}
                  </div>

                  <div style={{
                    color: isActive ? 'white' : '#1a1a1a',
                    fontWeight: 700,
                    fontSize: '14px',
                    fontFamily: 'Fraunces, serif'
                  }}>
                    {element.name}
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // ============ ELEMENT DETAIL SLIDE ============
    const ElementDetailSlide = ({ data }) => {
      const element = PAGE_ELEMENTS[data.elementIndex];
      const IconComponent = ElementIcons[element.icon];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              borderRadius: '20px',
              padding: '32px',
              border: `2px solid ${element.color}40`,
              position: 'relative',
              overflow: 'hidden'
            }}
          >
            {/* Top accent line */}
            <div style={{
              position: 'absolute',
              top: 0, left: 0, right: 0, height: '4px',
              background: `linear-gradient(90deg, transparent, ${element.color}, transparent)`
            }} />

            {/* Header */}
            <div style={{ display: 'flex', alignItems: 'center', gap: '16px', marginBottom: '24px' }}>
              <div style={{
                width: '60px', height: '60px', borderRadius: '16px',
                background: `linear-gradient(135deg, ${element.color}, ${element.color}dd)`,
                display: 'flex', alignItems: 'center', justifyContent: 'center',
                color: 'white',
                boxShadow: `0 0 30px ${element.color}40`
              }}>
                {IconComponent && <IconComponent />}
              </div>
              <div>
                <div style={{
                  background: element.color,
                  color: 'white',
                  padding: '4px 12px',
                  borderRadius: '20px',
                  fontSize: '11px',
                  fontWeight: 700,
                  display: 'inline-block',
                  marginBottom: '8px'
                }}>
                  ELEMENT #{element.id}
                </div>
                <h3 style={{ color: 'white', fontSize: '28px', fontWeight: 800, fontFamily: 'Fraunces, serif' }}>
                  {element.name}
                </h3>
              </div>
            </div>

            {/* Description */}
            <p style={{ color: '#d4d4d4', fontSize: '16px', lineHeight: 1.7, marginBottom: '24px' }}>
              {element.description}
            </p>

            {/* Tactics */}
            <div>
              <div style={{ color: '#9ca3af', fontSize: '11px', fontWeight: 600, marginBottom: '12px', textTransform: 'uppercase', letterSpacing: '0.1em' }}>
                Key Requirements
              </div>
              <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                {element.tactics.map((tactic, i) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, scale: 0.9 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: 0.2 + i * 0.1 }}
                    style={{
                      background: `${element.color}20`,
                      border: `1px solid ${element.color}40`,
                      color: element.color,
                      padding: '8px 16px',
                      borderRadius: '8px',
                      fontSize: '13px',
                      fontWeight: 500
                    }}
                  >
                    {tactic}
                  </motion.div>
                ))}
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ HERO STATS SLIDE ============
    const HeroStatsSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
          Hero Section Impact
        </motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {HERO_STATS.map((stat, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 + i * 0.1 }}
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                borderRadius: '16px',
                padding: '24px',
                textAlign: 'center',
                border: '1px solid rgba(14, 165, 233, 0.2)'
              }}
            >
              <div style={{ color: '#0ea5e9', fontSize: '48px', fontWeight: 800, marginBottom: '8px', fontFamily: 'Fraunces, serif' }}>
                <AnimatedCounter value={stat.value} suffix={stat.suffix} />
              </div>
              <div style={{ color: 'white', fontSize: '16px', fontWeight: 600, marginBottom: '4px' }}>{stat.label}</div>
              <div style={{ color: '#9ca3af', fontSize: '13px' }}>{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // ============ OFFER COMPARISON SLIDE ============
    const OfferComparisonSlide = () => {
      const [showResult, setShowResult] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowResult(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      const rows = ['variants', 'quantity', 'subscribe', 'savings'];
      const labels = { variants: 'Variants', quantity: 'Quantity', subscribe: 'Subscribe', savings: 'Savings' };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
            Scattered vs Consolidated Offer
          </motion.h2>

          <div className="grid md:grid-cols-2 gap-6 mb-6">
            {/* Scattered */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.1 }}
              style={{
                background: 'linear-gradient(135deg, #fef2f2, #fee2e2)',
                borderRadius: '16px',
                padding: '24px',
                border: '2px solid #fecaca'
              }}
            >
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '16px' }}>
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: '#ef4444', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
                  <Icons.X />
                </div>
                <span style={{ fontWeight: 700, color: '#dc2626', fontSize: '16px' }}>Scattered Offer</span>
              </div>
              {rows.map((key, i) => (
                <motion.div
                  key={key}
                  initial={{ opacity: 0, x: -10 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.2 + i * 0.1 }}
                  style={{
                    display: 'flex', justifyContent: 'space-between',
                    padding: '8px 0', borderBottom: i < rows.length - 1 ? '1px solid #fecaca' : 'none'
                  }}
                >
                  <span style={{ color: '#991b1b', fontSize: '13px' }}>{labels[key]}</span>
                  <span style={{ color: '#dc2626', fontSize: '13px', fontWeight: 500 }}>{OFFER_COMPARISON.scattered[key]}</span>
                </motion.div>
              ))}
            </motion.div>

            {/* Consolidated */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2 }}
              style={{
                background: 'linear-gradient(135deg, #f0fdf4, #dcfce7)',
                borderRadius: '16px',
                padding: '24px',
                border: '2px solid #bbf7d0'
              }}
            >
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '16px' }}>
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: '#10b981', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
                  <Icons.Check />
                </div>
                <span style={{ fontWeight: 700, color: '#059669', fontSize: '16px' }}>Consolidated Block</span>
              </div>
              {rows.map((key, i) => (
                <motion.div
                  key={key}
                  initial={{ opacity: 0, x: 10 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.3 + i * 0.1 }}
                  style={{
                    display: 'flex', justifyContent: 'space-between',
                    padding: '8px 0', borderBottom: i < rows.length - 1 ? '1px solid #bbf7d0' : 'none'
                  }}
                >
                  <span style={{ color: '#166534', fontSize: '13px' }}>{labels[key]}</span>
                  <span style={{ color: '#059669', fontSize: '13px', fontWeight: 500 }}>{OFFER_COMPARISON.consolidated[key]}</span>
                </motion.div>
              ))}
            </motion.div>
          </div>

          {/* Result comparison */}
          <AnimatePresence>
            {showResult && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                style={{
                  background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                  borderRadius: '12px',
                  padding: '16px 24px',
                  display: 'flex', justifyContent: 'space-around', alignItems: 'center'
                }}
              >
                <div style={{ textAlign: 'center' }}>
                  <div style={{ color: '#ef4444', fontSize: '24px', fontWeight: 800 }}>2.1% CVR</div>
                  <div style={{ color: '#9ca3af', fontSize: '12px' }}>$42 AOV</div>
                </div>
                <div style={{ color: '#10b981', fontSize: '24px' }}>
                  <Icons.ArrowRight />
                </div>
                <div style={{ textAlign: 'center' }}>
                  <div style={{ color: '#10b981', fontSize: '24px', fontWeight: 800 }}>3.8% CVR</div>
                  <div style={{ color: '#9ca3af', fontSize: '12px' }}>$61 AOV (+81%)</div>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // ============ EXAMPLE SLIDE ============
    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Real Example</span>
          <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #fef2f2, #fee2e2)', border: '2px solid #fecaca' }}>
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div><span className="font-semibold text-red-700 text-sm">{data.before.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed whitespace-pre-line">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #f0fdf4, #dcfce7)', border: '2px solid #bbf7d0' }}>
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white"><Icons.Check /></div><span className="font-semibold text-green-700 text-sm">{data.after.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed whitespace-pre-line">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <p className="text-neutral-300 text-sm flex items-center justify-center gap-2"><Icons.Zap />{data.insight}</p>
        </motion.div>
      </div>
    );

    // ============ FRAMEWORK STATS SLIDE ============
    const FrameworkStatsSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
          The 5-Element Impact
        </motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {FRAMEWORK_STATS.map((stat, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 + i * 0.1 }}
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                borderRadius: '16px',
                padding: '24px',
                textAlign: 'center',
                border: '1px solid rgba(14, 165, 233, 0.2)'
              }}
            >
              <div style={{ color: '#0ea5e9', fontSize: '48px', fontWeight: 800, marginBottom: '8px', fontFamily: 'Fraunces, serif' }}>
                <AnimatedCounter value={stat.value} prefix={stat.prefix || ''} suffix={stat.suffix} />
              </div>
              <div style={{ color: 'white', fontSize: '16px', fontWeight: 600, marginBottom: '4px' }}>{stat.label}</div>
              <div style={{ color: '#9ca3af', fontSize: '13px' }}>{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // ============ ELITE INSIGHT SLIDE ============
    const EliteInsightSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '20px',
            padding: '32px',
            textAlign: 'center',
            border: '2px solid rgba(14, 165, 233, 0.3)',
            boxShadow: '0 0 40px rgba(14, 165, 233, 0.15)'
          }}
        >
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px', marginBottom: '16px' }}>
            <Icons.Lightbulb />
            <span style={{ color: '#0ea5e9', fontSize: '12px', fontWeight: 700, textTransform: 'uppercase', letterSpacing: '0.1em' }}>Elite Insight</span>
          </div>
          <h3 style={{ color: 'white', fontSize: '28px', fontWeight: 800, marginBottom: '16px', fontFamily: 'Fraunces, serif' }}>
            "The Consolidation Paradox"
          </h3>
          <p style={{ color: '#d4d4d4', fontSize: '16px', lineHeight: 1.8, marginBottom: '24px' }}>
            Most stores think they need more options, more pages, more clicks. The truth? Consolidation converts. Show everything at once. Variants as tiles, not dropdowns. Quantity tiers visible, not hidden. Subscribe toggle prominent, not buried. The visitor who can see all options decides faster than the one who has to hunt. Make the decision easy by making the offer visible.
          </p>
          <div style={{
            display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px',
            background: 'rgba(14, 165, 233, 0.1)',
            border: '1px solid rgba(14, 165, 233, 0.3)',
            padding: '12px 20px',
            borderRadius: '12px'
          }}>
            <Icons.Layout />
            <span style={{ color: '#0ea5e9', fontSize: '14px', fontWeight: 600 }}>
              All 5 elements. All visible. All converting.
            </span>
          </div>
        </motion.div>
      </div>
    );

    // ============ QUIZ SLIDE ============
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // ============ COMPLETION SLIDE ============
    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Product Page Mastered</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">You now have the 5-element product page framework. Apply all 5. Don't skip any. Watch your conversion rate climb.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      // Handle URL param for direct slide navigation
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const slideParam = params.get('slide');
        if (slideParam) {
          const slideIndex = parseInt(slideParam, 10);
          if (!isNaN(slideIndex) && slideIndex >= 0 && slideIndex < slides.length) {
            setCurrentSlide(slideIndex);
          }
        }
      }, []);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'mentor': return <MentorSlide data={slide} />;
          case 'five-elements-overview': return <FiveElementsOverviewSlide />;
          case 'element-detail': return <ElementDetailSlide data={slide} />;
          case 'hero-stats': return <HeroStatsSlide />;
          case 'offer-comparison': return <OfferComparisonSlide />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'framework-stats': return <FrameworkStatsSlide />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
