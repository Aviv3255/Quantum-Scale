<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Emotional Problem | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #f97316;
      --accent-dark: #ea580c;
      --accent-light: #fb923c;
      --accent-rgb: 249, 115, 22;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes pulse-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
    @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    // Animated Counter Component
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000, decimals = 0 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(decimals > 0 ? parseFloat(start.toFixed(decimals)) : Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration, decimals]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    const LESSON_CONFIG = {
      id: 'emotional-problem',
      title: 'The Emotional Problem',
      description: 'You\'re not selling a product. You\'re solving an emotional problem people didn\'t know they had.',
      accentColor: '#f97316',
      duration: '5 min',
      nextLesson: {
        id: 'emotional-gap',
        title: 'The Emotional Gap',
        teaser: 'Why mapping your competitors by feeling (not features) reveals billion-dollar opportunities.'
      }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; }
    });
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Heart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Eye: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      Star: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Package: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
      Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Brain: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Filter: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      DollarSign: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: [
        'Why The Oodie isn\'t really selling wearable blankets',
        'The 4 foundational questions that define your entire brand',
        'How emotional problems create brand filters for every decision'
      ]},
      { type: 'hook', headline: 'The Oodie doesn\'t sell wearable blankets. They sell comfort and peace during anxiety and lockdown.', subtext: 'This isn\'t marketing fluff. This is the difference between a commodity and a brand. Every successful brand solves an emotional problem first, practical problem second. The Oodie could be anything - a pillow, a chair, a candle. What they\'re really selling is the feeling. That\'s what people pay for.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Oodie-Logo-RGB-R.webp', brandName: 'The Oodie' },
      { type: 'emotional-transform', title: 'The Emotional Transformation', before: { state: 'Anxious & Cold', emotions: ['Isolated', 'Stressed', 'Uncomfortable', 'Uncertain'] }, after: { state: 'Warm & Safe', emotions: ['Comforted', 'Peaceful', 'Cozy', 'Protected'] }, insight: 'The product is just the vehicle. The transformation is what they pay for.' },
      { type: 'stat-showcase', title: 'The Oodie\'s Real Business', stats: [
        { value: 200, suffix: 'M+', label: 'Brand Value', subtext: 'Built on emotional positioning' },
        { value: 89, prefix: '$', label: 'Product Price', subtext: 'For infinite comfort' },
        { value: 1, label: 'Core Emotion', subtext: 'Peace during chaos' }
      ]},
      { type: 'content', title: 'The Product Is The Vehicle', body: 'Your product is just the delivery mechanism for the emotion you\'re selling. People don\'t buy drills. They buy the feeling of being a competent homeowner. They don\'t buy Peloton bikes. They buy the identity of being someone who prioritizes health. The Oodie understood: people were anxious, isolated, cold. The wearable blanket was just the vehicle to deliver warmth, safety, comfort.' },
      { type: 'brand-deck', title: 'The Brand Deck: 4 Foundations', cards: [
        { number: 1, title: 'Vision', description: 'The ultimate emotional state you\'re creating.', example: '"A world where comfort is accessible to everyone during chaos."', icon: 'Eye' },
        { number: 2, title: 'Mission', description: 'How you\'re delivering that emotion daily.', example: '"We create affordable, premium-quality comfort products that wrap you in peace."', icon: 'Target' },
        { number: 3, title: 'Promise', description: 'The guaranteed emotional outcome.', example: '"You will feel instantly calmer and warmer the moment you put this on."', icon: 'Shield' },
        { number: 4, title: 'Personality', description: 'How your brand behaves and speaks.', example: 'Cozy, playful, approachable, unpretentious. Never cold or corporate.', icon: 'Heart' }
      ]},
      { type: 'content', title: 'This Becomes Your Filter', body: 'Once you define the emotional problem and how you solve it, every future decision becomes easy. Should we sponsor this influencer? Does it align with our emotional promise? Should we add this product feature? Does it reinforce the feeling we\'re selling? Your brand definition is the filter. Without it, you\'re just guessing.' },
      { type: 'filter-visual', title: 'The Brand Filter In Action', decisions: [
        { question: 'Should we run a Black Friday discount?', withoutFilter: 'I guess? Everyone else does.', withFilter: 'No. We offer bundles that increase comfort instead.', verdict: 'filter' },
        { question: 'Should we sponsor this influencer?', withoutFilter: 'They have followers, why not?', withFilter: 'Only if they embody warmth and comfort authentically.', verdict: 'filter' },
        { question: 'Should we add this product feature?', withoutFilter: 'It seems cool, let\'s try it.', withFilter: 'Only if it reinforces the feeling of safety and peace.', verdict: 'filter' }
      ]},
      { type: 'brand-comparison', title: 'Brands That Nail Emotional Problems', brands: [
        { name: 'Nike', problem: 'You feel lazy and undisciplined', solution: 'Just Do It - become an athlete', color: '#f97316' },
        { name: 'Apple', problem: 'Technology makes you feel stupid', solution: 'Intuitive design - feel like a genius', color: '#a855f7' },
        { name: 'Liquid Death', problem: 'Healthy choices feel boring', solution: 'Murder your thirst - be rebellious', color: '#22c55e' }
      ]},
      { type: 'framework-summary', title: 'The Emotional Problem Framework', steps: [
        { step: 1, action: 'Identify the Pain', description: 'What does your customer FEEL before finding you?', icon: 'Brain' },
        { step: 2, action: 'Define the Transformation', description: 'What do they feel AFTER using your product?', icon: 'TrendingUp' },
        { step: 3, action: 'Build the Vehicle', description: 'Create the product that delivers this emotional shift.', icon: 'Package' },
        { step: 4, action: 'Filter Everything', description: 'Every decision must reinforce this emotional promise.', icon: 'Filter' }
      ]},
      { type: 'quiz', question: 'What is The Oodie REALLY selling when they sell wearable blankets?', options: ['High-quality sherpa fleece material', 'Comfort and peace during anxiety and chaos', 'A cheaper alternative to regular blankets', 'A fashionable loungewear item'], correctIndex: 1, feedback: { correct: 'Exactly! The Oodie identified the emotional problem first: people feeling anxious, cold, isolated. The wearable blanket is just the vehicle to deliver warmth, safety, and comfort. The emotion is the product.', incorrect: 'Not quite. The physical product features matter, but they\'re just the delivery mechanism. The Oodie sells the FEELING of comfort and peace during chaos. That emotional solution is what built a $200M brand.' }},
      { type: 'completion' }
    ];

    // ============ SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    // UNIQUE: Emotional Transform Slide - Before/After visualization
    const EmotionalTransformSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState('before');

      useEffect(() => {
        const timer = setInterval(() => {
          setActivePhase(p => p === 'before' ? 'after' : 'before');
        }, 3000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-2 gap-6 mb-6">
            {/* Before State */}
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
              className="relative rounded-2xl p-6 transition-all duration-500"
              style={{
                background: activePhase === 'before' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                border: activePhase === 'before' ? '2px solid rgba(239, 68, 68, 0.5)' : '2px solid #e5e5e5',
                boxShadow: activePhase === 'before' ? '0 0 40px rgba(239, 68, 68, 0.2)' : 'none'
              }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: activePhase === 'before' ? 'linear-gradient(90deg, transparent, #ef4444, transparent)' : 'transparent' }} />
              <div className="text-center mb-4">
                <span className="inline-block px-3 py-1 rounded-full text-xs font-bold" style={{ background: 'rgba(239, 68, 68, 0.2)', color: '#ef4444' }}>BEFORE</span>
              </div>
              <h3 className="text-xl md:text-2xl font-bold text-center mb-4" style={{ color: activePhase === 'before' ? '#ef4444' : '#737373' }}>{data.before.state}</h3>
              <div className="flex flex-wrap justify-center gap-2">
                {data.before.emotions.map((emotion, i) => (
                  <motion.span key={i} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.1 }}
                    className="px-3 py-1.5 rounded-full text-xs font-medium"
                    style={{ background: activePhase === 'before' ? 'rgba(239, 68, 68, 0.15)' : 'rgba(0,0,0,0.05)', color: activePhase === 'before' ? '#fca5a5' : '#737373' }}>
                    {emotion}
                  </motion.span>
                ))}
              </div>
            </motion.div>

            {/* After State */}
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="relative rounded-2xl p-6 transition-all duration-500"
              style={{
                background: activePhase === 'after' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                border: activePhase === 'after' ? '2px solid rgba(var(--accent-rgb), 0.5)' : '2px solid #e5e5e5',
                boxShadow: activePhase === 'after' ? '0 0 40px rgba(var(--accent-rgb), 0.2)' : 'none'
              }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: activePhase === 'after' ? 'linear-gradient(90deg, transparent, var(--accent), transparent)' : 'transparent' }} />
              <div className="text-center mb-4">
                <span className="inline-block px-3 py-1 rounded-full text-xs font-bold" style={{ background: 'rgba(var(--accent-rgb), 0.2)', color: 'var(--accent)' }}>AFTER</span>
              </div>
              <h3 className="text-xl md:text-2xl font-bold text-center mb-4" style={{ color: activePhase === 'after' ? 'var(--accent)' : '#737373' }}>{data.after.state}</h3>
              <div className="flex flex-wrap justify-center gap-2">
                {data.after.emotions.map((emotion, i) => (
                  <motion.span key={i} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.3 + i * 0.1 }}
                    className="px-3 py-1.5 rounded-full text-xs font-medium"
                    style={{ background: activePhase === 'after' ? 'rgba(var(--accent-rgb), 0.15)' : 'rgba(0,0,0,0.05)', color: activePhase === 'after' ? 'var(--accent-light)' : '#737373' }}>
                    {emotion}
                  </motion.span>
                ))}
              </div>
            </motion.div>
          </div>

          {/* Arrow Animation */}
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }} className="flex justify-center mb-6">
            <div className="flex items-center gap-3">
              <div className="w-16 h-0.5 bg-gradient-to-r from-red-500 to-transparent" />
              <motion.div animate={{ scale: [1, 1.2, 1] }} transition={{ repeat: Infinity, duration: 1.5 }} className="w-10 h-10 rounded-full flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
                <Icons.Zap />
              </motion.div>
              <div className="w-16 h-0.5 bg-gradient-to-r from-transparent to-orange-500" />
            </div>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }}
            className="text-center p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid rgba(var(--accent-rgb), 0.3)' }}>
            <p className="text-neutral-300 text-sm md:text-base"><Icons.Lightbulb className="inline mr-2" style={{ color: 'var(--accent)' }} />{data.insight}</p>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Stat Showcase Slide with animated counters
    const StatShowcaseSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }}
              className="relative rounded-2xl p-6 text-center overflow-hidden"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 8px 32px rgba(0,0,0,0.4), 0 0 40px rgba(var(--accent-rgb),0.15)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="text-4xl md:text-5xl font-bold mb-2" style={{ color: 'var(--accent)', textShadow: '0 0 30px rgba(var(--accent-rgb),0.5)' }}>
                <AnimatedCounter target={stat.value} prefix={stat.prefix || ''} suffix={stat.suffix || ''} />
              </div>
              <div className="text-sm md:text-base font-semibold text-white mb-1">{stat.label}</div>
              <div className="text-xs text-neutral-400">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    // UNIQUE: Brand Deck Slide with cycling highlight
    const BrandDeckSlide = ({ data }) => {
      const [activeCard, setActiveCard] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveCard(c => (c + 1) % data.cards.length);
        }, 3500);
        return () => clearInterval(timer);
      }, [data.cards.length]);

      const IconComponent = ({ name }) => {
        const IconMap = { Eye: Icons.Eye, Target: Icons.Target, Shield: Icons.Shield, Heart: Icons.Heart };
        const Icon = IconMap[name] || Icons.Star;
        return <Icon />;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-4">
            {data.cards.map((card, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setActiveCard(i)}
                className="relative rounded-2xl p-5 cursor-pointer transition-all duration-500"
                style={{
                  background: activeCard === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#fafafa',
                  border: activeCard === i ? '2px solid rgba(var(--accent-rgb), 0.5)' : '2px solid #e5e5e5',
                  boxShadow: activeCard === i ? '0 0 30px rgba(var(--accent-rgb), 0.2)' : 'none',
                  transform: activeCard === i ? 'scale(1.02)' : 'scale(1)'
                }}>
                <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl transition-all duration-500" style={{ background: activeCard === i ? 'linear-gradient(90deg, transparent, var(--accent), transparent)' : 'transparent' }} />
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 transition-all duration-500"
                    style={{ background: activeCard === i ? 'linear-gradient(135deg, var(--accent), var(--accent-dark))' : '#e5e5e5', color: activeCard === i ? 'white' : '#737373' }}>
                    <span className="text-lg font-bold">{card.number}</span>
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-2">
                      <h3 className="font-bold text-base transition-colors duration-500" style={{ color: activeCard === i ? 'white' : '#171717' }}>{card.title}</h3>
                      <span className="transition-colors duration-500" style={{ color: activeCard === i ? 'var(--accent)' : '#a3a3a3' }}><IconComponent name={card.icon} /></span>
                    </div>
                    <p className="text-xs mb-2 transition-colors duration-500" style={{ color: activeCard === i ? '#a3a3a3' : '#737373' }}>{card.description}</p>
                    <p className="text-xs italic transition-colors duration-500" style={{ color: activeCard === i ? 'var(--accent-light)' : '#a3a3a3' }}>{card.example}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // UNIQUE: Filter Visual Slide - Decision making with/without filter
    const FilterVisualSlide = ({ data }) => {
      const [activeDecision, setActiveDecision] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveDecision(d => (d + 1) % data.decisions.length);
        }, 4000);
        return () => clearInterval(timer);
      }, [data.decisions.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          {/* Decision Question */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
            className="text-center mb-6 p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="flex items-center justify-center gap-2 mb-2">
              <Icons.Filter style={{ color: 'var(--accent)' }} />
              <span className="text-xs text-neutral-400 uppercase tracking-wider">Decision #{activeDecision + 1}</span>
            </div>
            <p className="text-white font-semibold text-lg">{data.decisions[activeDecision].question}</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4">
            {/* Without Filter */}
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="rounded-2xl p-5 border-2 border-red-200 bg-red-50">
              <div className="flex items-center gap-2 mb-3">
                <div className="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div>
                <span className="font-bold text-red-700 text-sm">Without Emotional Filter</span>
              </div>
              <p className="text-neutral-700 text-sm leading-relaxed">{data.decisions[activeDecision].withoutFilter}</p>
              <div className="mt-3 text-xs text-red-600 font-medium">Random, reactive decision</div>
            </motion.div>

            {/* With Filter */}
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              className="rounded-2xl p-5 border-2 border-green-200 bg-green-50">
              <div className="flex items-center gap-2 mb-3">
                <div className="w-8 h-8 rounded-full bg-green-500 flex items-center justify-center text-white"><Icons.Check /></div>
                <span className="font-bold text-green-700 text-sm">With Emotional Filter</span>
              </div>
              <p className="text-neutral-700 text-sm leading-relaxed">{data.decisions[activeDecision].withFilter}</p>
              <div className="mt-3 text-xs text-green-600 font-medium">Strategic, aligned decision</div>
            </motion.div>
          </div>

          {/* Navigation Dots */}
          <div className="flex justify-center gap-2 mt-6">
            {data.decisions.map((_, i) => (
              <button key={i} onClick={() => setActiveDecision(i)}
                className="w-2.5 h-2.5 rounded-full transition-all duration-300"
                style={{ background: i === activeDecision ? 'var(--accent)' : '#d4d4d4', transform: i === activeDecision ? 'scale(1.3)' : 'scale(1)' }} />
            ))}
          </div>
        </div>
      );
    };

    // UNIQUE: Brand Comparison Slide
    const BrandComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {data.brands.map((brand, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }}
              className="relative rounded-2xl p-6 overflow-hidden"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 8px 32px rgba(0,0,0,0.4), 0 0 30px ${brand.color}20` }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${brand.color}, transparent)` }} />
              <div className="text-2xl font-bold mb-3" style={{ color: brand.color }}>{brand.name}</div>
              <div className="mb-4">
                <div className="text-xs text-neutral-500 uppercase tracking-wider mb-1">Emotional Problem</div>
                <p className="text-neutral-300 text-sm leading-relaxed">{brand.problem}</p>
              </div>
              <div className="p-3 rounded-lg" style={{ background: `${brand.color}15`, border: `1px solid ${brand.color}30` }}>
                <div className="text-xs uppercase tracking-wider mb-1" style={{ color: brand.color }}>Solution</div>
                <p className="text-white text-sm font-medium">{brand.solution}</p>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // UNIQUE: Framework Summary Slide
    const FrameworkSummarySlide = ({ data }) => {
      const IconComponent = ({ name }) => {
        const IconMap = { Brain: Icons.Brain, TrendingUp: Icons.TrendingUp, Package: Icons.Package, Filter: Icons.Filter };
        const Icon = IconMap[name] || Icons.Zap;
        return <Icon />;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-4">
            {data.steps.map((step, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                className="relative rounded-2xl p-5 overflow-hidden"
                style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid rgba(var(--accent-rgb), 0.2)' }}>
                <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                    style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 0 20px rgba(var(--accent-rgb), 0.3)' }}>
                    <span className="text-white"><IconComponent name={step.icon} /></span>
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-xs font-bold px-2 py-0.5 rounded" style={{ background: 'rgba(var(--accent-rgb), 0.2)', color: 'var(--accent)' }}>STEP {step.step}</span>
                    </div>
                    <h3 className="font-bold text-white text-base mb-1">{step.action}</h3>
                    <p className="text-neutral-400 text-sm">{step.description}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">Your product is just the vehicle. Define the emotional problem first. Build everything around that feeling. That's your brand.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'emotional-transform': return <EmotionalTransformSlide data={slide} />;
          case 'stat-showcase': return <StatShowcaseSlide data={slide} />;
          case 'brand-deck': return <BrandDeckSlide data={slide} />;
          case 'filter-visual': return <FilterVisualSlide data={slide} />;
          case 'brand-comparison': return <BrandComparisonSlide data={slide} />;
          case 'framework-summary': return <FrameworkSummarySlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
