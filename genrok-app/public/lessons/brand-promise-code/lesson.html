<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Brand Promise Code | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #8b5cf6; --accent-dark: #7c3aed; --accent-light: #a78bfa; --accent-rgb: 139, 92, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3 { font-family: 'Fraunces', serif; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'brand-promise-code',
      title: 'The Brand Promise Code',
      description: 'Your brand is NOT a logo - it\'s a promise.',
      accentColor: '#8b5cf6',
      duration: '6 min',
      nextLesson: { id: 'smallest-viable-market', title: 'The Smallest Viable Market', teaser: 'Why being for everyone means being for no one.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Users: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Heart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Eye: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      Palette: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="13.5" cy="6.5" r="0.5" fill="currentColor"/><circle cx="17.5" cy="10.5" r="0.5" fill="currentColor"/><circle cx="8.5" cy="7.5" r="0.5" fill="currentColor"/><circle cx="6.5" cy="12.5" r="0.5" fill="currentColor"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      FileText: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      Coffee: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
    };

    const getIcon = (name) => { const Icon = Icons[name]; return Icon ? <Icon /> : null; };

    const slides = [
      { type: 'welcome', learningGoals: ['Why your brand is a promise, not a logo or vibe', 'The Starbucks lesson: weird logo, powerful promise', 'The one question that defines your entire brand'] },
      { type: 'hook', headline: 'Starbucks\' logo is objectively weird. A green mermaid with two tails.', subtext: 'Yet it\'s one of the world\'s most valuable brands. Why? Because the logo doesn\'t matter. The promise does. Starbucks promises "your third place between home and work."', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Starbucks_Corporation_Logo_2011.svg.png', brandName: 'Starbucks' },
      { type: 'logo-vs-promise', title: 'What Founders Obsess Over vs What Matters', wrong: { label: 'LOGO OBSESSION', icon: 'Palette', items: ['What should our logo look like?', 'Which color palette feels right?', 'Is this font "on brand"?'], result: 'Pretty design. No conversions.' }, right: { label: 'PROMISE CLARITY', icon: 'Target', items: ['What change are we making?', 'For whom specifically?', 'Why should they believe us?'], result: 'Clear positioning. Strong conversions.' } },
      { type: 'promise-formula', title: 'The One Question That Defines Everything', question: 'What change are you making for a specific person?', components: [{ label: 'WHAT', description: 'The transformation or outcome', color: '#ef4444' }, { label: 'FOR WHOM', description: 'The specific person with the need', color: '#f59e0b' }], insight: 'Answer this clearly and your entire brand strategy becomes obvious.' },
      { type: 'starbucks-breakdown', title: 'The Starbucks Promise Decoded', logo: { label: 'THE LOGO', description: 'Green mermaid with two tails', note: 'Objectively strange. Doesn\'t matter.' }, promise: { label: 'THE PROMISE', text: 'Your third place', description: 'Not home. Not work. A comfortable space in between where you belong.' }, result: 'People pay $7 for coffee they could make for 50 cents. That\'s the power of a clear promise.' },
      { type: 'promise-pillars', title: 'What Makes a Promise Powerful', pillars: [{ number: '1', title: 'Specific Target', description: 'Not "everyone who drinks coffee." Specific people with a specific need.', icon: 'Users' }, { number: '2', title: 'Clear Change', description: 'Not "better coffee." A transformation they can visualize.', icon: 'TrendingUp' }, { number: '3', title: 'Immediate Relevance', description: 'They recognize themselves instantly. "That\'s me. That\'s what I need."', icon: 'Eye' }, { number: '4', title: 'Emotionally Resonant', description: 'Touches a desire or pain point deep enough to drive action.', icon: 'Heart' }] },
      { type: 'brand-examples-grid', title: 'Promise-Driven Brands', brands: [{ name: 'Patagonia', target: 'For climbers', promise: 'Gear that won\'t fail you', color: '#10b981' }, { name: 'Liquid Death', target: 'For rebels', promise: 'Water that\'s not boring', color: '#f59e0b' }, { name: 'Hims', target: 'For anxious men', promise: 'Healthcare without shame', color: '#8b5cf6' }], insight: 'Each brand: specific person, clear change, emotional resonance.' },
      { type: 'conversion-comparison', title: 'Generic vs Specific Promise', generic: { label: 'GENERIC PROMISE', lines: ['Brand: "We sell quality skincare"', 'For: "People who care about skin"', 'Promise: "Better skin"'], rate: '1.2%', color: '#ef4444' }, specific: { label: 'SPECIFIC PROMISE', lines: ['Brand: "We fix hormonal acne"', 'For: "Women 25-40 with adult acne"', 'Promise: "Clear skin in 90 days"'], rate: '8.7%', color: '#10b981' }, multiplier: '7x' },
      { type: 'picture-vs-promise', title: 'Focus on the Promise, Not the Picture', visual: { label: 'THE PICTURE', items: ['Your logo', 'Your colors', 'Your fonts'], description: 'Delivery mechanism' }, promise: { label: 'THE PROMISE', items: ['The change you make', 'For whom specifically', 'Why they should believe'], description: 'What actually converts' }, insight: 'Obsess over making the promise crystal clear. Once you nail that, the visual identity becomes easy.' },
      { type: 'quiz', question: 'What is the core function of a brand?', options: ['To create a beautiful visual identity that stands out', 'To make a clear promise about the change you create for a specific person', 'To build awareness and get people to recognize your logo', 'To develop an emotional connection over many years'], correctIndex: 1, feedback: { correct: 'Exactly! Your brand is a promise about the change you make for a specific person. Everything else - logos, colors, design - exists only to communicate that promise clearly.', incorrect: 'Not quite. Beautiful visuals and awareness don\'t drive conversions. Your brand is fundamentally a promise about the change you create for a specific person.' } },
      { type: 'mindset-shift', title: 'The Promise Mindset', insight: 'Stop asking "What should our logo look like?" Start asking "What change are we making for whom?" Get that one question right and every other brand decision becomes obvious. The logo is just a symbol. The promise is what builds the empire.' },
      { type: 'completion', sources: ['Brand Promise Strategy', 'Starbucks Third Place Concept', 'Performance Brand Playbook'] }
    ];

    // AnimatedCounter component
    const AnimatedCounter = ({ value, suffix = '%', duration = 1500 }) => {
      const [count, setCount] = useState(0);
      const numericValue = parseFloat(value) || 0;

      useEffect(() => {
        let startTime;
        const animate = (timestamp) => {
          if (!startTime) startTime = timestamp;
          const progress = Math.min((timestamp - startTime) / duration, 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          setCount(eased * numericValue);
          if (progress < 1) requestAnimationFrame(animate);
        };
        requestAnimationFrame(animate);
      }, [numericValue, duration]);

      return <span>{count.toFixed(1)}{suffix}</span>;
    };

    // WelcomeSlide
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl text-black mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg mb-3 max-w-lg" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.15 }} className="flex items-center gap-1.5 text-neutral-400 text-xs mb-3">{getIcon('Clock')}<span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }} className="rounded-2xl p-5 mb-4 max-w-sm w-full">
              <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">In this lesson</p>
              <ul className="space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-xs font-bold text-white flex-shrink-0" style={{ background: 'var(--accent)' }}>{i + 1}</span>
                    <span className="text-neutral-300 text-sm">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-7 py-3 rounded-xl text-white font-semibold" style={{ background: 'var(--accent)' }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    // HookSlide
    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }}>
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(139, 92, 246, 0.1)', color: 'var(--accent)' }}>The Hook</span>
            <h2 className="title-font text-2xl md:text-4xl text-black mb-4">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.15 }} className="text-lg text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} className="absolute bottom-8 right-8 z-0 hidden md:block" style={{ height: '100px' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain opacity-80" />
          </motion.div>
        )}
      </div>
    );

    // LogoVsPromiseSlide
    const LogoVsPromiseSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => { const t = setTimeout(() => setShowWinner(true), 1500); return () => clearTimeout(t); }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-4 mb-4">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="relative rounded-2xl p-5 overflow-hidden opacity-60" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
              <div className="flex items-center gap-2 mb-4">
                <div className="w-10 h-10 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400">{getIcon(data.wrong.icon)}</div>
                <span className="font-bold text-white text-sm">{data.wrong.label}</span>
              </div>
              <ul className="space-y-2 mb-4">
                {data.wrong.items.map((item, i) => (
                  <li key={i} className="flex items-center gap-2 text-neutral-400 text-sm">
                    <span className="text-red-400">{getIcon('X')}</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
              <div className="text-xs text-red-400 font-medium">{data.wrong.result}</div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: showWinner ? '0 0 30px rgba(16, 185, 129, 0.3)' : 'none' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              {showWinner && (
                <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} className="absolute top-3 right-3 px-2 py-1 rounded-full bg-emerald-500 text-white text-xs font-bold">WINS</motion.div>
              )}
              <div className="flex items-center gap-2 mb-4">
                <div className="w-10 h-10 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400">{getIcon(data.right.icon)}</div>
                <span className="font-bold text-white text-sm">{data.right.label}</span>
              </div>
              <ul className="space-y-2 mb-4">
                {data.right.items.map((item, i) => (
                  <li key={i} className="flex items-center gap-2 text-neutral-300 text-sm">
                    <span className="text-emerald-400">{getIcon('Check')}</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
              <div className="text-xs text-emerald-400 font-medium">{data.right.result}</div>
            </motion.div>
          </div>
        </div>
      );
    };

    // PromiseFormulaSlide
    const PromiseFormulaSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-8 text-center overflow-hidden mb-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 40px rgba(139, 92, 246, 0.2)' }}>
          <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #8b5cf6, transparent)' }} />
          <div className="text-xl md:text-2xl font-bold text-white mb-6" style={{ fontFamily: 'Fraunces, serif' }}>"{data.question}"</div>
          <div className="flex items-center justify-center gap-4 md:gap-8">
            {data.components.map((comp, i) => (
              <React.Fragment key={i}>
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 + i * 0.15 }} className="text-center">
                  <div className="w-16 h-16 md:w-20 md:h-20 rounded-2xl mx-auto flex items-center justify-center mb-2 text-xl md:text-2xl font-black" style={{ background: `${comp.color}20`, color: comp.color }}>{comp.label}</div>
                  <div className="text-xs text-neutral-400">{comp.description}</div>
                </motion.div>
                {i < data.components.length - 1 && (
                  <div className="text-3xl font-bold text-neutral-500">+</div>
                )}
              </React.Fragment>
            ))}
          </div>
        </motion.div>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }} className="text-center text-neutral-600 text-base">{data.insight}</motion.p>
      </div>
    );

    // StarbucksBreakdownSlide
    const StarbucksBreakdownSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="relative rounded-2xl p-5 overflow-hidden opacity-60" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #6b7280, transparent)' }} />
            <div className="text-xs text-neutral-500 uppercase tracking-wider mb-2">{data.logo.label}</div>
            <div className="text-lg font-bold text-white mb-2">{data.logo.description}</div>
            <div className="text-sm text-neutral-400">{data.logo.note}</div>
          </motion.div>

          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(16, 185, 129, 0.3)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
            <div className="text-xs text-neutral-500 uppercase tracking-wider mb-2">{data.promise.label}</div>
            <div className="text-2xl font-black text-emerald-400 mb-2" style={{ fontFamily: 'Fraunces, serif' }}>"{data.promise.text}"</div>
            <div className="text-sm text-neutral-300">{data.promise.description}</div>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="relative rounded-xl p-4 text-center overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <p className="text-neutral-300 text-sm flex items-center justify-center gap-2">{getIcon('Coffee')}<span>{data.result}</span></p>
        </motion.div>
      </div>
    );

    // PromisePillarsSlide
    const PromisePillarsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-4">
          {data.pillars.map((pillar, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #8b5cf6, transparent)' }} />
              <div className="flex items-start gap-3">
                <div className="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style={{ background: 'rgba(139, 92, 246, 0.2)' }}>
                  <span className="text-xl font-black" style={{ color: '#8b5cf6' }}>{pillar.number}</span>
                </div>
                <div>
                  <h3 className="font-bold text-white mb-1 flex items-center gap-2">
                    <span style={{ color: '#8b5cf6' }}>{getIcon(pillar.icon)}</span>
                    {pillar.title}
                  </h3>
                  <p className="text-neutral-400 text-sm">{pillar.description}</p>
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // BrandExamplesGridSlide
    const BrandExamplesGridSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-4 mb-6">
          {data.brands.map((brand, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="relative rounded-2xl p-5 text-center overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${brand.color}, transparent)` }} />
              <div className="text-2xl font-black mb-2" style={{ color: brand.color, fontFamily: 'Fraunces, serif' }}>{brand.name}</div>
              <div className="text-xs text-neutral-500 uppercase tracking-wider mb-1">{brand.target}</div>
              <div className="text-sm text-white">"{brand.promise}"</div>
            </motion.div>
          ))}
        </div>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }} className="text-center text-neutral-500 text-sm">{data.insight}</motion.p>
      </div>
    );

    // ConversionComparisonSlide
    const ConversionComparisonSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const t = setTimeout(() => setAnimated(true), 500); return () => clearTimeout(t); }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-4 mb-6">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${data.generic.color}, transparent)` }} />
              <div className="text-xs text-neutral-500 uppercase tracking-wider mb-3">{data.generic.label}</div>
              <ul className="space-y-2 mb-4">
                {data.generic.lines.map((line, i) => (
                  <li key={i} className="text-neutral-400 text-sm">{line}</li>
                ))}
              </ul>
              <div className="text-center">
                <div className="text-4xl font-black" style={{ color: data.generic.color }}>
                  {animated ? <AnimatedCounter value={data.generic.rate.replace('%', '')} /> : '0%'}
                </div>
                <div className="text-xs text-neutral-500">Conversion Rate</div>
              </div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(16, 185, 129, 0.3)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${data.specific.color}, transparent)` }} />
              <div className="text-xs text-neutral-500 uppercase tracking-wider mb-3">{data.specific.label}</div>
              <ul className="space-y-2 mb-4">
                {data.specific.lines.map((line, i) => (
                  <li key={i} className="text-neutral-300 text-sm">{line}</li>
                ))}
              </ul>
              <div className="text-center">
                <div className="text-4xl font-black" style={{ color: data.specific.color }}>
                  {animated ? <AnimatedCounter value={data.specific.rate.replace('%', '')} /> : '0%'}
                </div>
                <div className="text-xs text-neutral-500">Conversion Rate</div>
              </div>
            </motion.div>
          </div>
          <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.5, type: 'spring' }} className="mx-auto px-6 py-3 rounded-full text-white font-black text-lg" style={{ background: 'var(--accent)' }}>{data.multiplier} BETTER</motion.div>
        </div>
      );
    };

    // PictureVsPromiseSlide
    const PictureVsPromiseSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="relative rounded-2xl p-5 overflow-hidden opacity-60" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #6b7280, transparent)' }} />
            <div className="text-xs text-neutral-500 uppercase tracking-wider mb-3">{data.visual.label}</div>
            <ul className="space-y-2 mb-3">
              {data.visual.items.map((item, i) => (
                <li key={i} className="text-neutral-400 text-sm flex items-center gap-2">
                  <span className="text-neutral-500">{getIcon('Palette')}</span>{item}
                </li>
              ))}
            </ul>
            <div className="text-xs text-neutral-500">{data.visual.description}</div>
          </motion.div>

          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(139, 92, 246, 0.3)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #8b5cf6, transparent)' }} />
            <div className="text-xs text-neutral-500 uppercase tracking-wider mb-3">{data.promise.label}</div>
            <ul className="space-y-2 mb-3">
              {data.promise.items.map((item, i) => (
                <li key={i} className="text-neutral-300 text-sm flex items-center gap-2">
                  <span style={{ color: '#8b5cf6' }}>{getIcon('Target')}</span>{item}
                </li>
              ))}
            </ul>
            <div className="text-xs text-purple-400">{data.promise.description}</div>
          </motion.div>
        </div>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }} className="text-center text-neutral-600 text-base">{data.insight}</motion.p>
      </div>
    );

    // QuizSlide
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { onShowGif(isCorrect ? celebrationGif : empathyGif, '60%', gifSide); } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-2xl mx-auto py-8 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="title-font text-xl md:text-2xl text-black">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // MindsetShiftSlide
    const MindsetShiftSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center">
          <div className="w-16 h-16 mx-auto rounded-2xl flex items-center justify-center mb-4" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(139, 92, 246, 0.3)' }}>
            <span style={{ color: '#8b5cf6' }}>{getIcon('Lightbulb')}</span>
          </div>
          <h2 className="title-font text-2xl md:text-3xl text-black mb-4">{data.title}</h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }} className="text-neutral-600 text-lg leading-relaxed max-w-xl mx-auto">{data.insight}</motion.p>
        </motion.div>
      </div>
    );

    // CompletionSlide
    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: 'var(--accent)', boxShadow: '0 6px 24px rgba(139, 92, 246, 0.35)' }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="title-font text-2xl md:text-3xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md">You now understand the Brand Promise Code. Your brand is not a logo - it's a promise about the change you make for a specific person.</motion.p>
        <motion.a initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} href={`/lessons/${LESSON_CONFIG.nextLesson.id}/lesson.html`} className="block rounded-xl p-5 max-w-md w-full mb-4 text-left" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-1">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.a>
        {data?.sources && (
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.45 }} className="text-neutral-400 text-xs">Sources: {data.sources.join(', ')}</motion.p>
        )}
      </div>
    );

    // Main App
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'logo-vs-promise': return <LogoVsPromiseSlide data={slide} />;
          case 'promise-formula': return <PromiseFormulaSlide data={slide} />;
          case 'starbucks-breakdown': return <StarbucksBreakdownSlide data={slide} />;
          case 'promise-pillars': return <PromisePillarsSlide data={slide} />;
          case 'brand-examples-grid': return <BrandExamplesGridSlide data={slide} />;
          case 'conversion-comparison': return <ConversionComparisonSlide data={slide} />;
          case 'picture-vs-promise': return <PictureVsPromiseSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'mindset-shift': return <MindsetShiftSlide data={slide} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-3 md:left-5 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-3 md:right-5 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
