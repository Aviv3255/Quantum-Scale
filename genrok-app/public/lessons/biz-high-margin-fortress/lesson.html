<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The High Margin Fortress | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #8B5CF6; --accent-dark: #7C3AED; --accent-light: #A78BFA; --accent-rgb: 139, 92, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'biz-high-margin-fortress',
      title: 'The High Margin Fortress',
      description: 'Why selling cheap is a death sentence for eCommerce',
      accentColor: '#8B5CF6',
      duration: '5 min',
      nextLesson: { id: 'biz-ridge-wallet-protocol', title: 'The Ridge Wallet Protocol', teaser: 'How one wallet brand cracked premium positioning.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_above_head_world_champion_celebration_484bd560-f049-41ca-b3d1-c03d7468ab56_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_starting_with_slow_clap_accelerating_to_fast_c_ee478a38-0ee7-437d-bd13-d687f7dd624a_0.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_wiping_away_a_small_tear_sad_but_gentle_disapp_8d78571b-3c36-4502-abee-81683255843c_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_sighing_sadly_exhaling_with_disappointment_hea_f6014f2a-3a99-4378-a2a8-414e16b3e72d_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_slouching_with_disappointment_body_curling_inw_caedddbe-413c-492a-9fdf-1e8433f5e2a8_2%20(1).mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_placing_hand_on_forehead_sadly_eyes_closed_fru_3e048895-f365-4ff2-9e88-0d0a35b2a9e1_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_nodding_slowly_with_sadness_what_a_shame_expre_377f67ca-63da-41aa-9072-4926fc2f6e82_3.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['The fatal flaw of low margin businesses', 'Why premium equals profit fortress', 'How to position for thick margins'] },
      { type: 'hook', headline: 'Two stores. Same product. One charges $29. One charges $129.', subtext: 'The $129 store is printing money. The $29 store is bleeding to death. Same product. Same ads. Same traffic. But one business has a fortress around its profits. The other is one bad month away from collapse.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/framer-1.svg', brandName: 'Framer' },
      { type: 'margin-meter', title: 'The Margin Reality Check', lowMargin: { price: 29, cost: 18, profit: 11, margin: 38, label: 'Low Margin Product' }, highMargin: { price: 129, cost: 25, profit: 104, margin: 81, label: 'High Margin Product' } },
      { type: 'content', title: 'The Low Margin Trap', body: 'Selling cheap feels safe. It feels like the path to volume. But low margins create fragile businesses built on glass foundations. One tariff increase. One shipping delay. One ad platform change. The whole thing shatters. You are running a business with zero room for error. Every external shock threatens survival.' },
      { type: 'profit-waterfall', title: 'Where Your Money Actually Goes', scenarios: [
        { label: 'Low Margin ($29)', revenue: 29, cogs: 18, shipping: 5, ads: 8, profit: -2, color: '#EF4444' },
        { label: 'High Margin ($129)', revenue: 129, cogs: 25, shipping: 8, ads: 25, profit: 71, color: '#22C55E' }
      ]},
      { type: 'before-after', title: 'Low Margin vs High Margin', before: [
        'High volume required to survive',
        'Thin margins leave no buffer',
        'Price sensitive customers',
        'Fragile to market shifts',
        'No room to over-deliver'
      ], after: [
        'Premium positioning earns respect',
        'Thick margins create stability',
        'Value insensitive customers',
        'Robust against market changes',
        'Margin allows over-delivery'
      ]},
      { type: 'fortress-tower', title: 'Build Your Profit Fortress', lowTower: { height: 38, profit: '$11', label: 'Glass House', threats: ['Ad cost spike', 'Shipping delay', 'Supplier increase', 'Returns'] }, highTower: { height: 81, profit: '$104', label: 'Fortress', shields: ['Premium brand', 'Buffer margin', 'Over-delivery', 'Loyal customers'] } },
      { type: 'comparison-cards', title: 'Fragile Glass vs Solid Fortress', left: { label: 'LOW MARGIN', iconComponent: 'TrendingDown', value: '$11', subtext: 'profit per sale', percentage: '38%', items: ['One bad month = death', 'No room for error', 'Price war victim', 'Cuts corners to survive'], color: 'red' }, right: { label: 'HIGH MARGIN', iconComponent: 'Shield', value: '$104', subtext: 'profit per sale', percentage: '81%', items: ['Survives any storm', 'Buffer for mistakes', 'Premium positioning', 'Over-delivers & wins'], color: 'green' } },
      { type: 'pricing-pyramid', title: 'The Premium Positioning Ladder', tiers: [
        { level: 'Budget', price: '$29', margin: '38%', audience: 'Price shoppers', color: '#EF4444', width: '100%' },
        { level: 'Standard', price: '$79', margin: '62%', audience: 'Value seekers', color: '#F59E0B', width: '75%' },
        { level: 'Premium', price: '$129', margin: '81%', audience: 'Quality buyers', color: '#22C55E', width: '50%' }
      ]},
      { type: 'hormozi', title: 'Hormozi\'s Premium Principle', body: 'Alex Hormozi nailed it: Sell to rich people. Or sell a premium product to a niche audience. Why? Because their expectations for $100 are far lower than someone giving you 10 percent of their net worth. When you sell premium, customers judge value differently. A $100 product to a wealthy buyer is negligible. To them, it is pocket change. To a budget buyer, $100 is a major decision requiring deep scrutiny and price comparison.', image: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/eov911dsc81vaj73li2pag9pt7-removebg-preview.png' },
      { type: 'premium-pillars', title: 'The 5 Pillars of Premium Pricing', pillars: [
        { name: 'Design', description: 'Premium aesthetics signal quality. Clean, sophisticated, intentional.', icon: 'Palette', color: '#8B5CF6' },
        { name: 'Story', description: 'Origin, founder journey, mission. People pay for meaning, not just products.', icon: 'BookOpen', color: '#3B82F6' },
        { name: 'Packaging', description: 'The unboxing experience IS the product. Make it feel like a gift.', icon: 'Gift', color: '#22C55E' },
        { name: 'Scarcity', description: 'Limited editions, exclusive drops. Scarcity creates perceived value.', icon: 'Clock', color: '#F59E0B' },
        { name: 'Social Proof', description: 'Celebrity endorsements, influencers, user testimonials at scale.', icon: 'Star', color: '#EF4444' }
      ]},
      { type: 'premium-markup', title: 'The Premium Markup Math', scenarios: [
        { level: 'Commodity', markup: '2x', example: '$10 cost → $20 price', margin: '50%', color: '#EF4444', description: 'Race to the bottom. Competing on price alone.' },
        { level: 'Branded', markup: '4x', example: '$10 cost → $40 price', margin: '75%', color: '#F59E0B', description: 'Recognizable brand. Some loyalty. Still vulnerable.' },
        { level: 'Premium', markup: '8-10x', example: '$10 cost → $80-100 price', margin: '88-90%', color: '#22C55E', description: 'Status symbol. Emotional connection. Fortress margins.' }
      ], insight: 'The same $10 product can sell for $20 or $100. The difference? Positioning, story, and perceived value. Premium is a choice, not a cost.' },
      { type: 'content', title: 'How to Earn Premium Positioning', body: 'Premium pricing is not about lying or tricking customers. It is about creating genuine value beyond the physical product. Invest in design that stands out. Build a brand story that resonates. Create packaging that makes unboxing an event. Provide support that surprises and delights. When you genuinely over-deliver on experience, customers WANT to pay more. They feel like they are getting a deal even at premium prices. This is the virtuous cycle of high margins: charge more, deliver more, customers love you more, margins stay fat.' },
      { type: 'highlight-box', title: 'The Margin Advantage', body: 'The extra margin allows you to over-deliver and still be highly profitable. This is the secret. With thick margins, you can afford incredible packaging. Lightning fast shipping. Responsive support. Surprise bonuses. You create an experience that makes customers feel like they got a steal at any price. Meanwhile, your low-margin competitor is cutting corners just to break even.', highlight: 'The extra margin allows you to over-deliver and still be highly profitable.' },
      { type: 'implementation-guide', title: 'How To Calculate Your Real Margins', steps: [
        { step: 1, title: 'Calculate True COGS', description: 'Include product cost, packaging, inserts, labels. Most people forget 15-20% of real costs.', icon: 'Calculator', color: '#8B5CF6' },
        { step: 2, title: 'Add Fulfillment', description: 'Shipping, handling, returns rate (~5-8%). That "free shipping" comes from your margin.', icon: 'Package', color: '#3B82F6' },
        { step: 3, title: 'Factor Ad Spend', description: 'Divide monthly ad spend by orders. If you\'re spending $5k for 200 orders = $25/order.', icon: 'Target', color: '#22C55E' }
      ], proTip: 'Use a margin calculator spreadsheet or tools like Lifetimely to track true profit per order. Most stores discover they\'re actually losing money on "profitable" products when they include all costs.' },
      { type: 'quiz', question: 'What is the core advantage of a high margin business model?', options: ['Ability to sell more units', 'Margin allows over-delivery while staying profitable', 'Lower advertising costs', 'Faster shipping times'], correctIndex: 1, feedback: { correct: 'Exactly right. High margins create a buffer that lets you over-deliver on customer experience while remaining highly profitable. Low margin businesses cut corners to survive. High margin businesses wow customers and still win. That margin is your fortress against market chaos.', incorrect: 'Not quite. The core advantage is that margin allows you to over-deliver while staying profitable. With thick margins, you can afford amazing packaging, fast shipping, great support, and surprise bonuses. You create raving fans while your competitors are bleeding out on thin margins.' }},
      { type: 'completion', sources: [] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      // Premium comparison icons
      TrendingDown: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
      TrendingUp: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Shield: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      AlertTriangle: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      DollarSign: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Target: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Calculator: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="12" y1="10" x2="12" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="8" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="16" y1="18" x2="16" y2="18"/></svg>,
      Package: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M16.5 9.4l-9-5.19"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
      Building: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2" ry="2"/><line x1="9" y1="6" x2="9" y2="6"/><line x1="15" y1="6" x2="15" y2="6"/><line x1="9" y1="10" x2="9" y2="10"/><line x1="15" y1="10" x2="15" y2="10"/><line x1="9" y1="14" x2="9" y2="14"/><line x1="15" y1="14" x2="15" y2="14"/><line x1="9" y1="18" x2="15" y2="18"/></svg>,
      Layers: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
      Palette: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="13.5" cy="6.5" r="0.5"/><circle cx="17.5" cy="10.5" r="0.5"/><circle cx="8.5" cy="7.5" r="0.5"/><circle cx="6.5" cy="12.5" r="0.5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      BookOpen: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
      Gift: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>,
      Star: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Clock2: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
    };

    // Animated Components
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // NEW: Margin Meter Slide - Speedometer-style gauges for margin comparison
    const MarginMeterSlide = ({ data }) => {
      const GaugeMeter = ({ margin, label, price, profit, color, delay }) => {
        const [animatedMargin, setAnimatedMargin] = useState(0);
        useEffect(() => {
          const timer = setTimeout(() => {
            let start = 0;
            const increment = margin / 60;
            const interval = setInterval(() => {
              start += increment;
              if (start >= margin) { setAnimatedMargin(margin); clearInterval(interval); }
              else { setAnimatedMargin(Math.floor(start)); }
            }, 16);
          }, delay * 1000);
          return () => clearTimeout(timer);
        }, [margin, delay]);

        // Calculate arc path for gauge
        const radius = 70;
        const strokeWidth = 12;
        const circumference = Math.PI * radius; // Half circle
        const fillLength = (animatedMargin / 100) * circumference;

        return (
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay }}
            className="rounded-2xl p-6 text-center"
            style={{ background: '#0a0a0a', border: `1px solid ${color}40`, boxShadow: `0 0 30px ${color}15` }}
          >
            <div className="text-xs font-bold tracking-wider mb-4" style={{ color }}>{label}</div>

            {/* Gauge SVG */}
            <div className="relative w-44 h-24 mx-auto mb-4">
              <svg viewBox="0 0 160 90" className="w-full h-full">
                {/* Background arc */}
                <path
                  d="M 10 80 A 70 70 0 0 1 150 80"
                  fill="none"
                  stroke="#333"
                  strokeWidth={strokeWidth}
                  strokeLinecap="round"
                />
                {/* Colored arc */}
                <motion.path
                  d="M 10 80 A 70 70 0 0 1 150 80"
                  fill="none"
                  stroke={color}
                  strokeWidth={strokeWidth}
                  strokeLinecap="round"
                  strokeDasharray={circumference}
                  initial={{ strokeDashoffset: circumference }}
                  animate={{ strokeDashoffset: circumference - fillLength }}
                  transition={{ duration: 1.5, delay: delay + 0.3, ease: 'easeOut' }}
                  style={{ filter: `drop-shadow(0 0 8px ${color})` }}
                />
                {/* Center percentage */}
                <text x="80" y="75" textAnchor="middle" fill="white" fontSize="28" fontWeight="bold">
                  {animatedMargin}%
                </text>
              </svg>
            </div>

            {/* Price and Profit */}
            <div className="grid grid-cols-2 gap-3 text-sm">
              <div className="bg-neutral-900 rounded-lg p-2">
                <div className="text-neutral-500 text-[10px] uppercase">Price</div>
                <div className="text-white font-bold">${price}</div>
              </div>
              <div className="bg-neutral-900 rounded-lg p-2">
                <div className="text-neutral-500 text-[10px] uppercase">Profit</div>
                <div className="font-bold" style={{ color }}>${profit}</div>
              </div>
            </div>
          </motion.div>
        );
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Target size={14} color="var(--accent)" />
              <span>Margin Comparison</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-6">
            <GaugeMeter
              margin={data.lowMargin.margin}
              label={data.lowMargin.label}
              price={data.lowMargin.price}
              profit={data.lowMargin.profit}
              color="#EF4444"
              delay={0.2}
            />
            <GaugeMeter
              margin={data.highMargin.margin}
              label={data.highMargin.label}
              price={data.highMargin.price}
              profit={data.highMargin.profit}
              color="#22C55E"
              delay={0.4}
            />
          </div>

          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
            className="text-center mt-6"
          >
            <p className="text-neutral-500 text-sm">Same product category. Dramatically different profit margins.</p>
          </motion.div>
        </div>
      );
    };

    // NEW: Profit Waterfall Slide - Shows where money flows
    const ProfitWaterfallSlide = ({ data }) => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.DollarSign size={14} color="var(--accent)" />
              <span>Money Flow</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-6">
            {data.scenarios.map((scenario, idx) => (
              <motion.div
                key={idx}
                initial={{ opacity: 0, x: idx === 0 ? -30 : 30 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 + idx * 0.2 }}
                className="rounded-2xl p-5 relative overflow-hidden"
                style={{ background: '#0a0a0a', border: `1px solid ${scenario.color}40`, boxShadow: `0 0 25px ${scenario.color}12` }}
              >
                <div className="text-xs font-bold tracking-wider mb-4" style={{ color: scenario.color }}>{scenario.label}</div>

                {/* Waterfall bars */}
                <div className="space-y-2">
                  {[
                    { label: 'Revenue', value: scenario.revenue, type: 'positive' },
                    { label: 'COGS', value: -scenario.cogs, type: 'negative' },
                    { label: 'Shipping', value: -scenario.shipping, type: 'negative' },
                    { label: 'Ad Spend', value: -scenario.ads, type: 'negative' },
                  ].map((item, i) => {
                    const maxValue = scenario.revenue;
                    const width = Math.abs(item.value) / maxValue * 100;
                    return (
                      <motion.div
                        key={i}
                        initial={{ opacity: 0, x: -20 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.4 + idx * 0.2 + i * 0.1 }}
                        className="flex items-center gap-3"
                      >
                        <div className="w-16 text-[10px] text-neutral-500 text-right">{item.label}</div>
                        <div className="flex-1 h-6 bg-neutral-900 rounded overflow-hidden relative">
                          <motion.div
                            initial={{ width: 0 }}
                            animate={{ width: `${width}%` }}
                            transition={{ duration: 0.8, delay: 0.5 + idx * 0.2 + i * 0.1 }}
                            className="h-full rounded"
                            style={{
                              background: item.type === 'positive' ? '#3B82F6' : '#6B7280',
                              boxShadow: item.type === 'positive' ? '0 0 10px rgba(59,130,246,0.4)' : 'none'
                            }}
                          />
                          <div className="absolute right-2 top-1/2 -translate-y-1/2 text-[10px] font-semibold text-white">
                            {item.type === 'positive' ? '+' : '-'}${Math.abs(item.value)}
                          </div>
                        </div>
                      </motion.div>
                    );
                  })}

                  {/* Profit line */}
                  <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.9 + idx * 0.2 }}
                    className="border-t border-neutral-700 pt-2 mt-3"
                  >
                    <div className="flex items-center gap-3">
                      <div className="w-16 text-[10px] font-bold text-white text-right">PROFIT</div>
                      <div className="flex-1 h-8 bg-neutral-900 rounded overflow-hidden relative">
                        <motion.div
                          initial={{ width: 0 }}
                          animate={{ width: `${Math.max(0, scenario.profit) / scenario.revenue * 100}%` }}
                          transition={{ duration: 1, delay: 1 + idx * 0.2 }}
                          className="h-full rounded"
                          style={{
                            background: scenario.profit > 0 ? scenario.color : '#EF4444',
                            boxShadow: `0 0 15px ${scenario.profit > 0 ? scenario.color : '#EF4444'}50`
                          }}
                        />
                        <div className="absolute right-2 top-1/2 -translate-y-1/2 text-sm font-bold" style={{ color: scenario.profit > 0 ? scenario.color : '#EF4444' }}>
                          {scenario.profit > 0 ? '+' : ''}${scenario.profit}
                        </div>
                      </div>
                    </div>
                  </motion.div>
                </div>
              </motion.div>
            ))}
          </div>

          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1.2 }}
            className="text-center text-neutral-500 text-sm mt-5"
          >
            The low margin store actually <span className="text-red-400 font-semibold">loses $2</span> per sale after all costs. The high margin store keeps <span className="text-green-400 font-semibold">$71 profit</span>.
          </motion.p>
        </div>
      );
    };

    // NEW: Fortress Tower Slide - Visual tower comparison
    const FortressTowerSlide = ({ data }) => {
      const Tower = ({ towerData, color, isLow, delay }) => {
        const items = isLow ? towerData.threats : towerData.shields;
        const heightPercent = towerData.height;

        return (
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay }}
            className="flex flex-col items-center"
          >
            {/* Tower label */}
            <div className="text-xs font-bold tracking-wider mb-3" style={{ color }}>{towerData.label}</div>

            {/* Tower visual */}
            <div className="relative w-28 h-48 md:w-32 md:h-56 flex items-end justify-center mb-4">
              {/* Background frame */}
              <div className="absolute inset-x-0 bottom-0 h-full border-2 border-dashed border-neutral-700 rounded-t-lg opacity-30" />

              {/* Animated tower */}
              <motion.div
                initial={{ height: 0 }}
                animate={{ height: `${heightPercent}%` }}
                transition={{ duration: 1.5, delay: delay + 0.3, ease: 'easeOut' }}
                className="relative w-full rounded-t-lg"
                style={{
                  background: `linear-gradient(180deg, ${color}40 0%, ${color}20 100%)`,
                  border: `2px solid ${color}`,
                  boxShadow: `0 0 30px ${color}30, inset 0 0 20px ${color}10`
                }}
              >
                {/* Tower windows/details */}
                <div className="absolute inset-0 flex flex-col justify-around items-center py-3">
                  {[...Array(Math.floor(heightPercent / 25))].map((_, i) => (
                    <motion.div
                      key={i}
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: delay + 0.8 + i * 0.2 }}
                      className="w-4 h-4 rounded"
                      style={{ background: `${color}60`, boxShadow: `0 0 8px ${color}` }}
                    />
                  ))}
                </div>

                {/* Profit badge */}
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  transition={{ delay: delay + 1.2, type: 'spring' }}
                  className="absolute -top-4 left-1/2 -translate-x-1/2 px-3 py-1 rounded-full text-white text-sm font-bold whitespace-nowrap"
                  style={{ background: color, boxShadow: `0 0 15px ${color}` }}
                >
                  {towerData.profit}
                </motion.div>
              </motion.div>
            </div>

            {/* Items list */}
            <div className="w-full max-w-[160px]">
              {items.map((item, i) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: isLow ? -10 : 10 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: delay + 0.5 + i * 0.1 }}
                  className="flex items-center gap-2 py-1"
                >
                  <span className="w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ background: color }} />
                  <span className="text-[11px] text-neutral-400">{item}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        );
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Shield size={14} color="var(--accent)" />
              <span>Visual Metaphor</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="rounded-2xl p-6 md:p-8" style={{ background: '#0a0a0a' }}>
            <div className="grid grid-cols-2 gap-8">
              <Tower towerData={data.lowTower} color="#EF4444" isLow={true} delay={0.2} />
              <Tower towerData={data.highTower} color="#22C55E" isLow={false} delay={0.4} />
            </div>
          </div>

          <motion.p
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 1.5 }}
            className="text-center text-neutral-500 text-sm mt-5"
          >
            Low margins = Glass house. High margins = Profit fortress.
          </motion.p>
        </div>
      );
    };

    // NEW: Pricing Pyramid Slide - Shows pricing tiers as pyramid
    const PricingPyramidSlide = ({ data }) => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Layers size={14} color="var(--accent)" />
              <span>Positioning Strategy</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          {/* Pyramid container */}
          <div className="rounded-2xl p-6 md:p-8" style={{ background: '#0a0a0a', boxShadow: '0 0 40px rgba(0,0,0,0.3)' }}>
            <div className="flex flex-col items-center gap-3">
              {[...data.tiers].reverse().map((tier, idx) => {
                const reversedIdx = data.tiers.length - 1 - idx;
                return (
                  <motion.div
                    key={idx}
                    initial={{ opacity: 0, scale: 0.8, y: 20 }}
                    animate={{ opacity: 1, scale: 1, y: 0 }}
                    transition={{ delay: 0.2 + reversedIdx * 0.2 }}
                    className="relative rounded-xl p-4 text-center transition-all"
                    style={{
                      width: tier.width,
                      background: `linear-gradient(135deg, ${tier.color}20 0%, ${tier.color}10 100%)`,
                      border: `2px solid ${tier.color}`,
                      boxShadow: `0 0 20px ${tier.color}20`
                    }}
                  >
                    <div className="flex items-center justify-between">
                      <div className="text-left">
                        <div className="text-xs font-bold tracking-wider mb-1" style={{ color: tier.color }}>{tier.level}</div>
                        <div className="text-[10px] text-neutral-500">{tier.audience}</div>
                      </div>
                      <div className="text-right">
                        <div className="text-xl font-bold text-white">{tier.price}</div>
                        <div className="text-[10px] font-semibold" style={{ color: tier.color }}>{tier.margin} margin</div>
                      </div>
                    </div>

                    {/* Margin bar */}
                    <div className="mt-3 h-1.5 bg-neutral-800 rounded-full overflow-hidden">
                      <motion.div
                        initial={{ width: 0 }}
                        animate={{ width: tier.margin }}
                        transition={{ duration: 1, delay: 0.5 + reversedIdx * 0.2 }}
                        className="h-full rounded-full"
                        style={{ background: tier.color, boxShadow: `0 0 8px ${tier.color}` }}
                      />
                    </div>
                  </motion.div>
                );
              })}
            </div>

            {/* Arrow pointing up */}
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 1 }}
              className="flex flex-col items-center mt-6"
            >
              <svg width="24" height="40" viewBox="0 0 24 40" fill="none" className="text-purple-400">
                <path d="M12 38V2M12 2L3 11M12 2L21 11" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"/>
              </svg>
              <span className="text-xs text-purple-400 font-semibold mt-2">Aim Higher</span>
            </motion.div>
          </div>
        </div>
      );
    };

    // NEW: Implementation Guide Slide - Natural tool integration
    const ImplementationGuideSlide = ({ data }) => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Target size={14} color="var(--accent)" />
              <span>How To Implement</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          {/* Implementation steps */}
          <div className="space-y-4 mb-6">
            {data.steps.map((step, i) => {
              const IconComponent = Icons[step.icon] || Icons.Check;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.15 + i * 0.15 }}
                  className="rounded-xl p-5 relative overflow-hidden"
                  style={{ background: '#0a0a0a', border: `1px solid ${step.color}30`, boxShadow: `0 0 20px ${step.color}08` }}
                >
                  <div className="absolute top-0 right-0 w-24 h-24 rounded-full blur-3xl -mr-12 -mt-12" style={{ background: `${step.color}10` }} />

                  <div className="flex items-start gap-4 relative z-10">
                    <div className="w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0" style={{ background: `${step.color}20`, border: `1px solid ${step.color}40` }}>
                      <IconComponent size={20} color={step.color} />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="text-[10px] font-bold px-2 py-0.5 rounded" style={{ background: step.color, color: 'white' }}>Step {step.step}</span>
                        <span className="text-sm font-bold text-white">{step.title}</span>
                      </div>
                      <p className="text-neutral-400 text-sm leading-relaxed">{step.description}</p>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>

          {/* Pro tip with natural tool mention */}
          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.7 }}
            className="rounded-xl p-4 border border-neutral-200 bg-neutral-50"
          >
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center flex-shrink-0">
                <Icons.Zap />
              </div>
              <div>
                <p className="text-neutral-700 text-sm leading-relaxed">
                  <strong className="text-purple-600">Pro tip:</strong> {data.proTip}
                </p>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none" style={{ height: '30%', maxHeight: '200px', marginRight: '3%', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 0.2 }} />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    // Hormozi Slide - Premium Principle with Hormozi image
    const HormoziSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        {/* Content area - left side */}
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-2xl slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            className="mb-4"
          >
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.DollarSign size={14} color="var(--accent)" />
              <span>Premium Strategy</span>
            </span>
          </motion.div>
          <motion.h2
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.1 }}
            className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6"
          >
            {data.title}
          </motion.h2>
          <motion.p
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="text-base md:text-lg text-neutral-600 leading-relaxed mb-6"
          >
            {data.body}
          </motion.p>
          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.3 }}
            className="rounded-xl p-4 max-w-md"
            style={{ background: '#0a0a0a', border: '1px solid rgba(var(--accent-rgb), 0.3)' }}
          >
            <p className="text-white text-sm font-medium leading-relaxed">
              <span style={{ color: 'var(--accent)' }}>"</span>Sell to rich people. Their expectations for $100 are far lower than someone giving you 10% of their net worth.<span style={{ color: 'var(--accent)' }}>"</span>
            </p>
            <p className="text-neutral-500 text-xs mt-2">— Alex Hormozi</p>
          </motion.div>
        </div>

        {/* Hormozi image - bottom right, 60% height */}
        <motion.div
          initial={{ opacity: 0, x: 50 }}
          animate={{ opacity: 1, x: 0 }}
          transition={{ delay: 0.4, duration: 0.6 }}
          className="absolute bottom-0 right-0 z-0 pointer-events-none"
          style={{ height: '60vh' }}
        >
          <img
            src={data.image}
            alt="Alex Hormozi"
            className="h-full w-auto object-contain object-bottom"
            style={{ maxWidth: '40vw' }}
          />
        </motion.div>
      </div>
    );

    // Premium Pillars Slide - 5 pillars of premium pricing
    const PremiumPillarsSlide = ({ data }) => {
      const getIcon = (iconName) => {
        const iconMap = { Palette: Icons.Palette, BookOpen: Icons.BookOpen, Gift: Icons.Gift, Clock: Icons.Clock2, Star: Icons.Star };
        return iconMap[iconName] || Icons.Check;
      };
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Layers size={14} color="var(--accent)" />
              <span>Premium Framework</span>
            </span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>
          <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
            {data.pillars.map((pillar, i) => {
              const IconComponent = getIcon(pillar.icon);
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  className="rounded-xl p-4 text-center relative overflow-hidden"
                  style={{ background: '#0a0a0a', border: `1px solid ${pillar.color}30` }}
                >
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 w-16 h-16 rounded-full blur-2xl -mt-8" style={{ background: pillar.color, opacity: 0.2 }} />
                  <div className="relative z-10">
                    <div className="w-10 h-10 rounded-lg mx-auto mb-3 flex items-center justify-center" style={{ background: `${pillar.color}20`, border: `1px solid ${pillar.color}40` }}>
                      <IconComponent size={20} color={pillar.color} />
                    </div>
                    <div className="text-white font-bold text-sm mb-2">{pillar.name}</div>
                    <p className="text-neutral-400 text-[10px] leading-relaxed">{pillar.description}</p>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Premium Markup Slide - Shows markup levels
    const PremiumMarkupSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
            <Icons.DollarSign size={14} color="var(--accent)" />
            <span>Markup Strategy</span>
          </span>
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>
        <div className="space-y-3 mb-6">
          {data.scenarios.map((scenario, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.15 + i * 0.15 }}
              className="rounded-xl overflow-hidden"
              style={{ border: `1px solid ${scenario.color}30` }}
            >
              <div className="flex items-center gap-4 p-4" style={{ background: '#0a0a0a' }}>
                <div className="w-14 h-14 rounded-xl flex flex-col items-center justify-center flex-shrink-0" style={{ background: `${scenario.color}20`, border: `1px solid ${scenario.color}40` }}>
                  <span className="text-lg font-bold" style={{ color: scenario.color }}>{scenario.markup}</span>
                </div>
                <div className="flex-1">
                  <div className="flex items-center gap-2 mb-1">
                    <span className="text-white font-bold text-sm">{scenario.level}</span>
                    <span className="px-2 py-0.5 rounded-full text-[10px] font-bold" style={{ background: `${scenario.color}20`, color: scenario.color }}>{scenario.margin} margin</span>
                  </div>
                  <p className="text-neutral-400 text-xs">{scenario.example}</p>
                </div>
              </div>
              <div className="px-4 py-2 bg-neutral-50 border-t border-neutral-100">
                <p className="text-neutral-600 text-xs">{scenario.description}</p>
              </div>
            </motion.div>
          ))}
        </div>
        <motion.div
          initial={{ opacity: 0, y: 15 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
          className="rounded-xl p-4 text-center"
          style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}
        >
          <p className="text-white text-sm font-medium">{data.insight}</p>
        </motion.div>
      </div>
    );

    const StatCountdownSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-6">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }} className="bg-neutral-900 rounded-xl p-6 text-center">
              <div className="text-5xl font-bold mb-2" style={{ color: 'var(--accent)' }}>
                <AnimatedCounter target={stat.value} suffix={stat.suffix} prefix={stat.prefix} />
              </div>
              <div className="text-sm font-semibold text-white mb-1">{stat.label}</div>
              <div className="text-xs text-neutral-400">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const MockupSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 }} className="bg-white border-2 border-neutral-200 rounded-2xl p-8 mb-4">
          <div dangerouslySetInnerHTML={{ __html: data.svgContent }} />
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-neutral-600 text-sm text-center max-w-2xl mx-auto">{data.caption}</motion.p>
      </div>
    );

    const HighlightBoxSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed mb-6">{data.body}</motion.p>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-xl p-6 text-center" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
          <p className="text-white text-lg font-bold">{data.highlight}</p>
        </motion.div>
      </div>
    );

    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          {/* BEFORE Card - Dark with red border */}
          <motion.div
            initial={{ opacity: 0, x: -30 }}
            animate={{ opacity: 1, x: 0 }}
            className="relative"
          >
            <div
              className="absolute -top-3 left-4 px-3 py-1 text-xs font-bold rounded-full z-10"
              style={{ background: '#EF4444', color: 'white', boxShadow: '0 0 10px rgba(239, 68, 68, 0.4)' }}
            >BEFORE</div>
            <div
              className="rounded-2xl p-6 pt-8 relative overflow-hidden"
              style={{
                background: '#0a0a0a',
                border: '1px solid #EF4444',
                boxShadow: '0 0 25px rgba(239, 68, 68, 0.12)'
              }}
            >
              <div className="absolute top-0 left-0 w-32 h-32 rounded-full blur-3xl -ml-16 -mt-16" style={{ background: 'rgba(239, 68, 68, 0.08)' }}></div>
              <ul className="space-y-3 relative z-10">
                {data.before.map((item, i) => (
                  <motion.li
                    key={i}
                    initial={{ opacity: 0, x: -10 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.2 + i * 0.08 }}
                    className="flex items-start gap-3"
                  >
                    <span className="flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5" style={{ background: 'rgba(239, 68, 68, 0.15)', border: '1px solid #EF4444' }}>
                      <Icons.X />
                    </span>
                    <span className="text-sm text-neutral-300">{item}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
          {/* AFTER Card - Dark with green border */}
          <motion.div
            initial={{ opacity: 0, x: 30 }}
            animate={{ opacity: 1, x: 0 }}
            transition={{ delay: 0.15 }}
            className="relative"
          >
            <div
              className="absolute -top-3 left-4 px-3 py-1 text-xs font-bold rounded-full z-10"
              style={{ background: '#22C55E', color: 'white', boxShadow: '0 0 10px rgba(34, 197, 94, 0.4)' }}
            >AFTER</div>
            <div
              className="rounded-2xl p-6 pt-8 relative overflow-hidden"
              style={{
                background: '#0a0a0a',
                border: '1px solid #22C55E',
                boxShadow: '0 0 25px rgba(34, 197, 94, 0.12)'
              }}
            >
              <div className="absolute top-0 right-0 w-32 h-32 rounded-full blur-3xl -mr-16 -mt-16" style={{ background: 'rgba(34, 197, 94, 0.08)' }}></div>
              <ul className="space-y-3 relative z-10">
                {data.after.map((item, i) => (
                  <motion.li
                    key={i}
                    initial={{ opacity: 0, x: -10 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.35 + i * 0.08 }}
                    className="flex items-start gap-3"
                  >
                    <span className="flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5" style={{ background: 'rgba(34, 197, 94, 0.15)', border: '1px solid #22C55E' }}>
                      <Icons.Check />
                    </span>
                    <span className="text-sm text-neutral-300">{item}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
        </div>
      </div>
    );

    const ComparisonCardsSlide = ({ data }) => {
      const LeftIcon = data.left.iconComponent ? Icons[data.left.iconComponent] : null;
      const RightIcon = data.right.iconComponent ? Icons[data.right.iconComponent] : null;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-6">
            {/* Left Card - Negative (Dark with red border) */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              className="rounded-2xl p-6 relative overflow-hidden"
              style={{
                background: '#0a0a0a',
                border: '1px solid #EF4444',
                boxShadow: '0 0 30px rgba(239, 68, 68, 0.15), inset 0 1px 0 rgba(255,255,255,0.03)'
              }}
            >
              <div className="absolute top-0 right-0 w-40 h-40 rounded-full blur-3xl -mr-20 -mt-20" style={{ background: 'rgba(239, 68, 68, 0.08)' }}></div>
              <div className="relative z-10">
                <div className="flex items-center justify-between mb-5">
                  <span className="text-xs font-bold tracking-wider" style={{ color: '#EF4444' }}>{data.left.label}</span>
                  {LeftIcon && <LeftIcon size={28} color="#EF4444" />}
                </div>
                <div className="mb-5">
                  <div className="text-4xl font-bold text-white mb-1">{data.left.value}</div>
                  <div className="text-neutral-500 text-sm">{data.left.subtext}</div>
                </div>
                {/* Animated Progress Bar */}
                <div className="mb-5">
                  <div className="h-2 rounded-full overflow-hidden" style={{ background: 'rgba(239, 68, 68, 0.15)' }}>
                    <motion.div
                      initial={{ width: 0 }}
                      animate={{ width: data.left.percentage || '35%' }}
                      transition={{ duration: 1.2, ease: 'easeOut', delay: 0.3 }}
                      className="h-full rounded-full"
                      style={{
                        background: 'linear-gradient(90deg, #EF4444, #DC2626)',
                        boxShadow: '0 0 10px rgba(239, 68, 68, 0.5)'
                      }}
                    />
                  </div>
                </div>
                <div className="border-t border-neutral-800/50 pt-4">
                  <ul className="space-y-2.5">
                    {data.left.items.map((item, i) => (
                      <motion.li
                        key={i}
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.4 + i * 0.1 }}
                        className="flex items-center gap-2.5 text-neutral-400 text-sm"
                      >
                        <span className="w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ background: '#EF4444', boxShadow: '0 0 6px rgba(239, 68, 68, 0.6)' }}></span>
                        {item}
                      </motion.li>
                    ))}
                  </ul>
                </div>
              </div>
            </motion.div>
            {/* Right Card - Positive (Dark with green border) */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.15 }}
              className="rounded-2xl p-6 relative overflow-hidden"
              style={{
                background: '#0a0a0a',
                border: '1px solid #22C55E',
                boxShadow: '0 0 30px rgba(34, 197, 94, 0.15), inset 0 1px 0 rgba(255,255,255,0.03)'
              }}
            >
              <div className="absolute top-0 right-0 w-40 h-40 rounded-full blur-3xl -mr-20 -mt-20" style={{ background: 'rgba(34, 197, 94, 0.08)' }}></div>
              <div className="relative z-10">
                <div className="flex items-center justify-between mb-5">
                  <span className="text-xs font-bold tracking-wider" style={{ color: '#22C55E' }}>{data.right.label}</span>
                  {RightIcon && <RightIcon size={28} color="#22C55E" />}
                </div>
                <div className="mb-5">
                  <div className="text-4xl font-bold text-white mb-1">{data.right.value}</div>
                  <div className="text-neutral-500 text-sm">{data.right.subtext}</div>
                </div>
                {/* Animated Progress Bar */}
                <div className="mb-5">
                  <div className="h-2 rounded-full overflow-hidden" style={{ background: 'rgba(34, 197, 94, 0.15)' }}>
                    <motion.div
                      initial={{ width: 0 }}
                      animate={{ width: data.right.percentage || '85%' }}
                      transition={{ duration: 1.2, ease: 'easeOut', delay: 0.45 }}
                      className="h-full rounded-full"
                      style={{
                        background: 'linear-gradient(90deg, #22C55E, #16A34A)',
                        boxShadow: '0 0 10px rgba(34, 197, 94, 0.5)'
                      }}
                    />
                  </div>
                </div>
                <div className="border-t border-neutral-800/50 pt-4">
                  <ul className="space-y-2.5">
                    {data.right.items.map((item, i) => (
                      <motion.li
                        key={i}
                        initial={{ opacity: 0, x: -10 }}
                        animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.55 + i * 0.1 }}
                        className="flex items-center gap-2.5 text-neutral-400 text-sm"
                      >
                        <span className="w-1.5 h-1.5 rounded-full flex-shrink-0" style={{ background: '#22C55E', boxShadow: '0 0 6px rgba(34, 197, 94, 0.6)' }}></span>
                        {item}
                      </motion.li>
                    ))}
                  </ul>
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      );
    };

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand why selling cheap is a death sentence. Low margins create fragile businesses. High margins create profit fortresses. The extra margin lets you over-deliver while staying profitable. Build your fortress.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'hormozi': return <HormoziSlide data={slide} />;
          case 'premium-pillars': return <PremiumPillarsSlide data={slide} />;
          case 'premium-markup': return <PremiumMarkupSlide data={slide} />;
          case 'stat-countdown': return <StatCountdownSlide data={slide} />;
          case 'mockup': return <MockupSlide data={slide} />;
          case 'highlight-box': return <HighlightBoxSlide data={slide} />;
          case 'before-after': return <BeforeAfterSlide data={slide} />;
          case 'comparison-cards': return <ComparisonCardsSlide data={slide} />;
          case 'margin-meter': return <MarginMeterSlide data={slide} />;
          case 'profit-waterfall': return <ProfitWaterfallSlide data={slide} />;
          case 'fortress-tower': return <FortressTowerSlide data={slide} />;
          case 'pricing-pyramid': return <PricingPyramidSlide data={slide} />;
          case 'implementation-guide': return <ImplementationGuideSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
