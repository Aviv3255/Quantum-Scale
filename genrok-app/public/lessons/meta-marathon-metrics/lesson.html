<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Marathon Metrics: Measuring What Actually Matters | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #10b981; --accent-dark: #059669; --accent-light: #34d399; --accent-rgb: 16, 185, 129; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'meta-marathon-metrics',
      title: 'Marathon Metrics: Measuring What Matters',
      description: 'Omnipresent Content won\'t show high direct ROAS. That\'s by design. Learn the 4 leading indicators that actually measure success.',
      accentColor: '#10b981',
      duration: '6 min',
      nextLesson: { id: 'meta-ai-era-edge', title: 'Your 3 Unfair Advantages in the AI Era', teaser: 'Discover the only three competitive advantages that AI can\'t automate away.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why Omnipresent Content won\'t show high direct ROAS (and why that\'s okay)', 'The 4 leading indicators that reveal true success', 'How to build a dashboard that measures ecosystem impact'] },
      { type: 'hook', headline: 'Your boss asks: "What\'s the ROAS on that Omnipresent Content campaign?" You say: "0.8x." They say: "Shut it down." And you just killed the engine that was driving 40% of your other campaigns\' success.', subtext: 'Omnipresent Content is a marathon, not a sprint. Measuring it like a direct-response campaign is like measuring a gym membership by asking "How much weight did you lose today?" Wrong question. Wrong timeframe. Wrong metric.' , brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/H&M-Logo.svg.png', brandName: 'H&M' },
      { type: 'content', title: 'The Measurement Trap', body: 'Here\'s why most advertisers kill their best campaigns:\n\nThey measure Omnipresent Content the same way they measure direct-response ads.\n\nDirect-response: "I spent $100, made $400. ROAS is 4x. Good."\n\nOmnipresent Content: "I spent $100, made... $80? ROAS is 0.8x. Bad."\n\nBut wait. That $100 in Omnipresent Content also:\n\n• Increased brand recall by 34%\n• Made your sales campaigns convert 28% better\n• Generated 150 new followers\n• Created 12 inbound leads who said "I\'ve been seeing you everywhere"\n\nNone of that shows up in the ROAS column. All of it shows up in your revenue.' },
      { type: 'insight', title: 'The Reality of Asset-Building', quote: 'Omnipresent Content is a long-term asset-building strategy. It will not have a high direct ROAS in Ads Manager, and that\'s by design.', explanation: 'Its true impact is measured by its effect on your entire ecosystem. You\'re building mental real estate, not buying clicks.' },
      { type: 'metrics', title: 'The 4 Leading Indicators', indicators: [
        {
          number: '01',
          title: 'Improved Performance in Other Campaigns',
          icon: 'chart',
          description: 'A noticeable lift in conversion rates and ROAS in your separate, direct-response sales campaigns.',
          what: 'Your sales campaigns suddenly perform 15-30% better',
          why: 'Omnipresent Content pre-warmed the audience. When they see your sales ad, they already trust you.',
          measure: 'Compare sales campaign ROAS before and 4-6 weeks after launching Omnipresent Content'
        },
        {
          number: '02',
          title: 'Qualitative Feedback',
          icon: 'chat',
          description: 'Prospects and new customers consistently say things like, "I see you guys everywhere."',
          what: 'New customers mention seeing your brand repeatedly',
          why: 'You\'ve successfully occupied mental real estate. You\'re top-of-mind when they\'re ready.',
          measure: 'Add post-purchase survey: "Where did you first hear about us?" Track "I\'ve been seeing you everywhere" responses'
        },
        {
          number: '03',
          title: 'Growth in Brand Metrics',
          icon: 'trending',
          description: 'A steady increase in social media follower counts and positive engagement on your ads and organic posts.',
          what: 'Follower growth, engagement rates, and positive comments increase',
          why: 'Trust and value delivery compound over time. Your brand becomes a magnet.',
          measure: 'Track weekly follower growth, engagement rate, and sentiment in comments'
        },
        {
          number: '04',
          title: 'Increased Inbound Demand',
          icon: 'inbox',
          description: 'More organic and direct traffic, and more leads saying they\'ve been "following you for a while."',
          what: 'Organic traffic, direct traffic, and inbound DMs increase',
          why: 'Omnipresence creates inevitability. When they\'re ready, you\'re the only option.',
          measure: 'Track organic/direct traffic growth and lead source attribution'
        }
      ]},
      { type: 'dashboard', title: 'Your Marathon Metrics Dashboard', sections: [
        { title: 'Lagging Indicators (What most people check)', items: ['Omnipresent Campaign ROAS', 'Cost Per Result'], warning: 'These will look "bad" - that\'s expected' },
        { title: 'Leading Indicators (What actually matters)', items: ['Sales Campaign ROAS Trend', 'Qualitative Feedback %', 'Follower Growth Rate', 'Inbound Lead Increase'], success: 'Track these weekly. Growth here = strategy working' }
      ]},
      { type: 'timeline', title: 'The Marathon Timeline', milestones: [
        { week: 'Week 1-2', status: 'Learning', description: 'GEM learning your audiences. ROAS looks terrible. Don\'t panic.', color: '#ef4444' },
        { week: 'Week 3-4', status: 'Building', description: 'First signals appear. Followers increase. Some qualitative feedback.', color: '#f59e0b' },
        { week: 'Week 5-8', status: 'Compounding', description: 'Sales campaigns improve. "I see you everywhere" comments increase.', color: '#10b981' },
        { week: 'Week 9+', status: 'Dominant', description: 'Full ecosystem effect. You\'re the obvious choice when they\'re ready.', color: '#3b82f6' }
      ]},
      { type: 'content', title: 'How to Explain This to Your Boss', body: '"We\'re running a brand-building campaign that won\'t show direct ROAS. Here\'s why it matters:"\n\n1. "Our sales campaigns improved by X% since we started"\n2. "New customers are mentioning seeing us everywhere"\n3. "Inbound leads increased by X%"\n4. "Our cost per acquisition across ALL campaigns dropped by X%"\n\n"This campaign is the reason our other campaigns work better. It\'s like asking what\'s the ROI of the foundation on a house - you can\'t measure it directly, but without it, the whole thing falls down."' },
      { type: 'comparison', title: 'Sprint vs. Marathon Metrics', sprint: {
        title: 'Sprint Metrics',
        icon: 'bolt',
        items: ['Direct ROAS', 'Cost Per Purchase', 'Immediate Revenue', 'Click-Through Rate'],
        use: 'For direct-response sales campaigns'
      }, marathon: {
        title: 'Marathon Metrics',
        icon: 'trophy',
        items: ['Ecosystem ROAS Lift', 'Brand Recall Increase', 'Inbound Lead Growth', 'Qualitative Feedback'],
        use: 'For Omnipresent Content campaigns'
      }},
      { type: 'quiz', question: 'Your Omnipresent Content campaign shows 0.9x ROAS after 4 weeks. Meanwhile, your sales campaigns improved by 25%. What should you do?', options: ['Shut down the Omnipresent campaign - it\'s losing money', 'Continue and monitor the 4 leading indicators - the strategy is working', 'Double the budget on Omnipresent to try to fix the ROAS', 'Pivot all budget to direct-response campaigns only'], correctIndex: 1, feedback: { correct: 'Exactly! A 25% improvement in sales campaigns is a massive win. That\'s the Omnipresent Content strategy working perfectly. The 0.9x direct ROAS is expected - you\'re building trust, not buying instant conversions. Keep monitoring the 4 leading indicators: sales campaign lift, qualitative feedback, brand metrics, and inbound demand. The marathon is working.', incorrect: 'Not quite. A 0.9x direct ROAS is EXPECTED for Omnipresent Content - it\'s a brand-building strategy, not a direct-response campaign. The 25% improvement in sales campaigns is the real success indicator. This means the strategy is working: Omnipresent Content is pre-warming audiences, making your sales campaigns convert better. Keep monitoring the 4 leading indicators and trust the marathon.' }},
      { type: 'completion', sources: [{ name: 'The Meta Iceberg: Unlocking AI Mastery', url: '#' }] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Chart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="18" y1="20" x2="18" y2="10"/><line x1="12" y1="20" x2="12" y2="4"/><line x1="6" y1="20" x2="6" y2="14"/></svg>,
      Chat: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
      Trending: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Inbox: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 16 12 14 15 10 15 8 12 2 12"/><path d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"/></svg>,
      Bolt: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Trophy: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none" style={{ height: '30%', maxHeight: '200px', marginRight: '3%', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed whitespace-pre-line">{data.body}</motion.p>
      </div>
    );

    const InsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.15 }} className="rounded-2xl p-8 md:p-12 mb-6" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
          <p className="text-xl md:text-2xl font-bold text-white text-center leading-relaxed">"{data.quote}"</p>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-base md:text-lg text-neutral-600 text-center leading-relaxed">{data.explanation}</motion.p>
      </div>
    );

    const MetricsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-4">
          {data.indicators.map((indicator, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="bg-white border-2 border-emerald-200 rounded-xl p-5 hover:border-emerald-400 transition-all">
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 rounded-lg flex items-center justify-center text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
                  {indicator.icon === 'chart' && <Icons.Chart />}
                  {indicator.icon === 'chat' && <Icons.Chat />}
                  {indicator.icon === 'trending' && <Icons.Trending />}
                  {indicator.icon === 'inbox' && <Icons.Inbox />}
                </div>
                <div>
                  <span className="text-xs text-emerald-600 font-mono">{indicator.number}</span>
                  <h3 className="text-base font-bold text-black">{indicator.title}</h3>
                </div>
              </div>
              <p className="text-sm text-neutral-600 mb-3">{indicator.description}</p>
              <div className="space-y-2 text-xs">
                <div className="bg-emerald-50 rounded-lg p-2">
                  <span className="font-semibold text-emerald-700">What:</span>
                  <span className="text-emerald-600 ml-1">{indicator.what}</span>
                </div>
                <div className="bg-blue-50 rounded-lg p-2">
                  <span className="font-semibold text-blue-700">Why:</span>
                  <span className="text-blue-600 ml-1">{indicator.why}</span>
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const DashboardSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="space-y-6">
          {data.sections.map((section, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.2 }} className={`rounded-xl p-5 ${section.warning ? 'bg-neutral-100 border-2 border-neutral-300' : 'bg-emerald-50 border-2 border-emerald-300'}`}>
              <h3 className={`font-bold mb-3 ${section.warning ? 'text-neutral-700' : 'text-emerald-700'}`}>{section.title}</h3>
              <div className="grid md:grid-cols-2 gap-2 mb-3">
                {section.items.map((item, j) => (
                  <div key={j} className={`rounded-lg px-4 py-2 text-sm ${section.warning ? 'bg-white text-neutral-600' : 'bg-white text-emerald-700'}`}>{item}</div>
                ))}
              </div>
              {section.warning && <p className="text-xs text-red-500 italic">{section.warning}</p>}
              {section.success && <p className="text-xs text-emerald-600 italic">{section.success}</p>}
            </motion.div>
          ))}
        </div>
      </div>
    );

    const TimelineSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="relative">
          <div className="absolute left-4 top-0 bottom-0 w-1 bg-neutral-200 rounded-full" />
          <div className="space-y-6">
            {data.milestones.map((milestone, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.15 }} className="relative pl-12">
                <div className="absolute left-0 w-9 h-9 rounded-full flex items-center justify-center text-white text-xs font-bold" style={{ background: milestone.color }}>{i + 1}</div>
                <div className="bg-white border-2 rounded-xl p-4" style={{ borderColor: milestone.color }}>
                  <div className="flex items-center gap-3 mb-2">
                    <span className="text-sm font-bold" style={{ color: milestone.color }}>{milestone.week}</span>
                    <span className="px-2 py-0.5 rounded-full text-xs text-white" style={{ background: milestone.color }}>{milestone.status}</span>
                  </div>
                  <p className="text-sm text-neutral-600">{milestone.description}</p>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </div>
    );

    const ComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-amber-50 border-2 border-amber-300 rounded-2xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-xl bg-amber-500 flex items-center justify-center text-white">
                <Icons.Bolt />
              </div>
              <h3 className="text-xl font-bold text-amber-700">{data.sprint.title}</h3>
            </div>
            <ul className="space-y-2 mb-4">
              {data.sprint.items.map((item, i) => (
                <li key={i} className="text-sm text-amber-700 flex items-center gap-2">
                  <span className="w-2 h-2 rounded-full bg-amber-500" />
                  {item}
                </li>
              ))}
            </ul>
            <div className="bg-amber-100 rounded-lg p-3">
              <span className="text-xs text-amber-600">{data.sprint.use}</span>
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="bg-emerald-50 border-2 border-emerald-300 rounded-2xl p-6">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
                <Icons.Trophy />
              </div>
              <h3 className="text-xl font-bold text-emerald-700">{data.marathon.title}</h3>
            </div>
            <ul className="space-y-2 mb-4">
              {data.marathon.items.map((item, i) => (
                <li key={i} className="text-sm text-emerald-700 flex items-center gap-2">
                  <span className="w-2 h-2 rounded-full bg-emerald-500" />
                  {item}
                </li>
              ))}
            </ul>
            <div className="bg-emerald-100 rounded-lg p-3">
              <span className="text-xs text-emerald-600">{data.marathon.use}</span>
            </div>
          </motion.div>
        </div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [answered, setAnswered] = useState(false);
      const handleSelect = (index) => {
        if (answered) return;
        setSelected(index);
        setAnswered(true);
        const isCorrect = index === data.correctIndex;
        const gif = isCorrect ? getRandomCelebrationGif() : getRandomEmpathyGif();
        onShowGif(gif, '50%', 'center');
        setTimeout(() => onHideGif(), 3000);
        onAnswer(isCorrect);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Knowledge Check</span>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>
          <div className="space-y-3 mb-6">
            {data.options.map((option, i) => (
              <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.05 }} onClick={() => handleSelect(i)} disabled={answered} className={`w-full text-left p-4 rounded-xl border-2 transition-all ${answered ? (i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-500 bg-red-50' : 'border-neutral-200 bg-neutral-50') : 'border-neutral-200 bg-white hover:border-emerald-300 hover:bg-emerald-50'}`}>
                <div className="flex items-center gap-3">
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${answered ? (i === data.correctIndex ? 'bg-green-500' : i === selected ? 'bg-red-500' : 'bg-neutral-300') : 'bg-neutral-200'}`}>
                    {answered && i === data.correctIndex && <Icons.Check className="text-white" />}
                    {answered && i === selected && i !== data.correctIndex && <Icons.X className="text-white" />}
                  </div>
                  <span className="text-sm md:text-base text-neutral-700">{option}</span>
                </div>
              </motion.button>
            ))}
          </div>
          <AnimatePresence>
            {answered && (
              <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className={`rounded-xl p-4 ${selected === data.correctIndex ? 'bg-green-50 border-2 border-green-200' : 'bg-emerald-50 border-2 border-emerald-200'}`}>
                <p className="text-sm text-neutral-700 leading-relaxed">{selected === data.correctIndex ? data.feedback.correct : data.feedback.incorrect}</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center text-center px-6 py-10">
        <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', duration: 0.6 }}>
          <div className="w-20 h-20 rounded-full flex items-center justify-center mb-4 mx-auto" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
            <Icons.Check className="text-white" />
          </div>
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="slide-title text-3xl md:text-4xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="text-neutral-600 text-base md:text-lg mb-6 max-w-md">You now know how to measure Omnipresent Content success - focus on the 4 leading indicators, not direct ROAS.</motion.p>
        {data.sources && data.sources.length > 0 && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-neutral-50 rounded-xl p-4 max-w-md w-full mb-6">
            <p className="text-xs uppercase tracking-wider text-neutral-400 mb-2">Sources</p>
            {data.sources.map((source, i) => (
              <div key={i} className="text-sm flex items-center gap-1 mb-1" style={{ color: 'var(--accent)' }}>{source.name}</div>
            ))}
          </motion.div>
        )}
        <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} onClick={() => window.location.href = '/dashboard'} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Back to Dashboard</motion.button>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(0);
      const [userName] = useState(getUserName());
      const [gif, setGif] = useState({ src: null, opacity: 0, side: 'center' });

      const showGif = useCallback((src, opacity, side) => { setGif({ src, opacity, side }); }, []);
      const hideGif = useCallback(() => { setGif(prev => ({ ...prev, opacity: 0 })); }, []);

      const nextSlide = useCallback(() => {
        if (currentSlide < slides.length - 1) {
          setDirection(1);
          setCurrentSlide(prev => prev + 1);
        }
      }, [currentSlide]);

      const prevSlide = useCallback(() => {
        if (currentSlide > 0) {
          setDirection(-1);
          setCurrentSlide(prev => prev - 1);
        }
      }, [currentSlide]);

      const startLesson = useCallback(() => {
        setDirection(1);
        setCurrentSlide(1);
      }, []);

      const handleAnswer = useCallback((correct) => {
        setTimeout(nextSlide, 3000);
      }, [nextSlide]);

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={startLesson} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'insight': return <InsightSlide data={slide} />;
          case 'metrics': return <MetricsSlide data={slide} />;
          case 'dashboard': return <DashboardSlide data={slide} />;
          case 'timeline': return <TimelineSlide data={slide} />;
          case 'comparison': return <ComparisonSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onAnswer={handleAnswer} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return <ContentSlide data={slide} />;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction}>
              <motion.div key={currentSlide} custom={direction} initial={{ opacity: 0, x: direction > 0 ? 100 : -100 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: direction > 0 ? -100 : 100 }} transition={{ duration: 0.3 }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => { if (Math.abs(i - currentSlide) === 1 || i === currentSlide) { setDirection(i > currentSlide ? 1 : -1); setCurrentSlide(i); } }} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gif.src && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gif.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gif.opacity }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gif.src} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>