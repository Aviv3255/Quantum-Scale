<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conviction Architecture | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #88da1c; --accent-dark: #6fb816; --accent-light: #a3e635; --accent-rgb: 136, 218, 28; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    // Animated Counter Component
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000, decimals = 0 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(start); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{decimals > 0 ? count.toFixed(decimals) : Math.floor(count)}{suffix}</span>;
    };

    // Animated Pyramid Layer
    const AnimatedPyramidLayer = ({ layer, index, total, isActive, onClick }) => {
      const widthPercent = 30 + (index * 25);
      const colors = {
        'apex': { bg: 'linear-gradient(135deg, #6366f1, #4f46e5)', glow: 'rgba(99, 102, 241, 0.4)' },
        'core': { bg: 'linear-gradient(135deg, #818cf8, #6366f1)', glow: 'rgba(129, 140, 248, 0.3)' },
        'foundation': { bg: 'linear-gradient(135deg, #a5b4fc, #818cf8)', glow: 'rgba(165, 180, 252, 0.3)' }
      };
      const layerColor = colors[layer.type] || colors.foundation;

      return (
        <motion.div
          initial={{ opacity: 0, y: 30, scale: 0.9 }}
          animate={{ opacity: 1, y: 0, scale: 1 }}
          transition={{ delay: 0.2 + (total - index - 1) * 0.15, duration: 0.5 }}
          onClick={onClick}
          className="cursor-pointer transition-all duration-300"
          style={{ width: `${widthPercent}%` }}
          whileHover={{ scale: 1.02 }}
        >
          <div
            className="py-4 md:py-5 px-4 md:px-6 text-center text-white rounded-xl transition-all duration-300"
            style={{
              background: layerColor.bg,
              boxShadow: isActive ? `0 0 30px ${layerColor.glow}, 0 8px 32px rgba(0,0,0,0.3)` : '0 4px 20px rgba(0,0,0,0.2)',
              border: isActive ? '2px solid rgba(255,255,255,0.3)' : '2px solid transparent'
            }}
          >
            <h4 className="font-bold text-sm md:text-lg mb-1">{layer.name}</h4>
            <p className="text-white/70 text-[10px] md:text-xs hidden md:block">{layer.shortDesc}</p>
          </div>
        </motion.div>
      );
    };

    const LESSON_CONFIG = {
      id: 'conviction-architecture',
      title: 'Conviction Architecture',
      description: 'The 3-layer pyramid that separates amateur marketers from masters of influence. Build messaging that converts consistently.',
      accentColor: '#6366f1',
      duration: '10 min',
      nextLesson: { id: 'copywriters-codex', title: 'Copywriter\'s Codex', teaser: 'Master the art of words that sell.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    // Per-slide bug reporting for admin users
    let __isAdmin = false;

    // Listen for admin status from parent
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') {
        __isAdmin = e.data.isAdmin;
      }
    });

    // Request admin status on load
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    // Admin Report Button Component
    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      // TEMP: if (!__isAdmin) return null; // TODO: restore before going live

      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button
          onClick={handleReport}
          title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{
            position: 'absolute',
            top: '12px',
            right: '12px',
            width: '32px',
            height: '32px',
            borderRadius: '8px',
            backgroundColor: 'rgba(239, 68, 68, 0.9)',
            color: 'white',
            border: 'none',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            opacity: 0.6,
            transition: 'opacity 0.2s, transform 0.2s',
            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
          }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/>
            <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/>
            <path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/>
            <path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============


    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['The 3-layer pyramid of conversion mastery', 'Why stories sell identities, not just products', 'How to build proof that creates fierce loyalty'] },
      { type: 'hook', headline: 'Mastery isn\'t in the tactics. It\'s in the architecture.', subtext: 'You can learn every psychological trick in the book. Every headline formula. Every persuasion technique. But without the right architecture underneath, it all crumbles. The masters build from the foundation upâ€”and that\'s what separates consistent converters from random luck.', characterVideo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_reading_intently_with_glasses_book_in_hand_--a_fae4f829-ea0b-4a5a-8fb0-3de395a6b6ee_2.mp4', characterPosition: 'right' },
      { type: 'stat-countdown', title: 'The Cost of Missing Architecture', stats: [
        { value: 97, suffix: '%', label: 'Marketers Fail', subtext: 'Without proper foundation' },
        { value: 3, suffix: 'x', label: 'More Consistent', subtext: 'With architectural approach' },
        { value: 1, prefix: '', suffix: '', label: 'Truth Matters', subtext: 'Trust is everything' }
      ]},
      { type: 'pyramid-visual', title: 'The Psychological Architecture of Conversion', layers: [
        { type: 'apex', name: 'THE MECHANICS', shortDesc: 'Pain-Dream precision', fullDesc: 'Engineering a decision using the Pain-Dream framework with precision. Only NOW do tactics matter. With the foundation and core in place, you can engineer decisions using frameworks with precision.', icon: 'âš™ï¸' },
        { type: 'core', name: 'THE METHOD', shortDesc: 'Authority & certainty', fullDesc: 'Forging your communication into an instrument of authority and certainty to create safety. Your customer\'s subconscious needs to feel safe before it can say "yes."', icon: 'ðŸŽ¯' },
        { type: 'foundation', name: 'THE MINDSET', shortDesc: 'Customer focus', fullDesc: 'A radical, external focus on the customer\'s inner world. Not your product. Not your features. Not your story. Their pains, dreams, language, and identity.', icon: 'ðŸ’­' }
      ], footer: 'When the foundation and core are strong, the mechanics work with precision and integrity.' },
      { type: 'layer-deep-dive', layerIndex: 2, title: 'Layer 1: The Mindset (Foundation)', icon: 'ðŸ’­', color: '#a5b4fc', content: 'Everything starts here. A radical, external focus on the customer\'s inner world. Not your product. Not your features. Not your story. Their pains, their dreams, their language, their identity. Without this foundation, every tactic you build on top will eventually collapse.', keyPoint: 'The Mindset is the ground truth that makes everything else work.' },
      { type: 'layer-deep-dive', layerIndex: 1, title: 'Layer 2: The Method (Core)', icon: 'ðŸŽ¯', color: '#818cf8', content: 'With the right mindset, you forge your communication into an instrument of authority and certainty. This is where you learn to transfer conviction, project confidence, and create psychological safety.', keyPoint: 'Your customer\'s subconscious needs to feel safe before it can say "yes."' },
      { type: 'layer-deep-dive', layerIndex: 0, title: 'Layer 3: The Mechanics (Apex)', icon: 'âš™ï¸', color: '#6366f1', content: 'Only NOW do tactics matter. With the foundation and core in place, you can engineer decisions using frameworks like Pain-Dream-Bridge with precision. The mechanics become powerful because they\'re built on solid architecture.', keyPoint: 'Without the layers below, these same tactics feel manipulative and fall flat.' },
      { type: 'bigStatement', pretext: 'The key insight:', statement: 'Story sells an identity, not just a product.', posttext: 'You aren\'t just selling a product. You\'re selling admission to a new identity: "I am the kind of person who has solved this problem."' },
      { type: 'identity-transformation', title: 'The Identity Shift', before: { label: 'Before', states: ['Frustrated', 'Uncertain', 'Stuck', 'Hoping'] }, after: { label: 'After', states: ['Confident', 'Certain', 'Free', 'Achieving'] }, insight: 'When customers identify with a brand, an attack on that brand feels like an attack on themselves. This creates fierce loyalty.' },
      { type: 'proof-comparison', title: 'Good vs. Lethal Proof', leftTitle: 'Good (Reviews)', leftIcon: 'â­', leftItems: ['"Great product, works as advertised"', 'Five stars', 'Builds credibility', 'Doesn\'t transform'], rightTitle: 'Lethal (Story)', rightIcon: 'ðŸ”¥', rightItems: ['"I finally feel like myself again"', 'Video testimonials', 'Shows transformation', 'Makes journey feel attainable'] },
      { type: 'strategy-cards', title: 'Engineering Proof & Identity', items: [
        { icon: 'ðŸŽ¬', title: 'Pain-Dream-Bridge Script', description: 'Guide customers to tell their story: "Describe your frustration before (Pain). What were you hoping for? (Dream). How did our product serve as the bridge?"' },
        { icon: 'ðŸ›¡ï¸', title: 'Objection-Handling Cases', description: 'Find customers who had a common objection ("I thought it was too expensive...") and feature their story about why they were wrong.' },
        { icon: 'ðŸ‘¥', title: 'Build Your "Tribe"', description: 'Create a private community for customers. This solidifies their new identity, creates community, and becomes a perpetual engine for social proof.' }
      ]},
      { type: 'example', scenario: 'Customer Testimonial - Identity-Based', before: { label: 'Product-Focused (Good)', text: '"Great product! Fast shipping, nice packaging. The quality is excellent and I would recommend it to anyone."' }, after: { label: 'Identity-Focused (Lethal)', text: '"I finally feel like myself again. My friends keep asking what changed. For the first time in years, I actually look forward to getting dressed. This didn\'t just change my wardrobeâ€”it changed how I see myself."' }, insight: 'The first talks about the product. The second talks about who they BECAME. That\'s the identity shift that creates customers for life.', characterVideo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_sharing_with_a_friend_two_monkeys_one_explaini_b30f53d7-8f44-4b0a-8c27-ad2e11f08a64_1.mp4', characterPosition: 'left' },
      { type: 'bigStatement', pretext: 'The ethical foundation:', statement: 'Trust, built on solving real problems, is the only sustainable advantage.', posttext: 'Manipulative tactics are built on pressure and confusion. Ethical influence is about being congruentâ€”understanding their problems so deeply that you can guide them to a decision that genuinely improves their lives.' },
      { type: 'architecture-summary', title: 'The Complete Architecture', layers: [
        { name: 'MINDSET', label: 'Foundation', description: 'External focus on customer\'s inner world', color: '#a5b4fc' },
        { name: 'METHOD', label: 'Core', description: 'Authority, certainty, and safety', color: '#818cf8' },
        { name: 'MECHANICS', label: 'Apex', description: 'Pain-Dream precision tactics', color: '#6366f1' }
      ]},
      { type: 'quiz', question: 'In the Psychological Architecture of Conversion, what is "The Mindset" layer?', options: ['Advanced copywriting techniques', 'A radical focus on the customer\'s inner world', 'Pricing and positioning strategy', 'Social media marketing tactics'], correctIndex: 1, feedback: { correct: 'Exactly! The Mindset is the foundationâ€”a radical, external focus on the customer\'s inner world. Not your product, not your features, but THEIR pains, dreams, language, and identity.', incorrect: 'Not quite. The Mindset is the foundation of the pyramidâ€”a radical, external focus on the customer\'s inner world. Their pains, their dreams, their language, their identity.' } },
      { type: 'completion', sources: [] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Quote: () => <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor" opacity="0.15"><path d="M11 7H7a4 4 0 0 0-4 4v7h7v-7H6a2 2 0 0 1 2-2h3V7zm10 0h-4a4 4 0 0 0-4 4v7h7v-7h-4a2 2 0 0 1 2-2h3V7z"/></svg>,
      ArrowUpRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="7" y1="17" x2="17" y2="7"/><polyline points="7 7 17 7 17 17"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>
              <Icons.Zap /> The Hook
            </span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.characterVideo && (
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3, duration: 0.6 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none hidden md:block`}
            style={{ height: '52%', maxHeight: '400px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
      </div>
    );

    const StatCountdownSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 md:mb-8">
          <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>
            <Icons.Zap /> The Problem
          </span>
          <h2 className="slide-title text-xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>
        <div className="grid md:grid-cols-3 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 + i * 0.1 }}
              className="rounded-2xl p-6 text-center"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(99, 102, 241, 0.15), 0 8px 32px rgba(0,0,0,0.4)' }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="text-4xl md:text-5xl font-bold mb-2" style={{ color: 'var(--accent)', textShadow: '0 0 30px rgba(99, 102, 241, 0.5)' }}>
                <AnimatedCounter target={stat.value} suffix={stat.suffix} prefix={stat.prefix} />
              </div>
              <p className="text-white font-semibold text-sm md:text-base mb-1">{stat.label}</p>
              <p className="text-neutral-400 text-xs">{stat.subtext}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const PyramidVisualSlide = ({ data }) => {
      const [activeLayer, setActiveLayer] = useState(null);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-6">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-lg md:text-2xl text-black text-center mb-4 md:mb-6">{data.title}</motion.h2>

          <div className="flex flex-col items-center gap-2 md:gap-3 mb-4">
            {data.layers.map((layer, i) => (
              <AnimatedPyramidLayer
                key={i}
                layer={layer}
                index={i}
                total={data.layers.length}
                isActive={activeLayer === i}
                onClick={() => setActiveLayer(activeLayer === i ? null : i)}
              />
            ))}
          </div>

          <AnimatePresence mode="wait">
            {activeLayer !== null && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                exit={{ opacity: 0, y: -10 }}
                className="rounded-xl p-4 text-center max-w-lg mx-auto"
                style={{
                  background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                  border: '1px solid rgba(99, 102, 241, 0.3)'
                }}
              >
                <span className="text-2xl mb-2 block">{data.layers[activeLayer].icon}</span>
                <p className="text-white text-sm leading-relaxed">{data.layers[activeLayer].fullDesc}</p>
              </motion.div>
            )}
          </AnimatePresence>

          {activeLayer === null && (
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.8 }} className="text-neutral-500 text-sm text-center mt-2">
              Click a layer to explore
            </motion.p>
          )}

          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="text-neutral-600 text-sm text-center mt-4 max-w-lg mx-auto">{data.footer}</motion.p>
        </div>
      );
    };

    const LayerDeepDiveSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} className="w-16 h-16 rounded-2xl flex items-center justify-center text-3xl mb-4 mx-auto" style={{ background: `linear-gradient(135deg, ${data.color}, ${data.color}99)`, boxShadow: `0 0 30px ${data.color}40` }}>
          {data.icon}
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-base md:text-lg text-neutral-600 leading-relaxed text-center mb-6">{data.content}</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: `2px solid ${data.color}40` }}>
          <p className="text-white font-medium text-sm md:text-base">{data.keyPoint}</p>
        </motion.div>
      </div>
    );

    const BigStatementSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-8 md:px-16 max-w-4xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-sm md:text-base text-neutral-500 mb-4 uppercase tracking-wider">{data.pretext}</motion.p>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 }} className="relative mb-6">
          <div className="absolute -left-4 -top-2"><Icons.Quote /></div>
          <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black text-center leading-tight px-6">{data.statement}</h2>
          <div className="absolute -right-4 -bottom-2 rotate-180"><Icons.Quote /></div>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-lg md:text-xl text-neutral-700 text-center font-medium max-w-2xl">{data.posttext}</motion.p>
      </div>
    );

    const IdentityTransformationSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

        <div className="flex items-center justify-center gap-4 md:gap-8 mb-6">
          {/* Before */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="flex-1 max-w-xs">
            <div className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, #374151, #4b5563)', border: '2px solid #6b7280' }}>
              <p className="text-neutral-400 text-xs uppercase tracking-wider mb-3">{data.before.label}</p>
              <div className="space-y-2">
                {data.before.states.map((state, i) => (
                  <motion.div key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.05 }} className="bg-neutral-700/50 rounded-lg py-2 px-3">
                    <span className="text-neutral-300 text-sm">{state}</span>
                  </motion.div>
                ))}
              </div>
            </div>
          </motion.div>

          {/* Arrow */}
          <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.4, type: 'spring' }} className="flex-shrink-0">
            <div className="w-12 h-12 rounded-full flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 0 20px rgba(99, 102, 241, 0.4)' }}>
              <Icons.ArrowRight />
            </div>
          </motion.div>

          {/* After */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="flex-1 max-w-xs">
            <div className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '2px solid var(--accent)', boxShadow: '0 0 30px rgba(99, 102, 241, 0.2)' }}>
              <p className="text-xs uppercase tracking-wider mb-3" style={{ color: 'var(--accent)' }}>{data.after.label}</p>
              <div className="space-y-2">
                {data.after.states.map((state, i) => (
                  <motion.div key={i} initial={{ opacity: 0, x: 10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.05 }} className="rounded-lg py-2 px-3" style={{ background: 'rgba(99, 102, 241, 0.2)' }}>
                    <span className="text-white text-sm font-medium">{state}</span>
                  </motion.div>
                ))}
              </div>
            </div>
          </motion.div>
        </div>

        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="bg-neutral-900 rounded-xl p-4 text-center max-w-lg mx-auto">
          <p className="text-neutral-300 text-sm">{data.insight}</p>
        </motion.div>
      </div>
    );

    const ProofComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

        <div className="grid md:grid-cols-2 gap-4">
          {/* Good */}
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-neutral-100 border-2 border-neutral-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-4">
              <span className="text-2xl">{data.leftIcon}</span>
              <h3 className="font-bold text-neutral-700 text-lg">{data.leftTitle}</h3>
            </div>
            <div className="space-y-2">
              {data.leftItems.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.05 }} className="flex items-start gap-2">
                  <span className="text-neutral-400 text-xs mt-1">â€¢</span>
                  <span className="text-neutral-600 text-sm">{item}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>

          {/* Lethal */}
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.15), rgba(99, 102, 241, 0.05))', border: '2px solid var(--accent)' }}>
            <div className="flex items-center gap-2 mb-4">
              <span className="text-2xl">{data.rightIcon}</span>
              <h3 className="font-bold text-lg" style={{ color: 'var(--accent)' }}>{data.rightTitle}</h3>
            </div>
            <div className="space-y-2">
              {data.rightItems.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.05 }} className="flex items-start gap-2">
                  <span style={{ color: 'var(--accent)' }} className="text-xs mt-1">âœ“</span>
                  <span className="text-neutral-700 text-sm font-medium">{item}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>
    );

    const StrategyCardsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

        <div className="grid md:grid-cols-3 gap-4">
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-5 relative overflow-hidden"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid rgba(99, 102, 241, 0.3)', boxShadow: '0 0 20px rgba(99, 102, 241, 0.1)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <span className="text-3xl mb-3 block">{item.icon}</span>
              <h3 className="text-white font-bold text-base mb-2">{item.title}</h3>
              <p className="text-neutral-400 text-xs leading-relaxed">{item.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const ExampleSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8 relative z-10">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Real Example</span>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
          </motion.div>
          <div className="grid md:grid-cols-2 gap-4 mb-6">
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-neutral-100 border-2 border-neutral-200 rounded-xl p-5">
              <div className="flex items-center gap-2 mb-3"><span className="font-semibold text-neutral-700 text-sm">{data.before.label}</span></div>
              <p className="text-neutral-600 text-sm leading-relaxed italic">{data.before.text}</p>
            </motion.div>
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(99, 102, 241, 0.05))', border: '2px solid var(--accent)' }}>
              <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full flex items-center justify-center text-white" style={{ background: 'var(--accent)' }}><Icons.Check /></div><span className="font-semibold text-sm" style={{ color: 'var(--accent)' }}>{data.after.label}</span></div>
              <p className="text-neutral-700 text-sm leading-relaxed italic">{data.after.text}</p>
            </motion.div>
          </div>
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-neutral-900 rounded-xl p-4 text-center">
            <p className="text-neutral-300 text-sm"><Icons.Zap className="inline mr-2" />{data.insight}</p>
          </motion.div>
        </div>
        {data.characterVideo && (
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4, duration: 0.6 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none hidden md:block`}
            style={{ height: '40%', maxHeight: '300px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
      </div>
    );

    const ArchitectureSummarySlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-3xl text-black text-center mb-6 md:mb-8">{data.title}</motion.h2>

        <div className="grid md:grid-cols-3 gap-4">
          {data.layers.map((layer, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-6 text-center"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${layer.color}30, 0 8px 32px rgba(0,0,0,0.4)` }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-xl" style={{ background: `linear-gradient(90deg, transparent, ${layer.color}, transparent)` }} />
              <div className="text-2xl md:text-3xl font-bold mb-2" style={{ color: layer.color, textShadow: `0 0 20px ${layer.color}50` }}>{layer.name}</div>
              <div className="text-xs md:text-sm font-semibold text-white mb-1">{layer.label}</div>
              <div className="text-[10px] md:text-xs text-neutral-400">{layer.description}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You've mastered the Psychological Architecture of Conversion. Remember: Mindset (customer focus) â†’ Method (authority & certainty) â†’ Mechanics (pain-dream precision). Build from the foundation up.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Key Takeaway</p>
          <h3 className="text-white font-bold text-lg mb-1">Trust built on solving real problems is the only sustainable advantage.</h3>
          <p className="text-neutral-400 text-xs">Ethical influence is about being congruentâ€”not manipulative.</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'stat-countdown': return <StatCountdownSlide data={slide} />;
          case 'pyramid-visual': return <PyramidVisualSlide data={slide} />;
          case 'layer-deep-dive': return <LayerDeepDiveSlide data={slide} />;
          case 'bigStatement': return <BigStatementSlide data={slide} />;
          case 'identity-transformation': return <IdentityTransformationSlide data={slide} />;
          case 'proof-comparison': return <ProofComparisonSlide data={slide} />;
          case 'strategy-cards': return <StrategyCardsSlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'architecture-summary': return <ArchitectureSummarySlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-16 pointer-events-none`} style={{ zIndex: 50, height: gifConfig.height, maxHeight: '40%' }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
