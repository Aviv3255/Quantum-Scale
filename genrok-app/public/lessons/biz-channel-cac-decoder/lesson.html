<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Channel CAC Decoder | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #3B82F6; --accent-dark: #2563EB; --accent-light: #60A5FA; --accent-rgb: 59, 130, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'biz-channel-cac-decoder',
      title: 'The Channel CAC Decoder',
      description: 'Why your blended CAC is lying to you',
      accentColor: '#3B82F6',
      duration: '5 min',
      nextLesson: { id: 'biz-6-to-1-problem', title: 'The 6:1 Problem', teaser: 'When your ratio is TOO good, you are leaving money on the table.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why blended CAC hides the truth', 'How to calculate CAC by channel', 'Which channels are actually profitable'] },
      { type: 'hook', headline: 'Your CAC is a lie.', subtext: 'Most businesses calculate one number: blended CAC. They divide total ad spend by total customers. Simple. Clean. And completely misleading. That blended number hides winners and losers. It makes bad channels look acceptable. It makes good channels look average. The truth? Your Meta CAC and Google CAC are different numbers. Your TikTok CAC and influencer CAC are different numbers. And treating them the same is costing you thousands.' },
      { type: 'blended-lie', title: 'The Blended CAC Lie', blended: { total: '$45', label: 'Blended CAC', looks: 'Looks fine!' }, reality: [
        { channel: 'Meta Ads', cac: '$28', color: '#3B82F6', verdict: 'Winner' },
        { channel: 'Google Ads', cac: '$52', color: '#F59E0B', verdict: 'Borderline' },
        { channel: 'TikTok Ads', cac: '$67', color: '#EF4444', verdict: 'Losing money' },
        { channel: 'Influencers', cac: '$34', color: '#22C55E', verdict: 'Winner' }
      ], insight: 'The $45 blended CAC hides a $67 loser and a $28 winner.' },
      { type: 'content', title: 'Why Channel CAC Matters', body: 'Every channel has different economics. Meta customers might have different LTV than Google customers. TikTok buyers might return at different rates. Influencer traffic might convert differently. When you blend everything together, you lose visibility into what is actually working. You keep funding losers because winners are propping up the average. You underinvest in winners because they look "just okay" in the blend.' },
      { type: 'channel-breakdown', title: 'Real Channel Economics', channels: [
        { name: 'Meta Ads', cac: 28, ltv: 112, ratio: '4.0:1', color: '#3B82F6', status: 'Scale aggressively' },
        { name: 'Google Ads', cac: 52, ltv: 156, ratio: '3.0:1', color: '#F59E0B', status: 'Healthy - maintain' },
        { name: 'TikTok Ads', cac: 67, ltv: 89, ratio: '1.3:1', color: '#EF4444', status: 'Cut or optimize' },
        { name: 'Influencers', cac: 34, ltv: 170, ratio: '5.0:1', color: '#22C55E', status: 'Scale aggressively' }
      ]},
      { type: 'stat-countdown', title: 'Hidden Channel Differences', stats: [
        { value: 2.4, suffix: 'x', label: 'CAC Variation', subtext: 'Between best & worst channel' },
        { value: 67, suffix: '%', label: 'Miss Winners', subtext: 'With blended CAC only' },
        { value: 41, suffix: '%', label: 'Overspend', subtext: 'On losing channels' }
      ]},
      { type: 'content', title: 'The LTV Twist', body: 'Here is what makes it even more complex: different channels attract different customers. Meta might bring impulse buyers with low LTV. Google might bring researchers with high intent and high LTV. Influencer traffic might bring superfans who become brand evangelists. So even if two channels have the same CAC, they might have completely different profitability. You need to track CAC AND LTV by channel.' },
      { type: 'ltv-by-channel', title: 'Same CAC, Different LTV', examples: [
        { channel: 'Channel A', cac: '$40', ltv: '$80', ratio: '2:1', color: '#EF4444', verdict: 'Break-even' },
        { channel: 'Channel B', cac: '$40', ltv: '$160', ratio: '4:1', color: '#22C55E', verdict: 'Highly profitable' }
      ], insight: 'Same CAC. Completely different profitability. Without LTV by channel, you would treat these the same.' },
      { type: 'strategy-steps', title: 'Decode Your Channel CAC', steps: [
        { number: 1, title: 'TAG EVERYTHING', icon: 'Tag', color: '#3B82F6', description: 'Use UTM parameters religiously. Every ad, every influencer, every channel gets unique tracking. No tagging = no visibility.' },
        { number: 2, title: 'CALCULATE BY CHANNEL', icon: 'Calculator', color: '#8B5CF6', description: 'Break your CAC into channel-specific numbers. Meta CAC, Google CAC, TikTok CAC. Stop blending. Start seeing.' },
        { number: 3, title: 'TRACK LTV BY SOURCE', icon: 'TrendingUp', color: '#22C55E', description: 'Use DataDrew to see which channels bring the highest LTV customers. Some channels bring whales. Others bring minnows.' }
      ]},
      { type: 'tool-integration', title: 'See Your Real Channel Performance', subtitle: 'Stop guessing which channels actually work', tool: { name: 'DataDrew', description: 'Free Shopify app that shows LTV by acquisition source and channel', image: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/46.webp', link: 'https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva', features: ['LTV by acquisition channel', 'See which channels bring whales', 'Identify your best traffic sources', 'Free forever - no credit card'] } },
      { type: 'before-after', title: 'Blended vs Decoded Decisions', before: [
        '"Our CAC is $45, looks fine"',
        'All channels get equal budget',
        'Cannot explain profit fluctuations',
        'Scale everything equally',
        'React when it is too late'
      ], after: [
        '"Meta is $28, TikTok is $67"',
        'Budget weighted by performance',
        'Know exactly what drives profit',
        'Scale winners, cut losers',
        'Proactive optimization'
      ]},
      { type: 'highlight-box', title: 'The Channel Truth', body: 'Your blended CAC is an average that tells you nothing. It is like saying the average temperature in your house is 70Â°F when your kitchen is on fire and your bedroom is freezing. The average sounds fine. But you have a problem. Break your CAC into channels. Break your LTV into channels. Only then will you see where to pour fuel and where to cut losses.', highlight: 'Your blended CAC is like averaging a burning kitchen and a freezing bedroom. The number looks fine. The reality does not.' },
      { type: 'quiz', question: 'Why is blended CAC misleading?', options: ['It is too difficult to calculate', 'It hides which channels are winning and losing', 'It only works for large businesses', 'It does not account for returns'], correctIndex: 1, feedback: { correct: 'Exactly. Blended CAC averages winners and losers together. A great channel might look average, and a terrible channel might look acceptable. Breaking CAC into channel-specific numbers reveals the truth about what is actually working.', incorrect: 'Not quite. Blended CAC is misleading because it hides which channels are winning and losing. Winners prop up the average, making losers look acceptable. You need channel-specific CAC to see the truth.' }},
      { type: 'completion', sources: [] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Tag: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z"/><path d="M7 7h.01"/></svg>,
      Calculator: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="4" y="2" width="16" height="20" rx="2"/><line x1="8" y1="6" x2="16" y2="6"/><line x1="8" y1="10" x2="8" y2="10"/><line x1="12" y1="10" x2="12" y2="10"/><line x1="16" y1="10" x2="16" y2="10"/><line x1="8" y1="14" x2="8" y2="14"/><line x1="12" y1="14" x2="12" y2="14"/><line x1="16" y1="14" x2="16" y2="14"/><line x1="8" y1="18" x2="8" y2="18"/><line x1="12" y1="18" x2="12" y2="18"/><line x1="16" y1="18" x2="16" y2="18"/></svg>,
      TrendingUp: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      AlertCircle: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
      BarChart: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
    };

    // Animated Counter
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start * 10) / 10); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // Welcome Slide with GIF overlay
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }}>
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-6" style={{ background: `rgba(${LESSON_CONFIG.accentColor === '#3B82F6' ? '59, 130, 246' : '59, 130, 246'}, 0.1)`, color: LESSON_CONFIG.accentColor }}>
              <Icons.Zap />
              <span>CAC Analytics</span>
            </div>

            <h1 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black mb-4">
              {formatGreeting(welcomeData.greeting, userName)}
            </h1>

            <p className="text-neutral-500 text-lg mb-8">Here's what you'll discover:</p>

            <div className="space-y-3">
              {data.learningGoals.map((goal, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-center gap-3 p-4 rounded-xl" style={{ background: '#fafafa', border: '1px solid #eee' }}>
                  <div className="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold" style={{ background: LESSON_CONFIG.accentColor }}>
                    {i + 1}
                  </div>
                  <span className="text-neutral-700 font-medium">{goal}</span>
                </motion.div>
              ))}
            </div>

            <motion.button
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.6 }}
              onClick={onStart}
              className="mt-8 px-8 py-4 rounded-xl font-semibold text-white flex items-center gap-2 transition-all hover:scale-105"
              style={{ background: `linear-gradient(135deg, ${LESSON_CONFIG.accentColor}, var(--accent-dark))` }}
            >
              Let's decode your CAC
              <Icons.ArrowRight />
            </motion.button>
          </motion.div>
        </div>
      );
    };

    // Hook Slide
    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}>
          <h2 className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6 leading-tight">
            {data.headline}
          </h2>
          <p className="text-neutral-600 text-lg leading-relaxed">{data.subtext}</p>
        </motion.div>
      </div>
    );

    // Blended Lie Slide
    const BlendedLieSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(239, 68, 68, 0.1)', color: '#EF4444' }}>
            <Icons.AlertCircle size={14} color="#EF4444" />
            <span>The Problem</span>
          </div>
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-2xl p-6 mb-6 text-center" style={{ background: '#0a0a0a', border: '1px solid #333' }}>
          <div className="text-xs text-neutral-500 uppercase tracking-wider mb-2">{data.blended.label}</div>
          <div className="text-5xl font-bold text-white mb-2">{data.blended.total}</div>
          <div className="text-neutral-400 text-sm">{data.blended.looks}</div>
        </motion.div>

        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="rounded-2xl p-6" style={{ background: '#0a0a0a', border: '1px solid #222' }}>
          <div className="text-xs text-neutral-500 uppercase tracking-wider mb-4 text-center">The Reality Behind The Blend</div>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {data.reality.map((channel, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 + i * 0.1 }} className="text-center p-4 rounded-xl" style={{ background: '#1a1a1a', border: `1px solid ${channel.color}30` }}>
                <div className="text-xs text-neutral-400 mb-1">{channel.channel}</div>
                <div className="text-2xl font-bold mb-1" style={{ color: channel.color }}>{channel.cac}</div>
                <div className="text-xs" style={{ color: channel.color }}>{channel.verdict}</div>
              </motion.div>
            ))}
          </div>
        </motion.div>

        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.9 }} className="text-center text-neutral-600 text-sm mt-6">
          {data.insight}
        </motion.p>
      </div>
    );

    // Channel Breakdown Slide
    const ChannelBreakdownSlide = ({ data }) => {
      const maxCac = Math.max(...data.channels.map(c => c.cac));

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#3B82F6' }}>
              <Icons.BarChart size={14} color="#3B82F6" />
              <span>Channel Analysis</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="space-y-4">
            {data.channels.map((channel, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.15 + i * 0.1 }} className="rounded-xl p-5" style={{ background: '#0a0a0a', border: `1px solid ${channel.color}30` }}>
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-3">
                    <div className="w-3 h-3 rounded-full" style={{ background: channel.color }} />
                    <span className="text-white font-medium">{channel.name}</span>
                  </div>
                  <div className="flex items-center gap-4 text-sm">
                    <div className="text-neutral-400">CAC: <span className="text-white font-bold">${channel.cac}</span></div>
                    <div className="text-neutral-400">LTV: <span className="text-white font-bold">${channel.ltv}</span></div>
                    <div className="px-2 py-1 rounded text-xs font-bold" style={{ background: `${channel.color}20`, color: channel.color }}>{channel.ratio}</div>
                  </div>
                </div>
                <div className="h-3 rounded-full overflow-hidden mb-2" style={{ background: '#1f1f1f' }}>
                  <motion.div
                    initial={{ width: 0 }}
                    animate={{ width: `${(channel.cac / maxCac) * 100}%` }}
                    transition={{ duration: 1, delay: 0.3 + i * 0.1 }}
                    className="h-full rounded-full"
                    style={{ background: channel.color, boxShadow: `0 0 10px ${channel.color}50` }}
                  />
                </div>
                <div className="text-xs" style={{ color: channel.color }}>{channel.status}</div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // LTV By Channel Slide
    const LtvByChannelSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#3B82F6' }}>
            <Icons.TrendingUp size={14} color="#3B82F6" />
            <span>Critical Insight</span>
          </div>
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <div className="grid md:grid-cols-2 gap-6 mb-6">
          {data.examples.map((example, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} className="rounded-2xl p-6" style={{ background: '#0a0a0a', border: `1px solid ${example.color}30` }}>
              <div className="text-xs text-neutral-500 uppercase tracking-wider mb-4">{example.channel}</div>
              <div className="grid grid-cols-3 gap-4 text-center mb-4">
                <div>
                  <div className="text-xs text-neutral-400 mb-1">CAC</div>
                  <div className="text-2xl font-bold text-white">{example.cac}</div>
                </div>
                <div>
                  <div className="text-xs text-neutral-400 mb-1">LTV</div>
                  <div className="text-2xl font-bold text-white">{example.ltv}</div>
                </div>
                <div>
                  <div className="text-xs text-neutral-400 mb-1">Ratio</div>
                  <div className="text-2xl font-bold" style={{ color: example.color }}>{example.ratio}</div>
                </div>
              </div>
              <div className="text-center text-sm font-bold" style={{ color: example.color }}>{example.verdict}</div>
            </motion.div>
          ))}
        </div>

        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(59, 130, 246, 0.05))', border: '1px solid rgba(59, 130, 246, 0.2)' }}>
          <p className="text-neutral-700 text-sm font-medium">{data.insight}</p>
        </motion.div>
      </div>
    );

    // Strategy Steps Slide
    const StrategyStepsSlide = ({ data }) => {
      const IconComponent = (name, color) => {
        const iconMap = { Tag: Icons.Tag, Calculator: Icons.Calculator, TrendingUp: Icons.TrendingUp };
        const Icon = iconMap[name] || Icons.Tag;
        return <Icon size={24} color={color} />;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#3B82F6' }}>
              <Icons.Zap />
              <span>Action Plan</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="space-y-4">
            {data.steps.map((step, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} className="rounded-xl p-5" style={{ background: '#0a0a0a', border: `1px solid ${step.color}30` }}>
                <div className="flex items-start gap-4">
                  <div className="w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0 relative" style={{ background: `${step.color}15` }}>
                    {IconComponent(step.icon, step.color)}
                    <div className="absolute -top-2 -right-2 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-white" style={{ background: step.color }}>
                      {step.number}
                    </div>
                  </div>
                  <div>
                    <h3 className="text-white font-bold mb-1" style={{ color: step.color }}>{step.title}</h3>
                    <p className="text-neutral-400 text-sm leading-relaxed">{step.description}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // Tool Integration Slide
    const ToolIntegrationSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(59, 130, 246, 0.1)', color: '#3B82F6' }}>
            <Icons.Zap />
            <span>Recommended Tool</span>
          </div>
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
          <p className="text-neutral-500 text-sm">{data.subtitle}</p>
        </motion.div>

        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-2xl p-6 md:p-8" style={{ background: '#0a0a0a', border: '1px solid #222' }}>
          <div className="flex flex-col md:flex-row gap-6 items-center">
            <div className="w-full md:w-2/5">
              <img src={data.tool.image} alt={data.tool.name} className="w-full rounded-xl" style={{ border: '1px solid #333' }} />
            </div>
            <div className="w-full md:w-3/5">
              <h3 className="text-2xl font-bold text-white mb-2">{data.tool.name}</h3>
              <p className="text-neutral-400 text-sm mb-4">{data.tool.description}</p>
              <div className="space-y-2 mb-6">
                {data.tool.features.map((feature, i) => (
                  <motion.div key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + i * 0.1 }} className="flex items-center gap-2 text-sm">
                    <span className="text-green-500"><Icons.Check /></span>
                    <span className="text-neutral-300">{feature}</span>
                  </motion.div>
                ))}
              </div>
              <a href={data.tool.link} target="_blank" rel="noopener noreferrer" className="inline-flex items-center gap-2 px-5 py-3 rounded-xl font-semibold text-white text-sm transition-all hover:scale-105" style={{ background: 'linear-gradient(135deg, #3B82F6, #2563EB)' }}>
                Get {data.tool.name} Free
                <Icons.ExternalLink />
              </a>
            </div>
          </div>
        </motion.div>
      </div>
    );

    // Stat Countdown Slide
    const StatCountdownSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-10">
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} className="rounded-2xl p-6 text-center" style={{ background: '#0a0a0a', border: '1px solid #222' }}>
              <div className="text-5xl md:text-6xl font-bold mb-2" style={{ color: '#3B82F6' }}>
                <AnimatedCounter target={stat.value} suffix={stat.suffix} duration={2000 + i * 500} />
              </div>
              <div className="text-white font-medium mb-1">{stat.label}</div>
              <div className="text-neutral-500 text-sm">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Before/After Slide
    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <div className="grid md:grid-cols-2 gap-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-2xl p-6" style={{ background: '#0a0a0a', border: '1px solid rgba(107, 114, 128, 0.3)' }}>
            <div className="flex items-center gap-2 mb-4">
              <div className="w-8 h-8 rounded-full flex items-center justify-center" style={{ background: 'rgba(107, 114, 128, 0.2)' }}>
                <Icons.X />
              </div>
              <span className="text-neutral-500 font-semibold uppercase text-sm tracking-wider">Blended Only</span>
            </div>
            <div className="space-y-3">
              {data.before.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-start gap-3 text-neutral-400 text-sm">
                  <span className="text-neutral-600 mt-0.5">-</span>
                  <span>{item}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>

          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} className="rounded-2xl p-6" style={{ background: '#0a0a0a', border: '1px solid rgba(59, 130, 246, 0.3)', boxShadow: '0 0 30px rgba(59, 130, 246, 0.1)' }}>
            <div className="flex items-center gap-2 mb-4">
              <div className="w-8 h-8 rounded-full flex items-center justify-center" style={{ background: 'rgba(59, 130, 246, 0.2)' }}>
                <Icons.Check />
              </div>
              <span className="text-blue-400 font-semibold uppercase text-sm tracking-wider">Decoded</span>
            </div>
            <div className="space-y-3">
              {data.after.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + i * 0.1 }} className="flex items-start gap-3 text-neutral-300 text-sm">
                  <span className="text-blue-500 mt-0.5">+</span>
                  <span>{item}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>
    );

    // Highlight Box Slide
    const HighlightBoxSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-2xl p-8 md:p-10" style={{ background: '#0a0a0a', border: '1px solid rgba(59, 130, 246, 0.3)', boxShadow: '0 0 40px rgba(59, 130, 246, 0.1)' }}>
          <p className="text-neutral-300 text-lg leading-relaxed mb-6">{data.body}</p>
          <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="rounded-xl p-4" style={{ background: 'linear-gradient(135deg, rgba(59, 130, 246, 0.15), rgba(59, 130, 246, 0.05))', borderLeft: '4px solid #3B82F6' }}>
            <p className="text-white font-medium text-lg italic">"{data.highlight}"</p>
          </motion.div>
        </motion.div>
      </div>
    );

    // Content Slide
    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }}>
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-6">{data.title}</h2>
          <div className="prose prose-lg">
            <p className="text-neutral-600 text-lg leading-relaxed">{data.body}</p>
          </div>
        </motion.div>
      </div>
    );

    // Quiz Slide with GIF overlay
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const isCorrect = selected === data.correctIndex;

      const handleSelect = (index) => {
        if (showFeedback) return;
        setSelected(index);
        setShowFeedback(true);

        const gifSide = Math.random() > 0.5 ? 'left' : 'right';
        if (index === data.correctIndex) {
          onShowGif(getRandomCelebrationGif(), '55%', gifSide);
        } else {
          onShowGif(getRandomEmpathyGif(), '55%', gifSide);
        }
      };

      useEffect(() => {
        return () => onHideGif();
      }, [onHideGif]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(${LESSON_CONFIG.accentColor === '#3B82F6' ? '59, 130, 246' : '59, 130, 246'}, 0.1)`, color: LESSON_CONFIG.accentColor }}>
              <span>Quick Check</span>
            </div>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>

          <div className="space-y-3 mb-8">
            {data.options.map((option, i) => (
              <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all ${showFeedback ? (i === data.correctIndex ? 'ring-2 ring-green-500' : i === selected ? 'ring-2 ring-red-500' : '') : 'hover:bg-neutral-100'}`} style={{ background: showFeedback && i === data.correctIndex ? 'rgba(34, 197, 94, 0.1)' : showFeedback && i === selected && i !== data.correctIndex ? 'rgba(239, 68, 68, 0.1)' : '#fafafa', border: '1px solid #eee' }}>
                <div className="flex items-center gap-3">
                  <div className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected ? 'bg-red-500 text-white' : 'bg-white text-neutral-600 border border-neutral-200'}`}>
                    {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected ? <Icons.X /> : String.fromCharCode(65 + i)}
                  </div>
                  <span className="text-neutral-700">{option}</span>
                </div>
              </motion.button>
            ))}
          </div>

          <AnimatePresence>
            {showFeedback && (
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }} className="rounded-xl p-6" style={{ background: isCorrect ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)', border: `1px solid ${isCorrect ? 'rgba(34, 197, 94, 0.3)' : 'rgba(239, 68, 68, 0.3)'}` }}>
                <div className={`font-bold mb-2 ${isCorrect ? 'text-green-600' : 'text-red-600'}`}>
                  {isCorrect ? 'Correct!' : 'Not quite!'}
                </div>
                <p className="text-neutral-600 text-sm">{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // Completion Slide
    const CompletionSlide = ({ data, userName }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8 text-center">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}>
          <div className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6" style={{ background: `linear-gradient(135deg, ${LESSON_CONFIG.accentColor}, var(--accent-dark))` }}>
            <Icons.Check />
          </div>

          <h2 className="slide-title text-2xl md:text-3xl text-black mb-4">
            Lesson Complete!
          </h2>

          <p className="text-neutral-500 text-lg mb-8">
            Great work, {userName}! You now understand why blended CAC is misleading and how to decode your channel performance.
          </p>

          {LESSON_CONFIG.nextLesson && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="rounded-xl p-6 text-left" style={{ background: '#0a0a0a', border: '1px solid #222' }}>
              <div className="text-xs text-neutral-500 uppercase tracking-wider mb-2">Up Next</div>
              <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
              <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
            </motion.div>
          )}
        </motion.div>
      </div>
    );

    // Main Lesson App
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [gifConfig, setGifConfig] = useState({ visible: false, src: '', maxHeight: '60%', side: 'right' });
      const totalSlides = slides.length;
      const userName = getUserName();

      const showGif = useCallback((src, maxHeight = '60%', side = 'right') => {
        setGifConfig({ visible: true, src, maxHeight, side });
      }, []);

      const hideGif = useCallback(() => {
        setGifConfig(prev => ({ ...prev, visible: false }));
      }, []);

      const goNext = useCallback(() => { if (currentSlide < totalSlides - 1) { hideGif(); setCurrentSlide(prev => prev + 1); } }, [currentSlide, totalSlides, hideGif]);
      const goPrev = useCallback(() => { if (currentSlide > 0) { hideGif(); setCurrentSlide(prev => prev - 1); } }, [currentSlide, hideGif]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); goNext(); }
          else if (e.key === 'ArrowLeft') { e.preventDefault(); goPrev(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [goNext, goPrev]);

      const renderSlide = () => {
        const slide = slides[currentSlide];
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={goNext} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'blended-lie': return <BlendedLieSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'channel-breakdown': return <ChannelBreakdownSlide data={slide} />;
          case 'stat-countdown': return <StatCountdownSlide data={slide} />;
          case 'ltv-by-channel': return <LtvByChannelSlide data={slide} />;
          case 'strategy-steps': return <StrategyStepsSlide data={slide} />;
          case 'tool-integration': return <ToolIntegrationSlide data={slide} />;
          case 'before-after': return <BeforeAfterSlide data={slide} />;
          case 'highlight-box': return <HighlightBoxSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} userName={userName} />;
          default: return <ContentSlide data={slide} />;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < totalSlides - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide()}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={goPrev} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={goNext} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => { hideGif(); setCurrentSlide(i); }} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig.visible && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, maxHeight: gifConfig.maxHeight }}>
                <video src={gifConfig.src} autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none', maxHeight: gifConfig.maxHeight }} />
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
