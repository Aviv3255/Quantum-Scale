<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Le Creuset's Scarcity Engine | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #dc2626; --accent-dark: #991b1b; --accent-light: #ef4444; --accent-rgb: 220, 38, 38; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'scarcity-calendar',
      title: 'Le Creuset\'s Scarcity Engine',
      description: 'One new color per year. Collectors buy multiple. FOMO drives demand.',
      accentColor: '#dc2626',
      duration: '6 min',
      nextLesson: { id: 'anchor-moments', title: 'Ralph Lauren\'s Anchor Moments', teaser: 'How a $20,000 handbag makes $200 polos feel like a steal.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) { window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*'); }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ value, suffix = '', prefix = '', decimals = 0, duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(value);
        const increment = end / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(start); }
        }, 16);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{prefix}{decimals > 0 ? count.toFixed(decimals) : Math.round(count)}{suffix}</span>;
    };

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Calendar: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"/><line x1="16" y1="2" x2="16" y2="6"/><line x1="8" y1="2" x2="8" y2="6"/><line x1="3" y1="10" x2="21" y2="10"/></svg>,
      Palette: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      DollarSign: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Heart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      AlertTriangle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Star: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Timer: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="13" r="8"/><path d="M12 9v4l2 2"/><path d="M5 3L2 6"/><path d="M22 6l-3-3"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Package: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16.5 9.4l-9-5.19M21 16V8a2 2 0 00-1-1.73l-7-4a2 2 0 00-2 0l-7 4A2 2 0 003 8v8a2 2 0 001 1.73l7 4a2 2 0 002 0l7-4A2 2 0 0021 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
    };

    // ============ SLIDES ============
    const slides = [
      { type: 'welcome', learningGoals: ['Why Le Creuset releases ONE color per year', 'How calendar scarcity creates collector behavior', 'The psychology behind fair urgency vs panic pressure', 'How discontinued colors become 2-3x retail investments'] },
      { type: 'hook', headline: 'Le Creuset releases one new color per year.', subtext: 'Not because production is limited. Not because they can\'t make more. Because scarcity on a calendar creates collector behavior. And collectors don\'t buy one. They buy the set.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Le_Creuset_Logo.png', brandName: 'Le Creuset' },
      { type: 'color-wheel', title: 'The Color of the Year Strategy', subtitle: 'One color. 365 days to buy it. Then it\'s gone forever.' },
      { type: 'collector-flywheel', title: 'How the Scarcity Calendar Works', subtitle: 'The 4-step cycle that turns customers into collectors' },
      { type: 'color-timeline', title: 'Annual Release Timeline', subtitle: 'Each color becomes more valuable after retirement' },
      { type: 'flash-vs-calendar', title: 'Why Calendar Scarcity Beats Flash Sales', subtitle: 'Same urgency. Zero manipulation.' },
      { type: 'application-grid', title: 'Create Your Scarcity Calendar', subtitle: 'Apply this to any business model' },
      { type: 'countdown-bridge', title: 'The Missing Piece: Visible Deadlines', subtitle: 'Le Creuset\'s calendar works because the deadline is REAL' },
      { type: 'secondary-market', title: 'The Secondary Market Signal', subtitle: 'Discontinued colors selling for 2-3x retail validates the scarcity' },
      { type: 'pricing-comparison', title: 'The Scarcity Premium Effect', subtitle: 'Calendar scarcity commands premium pricing' },
      { type: 'elite-insight', quote: 'A full year feels generous. The deadline is still real.', author: 'Calendar Scarcity Principle', insight: 'This is the magic: customers have 365 days to decide. No panic. No pressure. Yet after December 31st, it\'s gone forever. Fair urgency, maximum conversion.' },
      { type: 'quiz', question: 'Why does Le Creuset\'s annual color strategy work better than constant flash sales?', options: ['Annual releases are easier to produce', 'Customers have a full year to buy, so it feels fair instead of manipulative, yet still drives urgency', 'They save money on marketing', 'Flash sales are illegal in some countries'], correctIndex: 1, feedback: { correct: 'Exactly. The brilliance is in the timing. A full year feels generous and fair. No pressure, no panic. But the deadline is real. After December 31st, it\'s gone. This creates urgency without manipulation, and builds collector behavior instead of buyer\'s remorse.', incorrect: 'Not quite. The power is in the psychology. A year-long window feels fair and pressure-free, yet the deadline is absolute. This builds anticipation and collector mentality, while flash sales create panic and often regret. Same scarcity, better customer experience.' }},
      { type: 'completion', sources: [{ name: 'Essential Countdown Timer', url: 'https://platform.shoffi.app/r/rl_6EEzhlj9' }] }
    ];

    // ============ COLOR DATA ============
    const COLOR_RELEASES = [
      { year: '2021', name: 'Provence', hex: '#9B7BB8', status: 'RETIRED', resale: '2.4x' },
      { year: '2022', name: 'Meringue', hex: '#F5F0E6', status: 'RETIRED', resale: '2.1x' },
      { year: '2023', name: 'Agave', hex: '#7BA394', status: 'RETIRED', resale: '2.8x' },
      { year: '2024', name: 'Rhone', hex: '#8B4B6B', status: 'CURRENT', resale: '-' },
      { year: '2025', name: '???', hex: '#333', status: 'UPCOMING', resale: '-' }
    ];

    // ============ WELCOME SLIDE ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    // ============ HOOK SLIDE ============
    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 0.9 }} />
          </motion.div>
        )}
      </div>
    );

    // ============ COLOR WHEEL SLIDE ============
    const ColorWheelSlide = ({ data }) => {
      const [activeYear, setActiveYear] = useState(3);
      useEffect(() => {
        const interval = setInterval(() => {
          setActiveYear(prev => (prev + 1) % COLOR_RELEASES.length);
        }, 2500);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
            <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
          </motion.div>

          {/* Color Wheel Visualization */}
          <div className="flex flex-col md:flex-row items-center justify-center gap-8 mb-6">
            {/* Animated Color Swatch Display */}
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              style={{
                width: '200px',
                height: '200px',
                borderRadius: '20px',
                background: COLOR_RELEASES[activeYear].hex,
                boxShadow: `0 0 60px ${COLOR_RELEASES[activeYear].hex}66`,
                display: 'flex',
                flexDirection: 'column',
                alignItems: 'center',
                justifyContent: 'center',
                position: 'relative',
                overflow: 'hidden'
              }}
            >
              <motion.div
                key={activeYear}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                className="text-center"
              >
                <p className="text-white font-bold text-4xl mb-1" style={{ textShadow: '0 2px 10px rgba(0,0,0,0.3)' }}>{COLOR_RELEASES[activeYear].year}</p>
                <p className="text-white/90 text-lg font-medium" style={{ textShadow: '0 1px 5px rgba(0,0,0,0.3)' }}>{COLOR_RELEASES[activeYear].name}</p>
                <span className={`inline-block mt-2 px-3 py-1 rounded-full text-xs font-bold ${COLOR_RELEASES[activeYear].status === 'CURRENT' ? 'bg-green-500 text-white' : COLOR_RELEASES[activeYear].status === 'RETIRED' ? 'bg-black/50 text-white' : 'bg-white/30 text-white'}`}>
                  {COLOR_RELEASES[activeYear].status}
                </span>
              </motion.div>
            </motion.div>

            {/* Year Selection */}
            <div className="flex flex-col gap-2">
              {COLOR_RELEASES.map((color, i) => (
                <motion.button
                  key={color.year}
                  initial={{ opacity: 0, x: 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.2 + i * 0.1 }}
                  onClick={() => setActiveYear(i)}
                  style={{
                    display: 'flex',
                    alignItems: 'center',
                    gap: '12px',
                    padding: '12px 16px',
                    borderRadius: '12px',
                    background: activeYear === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                    border: activeYear === i ? '2px solid var(--accent)' : '2px solid transparent',
                    cursor: 'pointer',
                    transition: 'all 0.2s ease'
                  }}
                >
                  <div style={{ width: '24px', height: '24px', borderRadius: '6px', background: color.hex, border: '2px solid rgba(0,0,0,0.1)' }} />
                  <div className="text-left">
                    <p style={{ fontSize: '14px', fontWeight: 'bold', color: activeYear === i ? 'white' : '#1a1a1a' }}>{color.year} - {color.name}</p>
                    <p style={{ fontSize: '11px', color: activeYear === i ? '#a3a3a3' : '#666' }}>{color.status}</p>
                  </div>
                </motion.button>
              ))}
            </div>
          </div>

          {/* Bottom Insight */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.5 }}
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              borderRadius: '16px',
              padding: '20px 24px',
              position: 'relative',
              overflow: 'hidden'
            }}
          >
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <div className="flex items-center gap-4">
              <div style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', borderRadius: '10px', padding: '10px' }}>
                <span style={{ color: 'white' }}><Icons.Calendar /></span>
              </div>
              <div>
                <p className="text-white font-bold text-sm">365 days. Then gone forever.</p>
                <p className="text-neutral-400 text-xs">Replaced by next year's color. The countdown creates urgency without pressure.</p>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ COLLECTOR FLYWHEEL SLIDE ============
    const CollectorFlywheelSlide = ({ data }) => {
      const [activeStep, setActiveStep] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => {
          setActiveStep(prev => (prev + 1) % 4);
        }, 3000);
        return () => clearInterval(interval);
      }, []);

      const steps = [
        { icon: Icons.Calendar, title: 'Annual Release Ritual', description: 'New color drops once per year. Customers anticipate it. They mark calendars. They sign up for alerts.', color: '#dc2626' },
        { icon: Icons.Heart, title: 'Collector Mentality Activates', description: 'Limited time = must collect. Customers don\'t buy one pot. They buy multiple pieces before it disappears.', color: '#f97316' },
        { icon: Icons.AlertTriangle, title: 'FOMO on Missed Colors', description: 'See last year\'s discontinued color? Instant regret. Customers vow not to miss this year\'s release.', color: '#8b5cf6' },
        { icon: Icons.TrendingUp, title: 'Secondary Market Premium', description: 'Discontinued colors resell for 200-300% of retail. Scarcity creates lasting value.', color: '#10b981' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
            <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4">
            {steps.map((step, i) => {
              const IconComp = step.icon;
              const isActive = activeStep === i;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  onClick={() => setActiveStep(i)}
                  style={{
                    background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                    borderRadius: '16px',
                    padding: '20px',
                    position: 'relative',
                    overflow: 'hidden',
                    cursor: 'pointer',
                    boxShadow: isActive ? `0 0 40px ${step.color}33` : 'none',
                    transition: 'all 0.3s ease'
                  }}
                >
                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    height: '3px',
                    background: isActive ? `linear-gradient(90deg, transparent, ${step.color}, transparent)` : 'transparent'
                  }} />
                  <div className="flex items-start gap-4">
                    <div style={{
                      width: '44px',
                      height: '44px',
                      borderRadius: '12px',
                      background: isActive ? step.color : '#e5e5e5',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      flexShrink: 0,
                      color: isActive ? 'white' : '#666'
                    }}>
                      <span className="text-white font-bold text-lg">{i + 1}</span>
                    </div>
                    <div>
                      <h3 style={{ fontSize: '16px', fontWeight: 'bold', color: isActive ? 'white' : '#1a1a1a', marginBottom: '4px' }}>{step.title}</h3>
                      <p style={{ fontSize: '13px', color: isActive ? '#a3a3a3' : '#666', lineHeight: '1.5' }}>{step.description}</p>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // ============ COLOR TIMELINE SLIDE ============
    const ColorTimelineSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
          <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
        </motion.div>

        <div className="space-y-4">
          {COLOR_RELEASES.filter(c => c.status === 'RETIRED').map((color, i) => (
            <motion.div
              key={color.year}
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2 + i * 0.15 }}
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                borderRadius: '16px',
                padding: '20px 24px',
                position: 'relative',
                overflow: 'hidden'
              }}
            >
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${color.hex}, transparent)` }} />
              <div className="flex items-center justify-between flex-wrap gap-4">
                <div className="flex items-center gap-4">
                  <div style={{ width: '50px', height: '50px', borderRadius: '12px', background: color.hex, boxShadow: `0 0 20px ${color.hex}66` }} />
                  <div>
                    <p className="text-white font-bold text-lg">{color.year} - {color.name}</p>
                    <p className="text-neutral-400 text-sm">Retired color</p>
                  </div>
                </div>
                <div className="text-right">
                  <p className="text-3xl font-black" style={{ color: '#10b981' }}><AnimatedCounter value={parseFloat(color.resale)} decimals={1} suffix="x" /></p>
                  <p className="text-neutral-400 text-xs">Current resale value</p>
                </div>
              </div>
            </motion.div>
          ))}
        </div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
          className="mt-6 text-center"
        >
          <p className="text-neutral-600 text-sm">
            <span className="font-bold" style={{ color: 'var(--accent)' }}>Pattern:</span> Every retired color appreciates. Scarcity creates lasting value.
          </p>
        </motion.div>
      </div>
    );

    // ============ FLASH VS CALENDAR SLIDE ============
    const FlashVsCalendarSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
            <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-6 mb-6">
            {/* Flash Sales */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2 }}
              style={{
                background: 'linear-gradient(135deg, #374151, #4b5563)',
                borderRadius: '20px',
                padding: '28px',
                position: 'relative',
                overflow: 'hidden'
              }}
            >
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #f59e0b, transparent)' }} />
              <div className="text-center mb-4">
                <span className="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider" style={{ background: 'rgba(245, 158, 11, 0.2)', color: '#fbbf24' }}>Flash Sales</span>
              </div>
              <div className="space-y-3 mb-4">
                {['48-hour panic window', 'Pressure-based decisions', 'Buyer\'s remorse common', 'No collector behavior'].map((item, i) => (
                  <div key={i} className="flex items-center gap-3">
                    <span style={{ color: '#f87171' }}><Icons.X /></span>
                    <span className="text-neutral-300 text-sm">{item}</span>
                  </div>
                ))}
              </div>
              <div style={{ background: 'rgba(0,0,0,0.3)', borderRadius: '10px', padding: '12px', textAlign: 'center' }}>
                <p className="text-neutral-400 text-xs">"Buy NOW or lose it forever!"</p>
              </div>
            </motion.div>

            {/* Calendar Scarcity */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.4 }}
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                borderRadius: '20px',
                padding: '28px',
                position: 'relative',
                overflow: 'hidden',
                boxShadow: showWinner ? '0 0 60px rgba(16, 185, 129, 0.3)' : 'none'
              }}
            >
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              {showWinner && (
                <motion.div
                  initial={{ scale: 0 }}
                  animate={{ scale: 1 }}
                  style={{ position: 'absolute', top: '12px', right: '12px', background: '#10b981', borderRadius: '8px', padding: '4px 12px' }}
                >
                  <span className="text-white text-xs font-bold">WINNER</span>
                </motion.div>
              )}
              <div className="text-center mb-4">
                <span className="inline-block px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider" style={{ background: 'rgba(16, 185, 129, 0.2)', color: '#34d399' }}>Calendar Scarcity</span>
              </div>
              <div className="space-y-3 mb-4">
                {['365-day decision window', 'Fair, pressure-free', 'Proud ownership', 'Creates collectors'].map((item, i) => (
                  <div key={i} className="flex items-center gap-3">
                    <span style={{ color: '#34d399' }}><Icons.Check /></span>
                    <span className="text-neutral-300 text-sm">{item}</span>
                  </div>
                ))}
              </div>
              <div style={{ background: 'rgba(16, 185, 129, 0.1)', borderRadius: '10px', padding: '12px', textAlign: 'center', border: '1px solid rgba(16, 185, 129, 0.3)' }}>
                <p className="text-neutral-300 text-xs">"2024 Limited Edition. Retires Dec 31st."</p>
              </div>
            </motion.div>
          </div>

          <AnimatePresence>
            {showWinner && (
              <motion.div
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                style={{
                  background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                  borderRadius: '16px',
                  padding: '16px 24px',
                  textAlign: 'center',
                  position: 'relative',
                  overflow: 'hidden'
                }}
              >
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
                <p className="text-white font-medium">Same scarcity psychology. <span style={{ color: '#34d399' }}>Zero manipulation.</span> Better results.</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // ============ APPLICATION GRID SLIDE ============
    const ApplicationGridSlide = ({ data }) => {
      const [activeApp, setActiveApp] = useState(0);
      const applications = [
        { icon: Icons.Package, title: 'Physical Products', description: 'Annual limited edition colors, seasonal exclusives, or yearly collaborations.', example: '"2024 Summer Collection - available June-August only."', color: '#dc2626' },
        { icon: Icons.Users, title: 'Digital Products', description: 'Yearly cohorts with closed enrollment. Create anticipation for the next batch.', example: '"2024 Cohort closes December 31st. Next cohort: January 2025."', color: '#3b82f6' },
        { icon: Icons.Star, title: 'Services', description: 'Fixed annual spots or seasonal availability. Quality through scarcity.', example: '"Taking 12 new clients for Q1 2024. Applications close March 31st."', color: '#8b5cf6' },
        { icon: Icons.Heart, title: 'Subscription Boxes', description: 'Seasonal themes that never repeat. Each box becomes collectible.', example: '"Fall 2024 Box: Harvest Collection. One-time theme, gone after October."', color: '#f97316' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
            <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4">
            {applications.map((app, i) => {
              const IconComp = app.icon;
              const isActive = activeApp === i;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  onClick={() => setActiveApp(i)}
                  style={{
                    background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                    borderRadius: '16px',
                    padding: '20px',
                    position: 'relative',
                    overflow: 'hidden',
                    cursor: 'pointer',
                    boxShadow: isActive ? `0 0 40px ${app.color}33` : 'none',
                    transition: 'all 0.3s ease'
                  }}
                >
                  <div style={{
                    position: 'absolute',
                    top: 0,
                    left: 0,
                    right: 0,
                    height: '3px',
                    background: isActive ? `linear-gradient(90deg, transparent, ${app.color}, transparent)` : 'transparent'
                  }} />
                  <div className="flex items-start gap-4">
                    <div style={{
                      width: '44px',
                      height: '44px',
                      borderRadius: '12px',
                      background: isActive ? app.color : '#e5e5e5',
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      flexShrink: 0,
                      color: isActive ? 'white' : '#666'
                    }}>
                      <IconComp />
                    </div>
                    <div className="flex-1">
                      <h3 style={{ fontSize: '16px', fontWeight: 'bold', color: isActive ? 'white' : '#1a1a1a', marginBottom: '4px' }}>{app.title}</h3>
                      <p style={{ fontSize: '13px', color: isActive ? '#a3a3a3' : '#666', lineHeight: '1.5', marginBottom: '8px' }}>{app.description}</p>
                      {isActive && (
                        <motion.div
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          style={{ background: 'rgba(255,255,255,0.05)', borderRadius: '8px', padding: '10px', border: `1px solid ${app.color}33` }}
                        >
                          <p style={{ fontSize: '12px', color: app.color, fontStyle: 'italic' }}>{app.example}</p>
                        </motion.div>
                      )}
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // ============ COUNTDOWN BRIDGE SLIDE ============
    const CountdownBridgeSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
          <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: 0.2 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '20px',
            padding: '32px',
            position: 'relative',
            overflow: 'hidden',
            marginBottom: '24px'
          }}
        >
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <div className="text-center mb-6">
            <p className="text-neutral-400 text-sm mb-2">2024 Limited Edition: Rhone</p>
            <p className="text-white text-lg font-bold mb-4">Retires in...</p>
            <div className="flex justify-center gap-4">
              {[
                { value: 47, label: 'DAYS' },
                { value: 12, label: 'HOURS' },
                { value: 38, label: 'MIN' },
                { value: 22, label: 'SEC' }
              ].map((item, i) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.3 + i * 0.1 }}
                  style={{
                    background: 'rgba(220, 38, 38, 0.1)',
                    borderRadius: '12px',
                    padding: '16px 20px',
                    border: '1px solid rgba(220, 38, 38, 0.3)'
                  }}
                >
                  <p className="text-3xl font-black" style={{ color: 'var(--accent)' }}><AnimatedCounter value={item.value} /></p>
                  <p className="text-neutral-400 text-xs">{item.label}</p>
                </motion.div>
              ))}
            </div>
          </div>

          <p className="text-neutral-300 text-center text-sm">The timer does the selling. No pushy copy needed.</p>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.6 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '16px',
            padding: '20px 24px',
            position: 'relative',
            overflow: 'hidden'
          }}
        >
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
          <div className="flex items-center gap-4">
            <div style={{ background: 'linear-gradient(135deg, #10b981, #059669)', borderRadius: '10px', padding: '10px' }}>
              <span style={{ color: 'white' }}><Icons.Lightbulb /></span>
            </div>
            <div>
              <p className="text-white font-bold text-sm">Le Creuset doesn't need a timer</p>
              <p className="text-neutral-400 text-xs">Their annual calendar is culturally embedded. Your store needs to make the countdown visible.</p>
            </div>
          </div>
        </motion.div>
      </div>
    );

    // ============ SECONDARY MARKET SLIDE ============
    const SecondaryMarketSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
          <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: 0.2 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '20px',
            padding: '32px',
            position: 'relative',
            overflow: 'hidden',
            marginBottom: '20px'
          }}
        >
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />

          <div className="text-center mb-6">
            <p className="text-neutral-400 text-xs uppercase tracking-wider mb-2">Case Study: Marseille Blue (2018)</p>
            <div className="flex items-center justify-center gap-6 flex-wrap">
              <div>
                <p className="text-neutral-400 text-sm">Original Retail</p>
                <p className="text-2xl font-bold text-white">$<AnimatedCounter value={150} /></p>
              </div>
              <div style={{ color: '#10b981', fontSize: '24px' }}>â†’</div>
              <div>
                <p className="text-neutral-400 text-sm">Current Resale</p>
                <p className="text-3xl font-black" style={{ color: '#10b981' }}>$<AnimatedCounter value={450} /></p>
              </div>
            </div>
          </div>

          <div className="grid grid-cols-3 gap-4">
            {[
              { label: 'Appreciation', value: '3x', color: '#10b981' },
              { label: 'Years Retired', value: '6', color: '#3b82f6' },
              { label: 'eBay Listings', value: '200+', color: '#8b5cf6' }
            ].map((stat, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.4 + i * 0.1 }}
                style={{ background: 'rgba(255,255,255,0.03)', borderRadius: '12px', padding: '16px', textAlign: 'center' }}
              >
                <p className="text-2xl font-bold" style={{ color: stat.color }}>{stat.value}</p>
                <p className="text-neutral-400 text-xs">{stat.label}</p>
              </motion.div>
            ))}
          </div>
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.7 }}
          className="text-center"
        >
          <p className="text-neutral-600 text-sm">
            <span className="font-bold" style={{ color: 'var(--accent)' }}>The signal:</span> Miss this year's color, pay premium later. Scarcity validated.
          </p>
        </motion.div>
      </div>
    );

    // ============ PRICING COMPARISON SLIDE ============
    const PricingComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
          <p className="text-neutral-500 text-sm md:text-base">{data.subtitle}</p>
        </motion.div>

        <div className="grid grid-cols-3 gap-4 md:gap-6">
          {[
            { label: 'Always Available', price: '$120', result: 'One purchase, maybe', color: '#94a3b8', winner: false },
            { label: 'Flash Sale', price: '$85', result: 'Panic buy, regret later', color: '#f59e0b', winner: false },
            { label: 'Calendar Scarcity', price: '$150', result: 'Multiple items, proud owner', color: '#10b981', winner: true }
          ].map((item, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 + i * 0.15 }}
              style={{
                background: item.winner ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                borderRadius: '16px',
                padding: '24px',
                textAlign: 'center',
                position: 'relative',
                overflow: 'hidden',
                transform: item.winner ? 'scale(1.05)' : 'scale(1)',
                boxShadow: item.winner ? '0 0 40px rgba(16, 185, 129, 0.3)' : 'none'
              }}
            >
              {item.winner && (
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              )}
              {item.winner && (
                <span className="absolute top-3 right-3 px-2 py-1 rounded-full text-[10px] font-bold" style={{ background: '#10b981', color: 'white' }}>BEST</span>
              )}
              <p className={`text-sm font-semibold mb-2 ${item.winner ? 'text-white' : 'text-neutral-700'}`}>{item.label}</p>
              <p className="text-4xl font-black mb-2" style={{ color: item.color }}>{item.price}</p>
              <p className={`text-xs ${item.winner ? 'text-neutral-400' : 'text-neutral-500'}`}>{item.result}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // ============ ELITE INSIGHT SLIDE ============
    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '24px',
            padding: '40px',
            position: 'relative',
            overflow: 'hidden',
            boxShadow: '0 0 80px rgba(220, 38, 38, 0.15)'
          }}
        >
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <div className="text-center mb-6">
            <motion.div
              initial={{ scale: 0 }}
              animate={{ scale: 1 }}
              transition={{ delay: 0.2, type: 'spring' }}
              style={{
                width: '80px',
                height: '80px',
                background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))',
                borderRadius: '20px',
                display: 'flex',
                alignItems: 'center',
                justifyContent: 'center',
                margin: '0 auto 24px',
                boxShadow: '0 0 40px rgba(220, 38, 38, 0.4)'
              }}
            >
              <Icons.Calendar />
            </motion.div>

            <motion.p
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.3 }}
              className="text-3xl md:text-4xl font-bold text-white mb-4 leading-tight"
              style={{ fontFamily: 'Fraunces, serif' }}
            >
              "{data.quote}"
            </motion.p>

            <motion.p
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.4 }}
              className="text-neutral-400 text-sm uppercase tracking-wider mb-6"
            >
              â€” {data.author}
            </motion.p>
          </div>

          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.5 }}
            style={{
              background: 'rgba(220, 38, 38, 0.1)',
              borderRadius: '16px',
              padding: '20px',
              border: '1px solid rgba(220, 38, 38, 0.2)'
            }}
          >
            <p className="text-neutral-300 text-center text-sm leading-relaxed">{data.insight}</p>
          </motion.div>
        </motion.div>
      </div>
    );

    // ============ QUIZ SLIDE ============
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // ============ COMPLETION SLIDE ============
    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">Calendar-based scarcity creates collectors. One release per year. Full time to decide. Zero pressure. Maximum urgency.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
        {data?.sources && data.sources.length > 0 && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} className="bg-neutral-50 border border-neutral-200 rounded-xl p-4 max-w-md w-full">
            <p className="text-neutral-400 text-xs uppercase tracking-wider mb-2 flex items-center justify-center gap-1">Tools Mentioned</p>
            <div className="space-y-1.5">
              {data.sources.map((source, i) => (
                <a key={i} href={source.url} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 text-sm font-medium transition-colors hover:underline" style={{ color: 'var(--accent)' }}>
                  {source.name}
                  <Icons.ExternalLink />
                </a>
              ))}
            </div>
          </motion.div>
        )}
      </div>
    );

    // ============ LESSON APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'color-wheel': return <ColorWheelSlide data={slide} />;
          case 'collector-flywheel': return <CollectorFlywheelSlide data={slide} />;
          case 'color-timeline': return <ColorTimelineSlide data={slide} />;
          case 'flash-vs-calendar': return <FlashVsCalendarSlide data={slide} />;
          case 'application-grid': return <ApplicationGridSlide data={slide} />;
          case 'countdown-bridge': return <CountdownBridgeSlide data={slide} />;
          case 'secondary-market': return <SecondaryMarketSlide data={slide} />;
          case 'pricing-comparison': return <PricingComparisonSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
