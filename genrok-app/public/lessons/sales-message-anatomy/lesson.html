<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sales Message Anatomy | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #10b981; --accent-dark: #059669; --accent-light: #34d399; --accent-rgb: 16, 185, 129; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes pulse-anatomy { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
    @keyframes flow-arrow { 0%, 100% { transform: translateX(0); opacity: 1; } 50% { transform: translateX(4px); opacity: 0.6; } }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'sales-message-anatomy',
      title: 'Sales Message Anatomy',
      description: 'Master the three-part structure that turns readers into buyers - Lead, Body, and Close.',
      accentColor: '#10b981',
      duration: '8 min',
      nextLesson: { id: 'self-persuasion-architecture', title: 'Self-Persuasion Architecture', teaser: 'Learn how to make customers convince themselves instead of pushing them.' }
    };

    // ============ CONFIGURATION ARRAYS ============
    const ANATOMY_SECTIONS = [
      { id: 1, name: 'THE LEAD', percentage: 40, description: 'Hook attention, create desire', role: 'Capture interest in 3 seconds', color: '#10b981', icon: 'Zap' },
      { id: 2, name: 'THE BODY', percentage: 40, description: 'Build belief, handle objections', role: 'Earn the right to sell', color: '#f97316', icon: 'Layers' },
      { id: 3, name: 'THE CLOSE', percentage: 20, description: 'Create urgency, drive action', role: 'Make saying yes easy', color: '#8b5cf6', icon: 'Target' }
    ];

    const LEAD_TYPES = [
      { id: 1, name: 'Problem Lead', description: 'Opens by identifying a painful problem', best: 'Shopify stores solving obvious pain points', example: 'Tired of customers abandoning at checkout?', icon: 'AlertCircle', color: '#ef4444' },
      { id: 2, name: 'Story Lead', description: 'Begins with a narrative that draws readers in', best: 'Personal brands and transformation offers', example: 'Three years ago, my store made $200/month...', icon: 'BookOpen', color: '#10b981' },
      { id: 3, name: 'Secret Lead', description: 'Promises insider information most do not know', best: 'Information products and courses', example: 'The hidden factor behind every 7-figure store...', icon: 'Eye', color: '#8b5cf6' },
      { id: 4, name: 'Direct Lead', description: 'Gets straight to the point with a clear offer', best: 'Established stores with warm audiences', example: '50% off our best-seller. Today only.', icon: 'ArrowRight', color: '#f97316' }
    ];

    const BODY_ELEMENTS = [
      { id: 1, name: 'Proof Stack', description: 'Testimonials, case studies, data, credentials. Stack multiple proof types.', impact: 'Builds credibility', icon: 'Award', color: '#10b981' },
      { id: 2, name: 'Benefits Over Features', description: 'Features tell what it does. Benefits explain why it matters.', impact: 'Creates desire', icon: 'Heart', color: '#ec4899' },
      { id: 3, name: 'Objection Handling', description: 'Address concerns before they voice them. Shows you understand.', impact: 'Removes friction', icon: 'Shield', color: '#f97316' },
      { id: 4, name: 'Future Pacing', description: 'Help them visualize life after using your product.', impact: 'Triggers action', icon: 'Sparkles', color: '#8b5cf6' }
    ];

    const CLOSING_ELEMENTS = [
      { id: 1, name: 'Offer Stack', description: 'Bundle your core offer with bonuses that increase perceived value', icon: 'Package', color: '#10b981' },
      { id: 2, name: 'Risk Reversal', description: 'Guarantees, free trials, easy refunds. Shift risk from buyer to seller.', icon: 'Shield', color: '#06b6d4' },
      { id: 3, name: 'Urgency & Scarcity', description: 'Give them a reason to act now. Limited time or quantity.', icon: 'Clock', color: '#f97316' },
      { id: 4, name: 'Clear CTA', description: 'Tell them exactly what to do next. Be specific and prominent.', icon: 'MousePointer', color: '#8b5cf6' }
    ];

    const CONVERSION_STATS = [
      { id: 1, value: 217, suffix: '%', label: 'Conversion Lift', subtext: 'Using 40-40-20 structure', color: '#10b981' },
      { id: 2, value: 3, suffix: 's', label: 'Decision Window', subtext: 'To hook attention in Lead', color: '#f97316' },
      { id: 3, value: 40, suffix: '%', label: 'Effort on Lead', subtext: 'Most critical investment', color: '#8b5cf6' }
    ];

    const ELITE_INSIGHT = {
      title: 'The Anatomy Paradox',
      quote: 'The more rigidly you follow the structure, the more naturally persuasive you become. Constraint creates flow.',
      insight: 'Master the anatomy, then the words write themselves.'
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) { window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*'); }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Layers: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
      AlertCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
      BookOpen: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
      Eye: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      Award: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89 17 22l-5-3-5 3 1.523-9.11"/></svg>,
      Heart: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      Shield: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Sparkles: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      Package: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
      MousePointer: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m3 3 7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/><path d="m13 13 6 6"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      ChevronRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
    };

    const IconMap = { Zap: Icons.Zap, Target: Icons.Target, Layers: Icons.Layers, AlertCircle: Icons.AlertCircle, BookOpen: Icons.BookOpen, Eye: Icons.Eye, ArrowRight: Icons.ArrowRight, Award: Icons.Award, Heart: Icons.Heart, Shield: Icons.Shield, Sparkles: Icons.Sparkles, Package: Icons.Package, Clock: Icons.Clock, MousePointer: Icons.MousePointer, Lightbulb: Icons.Lightbulb };

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ value, suffix = '', decimals = 0, duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(value);
        const increment = end / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(start); }
        }, 16);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{decimals > 0 ? count.toFixed(decimals) : Math.round(count)}{suffix}</span>;
    };

    // ============ SLIDES ============
    const slides = [
      { type: 'welcome', learningGoals: ['The 40-40-20 structure that pros use for every sales message', 'How to choose the right Lead type for your Shopify store', 'The Body elements that build belief and crush objections', 'Closing techniques that turn browsers into buyers'] },
      { type: 'hook', headline: 'Every sales message follows the same blueprint. Learn it once, use it forever.', subtext: 'Whether you are writing a product description, email sequence, or landing page for your Shopify store—the anatomy stays the same. Master this three-part structure and you will never stare at a blank page again.' },
      { type: 'anatomy-breakdown' },
      { type: 'message-pipeline' },
      { type: 'lead-selector' },
      { type: 'lead-detail', leadIndex: 0 },
      { type: 'lead-detail', leadIndex: 1 },
      { type: 'body-elements' },
      { type: 'body-detail', elementIndex: 0 },
      { type: 'body-detail', elementIndex: 1 },
      { type: 'closing-stack' },
      { type: 'conversion-stats' },
      { type: 'elite-insight' },
      { type: 'quiz', question: 'According to the Sales Message Anatomy, how much of your effort should go into crafting The Lead?', options: ['20% - just hook attention quickly', '40% - it determines if anyone reads the rest', '60% - it is the most important part', '33% - equal effort across all three parts'], correctIndex: 1, feedback: { correct: 'Exactly! The Lead gets 40% of your effort because if you lose them in the first few lines, your carefully crafted body and close mean nothing. Hook them first, then deliver value.', incorrect: 'Not quite. The Lead should get 40% of your effort—the same as the Body. Why? Because if you lose them in the first few lines, nothing else matters. The 40-40-20 rule mirrors how humans make buying decisions.' }},
      { type: 'completion', sources: [] }
    ];

    // ============ UNIQUE SLIDE COMPONENTS ============

    // Anatomy Breakdown - Visual 40-40-20 with animated progress bars
    const AnatomyBreakdownSlide = () => {
      const [activeSection, setActiveSection] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActiveSection(prev => (prev + 1) % 3), 3000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">The 40-40-20 Rule</motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">The proven structure behind every high-converting sales message</motion.p>

          <div className="space-y-4 mb-8">
            {ANATOMY_SECTIONS.map((section, i) => {
              const IconComponent = IconMap[section.icon];
              const isActive = activeSection === i;
              return (
                <motion.div key={section.id} initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.1 }}
                  className="relative" style={{ padding: '20px', borderRadius: '16px', background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', transition: 'all 0.3s ease' }}>
                  <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', borderRadius: '16px 16px 0 0', background: isActive ? `linear-gradient(90deg, transparent, ${section.color}, transparent)` : 'transparent' }} />
                  <div className="flex items-center gap-4">
                    <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: isActive ? section.color : '#e5e5e5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: isActive ? 'white' : '#666', transition: 'all 0.3s ease' }}>
                      <IconComponent />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-3 mb-1">
                        <span style={{ fontSize: '18px', fontWeight: 'bold', color: isActive ? 'white' : '#1a1a1a' }}>{section.name}</span>
                        <span style={{ padding: '4px 12px', borderRadius: '20px', fontSize: '14px', fontWeight: 'bold', background: section.color, color: 'white' }}>{section.percentage}%</span>
                      </div>
                      <p style={{ fontSize: '14px', color: isActive ? '#a3a3a3' : '#666' }}>{section.description}</p>
                    </div>
                    <div style={{ width: '120px' }}>
                      <div style={{ height: '8px', borderRadius: '4px', background: isActive ? '#404040' : '#e0e0e0', overflow: 'hidden' }}>
                        <motion.div initial={{ width: 0 }} animate={{ width: `${section.percentage * 2.5}%` }} transition={{ duration: 1, delay: 0.3 + i * 0.2 }}
                          style={{ height: '100%', background: section.color, borderRadius: '4px' }} />
                      </div>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>

          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.6 }}
            className="text-center" style={{ padding: '16px 24px', borderRadius: '12px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <p style={{ fontSize: '14px', color: '#a3a3a3' }}>This is not arbitrary—it mirrors how humans process buying decisions</p>
          </motion.div>
        </div>
      );
    };

    // Message Pipeline - Lead → Body → Close animated flow
    const MessagePipelineSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">The Message Flow</motion.h2>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-10">Each section builds on the last—skip one and the whole thing breaks</motion.p>

        <div className="flex items-center justify-center gap-4 md:gap-6 mb-10">
          {ANATOMY_SECTIONS.map((section, i) => {
            const IconComponent = IconMap[section.icon];
            return (
              <React.Fragment key={section.id}>
                <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.15 }}
                  style={{ width: '120px', textAlign: 'center' }}>
                  <div style={{ width: '80px', height: '80px', margin: '0 auto 12px', borderRadius: '20px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', display: 'flex', alignItems: 'center', justifyContent: 'center', boxShadow: `0 8px 24px ${section.color}30` }}>
                    <div style={{ color: section.color }}><IconComponent /></div>
                  </div>
                  <div style={{ fontSize: '14px', fontWeight: 'bold', color: section.color, marginBottom: '4px' }}>{section.percentage}%</div>
                  <div style={{ fontSize: '12px', fontWeight: '600', color: '#1a1a1a' }}>{section.name}</div>
                  <div style={{ fontSize: '10px', color: '#666', marginTop: '4px' }}>{section.role}</div>
                </motion.div>
                {i < 2 && (
                  <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 + i * 0.1 }}
                    style={{ color: '#ccc', animation: 'flow-arrow 1.5s infinite' }}>
                    <Icons.ChevronRight />
                  </motion.div>
                )}
              </React.Fragment>
            );
          })}
        </div>

        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.7 }}
          className="grid grid-cols-3 gap-4">
          {ANATOMY_SECTIONS.map((section, i) => (
            <div key={section.id} style={{ padding: '16px', borderRadius: '12px', background: '#f5f5f5', textAlign: 'center' }}>
              <div style={{ fontSize: '11px', fontWeight: '600', color: section.color, marginBottom: '4px' }}>IF YOU FAIL HERE</div>
              <div style={{ fontSize: '12px', color: '#666' }}>{i === 0 ? 'Nobody reads the rest' : i === 1 ? 'No belief = no sale' : 'They leave without buying'}</div>
            </div>
          ))}
        </motion.div>
      </div>
    );

    // Lead Type Selector - 4 types with auto-cycling
    const LeadSelectorSlide = () => {
      const [activeLead, setActiveLead] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActiveLead(prev => (prev + 1) % 4), 2500);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-2">
            <span style={{ display: 'inline-block', padding: '6px 16px', borderRadius: '20px', fontSize: '12px', fontWeight: '600', background: 'rgba(16, 185, 129, 0.1)', color: '#10b981', marginBottom: '12px' }}>Part 1: The Lead</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Four Lead Types That Convert</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">Choose the right lead type for your audience and offer</motion.p>

          <div className="grid md:grid-cols-2 gap-4">
            {LEAD_TYPES.map((lead, i) => {
              const IconComponent = IconMap[lead.icon];
              const isActive = activeLead === i;
              return (
                <motion.div key={lead.id} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }}
                  style={{ padding: '20px', borderRadius: '16px', background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: isActive ? 'none' : '2px solid #e5e5e5', transition: 'all 0.3s ease', cursor: 'pointer' }}
                  onClick={() => setActiveLead(i)}>
                  <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', borderRadius: '16px 16px 0 0', background: isActive ? `linear-gradient(90deg, transparent, ${lead.color}, transparent)` : 'transparent' }} />
                  <div className="flex items-start gap-3">
                    <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: isActive ? lead.color : '#f5f5f5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: isActive ? 'white' : lead.color, flexShrink: 0 }}>
                      <IconComponent />
                    </div>
                    <div>
                      <div className="flex items-center gap-2 mb-1">
                        <span style={{ fontSize: '16px', fontWeight: 'bold', color: isActive ? 'white' : '#1a1a1a' }}>{lead.name}</span>
                        {isActive && <span style={{ padding: '2px 8px', borderRadius: '10px', fontSize: '10px', fontWeight: '600', background: lead.color, color: 'white' }}>ACTIVE</span>}
                      </div>
                      <p style={{ fontSize: '13px', color: isActive ? '#a3a3a3' : '#666', marginBottom: '8px' }}>{lead.description}</p>
                      <div style={{ padding: '8px 12px', borderRadius: '8px', background: isActive ? '#333' : '#f5f5f5', fontSize: '12px', fontStyle: 'italic', color: isActive ? '#ccc' : '#666' }}>"{lead.example}"</div>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Lead Detail Slide
    const LeadDetailSlide = ({ leadIndex }) => {
      const lead = LEAD_TYPES[leadIndex];
      const IconComponent = IconMap[lead.icon];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            style={{ padding: '32px', borderRadius: '20px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', marginBottom: '24px' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', borderRadius: '20px 20px 0 0', background: `linear-gradient(90deg, transparent, ${lead.color}, transparent)` }} />
            <div className="flex items-center gap-4 mb-6">
              <div style={{ width: '56px', height: '56px', borderRadius: '14px', background: lead.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
                <IconComponent />
              </div>
              <div>
                <span style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', fontSize: '11px', fontWeight: '600', background: 'rgba(255,255,255,0.1)', color: '#a3a3a3', marginBottom: '4px' }}>Lead Type {leadIndex + 1}</span>
                <h2 className="slide-title text-2xl text-white">{lead.name}</h2>
              </div>
            </div>
            <p style={{ fontSize: '16px', color: '#d4d4d4', lineHeight: '1.7', marginBottom: '20px' }}>{lead.description}</p>
            <div style={{ padding: '16px', borderRadius: '12px', background: '#333' }}>
              <div style={{ fontSize: '11px', fontWeight: '600', color: lead.color, marginBottom: '8px' }}>BEST FOR</div>
              <p style={{ fontSize: '14px', color: '#a3a3a3' }}>{lead.best}</p>
            </div>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            style={{ padding: '20px', borderRadius: '16px', background: '#f5f5f5' }}>
            <div style={{ fontSize: '11px', fontWeight: '600', color: '#666', marginBottom: '8px' }}>EXAMPLE IN ACTION</div>
            <p style={{ fontSize: '16px', fontStyle: 'italic', color: '#1a1a1a' }}>"{lead.example}"</p>
          </motion.div>
        </div>
      );
    };

    // Body Elements - 4 elements with icons
    const BodyElementsSlide = () => {
      const [activeElement, setActiveElement] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActiveElement(prev => (prev + 1) % 4), 2500);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-2">
            <span style={{ display: 'inline-block', padding: '6px 16px', borderRadius: '20px', fontSize: '12px', fontWeight: '600', background: 'rgba(249, 115, 22, 0.1)', color: '#f97316', marginBottom: '12px' }}>Part 2: The Body</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Essential Body Elements</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">This is where you earn the right to ask for the sale</motion.p>

          <div className="grid md:grid-cols-2 gap-4">
            {BODY_ELEMENTS.map((element, i) => {
              const IconComponent = IconMap[element.icon];
              const isActive = activeElement === i;
              return (
                <motion.div key={element.id} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }}
                  style={{ padding: '20px', borderRadius: '16px', background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: isActive ? 'none' : '2px solid #e5e5e5', transition: 'all 0.3s ease' }}>
                  <div className="flex items-start gap-3">
                    <div style={{ width: '44px', height: '44px', borderRadius: '12px', background: isActive ? element.color : '#f5f5f5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: isActive ? 'white' : element.color, flexShrink: 0 }}>
                      <IconComponent />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-2">
                        <span style={{ width: '24px', height: '24px', borderRadius: '6px', background: isActive ? '#404040' : '#e5e5e5', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 'bold', color: isActive ? 'white' : '#666' }}>{i + 1}</span>
                        <span style={{ fontSize: '15px', fontWeight: 'bold', color: isActive ? 'white' : '#1a1a1a' }}>{element.name}</span>
                      </div>
                      <p style={{ fontSize: '13px', color: isActive ? '#a3a3a3' : '#666', marginBottom: '10px' }}>{element.description}</p>
                      <div style={{ display: 'inline-block', padding: '4px 10px', borderRadius: '8px', fontSize: '11px', fontWeight: '600', background: isActive ? element.color : 'rgba(0,0,0,0.05)', color: isActive ? 'white' : element.color }}>{element.impact}</div>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Body Detail Slide
    const BodyDetailSlide = ({ elementIndex }) => {
      const element = BODY_ELEMENTS[elementIndex];
      const IconComponent = IconMap[element.icon];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            style={{ padding: '32px', borderRadius: '20px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', borderRadius: '20px 20px 0 0', background: `linear-gradient(90deg, transparent, ${element.color}, transparent)` }} />
            <div className="flex items-center gap-4 mb-6">
              <div style={{ width: '56px', height: '56px', borderRadius: '14px', background: element.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
                <IconComponent />
              </div>
              <div>
                <span style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', fontSize: '11px', fontWeight: '600', background: 'rgba(255,255,255,0.1)', color: '#a3a3a3', marginBottom: '4px' }}>Body Element {elementIndex + 1}</span>
                <h2 className="slide-title text-2xl text-white">{element.name}</h2>
              </div>
            </div>
            <p style={{ fontSize: '16px', color: '#d4d4d4', lineHeight: '1.7', marginBottom: '20px' }}>{element.description}</p>
            <div className="grid grid-cols-2 gap-4">
              <div style={{ padding: '16px', borderRadius: '12px', background: '#333', textAlign: 'center' }}>
                <div style={{ fontSize: '11px', fontWeight: '600', color: '#666', marginBottom: '4px' }}>IMPACT</div>
                <div style={{ fontSize: '14px', fontWeight: 'bold', color: element.color }}>{element.impact}</div>
              </div>
              <div style={{ padding: '16px', borderRadius: '12px', background: '#333', textAlign: 'center' }}>
                <div style={{ fontSize: '11px', fontWeight: '600', color: '#666', marginBottom: '4px' }}>PRIORITY</div>
                <div style={{ fontSize: '14px', fontWeight: 'bold', color: 'white' }}>Essential</div>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // Closing Stack - Show closing elements
    const ClosingStackSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-2">
          <span style={{ display: 'inline-block', padding: '6px 16px', borderRadius: '20px', fontSize: '12px', fontWeight: '600', background: 'rgba(139, 92, 246, 0.1)', color: '#8b5cf6', marginBottom: '12px' }}>Part 3: The Close</span>
          <h2 className="slide-title text-2xl md:text-3xl text-black">Closing Elements That Convert</h2>
        </motion.div>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">Make saying yes the easiest decision they make all day</motion.p>

        <div className="grid md:grid-cols-2 gap-4">
          {CLOSING_ELEMENTS.map((element, i) => {
            const IconComponent = IconMap[element.icon];
            return (
              <motion.div key={element.id} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }}
                style={{ padding: '20px', borderRadius: '16px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', borderRadius: '16px 16px 0 0', background: `linear-gradient(90deg, transparent, ${element.color}, transparent)` }} />
                <div className="flex items-start gap-3">
                  <div style={{ width: '44px', height: '44px', borderRadius: '12px', background: element.color, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', flexShrink: 0 }}>
                    <IconComponent />
                  </div>
                  <div>
                    <div className="flex items-center gap-2 mb-2">
                      <span style={{ width: '24px', height: '24px', borderRadius: '6px', background: '#404040', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: '12px', fontWeight: 'bold', color: 'white' }}>{i + 1}</span>
                      <span style={{ fontSize: '15px', fontWeight: 'bold', color: 'white' }}>{element.name}</span>
                    </div>
                    <p style={{ fontSize: '13px', color: '#a3a3a3' }}>{element.description}</p>
                  </div>
                </div>
              </motion.div>
            );
          })}
        </div>
      </div>
    );

    // Conversion Stats with AnimatedCounters
    const ConversionStatsSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">The Power of Structure</motion.h2>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-10">Why following the anatomy creates predictable results</motion.p>

        <div className="grid md:grid-cols-3 gap-6">
          {CONVERSION_STATS.map((stat, i) => (
            <motion.div key={stat.id} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }}
              style={{ padding: '32px 24px', borderRadius: '20px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', textAlign: 'center' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', borderRadius: '20px 20px 0 0', background: `linear-gradient(90deg, transparent, ${stat.color}, transparent)` }} />
              <div style={{ fontSize: '48px', fontWeight: 'bold', color: stat.color, marginBottom: '8px' }}>
                <AnimatedCounter value={stat.value} suffix={stat.suffix} />
              </div>
              <div style={{ fontSize: '16px', fontWeight: '600', color: 'white', marginBottom: '4px' }}>{stat.label}</div>
              <div style={{ fontSize: '13px', color: '#666' }}>{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Elite Insight Slide
    const EliteInsightSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }}
          style={{ padding: '40px', borderRadius: '24px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', textAlign: 'center' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', borderRadius: '24px 24px 0 0', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2, type: 'spring' }}
            style={{ width: '64px', height: '64px', margin: '0 auto 20px', borderRadius: '16px', background: 'linear-gradient(135deg, #10b981, #059669)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}>
            <Icons.Lightbulb />
          </motion.div>
          <div style={{ fontSize: '12px', fontWeight: '600', color: '#10b981', marginBottom: '12px', letterSpacing: '0.1em' }}>ELITE INSIGHT</div>
          <h2 className="slide-title text-2xl md:text-3xl text-white mb-6">{ELITE_INSIGHT.title}</h2>
          <p style={{ fontSize: '18px', color: '#d4d4d4', lineHeight: '1.7', marginBottom: '24px', fontStyle: 'italic' }}>"{ELITE_INSIGHT.quote}"</p>
          <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '12px', padding: '16px 24px', borderRadius: '12px', background: 'rgba(16, 185, 129, 0.1)' }}>
            <Icons.Zap />
            <span style={{ fontSize: '14px', fontWeight: '600', color: '#10b981' }}>{ELITE_INSIGHT.insight}</span>
          </div>
        </motion.div>
      </div>
    );

    // ============ STANDARD SLIDES ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;
      useEffect(() => { if (showFeedback) { onShowGif(isCorrect ? celebrationGif : empathyGif, '60%', gifSide); } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now know the blueprint: 40% Lead to hook attention, 40% Body to build belief, 20% Close to drive action. Apply the 40-40-20 structure to any sales message.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'anatomy-breakdown': return <AnatomyBreakdownSlide />;
          case 'message-pipeline': return <MessagePipelineSlide />;
          case 'lead-selector': return <LeadSelectorSlide />;
          case 'lead-detail': return <LeadDetailSlide leadIndex={slide.leadIndex} />;
          case 'body-elements': return <BodyElementsSlide />;
          case 'body-detail': return <BodyDetailSlide elementIndex={slide.elementIndex} />;
          case 'closing-stack': return <ClosingStackSlide />;
          case 'conversion-stats': return <ConversionStatsSlide />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
