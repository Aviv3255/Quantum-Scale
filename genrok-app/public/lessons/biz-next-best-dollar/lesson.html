<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Next Best Dollar | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #F59E0B; --accent-dark: #D97706; --accent-light: #FCD34D; --accent-rgb: 245, 158, 11; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'biz-next-best-dollar',
      title: 'The Next Best Dollar',
      description: 'Think like a capital allocator, not a channel manager',
      accentColor: '#F59E0B',
      duration: '5 min',
      nextLesson: { id: 'biz-high-margin-fortress', title: 'The High Margin Fortress', teaser: 'Why selling cheap is a death sentence for eCommerce.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_above_head_world_champion_celebration_484bd560-f049-41ca-b3d1-c03d7468ab56_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_starting_with_slow_clap_accelerating_to_fast_c_ee478a38-0ee7-437d-bd13-d687f7dd624a_0.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_wiping_away_a_small_tear_sad_but_gentle_disapp_8d78571b-3c36-4502-abee-81683255843c_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_sighing_sadly_exhaling_with_disappointment_hea_f6014f2a-3a99-4378-a2a8-414e16b3e72d_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_slouching_with_disappointment_body_curling_inw_caedddbe-413c-492a-9fdf-1e8433f5e2a8_2%20(1).mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_placing_hand_on_forehead_sadly_eyes_closed_fru_3e048895-f365-4ff2-9e88-0d0a35b2a9e1_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_nodding_slowly_with_sadness_what_a_shame_expre_377f67ca-63da-41aa-9072-4926fc2f6e82_3.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why you are a capital allocator', 'The one question that changes everything', 'How to find the perfect spend level'] },
      { type: 'hook', headline: 'Most marketers manage channels. Elite marketers allocate capital.', subtext: 'One question separates the two. Most marketers ask "how do I improve my Meta ads?" Elite marketers ask "where does my next dollar generate the highest return?" The first optimizes in silos. The second optimizes the entire portfolio. One manages platforms. The other deploys capital for maximum efficiency.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/YouTube_Logo_2017.svg.png', brandName: 'YouTube' },
      { type: 'capital-allocation', title: 'How 9-Figure Brands Allocate Capital', subtitle: 'The proven 50/20/20/10 formula', segments: [
        { label: 'Primary Channel', percentage: 50, color: '#22C55E', description: 'Your top performer - scale aggressively' },
        { label: 'Secondary', percentage: 20, color: '#3B82F6', description: 'Strong ROI - maintain & optimize' },
        { label: 'Testing', percentage: 20, color: '#F59E0B', description: 'New opportunities - controlled experiments' },
        { label: 'Brand', percentage: 10, color: '#8B5CF6', description: 'Long-term equity - awareness plays' }
      ]},
      { type: 'content', title: 'You\'re Not a Channel Manager', body: 'Your job isn\'t to run Meta ads or manage Google. It\'s to deploy capital for maximum return. Stop thinking like a platform operator. Start thinking like an investor. Every dollar you spend is capital. Every channel is an investment opportunity. Your role is to allocate that capital to generate the highest possible ROI across your entire portfolio.' },
      { type: 'roi-cards', title: 'Capital Allocation in Action', cards: [
        { channel: 'YouTube', roi: '4.5x', color: '#FF0000', iconComponent: 'Youtube', action: 'Scale up â†’ More capital' },
        { channel: 'Meta Ads', roi: '3.1x', color: '#1877F2', iconComponent: 'Smartphone', action: 'Maintain â†’ Stable allocation' },
        { channel: 'TikTok', roi: '2.8x', color: '#EE1D52', iconComponent: 'Music', action: 'Evaluate â†’ Less capital' }
      ], insight: 'Deploy capital where returns are highest. YouTube at 4.5x gets priority over TikTok at 2.8x.' },
      { type: 'strategy-steps', title: 'The 3-Step Capital Allocation Framework', steps: [
        { number: 1, title: 'Measure Everything', description: 'Track ROI across ALL channels weekly. Know your exact return on every dollar.', icon: 'BarChart', color: '#3B82F6' },
        { number: 2, title: 'Rank by Returns', description: 'Order channels by ROI. Your best performer gets the most capital.', icon: 'TrendingUp', color: '#22C55E' },
        { number: 3, title: 'Reallocate Weekly', description: 'Shift budget from underperformers to top performers. Ruthlessly.', icon: 'Refresh', color: '#F59E0B' }
      ]},
      { type: 'highlight-box', title: 'The Only Question That Matters', body: 'Stop asking how to improve individual channels. Start asking where your next dollar generates the best return. This single question changes everything. It shifts you from channel manager to capital allocator. From platform optimizer to portfolio strategist. From tactical executor to financial decision maker.', highlight: 'Where should I spend my next best dollar to generate the highest possible return?' },
      { type: 'content', title: 'The Capital Allocator Mindset', body: 'Stop asking "how do I improve my Meta ads?" Start asking "where does my next dollar generate the best return?" This is a fundamental shift. Channel managers optimize in silos. Capital allocators optimize across the portfolio. Channel managers have loyalty to platforms. Capital allocators have loyalty to returns. One mindset leads to inconsistent ROI. The other leads to maximum efficiency.' },
      { type: 'before-after', title: 'Channel Manager vs Capital Allocator', before: [
        'Manage channels in isolation',
        'Optimize each platform separately',
        'Loyalty to specific channels',
        'Inconsistent ROI across portfolio',
        'Tactical execution focus'
      ], after: [
        'Allocate capital strategically',
        'Optimize entire portfolio together',
        'Loyalty only to returns',
        'Maximum efficiency everywhere',
        'Financial decision making focus'
      ]},
      { type: 'stat-countdown', title: 'Every Channel Has a Ceiling', stats: [
        { value: 3.1, suffix: 'x', label: 'Meta ROI', subtext: 'Strong performer, room to scale' },
        { value: 4.5, suffix: 'x', label: 'YouTube ROI', subtext: 'Top performer, allocate more capital' },
        { value: 2.8, suffix: 'x', label: 'TikTok ROI', subtext: 'Underperformer, reduce allocation' }
      ]},
      { type: 'tool-integration', title: 'Putting It Into Practice', subtitle: 'How to become a capital allocator this week' },
      { type: 'quiz', question: 'What is the guiding question for capital allocators?', options: ['How do I improve my Meta ads?', 'Where should I spend my next best dollar?', 'Which channel is cheapest?', 'How do I increase impressions?'], correctIndex: 1, feedback: { correct: 'Perfect. This is the only question that matters. Where does your next dollar generate the highest possible return? This question forces you to think like an investor, not a channel manager. It shifts you from optimizing platforms to optimizing capital deployment. Every dollar is an investment decision. Deploy it where returns are maximum.', incorrect: 'Not quite. The guiding question is: "Where should I spend my next best dollar to generate the highest possible return?" This question changes everything. It shifts you from channel manager to capital allocator. From platform optimizer to portfolio strategist. Stop optimizing channels. Start optimizing capital deployment.' }},
      { type: 'completion', sources: [] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: ({ size = 12, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      // Premium Icons for ROI Cards
      Youtube: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"/><polygon points="9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"/></svg>,
      Smartphone: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>,
      Music: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
      TrendingUp: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      DollarSign: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Target: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      CheckCircle: ({ size = 12, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      BarChart: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      Refresh: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>,
      PieChart: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"/><path d="M22 12A10 10 0 0 0 12 2v10z"/></svg>,
      Database: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"/><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"/><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"/></svg>,
    };

    // Animated Components
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start * 10) / 10); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none" style={{ height: '30%', maxHeight: '200px', marginRight: '3%', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    const StatCountdownSlide = ({ data }) => {
      // Colors for each stat card
      const cardColors = ['#22C55E', '#F59E0B', '#EF4444'];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-3 gap-6">
            {data.stats.map((stat, i) => {
              const color = cardColors[i] || 'var(--accent)';
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.15 }}
                  className="rounded-2xl p-6 text-center relative overflow-hidden"
                  style={{
                    background: '#0a0a0a',
                    border: `1px solid ${color}`,
                    boxShadow: `0 0 25px ${color}20`
                  }}
                >
                  {/* Glow effect */}
                  <div
                    className="absolute top-0 left-1/2 -translate-x-1/2 w-24 h-24 rounded-full blur-3xl -mt-12"
                    style={{ background: `${color}15` }}
                  ></div>

                  <div className="relative z-10">
                    <div className="text-5xl font-bold mb-2" style={{ color }}>
                      <AnimatedCounter target={stat.value} suffix={stat.suffix} prefix={stat.prefix} />
                    </div>
                    <div className="text-sm font-semibold text-white mb-1">{stat.label}</div>
                    <div className="text-xs text-neutral-400">{stat.subtext}</div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const MockupSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 }} className="bg-white border-2 border-neutral-200 rounded-2xl p-8 mb-4">
          <div dangerouslySetInnerHTML={{ __html: data.svgContent }} />
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-neutral-600 text-sm text-center max-w-2xl mx-auto">{data.caption}</motion.p>
      </div>
    );

    const RoiCardsSlide = ({ data }) => {
      const getGlowColor = (color) => {
        const hex = color.replace('#', '');
        const r = parseInt(hex.substr(0, 2), 16);
        const g = parseInt(hex.substr(2, 2), 16);
        const b = parseInt(hex.substr(4, 2), 16);
        return `rgba(${r}, ${g}, ${b}, 0.5)`;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-3 gap-5">
            {data.cards.map((card, i) => {
              const IconComponent = card.iconComponent ? Icons[card.iconComponent] : null;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.15 }}
                  className="rounded-2xl p-6 text-center relative overflow-hidden"
                  style={{
                    background: '#0a0a0a',
                    border: `1px solid ${card.color}`,
                    boxShadow: `0 0 30px ${getGlowColor(card.color).replace('0.5', '0.15')}`
                  }}
                >
                  {/* Glow effect */}
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 rounded-full blur-3xl -mt-16" style={{ background: getGlowColor(card.color).replace('0.5', '0.12') }}></div>

                  <div className="relative z-10">
                    {/* Icon box */}
                    {IconComponent && (
                      <div
                        className="w-14 h-14 rounded-xl flex items-center justify-center mx-auto mb-4"
                        style={{
                          background: `${card.color}15`,
                          border: `1px solid ${card.color}`
                        }}
                      >
                        <IconComponent size={28} color={card.color} />
                      </div>
                    )}

                    <div className="text-white font-bold text-lg mb-2">{card.channel}</div>
                    <div className="text-5xl font-bold mb-1" style={{ color: card.color }}>{card.roi}</div>
                    <div className="text-xs text-neutral-500 uppercase tracking-wider mb-4">Return on Investment</div>

                    {/* Action badge */}
                    <div
                      className="mt-3 pt-3 border-t"
                      style={{ borderColor: `${card.color}30` }}
                    >
                      <span
                        className="inline-block px-3 py-1.5 rounded-full text-xs font-semibold"
                        style={{
                          background: `${card.color}15`,
                          color: card.color
                        }}
                      >
                        {card.action}
                      </span>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="text-neutral-500 text-sm text-center mt-8 max-w-xl mx-auto">{data.insight}</motion.p>
        </div>
      );
    };

    const HighlightBoxSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed mb-6">{data.body}</motion.p>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-xl p-6 text-center" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
          <p className="text-white text-lg font-bold">{data.highlight}</p>
        </motion.div>
      </div>
    );

    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          {/* BEFORE Card - Dark with red border */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} className="relative">
            <div
              className="absolute -top-3 left-4 px-3 py-1 text-xs font-bold rounded-full z-10"
              style={{ background: '#EF4444', color: 'white', boxShadow: '0 0 10px rgba(239, 68, 68, 0.4)' }}
            >
              BEFORE
            </div>
            <div
              className="rounded-2xl p-6 pt-8 relative overflow-hidden"
              style={{ background: '#0a0a0a', border: '1px solid #EF4444', boxShadow: '0 0 25px rgba(239, 68, 68, 0.12)' }}
            >
              {/* Glow effect */}
              <div className="absolute top-0 left-0 w-32 h-32 rounded-full blur-3xl -ml-16 -mt-16" style={{ background: 'rgba(239, 68, 68, 0.08)' }}></div>

              <ul className="space-y-3 relative z-10">
                {data.before.map((item, i) => (
                  <motion.li
                    key={i}
                    initial={{ opacity: 0, x: -10 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.15 + i * 0.08 }}
                    className="flex items-start gap-3"
                  >
                    <span
                      className="flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5"
                      style={{ background: 'rgba(239, 68, 68, 0.15)', border: '1px solid #EF4444' }}
                    >
                      <Icons.X size={10} color="#EF4444" />
                    </span>
                    <span className="text-sm text-neutral-300">{item}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>

          {/* AFTER Card - Dark with green border */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative">
            <div
              className="absolute -top-3 left-4 px-3 py-1 text-xs font-bold rounded-full z-10"
              style={{ background: '#22C55E', color: 'white', boxShadow: '0 0 10px rgba(34, 197, 94, 0.4)' }}
            >
              AFTER
            </div>
            <div
              className="rounded-2xl p-6 pt-8 relative overflow-hidden"
              style={{ background: '#0a0a0a', border: '1px solid #22C55E', boxShadow: '0 0 25px rgba(34, 197, 94, 0.12)' }}
            >
              {/* Glow effect */}
              <div className="absolute top-0 right-0 w-32 h-32 rounded-full blur-3xl -mr-16 -mt-16" style={{ background: 'rgba(34, 197, 94, 0.08)' }}></div>

              <ul className="space-y-3 relative z-10">
                {data.after.map((item, i) => (
                  <motion.li
                    key={i}
                    initial={{ opacity: 0, x: 10 }}
                    animate={{ opacity: 1, x: 0 }}
                    transition={{ delay: 0.35 + i * 0.08 }}
                    className="flex items-start gap-3"
                  >
                    <span
                      className="flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center mt-0.5"
                      style={{ background: 'rgba(34, 197, 94, 0.15)', border: '1px solid #22C55E' }}
                    >
                      <Icons.CheckCircle size={10} color="#22C55E" />
                    </span>
                    <span className="text-sm text-neutral-300">{item}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
        </div>
      </div>
    );

    // NEW: Capital Allocation Slide with Animated Donut Chart
    const CapitalAllocationSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      // Calculate SVG donut chart segments
      const total = data.segments.reduce((sum, s) => sum + s.percentage, 0);
      let cumulative = 0;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.PieChart size={14} color="var(--accent)" />
              <span>The Formula</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</h2>
            <p className="text-neutral-500 text-sm">{data.subtitle}</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-8 items-center">
            {/* Animated Donut Chart */}
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.2 }}
              className="relative flex items-center justify-center"
            >
              <div className="rounded-2xl p-8" style={{ background: '#0a0a0a', boxShadow: '0 0 40px rgba(0,0,0,0.3)' }}>
                {/* SVG container with relative positioning for center text */}
                <div className="relative w-48 h-48 md:w-56 md:h-56 mx-auto">
                  <svg viewBox="0 0 200 200" className="w-full h-full transform -rotate-90">
                    {data.segments.map((segment, i) => {
                      const strokeDasharray = (segment.percentage / total) * 282.6;
                      const strokeDashoffset = -((cumulative / total) * 282.6);
                      cumulative += segment.percentage;

                      return (
                        <motion.circle
                          key={i}
                          cx="100"
                          cy="100"
                          r="45"
                          fill="none"
                          stroke={segment.color}
                          strokeWidth="30"
                          strokeDasharray={`${animated ? strokeDasharray : 0} 282.6`}
                          strokeDashoffset={strokeDashoffset}
                          style={{ filter: `drop-shadow(0 0 8px ${segment.color}50)` }}
                          initial={{ strokeDasharray: '0 282.6' }}
                          animate={{ strokeDasharray: `${strokeDasharray} 282.6` }}
                          transition={{ duration: 1, delay: 0.3 + i * 0.15, ease: 'easeOut' }}
                        />
                      );
                    })}
                  </svg>
                  {/* Center text - positioned relative to SVG only */}
                  <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <div className="text-center">
                      <div className="text-2xl font-bold text-white">100%</div>
                      <div className="text-[10px] text-neutral-400 uppercase tracking-wide">Budget</div>
                    </div>
                  </div>
                </div>
              </div>
            </motion.div>

            {/* Segment Legend */}
            <div className="space-y-3">
              {data.segments.map((segment, i) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: 20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.4 + i * 0.1 }}
                  className="rounded-xl p-4 relative overflow-hidden"
                  style={{ background: '#0a0a0a', border: `1px solid ${segment.color}30`, boxShadow: `0 0 20px ${segment.color}10` }}
                >
                  <div className="flex items-center gap-4">
                    <div
                      className="w-12 h-12 rounded-lg flex items-center justify-center text-xl font-bold"
                      style={{ background: `${segment.color}20`, color: segment.color }}
                    >
                      {segment.percentage}%
                    </div>
                    <div className="flex-1">
                      <div className="text-white font-semibold text-sm">{segment.label}</div>
                      <div className="text-neutral-400 text-xs">{segment.description}</div>
                    </div>
                  </div>
                  {/* Progress bar */}
                  <motion.div
                    className="h-1 rounded-full mt-3"
                    style={{ background: `${segment.color}20` }}
                  >
                    <motion.div
                      className="h-full rounded-full"
                      style={{ background: segment.color, filter: `drop-shadow(0 0 4px ${segment.color})` }}
                      initial={{ width: 0 }}
                      animate={{ width: `${segment.percentage}%` }}
                      transition={{ duration: 0.8, delay: 0.5 + i * 0.1 }}
                    />
                  </motion.div>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // NEW: Strategy Steps Slide - 3-step visual process (clean, no broken connectors)
    const StrategyStepsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
            <Icons.Target size={14} color="var(--accent)" />
            <span>Framework</span>
          </div>
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        {/* Steps with arrow connectors */}
        <div className="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-2">
          {data.steps.map((step, i) => {
            const IconComponent = Icons[step.icon] || Icons.Check;
            return (
              <React.Fragment key={i}>
                <motion.div
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.15 + i * 0.15 }}
                  className="rounded-2xl p-6 relative overflow-hidden flex-1 max-w-xs w-full"
                  style={{ background: '#0a0a0a', border: `1px solid ${step.color}40`, boxShadow: `0 0 25px ${step.color}15` }}
                >
                  {/* Glow effect */}
                  <div className="absolute top-0 left-1/2 -translate-x-1/2 w-32 h-32 rounded-full blur-3xl -mt-16" style={{ background: `${step.color}10` }}></div>

                  <div className="relative z-10">
                    {/* Step number badge */}
                    <div
                      className="w-10 h-10 rounded-xl flex items-center justify-center text-lg font-bold mb-4"
                      style={{ background: `${step.color}20`, color: step.color, border: `1px solid ${step.color}` }}
                    >
                      {step.number}
                    </div>

                    {/* Icon */}
                    <div
                      className="w-14 h-14 rounded-2xl flex items-center justify-center mb-4"
                      style={{ background: `${step.color}15`, border: `1px solid ${step.color}50` }}
                    >
                      <IconComponent size={28} color={step.color} />
                    </div>

                    <h3 className="text-white font-bold text-lg mb-2">{step.title}</h3>
                    <p className="text-neutral-400 text-sm leading-relaxed">{step.description}</p>
                  </div>
                </motion.div>

                {/* Arrow connector between steps */}
                {i < data.steps.length - 1 && (
                  <motion.div
                    initial={{ opacity: 0, scale: 0.5 }}
                    animate={{ opacity: 1, scale: 1 }}
                    transition={{ delay: 0.3 + i * 0.15 }}
                    className="hidden md:flex items-center justify-center w-8 flex-shrink-0"
                  >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke={step.color} strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                      <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                  </motion.div>
                )}
              </React.Fragment>
            );
          })}
        </div>
      </div>
    );

    // Implementation Guide Slide - Natural tool integration as part of workflow
    const ToolIntegrationSlide = ({ data }) => {
      const implementationSteps = [
        { step: 1, title: 'Set Up Tracking', description: 'Connect all your ad accounts to a single dashboard. You need visibility across Meta, Google, TikTok - everything.', icon: 'Database', color: '#3B82F6' },
        { step: 2, title: 'Measure Weekly ROI', description: 'Every Friday, pull your numbers. What\'s each channel returning? This becomes your allocation guide.', icon: 'BarChart', color: '#22C55E' },
        { step: 3, title: 'Reallocate Capital', description: 'Move budget from underperformers to top performers. The data tells you exactly where your next dollar belongs.', icon: 'TrendingUp', color: '#F59E0B' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8 slide-scroll overflow-y-auto">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>How To Implement This</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-2">Putting It Into Practice</h2>
            <p className="text-neutral-500 text-sm max-w-lg mx-auto">Here's exactly how to become a capital allocator starting this week</p>
          </motion.div>

          {/* Implementation steps */}
          <div className="space-y-4 mb-6">
            {implementationSteps.map((item, i) => {
              const IconComponent = Icons[item.icon] || Icons.Check;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.15 + i * 0.12 }}
                  className="rounded-xl p-4 relative overflow-hidden"
                  style={{ background: '#0a0a0a', border: `1px solid ${item.color}30` }}
                >
                  <div className="flex items-start gap-4">
                    <div
                      className="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0"
                      style={{ background: `${item.color}15`, border: `1px solid ${item.color}` }}
                    >
                      <IconComponent size={20} color={item.color} />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="text-xs font-bold px-2 py-0.5 rounded" style={{ background: `${item.color}20`, color: item.color }}>Step {item.step}</span>
                        <h4 className="text-white font-semibold">{item.title}</h4>
                      </div>
                      <p className="text-neutral-400 text-sm leading-relaxed">{item.description}</p>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>

          {/* Pro tip with tool mention - natural, not salesy */}
          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.6 }}
            className="rounded-xl p-4 border border-neutral-200 bg-neutral-50"
          >
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center flex-shrink-0">
                <span className="text-amber-600 text-sm">ðŸ’¡</span>
              </div>
              <div>
                <p className="text-neutral-700 text-sm leading-relaxed">
                  <strong>Pro tip:</strong> Tools like Triple Whale or Hyros make this easier by auto-tracking attribution across all channels. But you can start with a simple spreadsheet - the key is <em>measuring consistently</em>.
                </p>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You're not a channel manager. You're a capital allocator. Ask where your next dollar generates the highest return. This question shifts you from platform optimizer to portfolio strategist. Deploy capital for maximum efficiency. Find the perfect spend level on every channel.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'stat-countdown': return <StatCountdownSlide data={slide} />;
          case 'mockup': return <MockupSlide data={slide} />;
          case 'roi-cards': return <RoiCardsSlide data={slide} />;
          case 'highlight-box': return <HighlightBoxSlide data={slide} />;
          case 'before-after': return <BeforeAfterSlide data={slide} />;
          case 'capital-allocation': return <CapitalAllocationSlide data={slide} />;
          case 'strategy-steps': return <StrategyStepsSlide data={slide} />;
          case 'tool-integration': return <ToolIntegrationSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
