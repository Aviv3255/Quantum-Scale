<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Rat Brain Hijack | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #10b981; --accent-dark: #059669; --accent-light: #6ee7b7; --accent-rgb: 16, 185, 129; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'biz-rat-brain-hijack',
      title: 'The Rat Brain Hijack',
      description: 'How to command attention by triggering the subconscious mind',
      accentColor: '#10b981',
      duration: '6 min',
      nextLesson: { id: 'biz-remarkable-product', title: 'Build Something Remarkable', teaser: 'Why "good enough" products fight the laws of the matrix forever' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // AnimatedCounter component
    const AnimatedCounter = ({ value, suffix = '', prefix = '', duration = 1.5, decimals = 0 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(value);
        const startTime = Date.now();
        const tick = () => {
          const elapsed = Date.now() - startTime;
          const progress = Math.min(elapsed / (duration * 1000), 1);
          const eased = 1 - Math.pow(1 - progress, 3);
          setCount(start + (end - start) * eased);
          if (progress < 1) requestAnimationFrame(tick);
        };
        tick();
      }, [value, duration]);
      return <span>{prefix}{count.toFixed(decimals)}{suffix}</span>;
    };

    const slides = [
      { type: 'welcome', learningGoals: ['The Rat Brain vs Logical Brain - why subconscious wins', 'Rat Brain Analysis (RBA) - how to trigger instant attention', 'Real examples: Pink apples, hit songs, and pattern breaks'] },
      { type: 'hook', headline: 'You tap the glass. The fish jumps. That is marketing.', subtext: 'Except most people are tapping at the logical brain. The part that thinks. And thinking takes time. Too much time. Your ad is already gone. The scroll happened. The best marketers tap the Rat Brain - the subconscious part that reacts BEFORE you think.' },
      { type: 'brain-battle', title: 'Two Brains. One Winner.',
        ratBrain: { speed: '0.3', label: 'seconds to react', traits: ['Instant', 'Emotional', 'Subconscious', 'Cannot be controlled'] },
        logicalBrain: { speed: '2-4', label: 'seconds to process', traits: ['Slow', 'Analytical', 'Conscious', 'Requires effort'] }
      },
      { type: 'reaction-speed', title: 'The 0.3 Second Window',
        phases: [
          { time: '0.0s', label: 'Stimulus', description: 'Your ad appears' },
          { time: '0.3s', label: 'Rat Brain', description: 'Stop or scroll decision' },
          { time: '2.0s', label: 'Logical Brain', description: 'Too late - already scrolled' }
        ]
      },
      { type: 'rba-process', title: 'Rat Brain Analysis (RBA)',
        steps: [
          { number: 1, action: 'SCROLL', description: 'Scroll through feeds normally' },
          { number: 2, action: 'FREEZE', description: 'When you stop - freeze immediately' },
          { number: 3, action: 'ASK', description: 'Why did I stop? What triggered me?' },
          { number: 4, action: 'DOCUMENT', description: 'Record the trigger for replication' }
        ],
        insight: 'If something stops YOU, it will stop them.'
      },
      { type: 'trigger-catalog', title: 'The 6 Rat Brain Triggers',
        triggers: [
          { icon: 'Palette', name: 'Color', example: 'Pink apple on billboard' },
          { icon: 'Zap', name: 'Novelty', example: 'Unexpected element' },
          { icon: 'AlertTriangle', name: 'Danger', example: 'Gun on table' },
          { icon: 'Eye', name: 'Faces', example: 'Human eyes in frame' },
          { icon: 'Volume2', name: 'Sound', example: 'Jarring audio hook' },
          { icon: 'Activity', name: 'Movement', example: 'Sudden motion' }
        ]
      },
      { type: 'pattern-break', title: 'Pattern Break: The Pink Apple',
        before: { label: 'Red Apple (Expected)', reaction: 'Ignore', description: 'Your Rat Brain recognizes the pattern: apple = red = advertising = ignore. No surprise.' },
        after: { label: 'Pink Apple (Break)', reaction: 'STOP', description: 'Pink apple? That is wrong. That is different. Your attention is captured before logic starts.' },
        insight: 'Pink is the second-least-used color in advertising. Unfamiliarity breaks through ad fatigue.'
      },
      { type: 'speed-to-value', title: 'Speed to Value: Hit Songs',
        before: { era: 'Old Music', intro: '10-15 sec', result: 'Rat Brain gets bored. Skip.' },
        after: { era: 'Modern Hits', intro: '0 sec', result: 'Hook immediately. Stay.' },
        insight: 'The Rat Brain does not tolerate boredom. Fast dopamine = better UX.'
      },
      { type: 'gun-example', title: 'The Gun on the Table',
        scenario: 'Same video. Clean background. Professional lighting. But there is a GUN on the table behind them.',
        reaction: 'Your Rat Brain screams: "GUN!" You stop scrolling. Comments explode. Engagement soars.',
        lesson: 'The gun had nothing to do with the product - but it WORKED. Novelty triggers reaction.'
      },
      { type: 'why-works', title: 'Why Rat Brain Analysis Works',
        reasons: [
          { title: 'Attention is Instant', stat: '0.3', unit: 'sec', description: 'Decision happens before thought. You do not get a second chance.' },
          { title: 'Everyone Has One', stat: '100', unit: '%', description: 'Your Rat Brain works the same as theirs. Analyze yourself to predict them.' },
          { title: 'Lowers CAC Forever', stat: '10x', unit: '', description: 'Win the scroll war consistently, and acquisition costs drop permanently.' }
        ]
      },
      { type: 'quiz', question: 'What is the primary advantage of triggering the Rat Brain instead of the Logical Brain?', options: ['The Rat Brain is easier to convince with data', 'The Rat Brain reacts instantly BEFORE conscious thought', 'The Rat Brain is more interested in discounts', 'The Rat Brain only works on mobile'], correctIndex: 1, feedback: { correct: 'Exactly! The Rat Brain reacts in 0.3 seconds - before the logical brain even starts. If you trigger it, you capture attention before the scroll happens.', incorrect: 'Not quite. The key is SPEED. The Rat Brain reacts in 0.3 seconds. By the time logical thinking starts, the scroll already happened.' }},
      { type: 'mindset-shift', title: 'The Attention Paradox', insight: 'You cannot reason someone into attention. The Rat Brain decides who wins the scroll war - and it does not think. It reacts. Master the triggers, and attention is yours.' },
      { type: 'completion', sources: ['Rat Brain Analysis Framework'] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Brain: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-1.54"/></svg>,
      Zap: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Eye: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      AlertTriangle: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Palette: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="13.5" cy="6.5" r="0.5"/><circle cx="17.5" cy="10.5" r="0.5"/><circle cx="8.5" cy="7.5" r="0.5"/><circle cx="6.5" cy="12.5" r="0.5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      Volume2: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"/><path d="M15.54 8.46a5 5 0 0 1 0 7.07"/><path d="M19.07 4.93a10 10 0 0 1 0 14.14"/></svg>,
      Activity: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      TrendingDown: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
      Lightbulb: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10">
        <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
          <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
      </div>
    );

    // Brain Battle Slide - Animated comparison
    const BrainBattleSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActiveIndex(prev => (prev + 1) % 2), 2500);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-3 gap-6 items-center">
            {/* Rat Brain */}
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: activeIndex === 0 ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'linear-gradient(135deg, #f5f5f5, #e5e5e5)', position: 'relative', overflow: 'hidden' }}
              className="rounded-2xl p-6 transition-all duration-500">
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: activeIndex === 0 ? 'linear-gradient(90deg, transparent, #10b981, transparent)' : 'transparent' }} />
              <div className="text-center">
                <motion.div animate={{ scale: activeIndex === 0 ? [1, 1.1, 1] : 1 }} transition={{ duration: 0.5 }} className="w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-4" style={{ background: activeIndex === 0 ? 'linear-gradient(135deg, #10b981, #059669)' : '#d4d4d4' }}>
                  <Icons.Zap />
                </motion.div>
                <h3 className={`text-xl font-bold mb-2 ${activeIndex === 0 ? 'text-white' : 'text-neutral-400'}`}>RAT BRAIN</h3>
                <div className={`text-4xl font-bold mb-1 ${activeIndex === 0 ? 'text-emerald-400' : 'text-neutral-300'}`}>
                  <AnimatedCounter value={data.ratBrain.speed} decimals={1} />s
                </div>
                <p className={`text-sm mb-4 ${activeIndex === 0 ? 'text-neutral-400' : 'text-neutral-500'}`}>{data.ratBrain.label}</p>
                <div className="space-y-2">
                  {data.ratBrain.traits.map((trait, i) => (
                    <div key={i} className={`text-xs py-1 px-3 rounded-full inline-block mr-1 ${activeIndex === 0 ? 'bg-emerald-900/50 text-emerald-300' : 'bg-neutral-200 text-neutral-400'}`}>{trait}</div>
                  ))}
                </div>
                {activeIndex === 0 && <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="mt-4 py-2 px-4 rounded-full text-xs font-bold text-white" style={{ background: 'linear-gradient(135deg, #10b981, #059669)' }}>WINS ATTENTION</motion.div>}
              </div>
            </motion.div>

            {/* VS */}
            <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.3, type: 'spring' }} className="text-center hidden md:block">
              <div className="w-16 h-16 mx-auto rounded-full bg-neutral-900 flex items-center justify-center">
                <span className="text-white font-bold text-xl">VS</span>
              </div>
            </motion.div>

            {/* Logical Brain */}
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 }}
              style={{ background: activeIndex === 1 ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'linear-gradient(135deg, #f5f5f5, #e5e5e5)', position: 'relative', overflow: 'hidden' }}
              className="rounded-2xl p-6 transition-all duration-500">
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: activeIndex === 1 ? 'linear-gradient(90deg, transparent, #6b7280, transparent)' : 'transparent' }} />
              <div className="text-center">
                <div className="w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-4" style={{ background: activeIndex === 1 ? 'linear-gradient(135deg, #6b7280, #4b5563)' : '#d4d4d4' }}>
                  <Icons.Brain />
                </div>
                <h3 className={`text-xl font-bold mb-2 ${activeIndex === 1 ? 'text-white' : 'text-neutral-400'}`}>LOGICAL BRAIN</h3>
                <div className={`text-4xl font-bold mb-1 ${activeIndex === 1 ? 'text-gray-400' : 'text-neutral-300'}`}>{data.logicalBrain.speed}s</div>
                <p className={`text-sm mb-4 ${activeIndex === 1 ? 'text-neutral-400' : 'text-neutral-500'}`}>{data.logicalBrain.label}</p>
                <div className="space-y-2">
                  {data.logicalBrain.traits.map((trait, i) => (
                    <div key={i} className={`text-xs py-1 px-3 rounded-full inline-block mr-1 ${activeIndex === 1 ? 'bg-gray-700/50 text-gray-300' : 'bg-neutral-200 text-neutral-400'}`}>{trait}</div>
                  ))}
                </div>
                {activeIndex === 1 && <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="mt-4 py-2 px-4 rounded-full text-xs font-bold bg-gray-600 text-white">TOO SLOW</motion.div>}
              </div>
            </motion.div>
          </div>
        </div>
      );
    };

    // Reaction Speed Slide - Timeline visualization
    const ReactionSpeedSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActivePhase(prev => (prev + 1) % data.phases.length), 2000);
        return () => clearInterval(interval);
      }, [data.phases.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-10">{data.title}</motion.h2>

          <div className="relative">
            {/* Timeline bar */}
            <div className="absolute top-8 left-0 right-0 h-2 bg-neutral-200 rounded-full">
              <motion.div initial={{ width: 0 }} animate={{ width: `${((activePhase + 1) / data.phases.length) * 100}%` }}
                transition={{ duration: 0.5 }} className="h-full rounded-full" style={{ background: 'linear-gradient(90deg, #10b981, #059669)' }} />
            </div>

            <div className="grid grid-cols-3 gap-4 relative">
              {data.phases.map((phase, i) => (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 * i }}>
                  {/* Timeline dot */}
                  <motion.div animate={{ scale: activePhase === i ? 1.3 : 1, background: activePhase >= i ? '#10b981' : '#d4d4d4' }}
                    className="w-6 h-6 rounded-full mx-auto mb-6 relative z-10" />

                  {/* Card */}
                  <motion.div animate={{ scale: activePhase === i ? 1.05 : 1 }} transition={{ duration: 0.3 }}
                    style={{ background: activePhase === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', position: 'relative', overflow: 'hidden' }}
                    className="rounded-xl p-5 text-center transition-all duration-300">
                    {activePhase === i && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />}
                    <div className={`text-2xl font-bold mb-1 ${activePhase === i ? 'text-emerald-400' : 'text-neutral-400'}`}>{phase.time}</div>
                    <div className={`text-lg font-bold mb-2 ${activePhase === i ? 'text-white' : 'text-neutral-600'}`}>{phase.label}</div>
                    <p className={`text-sm ${activePhase === i ? 'text-neutral-400' : 'text-neutral-500'}`}>{phase.description}</p>
                    {i === 2 && activePhase === 2 && (
                      <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="mt-3 py-1 px-3 rounded-full text-xs font-bold bg-red-500 text-white inline-block">SCROLL HAPPENED</motion.div>
                    )}
                  </motion.div>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      );
    };

    // RBA Process Slide
    const RBAProcessSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-4 gap-4 mb-6">
          {data.steps.map((step, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 * i }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
              className="rounded-xl p-5 text-center">
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, #10b981, transparent)` }} />
              <div className="w-10 h-10 rounded-full flex items-center justify-center text-lg font-bold text-white mx-auto mb-3" style={{ background: 'linear-gradient(135deg, #10b981, #059669)' }}>{step.number}</div>
              <div className="text-xl font-bold text-emerald-400 mb-2">{step.action}</div>
              <p className="text-neutral-400 text-sm">{step.description}</p>
            </motion.div>
          ))}
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
          className="bg-neutral-900 rounded-xl p-4 text-center">
          <p className="text-emerald-400 font-medium"><Icons.Lightbulb className="inline mr-2 w-5 h-5" />{data.insight}</p>
        </motion.div>
      </div>
    );

    // Trigger Catalog Slide
    const TriggerCatalogSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => setActiveIndex(prev => (prev + 1) % data.triggers.length), 2000);
        return () => clearInterval(interval);
      }, [data.triggers.length]);

      const IconComponent = (name) => Icons[name] || Icons.Zap;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid grid-cols-2 md:grid-cols-3 gap-4">
            {data.triggers.map((trigger, i) => {
              const Icon = IconComponent(trigger.icon);
              return (
                <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: activeIndex === i ? 1.05 : 1 }} transition={{ delay: 0.05 * i }}
                  style={{ background: activeIndex === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', position: 'relative', overflow: 'hidden' }}
                  className="rounded-xl p-5 text-center transition-all duration-300">
                  {activeIndex === i && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />}
                  <div className={`w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3 ${activeIndex === i ? 'text-white' : 'text-neutral-400'}`} style={{ background: activeIndex === i ? 'linear-gradient(135deg, #10b981, #059669)' : '#e5e5e5' }}>
                    <Icon />
                  </div>
                  <div className={`text-lg font-bold mb-1 ${activeIndex === i ? 'text-white' : 'text-neutral-700'}`}>{trigger.name}</div>
                  <p className={`text-xs ${activeIndex === i ? 'text-emerald-400' : 'text-neutral-500'}`}>{trigger.example}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Pattern Break Slide
    const PatternBreakSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6 mb-6">
          {/* Before */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="bg-neutral-100 rounded-xl p-6 border-2 border-neutral-200">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-full bg-red-500 flex items-center justify-center">
                <div className="w-6 h-6 rounded-full bg-red-700"></div>
              </div>
              <div>
                <div className="font-bold text-neutral-700">{data.before.label}</div>
                <div className="text-2xl font-bold text-neutral-400">{data.before.reaction}</div>
              </div>
            </div>
            <p className="text-neutral-600 text-sm">{data.before.description}</p>
          </motion.div>

          {/* After */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
            className="rounded-xl p-6">
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ec4899, transparent)' }} />
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-full bg-pink-500 flex items-center justify-center">
                <div className="w-6 h-6 rounded-full bg-pink-300"></div>
              </div>
              <div>
                <div className="font-bold text-white">{data.after.label}</div>
                <div className="text-2xl font-bold text-emerald-400">{data.after.reaction}</div>
              </div>
            </div>
            <p className="text-neutral-400 text-sm">{data.after.description}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
          className="bg-neutral-900 rounded-xl p-4 text-center">
          <p className="text-neutral-300 text-sm"><Icons.Lightbulb className="inline mr-2 w-4 h-4 text-emerald-400" />{data.insight}</p>
        </motion.div>
      </div>
    );

    // Speed to Value Slide
    const SpeedToValueSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6 mb-6">
          {/* Before */}
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="bg-neutral-100 rounded-xl p-6 border-2 border-neutral-200 text-center">
            <div className="text-neutral-500 text-sm mb-2">{data.before.era}</div>
            <div className="text-5xl font-bold text-neutral-400 mb-2">{data.before.intro}</div>
            <div className="text-sm text-neutral-500 mb-4">intro length</div>
            <div className="py-2 px-4 rounded-full bg-red-100 text-red-600 text-sm font-medium inline-block">{data.before.result}</div>
          </motion.div>

          {/* After */}
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
            className="rounded-xl p-6 text-center">
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
            <div className="text-neutral-400 text-sm mb-2">{data.after.era}</div>
            <div className="text-5xl font-bold text-emerald-400 mb-2">{data.after.intro}</div>
            <div className="text-sm text-neutral-500 mb-4">intro length</div>
            <div className="py-2 px-4 rounded-full text-sm font-medium inline-block" style={{ background: 'linear-gradient(135deg, #10b981, #059669)', color: 'white' }}>{data.after.result}</div>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
          className="bg-neutral-900 rounded-xl p-4 text-center">
          <p className="text-neutral-300 text-sm"><Icons.Zap className="inline mr-2 w-4 h-4 text-emerald-400" />{data.insight}</p>
        </motion.div>
      </div>
    );

    // Gun Example Slide
    const GunExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
          style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
          className="rounded-2xl p-8">
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
          <div className="text-center mb-6">
            <motion.div animate={{ scale: [1, 1.1, 1] }} transition={{ repeat: Infinity, duration: 2 }}
              className="w-20 h-20 mx-auto rounded-full flex items-center justify-center mb-4" style={{ background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}>
              <Icons.AlertTriangle />
            </motion.div>
            <p className="text-neutral-300 text-lg leading-relaxed mb-6">{data.scenario}</p>
          </div>
          <div className="bg-black/30 rounded-xl p-4 mb-6">
            <p className="text-emerald-400 font-medium text-center">{data.reaction}</p>
          </div>
          <div className="text-center">
            <p className="text-neutral-400 text-sm"><Icons.Target className="inline mr-2 w-4 h-4" />{data.lesson}</p>
          </div>
        </motion.div>
      </div>
    );

    // Why Works Slide
    const WhyWorksSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {data.reasons.map((reason, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 * i }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
              className="rounded-xl p-6 text-center">
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
              <div className="text-4xl font-bold text-emerald-400 mb-1">
                {reason.stat.includes('x') ? reason.stat : <AnimatedCounter value={reason.stat} decimals={reason.stat.includes('.') ? 1 : 0} suffix={reason.unit} />}
              </div>
              <h3 className="text-lg font-bold text-white mb-2">{reason.title}</h3>
              <p className="text-neutral-400 text-sm">{reason.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Mindset Shift Slide
    const MindsetShiftSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
          style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', position: 'relative', overflow: 'hidden' }}
          className="rounded-2xl p-8 md:p-12 text-center w-full">
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2, type: 'spring' }}
            className="w-16 h-16 mx-auto rounded-full flex items-center justify-center mb-6" style={{ background: 'linear-gradient(135deg, #10b981, #059669)' }}>
            <Icons.Brain />
          </motion.div>
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="text-2xl md:text-3xl font-bold text-white mb-4">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="text-neutral-400 text-lg leading-relaxed">{data.insight}</motion.p>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand the Rat Brain - the subconscious trigger that decides attention in 0.3 seconds. Start using RBA: scroll, stop, ask why. That insight is the key to lower CAC.</motion.p>
        <motion.a initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} href={`/lessons/${LESSON_CONFIG.nextLesson.id}/lesson.html`} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4 block hover:bg-neutral-800 transition-colors">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.a>
        {data.sources?.length > 0 && <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.45 }} className="text-neutral-400 text-xs">Sources: {data.sources.join(', ')}</motion.div>}
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'brain-battle': return <BrainBattleSlide data={slide} />;
          case 'reaction-speed': return <ReactionSpeedSlide data={slide} />;
          case 'rba-process': return <RBAProcessSlide data={slide} />;
          case 'trigger-catalog': return <TriggerCatalogSlide data={slide} />;
          case 'pattern-break': return <PatternBreakSlide data={slide} />;
          case 'speed-to-value': return <SpeedToValueSlide data={slide} />;
          case 'gun-example': return <GunExampleSlide data={slide} />;
          case 'why-works': return <WhyWorksSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'mindset-shift': return <MindsetShiftSlide data={slide} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
