<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Two Rules That Determine Whether a Product Can Win on Meta | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #f59e0b; --accent-dark: #d97706; --accent-light: #fbbf24; --accent-rgb: 245, 158, 11; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'two-meta-rules',
      title: 'The Two Rules That Determine Whether a Product Can Win on Meta',
      description: 'Not every product can win on Meta. Here\'s the exact framework to know before you test.',
      accentColor: '#f59e0b',
      duration: '6 min',
      nextLesson: { id: 'best-niches-2026', title: 'The Best Ecommerce Niches for 2026', teaser: 'Stop chasing quick sales. Focus on customer lifetime value instead.' }
    };

    // Admin Reporter
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1}`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s' }}
          onMouseEnter={(e) => e.currentTarget.style.opacity = '1'} onMouseLeave={(e) => e.currentTarget.style.opacity = '0.6'}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // AnimatedCounter with decimals
    const AnimatedCounter = ({ target, suffix = '', prefix = '', decimals = 0, duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(decimals > 0 ? parseFloat(start.toFixed(decimals)) : Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration, decimals]);
      return <span>{prefix}{decimals > 0 ? count.toFixed(decimals) : count}{suffix}</span>;
    };

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Eye: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Star: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Sparkles: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      Palette: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="13.5" cy="6.5" r=".5"/><circle cx="17.5" cy="10.5" r=".5"/><circle cx="8.5" cy="7.5" r=".5"/><circle cx="6.5" cy="12.5" r=".5"/><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.555C21.965 6.012 17.461 2 12 2z"/></svg>,
      Layers: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
      AlertTriangle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Skull: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: ['Why most products fail on Meta before the first ad runs', 'Rule #1: The 2-second "special enough" test', 'Rule #2: The "not too specific" market fit filter'] },
      { type: 'hook', headline: 'You can have the best creative, perfect targeting, and a flawless funnel.', subtext: 'But if your product doesn\'t pass these two rules, Meta will drain your budget and leave you with nothing. The algorithm rewards products that trigger instant desire AND fit broad audiences.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Meta_Platforms_Inc._logo_(cropped).svg.png', brandName: 'Meta' },
      { type: 'rule-reveal', ruleNumber: 1, title: 'Special Enough', subtitle: 'The 2-Second Scroll Test', description: 'Someone sees your product in their feed. Do they stop? Do they feel "I want this. Now." Or do they keep scrolling?', consequence: 'If your product looks like everything else on Amazon, Meta won\'t save you.' },
      { type: 'two-second-test', title: 'The 2-Second Test', phases: [{ time: 2, label: 'SCROLL', verdict: 'Generic = Ignored' }, { time: 1, label: 'PAUSE', verdict: 'Interesting = Maybe' }, { time: 0, label: 'STOP', verdict: 'Special = WANT' }] },
      { type: 'special-enough-grid', title: 'What Makes a Product "Special Enough"', items: [{ icon: 'Layers', title: 'Unique Fit or Design', description: 'Not generic. Unconventional silhouette, unexpected material.' }, { icon: 'Palette', title: 'Bold Colors', description: 'Color psychology matters. Vibrant, ownable color = scroll-stopping.' }, { icon: 'Sparkles', title: 'Proportions That Pop', description: 'Oversized. Minimalist. Asymmetrical. Creates micro "whoa" moment.' }] },
      { type: 'product-battle', title: 'Generic vs. Special T-Shirt', before: { label: 'NOT SPECIAL', text: 'Plain white t-shirt. Standard fit. Seen it 1,000 times.', result: 'SCROLL' }, after: { label: 'SPECIAL ENOUGH', text: 'Oversized, asymmetrical cut. Unique fabric texture. Unexpected collar.', result: 'STOP + WANT' } },
      { type: 'rule-reveal', ruleNumber: 2, title: 'Not Too Specific', subtitle: 'The Broad Market Filter', description: 'Meta needs volume to optimize. If only 2% of people can use your product, the algorithm can\'t find enough buyers.', consequence: 'Ultra-precise fit items, complex products, and tiny audiences kill Meta campaigns.' },
      { type: 'product-killers', title: 'What Kills Products on Meta', killers: [{ icon: 'Target', label: 'Ultra-Precise Fit', description: 'Custom-sized shoes. Body-specific garments. Too much friction.', severity: 'HIGH' }, { icon: 'AlertTriangle', label: 'Complex Products', description: 'If it takes 3 minutes to explain, Meta won\'t work.', severity: 'HIGH' }, { icon: 'Users', label: 'Tiny Audiences', description: 'TAM of 10,000 people? Meta can\'t scale.', severity: 'FATAL' }] },
      { type: 'audience-comparison', title: 'Too Specific vs. Broad Fit', before: { label: 'TOO SPECIFIC', example: 'Custom orthopedic insoles for marathon runners with flat feet', audience: '8K', result: 'FAILS' }, after: { label: 'BROAD FIT', example: 'Premium performance socks for active lifestyles', audience: '12M', result: 'WINS' } },
      { type: 'two-rule-matrix', title: 'The Two-Rule Matrix', quadrants: [{ special: true, broad: true, label: 'META GOLD', color: '#22c55e', icon: 'Star' }, { special: true, broad: false, label: 'NICHE ONLY', color: '#f59e0b', icon: 'Target' }, { special: false, broad: true, label: 'RACE TO BOTTOM', color: '#ef4444', icon: 'TrendingUp' }, { special: false, broad: false, label: 'DEAD ON ARRIVAL', color: '#6b7280', icon: 'Skull' }] },
      { type: 'meta-success-stats', title: 'The Meta Success Formula', stats: [{ value: 2, suffix: 's', label: 'Scroll Test', subtext: 'Time to trigger desire' }, { value: 0, suffix: '', label: 'Friction', subtext: 'Barriers to purchase' }, { value: 1, suffix: 'M+', label: 'Minimum TAM', subtext: 'Addressable audience' }] },
      { type: 'pre-test-checklist', title: 'Before You Spend $1 on Meta', checks: [{ question: 'Does my product generate instant "I want this" reaction?', rule: 'RULE #1' }, { question: 'Can millions of people buy it without confusion?', rule: 'RULE #2' }], warning: 'If the answer to EITHER is no, fix the product first.' },
      { type: 'quiz', question: 'Which product would PASS both Meta rules and scale profitably?', options: ['"Custom-fitted compression pants for powerlifters with knee issues"', '"Generic black backpack identical to 200 other brands"', '"Bold, minimalist water bottle with unique ergonomic grip - for active lifestyles"', '"Specialized gardening tool for left-handed bonsai enthusiasts"'], correctIndex: 2, feedback: { correct: 'Exactly! The water bottle passes both rules: Special enough (bold design, unique grip = 2-second desire), and not too specific (active lifestyles = millions of people, zero friction).', incorrect: 'The winner is the water bottle. It\'s special enough to stop the scroll (bold design, unique grip), but not too specific (active lifestyles = huge audience, no friction).' } },
      { type: 'elite-insight', quote: 'Special enough to stop the scroll. Broad enough to scale. That\'s the entire Meta game.', actions: [{ icon: 'Sparkles', label: 'Be Special' }, { icon: 'Users', label: 'Be Broad' }, { icon: 'TrendingUp', label: 'Scale' }] },
      { type: 'completion', sources: [{ name: 'Product Mapping Manipulation Course', url: 'https://quantum-scale.co/pages/product-mapping-manipulation' }] }
    ];

    // ==================== CUSTOM ELITE SLIDES ====================

    const RuleRevealSlide = ({ data }) => {
      const [showConsequence, setShowConsequence] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowConsequence(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div style={{ display: 'inline-flex', alignItems: 'center', gap: '12px', padding: '10px 24px', borderRadius: '30px', background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', marginBottom: '20px' }}>
              <span style={{ fontSize: '28px', fontWeight: '900', color: 'white' }}>#{data.ruleNumber}</span>
              <span style={{ fontSize: '14px', fontWeight: '700', color: 'rgba(255,255,255,0.9)', textTransform: 'uppercase', letterSpacing: '0.1em' }}>META RULE</span>
            </div>
            <h2 className="slide-title text-3xl md:text-4xl text-black mb-2">{data.title}</h2>
            <p style={{ color: 'var(--accent)', fontWeight: '600', fontSize: '18px' }}>{data.subtitle}</p>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '28px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <p style={{ color: '#e5e5e5', fontSize: '17px', lineHeight: '1.7', textAlign: 'center' }}>{data.description}</p>
          </motion.div>

          <AnimatePresence>
            {showConsequence && (
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
                style={{ marginTop: '20px', padding: '16px 24px', background: 'rgba(239, 68, 68, 0.1)', border: '2px solid rgba(239, 68, 68, 0.3)', borderRadius: '12px', textAlign: 'center' }}>
                <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
                  <Icons.AlertTriangle />
                  <span style={{ color: '#ef4444', fontWeight: '600' }}>{data.consequence}</span>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const TwoSecondTestSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActivePhase(prev => (prev + 1) % data.phases.length), 2000);
        return () => clearInterval(timer);
      }, [data.phases.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="flex justify-center gap-6 mb-8">
            {data.phases.map((phase, i) => (
              <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 + i * 0.1 }}
                style={{ width: '140px', textAlign: 'center', padding: '24px 16px', borderRadius: '20px', background: i === activePhase ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: i === activePhase ? 'none' : '2px solid #e5e5e5', transition: 'all 0.3s ease', position: 'relative', overflow: 'hidden' }}>
                {i === activePhase && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />}
                <div style={{ fontSize: '48px', fontWeight: '900', color: i === activePhase ? 'var(--accent)' : '#111', marginBottom: '8px' }}>{phase.time}</div>
                <div style={{ fontSize: '14px', fontWeight: '700', color: i === activePhase ? '#e5e5e5' : '#374151', marginBottom: '8px' }}>{phase.label}</div>
                <div style={{ fontSize: '11px', color: i === activePhase ? '#a1a1aa' : '#6b7280', fontWeight: '500' }}>{phase.verdict}</div>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '12px', padding: '20px', textAlign: 'center' }}>
            <span style={{ color: '#a1a1aa' }}>You have </span>
            <span style={{ color: 'var(--accent)', fontWeight: '800', fontSize: '20px' }}>2 seconds</span>
            <span style={{ color: '#a1a1aa' }}> to make them stop scrolling</span>
          </motion.div>
        </div>
      );
    };

    const SpecialEnoughGridSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveIndex(prev => (prev + 1) % data.items.length), 2500);
        return () => clearInterval(timer);
      }, [data.items.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-3 gap-4">
            {data.items.map((item, i) => {
              const ItemIcon = Icons[item.icon];
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                  style={{ background: i === activeIndex ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: i === activeIndex ? 'none' : '2px solid #e5e5e5', borderRadius: '16px', padding: '24px', textAlign: 'center', position: 'relative', overflow: 'hidden', transition: 'all 0.3s ease' }}>
                  {i === activeIndex && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />}
                  <div style={{ width: '56px', height: '56px', borderRadius: '14px', background: i === activeIndex ? 'rgba(245, 158, 11, 0.2)' : 'rgba(245, 158, 11, 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 16px', color: 'var(--accent)' }}>
                    <ItemIcon />
                  </div>
                  <h3 style={{ fontWeight: '700', fontSize: '16px', marginBottom: '8px', color: i === activeIndex ? '#e5e5e5' : '#111' }}>{item.title}</h3>
                  <p style={{ fontSize: '13px', color: i === activeIndex ? '#a1a1aa' : '#6b7280', lineHeight: '1.6' }}>{item.description}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const ProductBattleSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-2 gap-6">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #fef2f2, #fee2e2)', border: '2px solid #fecaca', borderRadius: '16px', padding: '24px' }}>
              <div style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', background: '#ef4444', color: 'white', fontSize: '11px', fontWeight: '700', marginBottom: '16px' }}>{data.before.label}</div>
              <p style={{ color: '#374151', fontSize: '15px', lineHeight: '1.7', marginBottom: '20px' }}>{data.before.text}</p>
              <div style={{ padding: '12px', background: 'rgba(239, 68, 68, 0.1)', borderRadius: '10px', textAlign: 'center' }}>
                <span style={{ fontWeight: '800', color: '#dc2626', fontSize: '18px' }}>{data.before.result}</span>
              </div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 }}
              style={{ background: 'linear-gradient(135deg, #f0fdf4, #dcfce7)', border: '2px solid #86efac', borderRadius: '16px', padding: '24px', position: 'relative' }}>
              <div style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', background: '#22c55e', color: 'white', fontSize: '11px', fontWeight: '700', marginBottom: '16px' }}>{data.after.label}</div>
              <p style={{ color: '#374151', fontSize: '15px', lineHeight: '1.7', marginBottom: '20px' }}>{data.after.text}</p>
              <div style={{ padding: '12px', background: 'rgba(34, 197, 94, 0.1)', borderRadius: '10px', textAlign: 'center' }}>
                <span style={{ fontWeight: '800', color: '#16a34a', fontSize: '18px' }}>{data.after.result}</span>
              </div>
              {showWinner && (
                <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring' }}
                  style={{ position: 'absolute', top: '-12px', right: '16px', background: 'linear-gradient(135deg, #fbbf24, #f59e0b)', color: '#000', padding: '6px 14px', borderRadius: '8px', fontWeight: '800', fontSize: '12px' }}>
                  WINNER
                </motion.div>
              )}
            </motion.div>
          </div>
        </div>
      );
    };

    const ProductKillersSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveIndex(prev => (prev + 1) % data.killers.length), 2500);
        return () => clearInterval(timer);
      }, [data.killers.length]);

      const severityColors = { HIGH: '#ef4444', FATAL: '#7c2d12' };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div style={{ display: 'inline-flex', alignItems: 'center', gap: '8px', marginBottom: '12px' }}>
              <Icons.Skull />
              <span style={{ color: '#ef4444', fontWeight: '700' }}>DANGER ZONE</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <div className="space-y-4">
            {data.killers.map((killer, i) => {
              const KillerIcon = Icons[killer.icon];
              return (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                  style={{ display: 'flex', alignItems: 'center', gap: '16px', padding: '20px', background: i === activeIndex ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: i === activeIndex ? 'none' : '2px solid #e5e5e5', borderRadius: '16px', transition: 'all 0.3s ease', position: 'relative', overflow: 'hidden' }}>
                  {i === activeIndex && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${severityColors[killer.severity]}, transparent)` }} />}
                  <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: `${severityColors[killer.severity]}20`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: severityColors[killer.severity], flexShrink: 0 }}>
                    <KillerIcon />
                  </div>
                  <div style={{ flex: 1 }}>
                    <div style={{ display: 'flex', alignItems: 'center', gap: '8px', marginBottom: '4px' }}>
                      <span style={{ fontWeight: '700', color: i === activeIndex ? '#e5e5e5' : '#111' }}>{killer.label}</span>
                      <span style={{ padding: '2px 8px', borderRadius: '4px', background: severityColors[killer.severity], color: 'white', fontSize: '10px', fontWeight: '700' }}>{killer.severity}</span>
                    </div>
                    <p style={{ fontSize: '13px', color: i === activeIndex ? '#a1a1aa' : '#6b7280' }}>{killer.description}</p>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const AudienceComparisonSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-2 gap-6">
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #fef2f2, #fee2e2)', border: '2px solid #fecaca', borderRadius: '16px', padding: '24px' }}>
              <div style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', background: '#ef4444', color: 'white', fontSize: '11px', fontWeight: '700', marginBottom: '16px' }}>{data.before.label}</div>
              <p style={{ color: '#374151', fontSize: '14px', lineHeight: '1.6', marginBottom: '16px', fontStyle: 'italic' }}>"{data.before.example}"</p>
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <div>
                  <span style={{ fontSize: '12px', color: '#6b7280' }}>Audience:</span>
                  <span style={{ fontSize: '24px', fontWeight: '900', color: '#dc2626', marginLeft: '8px' }}>{data.before.audience}</span>
                </div>
                <div style={{ padding: '8px 16px', background: '#ef4444', color: 'white', borderRadius: '8px', fontWeight: '700' }}>{data.before.result}</div>
              </div>
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 }}
              style={{ background: 'linear-gradient(135deg, #f0fdf4, #dcfce7)', border: '2px solid #86efac', borderRadius: '16px', padding: '24px', position: 'relative' }}>
              <div style={{ display: 'inline-block', padding: '4px 12px', borderRadius: '20px', background: '#22c55e', color: 'white', fontSize: '11px', fontWeight: '700', marginBottom: '16px' }}>{data.after.label}</div>
              <p style={{ color: '#374151', fontSize: '14px', lineHeight: '1.6', marginBottom: '16px', fontStyle: 'italic' }}>"{data.after.example}"</p>
              <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between' }}>
                <div>
                  <span style={{ fontSize: '12px', color: '#6b7280' }}>Audience:</span>
                  <span style={{ fontSize: '24px', fontWeight: '900', color: '#16a34a', marginLeft: '8px' }}>{data.after.audience}</span>
                </div>
                <div style={{ padding: '8px 16px', background: '#22c55e', color: 'white', borderRadius: '8px', fontWeight: '700' }}>{data.after.result}</div>
              </div>
              {showWinner && (
                <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring' }}
                  style={{ position: 'absolute', top: '-12px', right: '16px', background: 'linear-gradient(135deg, #fbbf24, #f59e0b)', color: '#000', padding: '6px 14px', borderRadius: '8px', fontWeight: '800', fontSize: '12px' }}>
                  1,500x BIGGER
                </motion.div>
              )}
            </motion.div>
          </div>
        </div>
      );
    };

    const TwoRuleMatrixSlide = ({ data }) => {
      const [activeQuadrant, setActiveQuadrant] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveQuadrant(prev => (prev + 1) % data.quadrants.length), 2000);
        return () => clearInterval(timer);
      }, [data.quadrants.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '12px', maxWidth: '500px', margin: '0 auto' }}>
            {data.quadrants.map((q, i) => {
              const QIcon = Icons[q.icon];
              return (
                <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 + i * 0.1 }}
                  style={{ background: i === activeQuadrant ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: i === activeQuadrant ? `2px solid ${q.color}` : '2px solid #e5e5e5', borderRadius: '16px', padding: '24px', textAlign: 'center', position: 'relative', overflow: 'hidden', transition: 'all 0.3s ease' }}>
                  {i === activeQuadrant && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: q.color }} />}
                  <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: `${q.color}20`, display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 12px', color: q.color }}>
                    <QIcon />
                  </div>
                  <div style={{ fontWeight: '800', fontSize: '14px', color: i === activeQuadrant ? q.color : '#374151', marginBottom: '8px' }}>{q.label}</div>
                  <div style={{ fontSize: '11px', color: i === activeQuadrant ? '#a1a1aa' : '#6b7280' }}>
                    {q.special ? 'Special' : 'Not Special'} + {q.broad ? 'Broad' : 'Specific'}
                  </div>
                </motion.div>
              );
            })}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }}
            style={{ marginTop: '24px', padding: '16px', background: 'linear-gradient(135deg, #22c55e, #16a34a)', borderRadius: '12px', textAlign: 'center' }}>
            <span style={{ color: 'white', fontWeight: '700' }}>Goal: META GOLD = Special + Broad</span>
          </motion.div>
        </div>
      );
    };

    const MetaSuccessStatsSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveIndex(prev => (prev + 1) % data.stats.length), 2500);
        return () => clearInterval(timer);
      }, [data.stats.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-3 gap-4">
            {data.stats.map((stat, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }}
                style={{ background: i === activeIndex ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: i === activeIndex ? 'none' : '2px solid #e5e5e5', borderRadius: '20px', padding: '28px', textAlign: 'center', position: 'relative', overflow: 'hidden', transition: 'all 0.3s ease', boxShadow: i === activeIndex ? '0 0 30px rgba(245, 158, 11, 0.2)' : 'none' }}>
                {i === activeIndex && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />}
                <div style={{ fontSize: '48px', fontWeight: '900', color: i === activeIndex ? 'var(--accent)' : '#111', marginBottom: '8px' }}>
                  <AnimatedCounter target={stat.value} suffix={stat.suffix} />
                </div>
                <div style={{ fontSize: '14px', fontWeight: '600', color: i === activeIndex ? '#e5e5e5' : '#374151', marginBottom: '4px' }}>{stat.label}</div>
                <div style={{ fontSize: '12px', color: i === activeIndex ? '#a1a1aa' : '#6b7280' }}>{stat.subtext}</div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    const PreTestChecklistSlide = ({ data }) => {
      const [checkedItems, setCheckedItems] = useState([]);
      useEffect(() => {
        const timers = data.checks.map((_, i) =>
          setTimeout(() => setCheckedItems(prev => [...prev, i]), 1000 + i * 1000)
        );
        return () => timers.forEach(t => clearTimeout(t));
      }, [data.checks.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="space-y-4 mb-6">
            {data.checks.map((check, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                style={{ display: 'flex', alignItems: 'center', gap: '16px', padding: '20px', background: checkedItems.includes(i) ? 'linear-gradient(135deg, #f0fdf4, #dcfce7)' : 'white', border: checkedItems.includes(i) ? '2px solid #86efac' : '2px solid #e5e5e5', borderRadius: '16px', transition: 'all 0.3s ease' }}>
                <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: checkedItems.includes(i) ? '#22c55e' : '#e5e5e5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', transition: 'all 0.3s ease' }}>
                  {checkedItems.includes(i) && <Icons.Check />}
                </div>
                <div style={{ flex: 1 }}>
                  <p style={{ fontWeight: '600', color: '#111', marginBottom: '4px' }}>{check.question}</p>
                  <span style={{ fontSize: '12px', padding: '2px 8px', borderRadius: '4px', background: 'var(--accent)', color: 'white', fontWeight: '700' }}>{check.rule}</span>
                </div>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            style={{ padding: '20px', background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '8px' }}>
              <Icons.AlertTriangle />
              <span style={{ color: '#fca5a5', fontWeight: '600' }}>{data.warning}</span>
            </div>
          </motion.div>
        </div>
      );
    };

    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }}
          style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '40px', position: 'relative', overflow: 'hidden', boxShadow: '0 0 60px rgba(245, 158, 11, 0.2)' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <div style={{ textAlign: 'center', marginBottom: '24px' }}>
            <div style={{ width: '64px', height: '64px', borderRadius: '16px', background: 'rgba(245, 158, 11, 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 16px', color: 'var(--accent)' }}>
              <Icons.Lightbulb />
            </div>
            <h2 className="slide-title text-xl md:text-2xl text-white">The Two Meta Rules</h2>
          </div>

          <p style={{ fontSize: '20px', color: '#e5e5e5', textAlign: 'center', fontStyle: 'italic', lineHeight: '1.7', marginBottom: '32px' }}>"{data.quote}"</p>

          <div style={{ display: 'flex', justifyContent: 'center', gap: '24px' }}>
            {data.actions.map((action, i) => {
              const ActionIcon = Icons[action.icon];
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 + i * 0.1 }}
                  style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: 'rgba(245, 158, 11, 0.15)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--accent)' }}>
                    <ActionIcon />
                  </div>
                  <span style={{ fontSize: '12px', color: '#a1a1aa', fontWeight: '500' }}>{action.label}</span>
                </motion.div>
              );
            })}
          </div>
        </motion.div>
      </div>
    );

    // ==================== STANDARD SLIDES ====================

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl text-black mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg mb-3 max-w-lg" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center gap-1.5 text-neutral-400 text-xs mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-2xl p-5 mb-4 max-w-sm w-full">
              <p className="text-neutral-500 text-[11px] uppercase tracking-wider mb-3">In this lesson</p>
              <ul className="space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>{i + 1}</span>
                    <span className="text-neutral-300 text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-7 py-3 rounded-xl text-white font-semibold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 0.9 }} />
          </motion.div>
        )}
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { onShowGif(isCorrect ? celebrationGif : empathyGif, '60%', gifSide); } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback}
                  className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 6px 24px rgba(var(--accent-rgb), 0.35)' }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Two Meta Rules: Mastered</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md">You now know the two rules: Special enough to trigger desire, and not too specific to scale. Before you test on Meta, run the 2-rule check.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
        <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={() => window.parent.postMessage({ type: 'LESSON_COMPLETE', lessonId: LESSON_CONFIG.id }, '*')} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>Complete Lesson</motion.button>
      </div>
    );

    // ==================== MAIN APP ====================

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'rule-reveal': return <RuleRevealSlide data={slide} />;
          case 'two-second-test': return <TwoSecondTestSlide data={slide} />;
          case 'special-enough-grid': return <SpecialEnoughGridSlide data={slide} />;
          case 'product-battle': return <ProductBattleSlide data={slide} />;
          case 'product-killers': return <ProductKillersSlide data={slide} />;
          case 'audience-comparison': return <AudienceComparisonSlide data={slide} />;
          case 'two-rule-matrix': return <TwoRuleMatrixSlide data={slide} />;
          case 'meta-success-stats': return <MetaSuccessStatsSlide data={slide} />;
          case 'pre-test-checklist': return <PreTestChecklistSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
