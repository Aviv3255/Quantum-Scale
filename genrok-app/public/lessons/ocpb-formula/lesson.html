<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The OCPB Formula | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #d946ef;
      --accent-dark: #c026d3;
      --accent-light: #e879f9;
      --accent-rgb: 217, 70, 239;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'ocpb-formula',
      title: 'The OCPB Formula',
      description: 'The 4-letter sequence that turns objections into conversions.',
      accentColor: '#d946ef',
      duration: '5 min',
      nextLesson: {
        id: 'self-persuasion-architecture',
        title: 'Self-Persuasion Architecture',
        teaser: 'Why convincing people doesn\'t work. And what does.'
      }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000, decimals = 0 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(target);
        const increment = end / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(start); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{decimals > 0 ? count.toFixed(decimals) : Math.round(count)}{suffix}</span>;
    };

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      DollarSign: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Clock2: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Shield: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Brain: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-1.54"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
      MessageCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      FileText: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Award: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: [
        'Why objections are buying signals in disguise',
        'The 4-step OCPB sequence that dissolves doubt',
        'How to turn "too expensive" into "where do I pay?"'
      ]},
      { type: 'hook', headline: 'Your customer just said "But..."', subtext: 'That moment when they hit you with "It\'s too expensive" or "I need to think about it." Most store owners panic. They discount. They beg. They lose the sale. But that objection? It\'s not a wall. It\'s a door.' },
      { type: 'objection-mindset', title: 'The Truth About Objections', data: {
        myth: { label: 'What Most Think', text: 'Objection = Rejection', result: 'They don\'t want it' },
        reality: { label: 'What\'s Actually Happening', text: 'Objection = Invitation', result: 'They want to be convinced' },
        insight: 'People who don\'t care just close the tab. People who object? They\'re practically begging you to help them say yes.'
      }},
      { type: 'ocpb-reveal', title: 'The OCPB Formula', letters: [
        { letter: 'O', word: 'Objection', action: 'Name It', description: 'Say their concern before they do', color: '#ef4444' },
        { letter: 'C', word: 'Claim', action: 'Counter It', description: 'Make a bold statement that reframes', color: '#f59e0b' },
        { letter: 'P', word: 'Proof', action: 'Prove It', description: 'Back your claim with evidence', color: '#10b981' },
        { letter: 'B', word: 'Benefit', action: 'Reward Them', description: 'Show the upside when they believe', color: '#8b5cf6' }
      ]},
      { type: 'letter-detail', letter: 'O', word: 'Objection', tagline: 'Name the Elephant', description: 'Say the objection out loud before they do. This builds instant trust and steals their ammo.', bad: { label: 'Ignoring It', example: '"Our course is the best in the market!"' }, good: { label: 'Naming It', example: '"Look, $297 isn\'t cheap. I get it. That\'s probably what\'s holding you back right now."' }, psychology: 'Hard to object when you just said their objection for them.' },
      { type: 'letter-detail', letter: 'C', word: 'Claim', tagline: 'Make a Bold Counter', description: 'Flip the script. Don\'t disagree softly. Make a confident statement that reframes their concern completely.', bad: { label: 'Weak Defense', example: '"Well, it\'s not that expensive compared to others..."' }, good: { label: 'Bold Counter', example: '"The real cost isn\'t the $297. It\'s the $10K+ you\'ll leave on the table this year without these skills."' }, psychology: 'Reframing shifts the conversation from cost to opportunity cost.' },
      { type: 'letter-detail', letter: 'P', word: 'Proof', tagline: 'Back It With Receipts', description: 'Claims without proof are just opinions. Drop the evidence. Numbers. Screenshots. Results. Make your claim undeniable.', bad: { label: 'Empty Claim', example: '"Trust me, it really works!"' }, good: { label: 'Evidence-Backed', example: '"Our students see ROI in 14 days on average. Sarah made $1,247 her first week."' }, psychology: 'The stronger your proof, the weaker their resistance.' },
      { type: 'letter-detail', letter: 'B', word: 'Benefit', tagline: 'Show the Upside', description: 'End with what they get when they believe you. Paint the picture so vivid they can taste it.', bad: { label: 'Vague Promise', example: '"You\'ll get great results!"' }, good: { label: 'Vivid Vision', example: '"Imagine 90 days from now - your store doing $50K months while you work less. That\'s what this unlocks."' }, psychology: 'Future-pacing creates emotional investment in the outcome.' },
      { type: 'trust-meter', title: 'How OCPB Builds Trust', stages: [
        { step: 'O', label: 'Skeptical', percent: 25, description: 'You acknowledge their concern' },
        { step: 'C', label: 'Curious', percent: 50, description: 'They start to reconsider' },
        { step: 'P', label: 'Interested', percent: 75, description: 'Evidence removes doubt' },
        { step: 'B', label: 'Ready to Buy', percent: 100, description: 'They see themselves winning' }
      ]},
      { type: 'full-example', title: 'OCPB in Action', context: 'Handling "It\'s too expensive" on a $297 course page:', steps: [
        { letter: 'O', text: '"I know $297 feels like a lot right now."' },
        { letter: 'C', text: '"But cheap alternatives cost you more in wasted time and missed sales."' },
        { letter: 'P', text: '"Our students see ROI in 14 days on average. Sarah made $1,247 her first week."' },
        { letter: 'B', text: '"That\'s 4X return before you even finish the course."' }
      ], result: '+67% Conversion Rate' },
      { type: 'objection-library', title: 'OCPB for Common Objections', objections: [
        { type: 'Price', quote: '"Too expensive"', icon: 'DollarSign', color: '#10b981', strategy: 'Reframe as investment vs. cost of inaction', example: 'O: "I know this seems like a big investment." C: "But the cost of staying stuck is higher." P: "$4,200 average ROI in 60 days." B: "That\'s 14X return."' },
        { type: 'Time', quote: '"No time"', icon: 'Clock2', color: '#3b82f6', strategy: 'Show how it saves time long-term', example: 'O: "I get it - you\'re already overwhelmed." C: "But this actually saves you 10+ hours/week." P: "Our automation reduced John\'s workload by 60%." B: "Imagine having your weekends back."' },
        { type: 'Trust', quote: '"Will it work?"', icon: 'Shield', color: '#8b5cf6', strategy: 'Proof from similar customers', example: 'O: "You\'re right to be skeptical." C: "Most courses don\'t deliver. We do." P: "847 students, 4.9 stars, 23% average revenue increase." B: "Join them in 90 days."' }
      ]},
      { type: 'copy-templates', title: 'Ready-to-Use OCPB Templates', templates: [
        { scenario: 'Price Objection', template: 'O: "I know [price] feels steep right now."\nC: "But [cheaper alternative] will cost you [hidden cost]."\nP: "[Specific proof with numbers]."\nB: "[Vivid outcome] in [timeframe]."' },
        { scenario: 'Time Objection', template: 'O: "I get it - you\'re already at capacity."\nC: "But this actually [time benefit]."\nP: "[Customer name] [specific time saved]."\nB: "Imagine [time freedom result]."' },
        { scenario: 'Trust Objection', template: 'O: "You should be skeptical of promises."\nC: "Most [category] don\'t work. We\'re different."\nP: "[Number] customers, [rating], [specific result]."\nB: "[Social proof future state]."' }
      ]},
      { type: 'impact-stats', title: 'The OCPB Effect', stats: [
        { value: 67, suffix: '%', label: 'Higher Conversion', subtext: 'When OCPB is used vs. ignoring objections', color: '#10b981' },
        { value: 2.3, suffix: 'x', label: 'Trust Increase', subtext: 'When you name objections first', color: '#d946ef' },
        { value: 4, suffix: ' steps', label: 'Simple Formula', subtext: 'O-C-P-B dissolves any doubt', color: '#f59e0b' }
      ]},
      { type: 'elite-insight', title: 'The Doubt Conversion Paradox', insight: 'The fastest way to overcome objections isn\'t to fight them. It\'s to embrace them. When you name someone\'s concern before they do, you become an ally instead of an adversary.', principle: 'Objections aren\'t obstacles. They\'re invitations disguised as resistance.', quote: '"The sale begins when the customer says no."' },
      { type: 'quiz', question: 'What is the core idea behind the OCPB Formula?', options: ['Ignore objections and focus on product benefits', 'Surface objections, counter with proof, and show the payoff', 'Offer discounts to overcome price resistance', 'Wait for customers to ask questions before addressing concerns'], correctIndex: 1, feedback: { correct: 'Exactly. OCPB is about proactively surfacing objections (O), making a bold counter-claim (C), backing it with proof (P), and showing the benefit (B). This sequence turns doubt into conviction.', incorrect: 'The OCPB Formula is: Surface the Objection, make a Counter-claim, provide Proof, show the Benefit. It\'s about proactively addressing concerns and building trust through evidence.' }},
      { type: 'completion', actionStep: 'Write out the top 3 objections your customers have. Then craft an OCPB response for each one. Use these in your product pages, emails, and ads.' }
    ];

    // ============ SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    // ============ OBJECTION MINDSET SLIDE ============
    const ObjectionMindsetSlide = ({ data }) => {
      const [showReality, setShowReality] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowReality(true), 1500);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-2 gap-6 mb-6">
            {/* Myth */}
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="relative rounded-2xl p-6 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />

              <div className="flex items-center gap-2 mb-4">
                <Icons.X />
                <span className="text-red-400 font-semibold">{data.data.myth.label}</span>
              </div>

              <div className="text-center py-6">
                <div className="text-3xl font-bold text-red-400 mb-2">{data.data.myth.text}</div>
                <div className="text-neutral-500 text-sm">{data.data.myth.result}</div>
              </div>

              <div className="flex justify-center">
                <motion.div animate={{ scale: [1, 1.1, 1] }} transition={{ duration: 2, repeat: Infinity }}
                  className="w-16 h-16 rounded-full bg-red-500/20 flex items-center justify-center">
                  <Icons.X />
                </motion.div>
              </div>
            </motion.div>

            {/* Reality */}
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: showReality ? 1 : 0.3, x: 0 }} transition={{ delay: 0.3 }}
              className="relative rounded-2xl p-6 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: showReality ? '0 0 40px rgba(16, 185, 129, 0.3)' : 'none' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />

              <div className="flex items-center gap-2 mb-4">
                <Icons.Check />
                <span className="text-green-400 font-semibold">{data.data.reality.label}</span>
              </div>

              <div className="text-center py-6">
                <div className="text-3xl font-bold text-green-400 mb-2">{data.data.reality.text}</div>
                <div className="text-neutral-500 text-sm">{data.data.reality.result}</div>
              </div>

              <div className="flex justify-center">
                <motion.div animate={{ scale: showReality ? [1, 1.2, 1] : 1 }} transition={{ duration: 1.5, repeat: showReality ? Infinity : 0 }}
                  className="w-16 h-16 rounded-full bg-green-500/20 flex items-center justify-center">
                  <Icons.Check />
                </motion.div>
              </div>
            </motion.div>
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: showReality ? 1 : 0, y: showReality ? 0 : 20 }}
            className="text-center rounded-xl p-4" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="inline-flex items-center gap-2 text-amber-400">
              <Icons.Lightbulb />
              <span className="text-sm">{data.data.insight}</span>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ OCPB REVEAL SLIDE ============
    const OCPBRevealSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveIndex(prev => (prev + 1) % data.letters.length);
        }, 3000);
        return () => clearInterval(timer);
      }, [data.letters.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="grid md:grid-cols-4 gap-4 mb-6">
            {data.letters.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setActiveIndex(i)}
                className={`relative rounded-2xl p-5 cursor-pointer text-center overflow-hidden transition-all duration-300 ${activeIndex === i ? 'ring-2' : ''}`}
                style={{
                  background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                  ringColor: activeIndex === i ? item.color : 'transparent',
                  boxShadow: activeIndex === i ? `0 0 30px ${item.color}30` : 'none'
                }}>
                <div className="absolute top-0 left-0 right-0 h-1 transition-opacity" style={{ background: `linear-gradient(90deg, transparent, ${item.color}, transparent)`, opacity: activeIndex === i ? 1 : 0.3 }} />

                <motion.div animate={{ scale: activeIndex === i ? [1, 1.1, 1] : 1 }} transition={{ duration: 1, repeat: activeIndex === i ? Infinity : 0 }}
                  className="w-16 h-16 rounded-xl flex items-center justify-center mx-auto mb-3" style={{ background: `linear-gradient(135deg, ${item.color}, ${item.color}dd)`, boxShadow: activeIndex === i ? `0 0 20px ${item.color}40` : 'none' }}>
                  <span className="text-white text-2xl font-bold">{item.letter}</span>
                </motion.div>

                <h3 className="text-white font-bold text-lg mb-1">{item.word}</h3>
                <p className="text-sm mb-2" style={{ color: item.color }}>{item.action}</p>
                <p className="text-neutral-400 text-xs">{item.description}</p>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }}
            className="text-center rounded-xl p-4" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="inline-flex items-center gap-2 text-neutral-400">
              <Icons.Zap />
              <span className="text-sm">Each step builds trust and dissolves doubt</span>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ LETTER DETAIL SLIDE ============
    const LetterDetailSlide = ({ data }) => {
      const letterColors = { O: '#ef4444', C: '#f59e0b', P: '#10b981', B: '#8b5cf6' };
      const color = letterColors[data.letter] || 'var(--accent)';

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-3 mb-3">
              <div className="w-14 h-14 rounded-xl flex items-center justify-center" style={{ background: `linear-gradient(135deg, ${color}, ${color}dd)`, boxShadow: `0 0 20px ${color}40` }}>
                <span className="text-white text-2xl font-bold">{data.letter}</span>
              </div>
              <div className="text-left">
                <span className="text-neutral-500 text-xs uppercase tracking-wider">Step {['O', 'C', 'P', 'B'].indexOf(data.letter) + 1}</span>
                <h2 className="slide-title text-2xl md:text-3xl text-black">{data.word}</h2>
              </div>
            </div>
            <p className="text-lg font-semibold" style={{ color }}>{data.tagline}</p>
          </motion.div>

          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
            className="text-neutral-600 text-center mb-6 max-w-2xl mx-auto">{data.description}</motion.p>

          <div className="grid md:grid-cols-2 gap-4 mb-6">
            {/* Bad */}
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />

              <div className="flex items-center gap-2 mb-3">
                <div className="w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center text-red-400"><Icons.X /></div>
                <span className="text-red-400 font-semibold text-sm">{data.bad.label}</span>
              </div>
              <p className="text-neutral-300 text-sm italic">"{data.bad.example}"</p>
            </motion.div>

            {/* Good */}
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${color}20` }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${color}, transparent)` }} />

              <div className="flex items-center gap-2 mb-3">
                <div className="w-6 h-6 rounded-full flex items-center justify-center" style={{ background: `${color}20`, color }}><Icons.Check /></div>
                <span className="font-semibold text-sm" style={{ color }}>{data.good.label}</span>
              </div>
              <p className="text-neutral-300 text-sm italic">"{data.good.example}"</p>
            </motion.div>
          </div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="text-center rounded-xl p-4" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="inline-flex items-center gap-2">
              <Icons.Brain />
              <span className="text-amber-400 text-sm">{data.psychology}</span>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ TRUST METER SLIDE ============
    const TrustMeterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>

        <div className="relative rounded-2xl p-6 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <div className="space-y-5">
            {data.stages.map((stage, i) => {
              const colors = ['#ef4444', '#f59e0b', '#10b981', '#8b5cf6'];
              const color = colors[i];

              return (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.15 }}>
                  <div className="flex justify-between mb-2">
                    <div className="flex items-center gap-3">
                      <span className="w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold text-white" style={{ background: `linear-gradient(135deg, ${color}, ${color}dd)` }}>{stage.step}</span>
                      <div>
                        <span className="text-white font-semibold text-sm">{stage.label}</span>
                        <p className="text-neutral-500 text-xs">{stage.description}</p>
                      </div>
                    </div>
                    <span className="text-neutral-400 text-sm font-bold">{stage.percent}%</span>
                  </div>
                  <div className="h-4 bg-neutral-800 rounded-full overflow-hidden">
                    <motion.div initial={{ width: 0 }} animate={{ width: `${stage.percent}%` }} transition={{ delay: 0.3 + i * 0.2, duration: 0.8, ease: 'easeOut' }}
                      className="h-full rounded-full" style={{ background: `linear-gradient(90deg, ${color}88, ${color})`, boxShadow: `0 0 15px ${color}60` }} />
                  </div>
                </motion.div>
              );
            })}
          </div>

          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1.2 }} className="text-center text-neutral-500 text-sm mt-6">
            Each step moves them closer to "Yes"
          </motion.p>
        </div>
      </div>
    );

    // ============ FULL EXAMPLE SLIDE ============
    const FullExampleSlide = ({ data }) => {
      const [phase, setPhase] = useState(0);

      useEffect(() => {
        const timers = data.steps.map((_, i) => setTimeout(() => setPhase(i + 1), 600 + i * 600));
        return () => timers.forEach(clearTimeout);
      }, [data.steps]);

      const colors = { O: '#ef4444', C: '#f59e0b', P: '#10b981', B: '#8b5cf6' };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-3">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center text-sm mb-6">{data.context}</motion.p>

          <div className="relative rounded-2xl p-6 overflow-hidden mb-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="space-y-4">
              {data.steps.map((step, i) => {
                const color = colors[step.letter];
                return (
                  <motion.div key={i} initial={{ opacity: 0.3, x: -10 }} animate={{ opacity: phase > i ? 1 : 0.3, x: phase > i ? 0 : -10 }}
                    className="flex items-start gap-4">
                    <div className="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0" style={{ background: `linear-gradient(135deg, ${color}, ${color}dd)`, boxShadow: phase > i ? `0 0 15px ${color}40` : 'none' }}>
                      <span className="text-white font-bold">{step.letter}</span>
                    </div>
                    <p className="text-neutral-300 text-sm pt-2 italic">"{step.text}"</p>
                  </motion.div>
                );
              })}
            </div>
          </div>

          <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: phase >= data.steps.length ? 1 : 0, scale: phase >= data.steps.length ? 1 : 0.8 }}
            className="flex justify-center">
            <div className="px-8 py-4 rounded-full font-bold text-xl" style={{ background: 'linear-gradient(135deg, #10b981, #059669)', color: 'white' }}>
              {data.result}
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ OBJECTION LIBRARY SLIDE ============
    const ObjectionLibrarySlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      const IconMap = { DollarSign: Icons.DollarSign, Clock2: Icons.Clock2, Shield: Icons.Shield };

      useEffect(() => {
        const timer = setInterval(() => setActiveIndex(prev => (prev + 1) % data.objections.length), 5000);
        return () => clearInterval(timer);
      }, [data.objections.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <div className="grid md:grid-cols-3 gap-3 mb-6">
            {data.objections.map((obj, i) => {
              const IconComponent = IconMap[obj.icon] || Icons.Target;
              return (
                <motion.button key={i} onClick={() => setActiveIndex(i)}
                  initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                  className={`relative rounded-xl p-4 text-left transition-all ${activeIndex === i ? 'ring-2' : ''}`}
                  style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', ringColor: activeIndex === i ? obj.color : 'transparent', boxShadow: activeIndex === i ? `0 0 20px ${obj.color}30` : 'none' }}>
                  <div className="absolute top-0 left-0 right-0 h-1 rounded-t-xl transition-opacity" style={{ background: `linear-gradient(90deg, transparent, ${obj.color}, transparent)`, opacity: activeIndex === i ? 1 : 0.3 }} />

                  <div className="w-10 h-10 rounded-lg flex items-center justify-center mb-2" style={{ background: `${obj.color}20`, color: obj.color }}>
                    <IconComponent />
                  </div>
                  <div className="text-white font-bold text-sm">{obj.type}</div>
                  <div className="text-neutral-400 text-xs italic">{obj.quote}</div>
                </motion.button>
              );
            })}
          </div>

          <AnimatePresence mode="wait">
            <motion.div key={activeIndex} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }}
              className="relative rounded-2xl p-5 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${data.objections[activeIndex].color}20` }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${data.objections[activeIndex].color}, transparent)` }} />

              <div className="mb-3">
                <span className="text-xs uppercase tracking-wider" style={{ color: data.objections[activeIndex].color }}>Strategy</span>
                <p className="text-white text-sm">{data.objections[activeIndex].strategy}</p>
              </div>

              <div className="p-4 rounded-lg bg-neutral-800/50">
                <span className="text-xs text-amber-400 uppercase tracking-wider">OCPB Response</span>
                <p className="text-neutral-300 text-sm mt-2 whitespace-pre-line">{data.objections[activeIndex].example}</p>
              </div>
            </motion.div>
          </AnimatePresence>
        </div>
      );
    };

    // ============ COPY TEMPLATES SLIDE ============
    const CopyTemplatesSlide = ({ data }) => {
      const [activeTab, setActiveTab] = useState(0);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <div className="flex justify-center gap-2 mb-6">
            {data.templates.map((t, i) => (
              <button key={i} onClick={() => setActiveTab(i)}
                className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${activeTab === i ? 'text-white' : 'bg-neutral-100 text-neutral-600'}`}
                style={{ background: activeTab === i ? 'linear-gradient(135deg, var(--accent), var(--accent-dark))' : undefined }}>
                {t.scenario}
              </button>
            ))}
          </div>

          <AnimatePresence mode="wait">
            <motion.div key={activeTab} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: -20 }}
              className="relative rounded-2xl p-6 overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

              <div className="flex items-center gap-2 mb-4">
                <Icons.FileText />
                <span className="text-white font-semibold">{data.templates[activeTab].scenario} Template</span>
              </div>

              <pre className="text-neutral-300 text-sm whitespace-pre-wrap font-mono p-4 rounded-lg bg-neutral-800/50">
                {data.templates[activeTab].template}
              </pre>

              <p className="text-neutral-500 text-xs mt-4 text-center">Copy and customize for your product</p>
            </motion.div>
          </AnimatePresence>
        </div>
      );
    };

    // ============ IMPACT STATS SLIDE ============
    const ImpactStatsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>

        <div className="grid md:grid-cols-3 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }}
              className="relative rounded-2xl p-6 text-center overflow-hidden" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${stat.color}20` }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${stat.color}, transparent)` }} />

              <div className="text-5xl md:text-6xl font-bold mb-3" style={{ color: stat.color }}>
                <AnimatedCounter target={stat.value} suffix={stat.suffix} duration={1500 + i * 300} decimals={stat.suffix === 'x' ? 1 : 0} />
              </div>
              <div className="text-white font-semibold text-lg mb-2">{stat.label}</div>
              <div className="text-neutral-400 text-sm">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // ============ ELITE INSIGHT SLIDE ============
    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
          className="w-full relative rounded-3xl p-8 md:p-12 overflow-hidden text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 60px rgba(217, 70, 239, 0.2)' }}>
          <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="flex justify-center mb-6">
            <div className="w-16 h-16 rounded-2xl flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 0 30px rgba(217, 70, 239, 0.4)' }}>
              <Icons.Lightbulb />
            </div>
          </motion.div>

          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="slide-title text-2xl md:text-3xl text-white mb-6">{data.title}</motion.h2>

          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="text-xl md:text-2xl text-neutral-300 leading-relaxed mb-6">{data.insight}</motion.p>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            className="px-6 py-3 rounded-xl mb-6" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
            <span className="text-sm" style={{ color: 'var(--accent)' }}>{data.principle}</span>
          </motion.div>

          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }}
            className="text-lg text-white italic font-medium">{data.quote}</motion.p>
        </motion.div>
      </div>
    );

    // ============ QUIZ SLIDE ============
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // ============ COMPLETION SLIDE ============
    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-6 max-w-md leading-relaxed">You now have a 4-letter cheat code for dissolving doubt. O-C-P-B. Use it on your product pages, emails, and ads.</motion.p>
        {data.actionStep && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-neutral-100 rounded-xl p-5 max-w-md w-full mb-8">
            <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Action Step</p>
            <p className="text-neutral-700 text-sm leading-relaxed">{data.actionStep}</p>
          </motion.div>
        )}
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'objection-mindset': return <ObjectionMindsetSlide data={slide} />;
          case 'ocpb-reveal': return <OCPBRevealSlide data={slide} />;
          case 'letter-detail': return <LetterDetailSlide data={slide} />;
          case 'trust-meter': return <TrustMeterSlide data={slide} />;
          case 'full-example': return <FullExampleSlide data={slide} />;
          case 'objection-library': return <ObjectionLibrarySlide data={slide} />;
          case 'copy-templates': return <CopyTemplatesSlide data={slide} />;
          case 'impact-stats': return <ImpactStatsSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
