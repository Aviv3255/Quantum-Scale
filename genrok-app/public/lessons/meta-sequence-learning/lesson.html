<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>How GEM Reads Your Customer's Story | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #06b6d4; --accent-dark: #0891b2; --accent-light: #67e8f9; --accent-rgb: 6, 182, 212; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'meta-sequence-learning',
      title: 'How GEM Reads Your Customer\'s Story',
      description: 'GEM doesn\'t just see the last click. It reads thousands of events across your customer\'s entire journey to predict what they\'ll do next.',
      accentColor: '#06b6d4',
      duration: '7 min',
      nextLesson: { id: 'meta-machine-scale', title: 'The Scale of the Machine', teaser: 'Discover the mind-blowing computational power that makes GEM impossible to outsmart.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why GEM sees the "whole story" not just the last chapter', 'The difference between Sequence Features and Non-Sequence Features', 'How the Pyramid-Parallel structure processes thousands of events simultaneously'] },
      { type: 'hook', headline: 'Old systems saw snapshots. GEM sees the entire movie. Every click. Every pause. Every scroll. Every purchase across years of behavior - processed simultaneously to predict what you\'ll do next.', subtext: 'This is why trying to outsmart GEM with manual targeting is like trying to hide from someone who\'s watched every moment of your life. The machine sees the whole story, not just the chapter you\'re in now.' },
      { type: 'content', title: 'The Old Way: Snapshot Targeting', body: 'Traditional advertising systems looked at users like photographs.\n\n"This person is 28, female, interested in fitness." That\'s the snapshot. That\'s all they knew. Every ad decision was based on this frozen moment in time.\n\nBut here\'s the problem: A snapshot doesn\'t tell you WHY someone does what they do. It doesn\'t know they\'ve been researching running shoes for 3 weeks. It doesn\'t know they just got a bonus. It doesn\'t know they abandon carts at midnight but purchase in the morning.\n\nSnapshots are static. Behavior is dynamic. And the gap between them is where billions in ad spend gets wasted.' },
      { type: 'insight', title: 'The GEM Difference', quote: 'GEM doesn\'t just know what you clicked. It models your entire purchase journey to predict what you\'ll do next.', explanation: 'Imagine having a memory of every single interaction across Facebook, Instagram, and Messenger for billions of users. That\'s what GEM has. And it uses ALL of it to understand intent.' },
      { type: 'features', title: 'Two Types of Data GEM Processes', features: [
        {
          type: 'sequence',
          title: 'Sequence Features',
          subtitle: 'Your Behavior Over Time',
          icon: 'timeline',
          color: '#06b6d4',
          items: ['Clicks, views, and interactions across ads', 'Organic content engagement patterns', 'Scroll behavior and pause duration', 'Purchase history timeline', 'Message conversations'],
          insight: 'GEM processes sequences of up to THOUSANDS of these events per user'
        },
        {
          type: 'non-sequence',
          title: 'Non-Sequence Features',
          subtitle: 'Static Context',
          icon: 'profile',
          color: '#8b5cf6',
          items: ['Age and location', 'Device and browser', 'Ad format being shown', 'Time of day', 'Platform (FB vs IG vs Messenger)'],
          insight: 'These provide context for interpreting the sequence data'
        }
      ]},
      { type: 'pyramid', title: 'The Pyramid-Parallel Structure', description: 'GEM uses a unique architecture that processes both types of features simultaneously, building up to hyper-accurate predictions.' },
      { type: 'journey', title: 'What This Looks Like in Practice', journey: {
        user: 'Sarah, 34, Marketing Manager',
        events: [
          { day: 'Day 1', action: 'Scrolls past yoga mat ad', time: '8:42 AM', signal: 'Light interest signal' },
          { day: 'Day 3', action: 'Watches 45s of yoga studio video', time: '7:15 PM', signal: 'Moderate engagement' },
          { day: 'Day 5', action: 'Visits yoga mat product page', time: '9:30 PM', signal: 'High intent signal' },
          { day: 'Day 6', action: 'Adds mat to cart, abandons', time: '11:45 PM', signal: 'Purchase intent detected' },
          { day: 'Day 7', action: 'Opens Instagram at coffee shop', time: '8:15 AM', signal: 'HIGH PURCHASE PROBABILITY' }
        ],
        prediction: 'GEM shows the yoga mat ad at exactly this moment. Sarah buys.',
        why: 'GEM knew her morning routine. It knew she researches at night but buys in the morning. It knew the cart abandonment pattern. Old systems would have retargeted her with the same ad 47 times.'
      }},
      { type: 'content', title: 'The "Whole Story" Advantage', body: 'Here\'s what makes this revolutionary:\n\nOld System: "Show yoga ad to women 25-40 interested in fitness."\nGEM: "Show yoga ad to Sarah at 8:15 AM on Thursday because she\'s researched for a week, added to cart last night, and her purchase history shows she converts on morning commutes."\n\nSame ad. Same product. Same budget. Completely different result.\n\nGEM doesn\'t guess. It KNOWS. Because it has the whole story.\n\nThis is why your manual audience research feels increasingly useless. You\'re bringing a character sketch to a fight against someone who\'s read the entire novel.' },
      { type: 'comparison', title: 'Snapshots vs. Stories', items: [
        { snapshot: 'Female, 25-34, interested in skincare', story: 'Researched retinol for 2 weeks, reads reviews at 10pm, bought competitor product 6 months ago, engagement spikes before payday' },
        { snapshot: 'Male, 35-44, interested in golf', story: 'Watches golf content weekends, clicked on premium brand ads 3x, typically purchases high-ticket items after watching 2+ videos' },
        { snapshot: 'Location: NYC, interested in food', story: 'Orders delivery Tues-Thurs, browses restaurant content during commute, opened food ads but never converted on mobile' }
      ]},
      { type: 'content', title: 'Why This Changes Your Strategy', body: 'If GEM can read the whole story, your job is no longer about telling it WHO to target.\n\nYour job is to:\n\n1. Feed it clean data - Every event GEM records should be accurate. Proper Pixel setup. CAPI implementation. Event match quality matters.\n\n2. Give it good signals - When someone purchases, GEM learns "this is what success looks like." More purchase signals = better story understanding.\n\n3. Let creative teach context - Different ad creatives attract different behavior patterns. GEM learns who responds to what.\n\n4. Trust the story reader - Stop trying to micro-manage audiences. GEM has read billions of stories. Let it use that knowledge.' },
      { type: 'quiz', question: 'What makes GEM\'s "Sequence Features" so powerful compared to traditional targeting?', options: ['They tell GEM basic demographics like age and location', 'They capture behavior OVER TIME - thousands of events that show patterns traditional targeting misses', 'They reduce the amount of data GEM needs to process', 'They focus only on the most recent user action'], correctIndex: 1, feedback: { correct: 'Exactly! Sequence Features capture behavior OVER TIME - clicks, views, interactions, purchases across thousands of events. This creates a "story" of user intent that static targeting (age, interests, location) can never match. GEM knows Sarah researches at night but buys in the morning. Traditional targeting just knows "Female, 34, interested in yoga." The story always beats the snapshot.', incorrect: 'Not quite. Sequence Features are powerful because they capture behavior OVER TIME - up to thousands of events per user. This includes clicks, views, scroll patterns, purchase history, and engagement across days/weeks/months. Traditional targeting gives you a snapshot ("Female, 34, interested in yoga"). Sequence Features give you the whole story ("Researches at night, buys in morning, converts after 3+ touchpoints"). The story always wins.' }},
      { type: 'completion', sources: [{ name: 'The Meta Iceberg: Unlocking AI Mastery', url: '#' }] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Timeline: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="3" y1="12" x2="21" y2="12"/><circle cx="6" cy="12" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="18" cy="12" r="2"/></svg>,
      Profile: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
          <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed whitespace-pre-line">{data.body}</motion.p>
      </div>
    );

    const InsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.15 }} className="rounded-2xl p-8 md:p-12 mb-6" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
          <p className="text-xl md:text-2xl font-bold text-white text-center leading-relaxed">"{data.quote}"</p>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-base md:text-lg text-neutral-600 text-center leading-relaxed">{data.explanation}</motion.p>
      </div>
    );

    const FeaturesSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          {data.features.map((feature, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }} className="bg-white border-2 rounded-2xl p-6" style={{ borderColor: feature.color }}>
              <div className="flex items-center gap-3 mb-4">
                <div className="w-12 h-12 rounded-xl flex items-center justify-center text-white" style={{ background: feature.color }}>
                  {feature.icon === 'timeline' ? <Icons.Timeline /> : <Icons.Profile />}
                </div>
                <div>
                  <h3 className="text-lg font-bold text-black">{feature.title}</h3>
                  <p className="text-xs text-neutral-500">{feature.subtitle}</p>
                </div>
              </div>
              <ul className="space-y-2 mb-4">
                {feature.items.map((item, j) => (
                  <li key={j} className="flex items-start gap-2 text-sm text-neutral-700">
                    <span style={{ color: feature.color }}>â€¢</span>
                    <span>{item}</span>
                  </li>
                ))}
              </ul>
              <div className="rounded-lg p-3" style={{ background: `${feature.color}15` }}>
                <p className="text-xs" style={{ color: feature.color }}>{feature.insight}</p>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const PyramidSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-sm text-neutral-600 text-center mb-8 max-w-2xl mx-auto">{data.description}</motion.p>
        <div className="relative w-full max-w-lg mx-auto">
          <svg viewBox="0 0 300 280" className="w-full">
            <defs>
              <linearGradient id="pyramidGradient2" x1="0%" y1="0%" x2="0%" y2="100%">
                <stop offset="0%" stopColor="#06b6d4" stopOpacity="0.9" />
                <stop offset="100%" stopColor="#0891b2" stopOpacity="0.4" />
              </linearGradient>
            </defs>
            <motion.polygon initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }} points="150,30 40,240 260,240" fill="url(#pyramidGradient2)" stroke="var(--accent)" strokeWidth="3" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.4, duration: 0.8 }} x1="150" y1="80" x2="80" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.5, duration: 0.8 }} x1="150" y1="130" x2="100" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.6, duration: 0.8 }} x1="150" y1="180" x2="120" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.4, duration: 0.8 }} x1="150" y1="80" x2="220" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.5, duration: 0.8 }} x1="150" y1="130" x2="200" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
            <motion.line initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.6, duration: 0.8 }} x1="150" y1="180" x2="180" y2="240" stroke="var(--accent-light)" strokeWidth="1.5" opacity="0.6" />
          </svg>
          <motion.div initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.7 }} className="absolute top-0 left-1/2 transform -translate-x-1/2 -translate-y-4 text-center">
            <div className="bg-cyan-50 border-2 border-cyan-200 rounded-lg px-4 py-2">
              <p className="text-sm font-bold text-cyan-700">Hyper-Accurate Predictions</p>
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.8 }} className="absolute left-0 top-1/3 transform -translate-x-full pr-3 text-right">
            <div className="bg-cyan-100 rounded-lg px-3 py-2">
              <p className="text-xs font-bold text-cyan-700">Sequence Features</p>
              <p className="text-[10px] text-cyan-600">Thousands of events</p>
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.9 }} className="absolute right-0 top-2/3 transform translate-x-full pl-3">
            <div className="bg-purple-100 rounded-lg px-3 py-2">
              <p className="text-xs font-bold text-purple-700">Non-Sequence Features</p>
              <p className="text-[10px] text-purple-600">Static context</p>
            </div>
          </motion.div>
        </div>
      </div>
    );

    const JourneySlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="bg-cyan-50 border border-cyan-200 rounded-lg px-4 py-2 mb-6 inline-block mx-auto">
          <span className="text-sm font-semibold text-cyan-700">{data.journey.user}</span>
        </motion.div>
        <div className="space-y-3 mb-6">
          {data.journey.events.map((event, i) => (
            <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.15 + i * 0.1 }} className={`flex items-center gap-4 rounded-xl p-4 ${i === data.journey.events.length - 1 ? 'bg-cyan-100 border-2 border-cyan-300' : 'bg-white border border-neutral-200'}`}>
              <div className="w-16 text-center flex-shrink-0">
                <span className={`text-xs font-bold ${i === data.journey.events.length - 1 ? 'text-cyan-700' : 'text-neutral-500'}`}>{event.day}</span>
              </div>
              <div className="flex-1">
                <p className={`text-sm font-medium ${i === data.journey.events.length - 1 ? 'text-cyan-800' : 'text-neutral-700'}`}>{event.action}</p>
                <p className="text-xs text-neutral-400">{event.time}</p>
              </div>
              <div className={`px-3 py-1 rounded-full text-xs ${i === data.journey.events.length - 1 ? 'bg-cyan-500 text-white font-bold' : 'bg-neutral-100 text-neutral-600'}`}>
                {event.signal}
              </div>
            </motion.div>
          ))}
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.7 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
          <p className="text-white font-bold mb-2">{data.journey.prediction}</p>
          <p className="text-cyan-100 text-sm">{data.journey.why}</p>
        </motion.div>
      </div>
    );

    const ComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="space-y-4">
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }} className="grid md:grid-cols-2 gap-4">
              <div className="bg-red-50 border-2 border-red-200 rounded-xl p-4">
                <span className="text-xs uppercase tracking-wider text-red-500 block mb-2">Snapshot</span>
                <p className="text-sm text-red-700">{item.snapshot}</p>
              </div>
              <div className="bg-cyan-50 border-2 border-cyan-200 rounded-xl p-4">
                <span className="text-xs uppercase tracking-wider text-cyan-500 block mb-2">Story</span>
                <p className="text-sm text-cyan-700">{item.story}</p>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [answered, setAnswered] = useState(false);
      const handleSelect = (index) => {
        if (answered) return;
        setSelected(index);
        setAnswered(true);
        const isCorrect = index === data.correctIndex;
        const gif = isCorrect ? getRandomCelebrationGif() : getRandomEmpathyGif();
        onShowGif(gif, '50%', 'center');
        setTimeout(() => onHideGif(), 3000);
        onAnswer(isCorrect);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Knowledge Check</span>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>
          <div className="space-y-3 mb-6">
            {data.options.map((option, i) => (
              <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.05 }} onClick={() => handleSelect(i)} disabled={answered} className={`w-full text-left p-4 rounded-xl border-2 transition-all ${answered ? (i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-500 bg-red-50' : 'border-neutral-200 bg-neutral-50') : 'border-neutral-200 bg-white hover:border-cyan-300 hover:bg-cyan-50'}`}>
                <div className="flex items-center gap-3">
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${answered ? (i === data.correctIndex ? 'bg-green-500' : i === selected ? 'bg-red-500' : 'bg-neutral-300') : 'bg-neutral-200'}`}>
                    {answered && i === data.correctIndex && <Icons.Check className="text-white" />}
                    {answered && i === selected && i !== data.correctIndex && <Icons.X className="text-white" />}
                  </div>
                  <span className="text-sm md:text-base text-neutral-700">{option}</span>
                </div>
              </motion.button>
            ))}
          </div>
          <AnimatePresence>
            {answered && (
              <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className={`rounded-xl p-4 ${selected === data.correctIndex ? 'bg-green-50 border-2 border-green-200' : 'bg-cyan-50 border-2 border-cyan-200'}`}>
                <p className="text-sm text-neutral-700 leading-relaxed">{selected === data.correctIndex ? data.feedback.correct : data.feedback.incorrect}</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center text-center px-6 py-10">
        <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', duration: 0.6 }}>
          <div className="w-20 h-20 rounded-full flex items-center justify-center mb-4 mx-auto" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
            <Icons.Check className="text-white" />
          </div>
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="slide-title text-3xl md:text-4xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="text-neutral-600 text-base md:text-lg mb-6 max-w-md">You now understand how GEM reads the entire customer journey - not just snapshots - to make predictions no human could match.</motion.p>
        {data.sources && data.sources.length > 0 && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-neutral-50 rounded-xl p-4 max-w-md w-full mb-6">
            <p className="text-xs uppercase tracking-wider text-neutral-400 mb-2">Sources</p>
            {data.sources.map((source, i) => (
              <div key={i} className="text-sm flex items-center gap-1 mb-1" style={{ color: 'var(--accent)' }}>{source.name}</div>
            ))}
          </motion.div>
        )}
        <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} onClick={() => window.location.href = '/dashboard'} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Back to Dashboard</motion.button>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(0);
      const [userName] = useState(getUserName());
      const [gif, setGif] = useState({ src: null, opacity: 0, side: 'center' });

      const showGif = useCallback((src, opacity, side) => { setGif({ src, opacity, side }); }, []);
      const hideGif = useCallback(() => { setGif(prev => ({ ...prev, opacity: 0 })); }, []);

      const nextSlide = useCallback(() => {
        if (currentSlide < slides.length - 1) {
          setDirection(1);
          setCurrentSlide(prev => prev + 1);
        }
      }, [currentSlide]);

      const prevSlide = useCallback(() => {
        if (currentSlide > 0) {
          setDirection(-1);
          setCurrentSlide(prev => prev - 1);
        }
      }, [currentSlide]);

      const startLesson = useCallback(() => {
        setDirection(1);
        setCurrentSlide(1);
      }, []);

      const handleAnswer = useCallback((correct) => {
        setTimeout(nextSlide, 3000);
      }, [nextSlide]);

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={startLesson} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'insight': return <InsightSlide data={slide} />;
          case 'features': return <FeaturesSlide data={slide} />;
          case 'pyramid': return <PyramidSlide data={slide} />;
          case 'journey': return <JourneySlide data={slide} />;
          case 'comparison': return <ComparisonSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onAnswer={handleAnswer} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return <ContentSlide data={slide} />;
        }
      };

      return (
        <div className="fixed inset-0 bg-white overflow-hidden">
          {gif.src && (
            <motion.div animate={{ opacity: gif.opacity }} initial={{ opacity: 0 }} transition={{ duration: 0.3 }} className="fixed inset-0 pointer-events-none z-50 flex items-center justify-center">
              <video src={gif.src} autoPlay loop muted playsInline className="h-2/3 object-contain" style={{ [gif.side]: '10%' }} />
            </motion.div>
          )}
          <AnimatePresence mode="wait" custom={direction}>
            <motion.div key={currentSlide} custom={direction} initial={{ opacity: 0, x: direction > 0 ? 100 : -100 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: direction > 0 ? -100 : 100 }} transition={{ duration: 0.3 }} className="absolute inset-0">
              {renderSlide(slides[currentSlide])}
            </motion.div>
          </AnimatePresence>
          {currentSlide > 0 && currentSlide < slides.length - 1 && (
            <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 z-30 flex items-center gap-4">
              <button onClick={prevSlide} disabled={currentSlide === 0} className="w-10 h-10 rounded-full bg-white border-2 border-neutral-200 flex items-center justify-center hover:border-cyan-300 disabled:opacity-30 disabled:cursor-not-allowed transition-all"><Icons.ArrowLeft /></button>
              <div className="flex gap-1">
                {slides.map((_, i) => (
                  <div key={i} className="w-1.5 h-1.5 rounded-full transition-all" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d8' }} />
                ))}
              </div>
              <button onClick={nextSlide} disabled={currentSlide === slides.length - 1} className="w-10 h-10 rounded-full flex items-center justify-center text-white disabled:opacity-30 disabled:cursor-not-allowed transition-all" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}><Icons.ArrowRight /></button>
            </div>
          )}
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>