<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Pre-Suasion Hack | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #0891b2; --accent-dark: #0e7490; --accent-light: #22d3ee; --accent-rgb: 8, 145, 178; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    // ============ CONFIGURATION ARRAYS ============
    const WINE_EXPERIMENT = {
      french: { music: 'French Music', value: 5, suffix: 'x', result: 'French wine sales', color: '#0891b2' },
      german: { music: 'German Music', value: 4, suffix: 'x', result: 'German wine sales', color: '#f59e0b' },
      awareness: { label: 'Customer Awareness', value: 0, suffix: '%', result: 'None realized influence', color: '#ef4444' }
    };

    const PRIMING_EXAMPLES = [
      { trigger: 'Images of Luxury', effect: 'Price seems justified', icon: 'Image', color: '#a855f7' },
      { trigger: 'Success Stories', effect: 'Product = transformation', icon: 'Star', color: '#22c55e' },
      { trigger: 'Pain Described', effect: 'Solution feels urgent', icon: 'AlertCircle', color: '#ef4444' },
      { trigger: '"Take Action" Question', effect: 'Commitment activated', icon: 'HelpCircle', color: '#0891b2' }
    ];

    const TOUCHPOINT_SEQUENCE = [
      { stage: 'Ad', prime: 'Show transformation', icon: 'Eye', color: '#a855f7' },
      { stage: 'Headline', prime: '"Finally" = Relief', icon: 'FileText', color: '#0891b2' },
      { stage: 'Testimonials', prime: 'Social proof', icon: 'Users', color: '#22c55e' },
      { stage: 'Price', prime: 'Feels "worth it"', icon: 'DollarSign', color: '#f59e0b' }
    ];

    const PRESUASION_TACTICS = [
      { title: 'Images Before Price', desc: 'Show luxury imagery before revealing cost. Brain associates product with premium quality.', icon: 'Image' },
      { title: 'Questions Before Pitch', desc: '"Are you someone who takes action?" They say yes. Now primed to act on your advice.', icon: 'HelpCircle' },
      { title: 'Stories Before Facts', desc: 'Tell transformation story before specs. They evaluate through success lens.', icon: 'BookOpen' },
      { title: 'Pain Before Solution', desc: 'Describe frustration vividly before presenting solution. Relief attaches to your product.', icon: 'AlertCircle' }
    ];

    const ATTENTION_WINDOW = {
      before: { label: 'What They See BEFORE', examples: ['Luxury images', 'Success stories', 'Social proof', 'Pain acknowledgment'], color: '#22c55e' },
      offer: { label: 'Your Offer', examples: ['Price', 'Features', 'CTA'], color: '#0891b2' },
      perception: { label: 'How They Perceive It', examples: ['"Worth it"', '"This is for me"', '"I need this"'], color: '#a855f7' }
    };

    const IMPACT_STATS = [
      { value: 5, suffix: 'x', label: 'Sales Increase', subtext: 'Music → wine preference' },
      { value: 0, suffix: '%', label: 'Awareness', subtext: 'Customers unaware of influence' },
      { value: 100, suffix: '%', label: 'Pre-Decision', subtext: 'Choice made before seeing product' }
    ];

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Music: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18V5l12-2v13"/><circle cx="6" cy="18" r="3"/><circle cx="18" cy="16" r="3"/></svg>,
      Wine: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8 22h8"/><path d="M7 10h10"/><path d="M12 15v7"/><path d="M12 15a5 5 0 0 0 5-5c0-2-.5-4-2-8H9c-1.5 4-2 6-2 8a5 5 0 0 0 5 5z"/></svg>,
      Brain: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24A2.5 2.5 0 0 0 14.5 2"/></svg>,
      Eye: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      Image: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
      Star: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      AlertCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>,
      HelpCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      FileText: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg>,
      Users: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      DollarSign: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      BookOpen: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Zap: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Lightbulb: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      ArrowRightCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 16 16 12 12 8"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
    };

    const IconComponents = {
      Image: Icons.Image,
      Star: Icons.Star,
      AlertCircle: Icons.AlertCircle,
      HelpCircle: Icons.HelpCircle,
      Eye: Icons.Eye,
      FileText: Icons.FileText,
      Users: Icons.Users,
      DollarSign: Icons.DollarSign,
      BookOpen: Icons.BookOpen,
      Target: Icons.Target,
      Brain: Icons.Brain,
      Music: Icons.Music,
      Wine: Icons.Wine,
      Zap: Icons.Zap,
      Lightbulb: Icons.Lightbulb
    };

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // ============ LESSON CONFIG ============
    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'pre-suasion-hack',
      title: 'The Pre-Suasion Hack',
      description: 'How to prime your customer\'s mind BEFORE they even see your offer.',
      accentColor: '#0891b2',
      duration: '6 min',
      nextLesson: { id: 'pattern-interrupts', title: 'Pattern Interrupts', teaser: 'Why your customer\'s brain ignores 90% of what you show them.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`} style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }} onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }} onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    // ============ VIDEO GIFS ============
    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ UNIQUE CUSTOM SLIDES ============

    // Wine Experiment Slide - Animated music + wine visualization
    const WineExperimentSlide = ({ data }) => {
      const [activeMusic, setActiveMusic] = useState('french');
      useEffect(() => {
        const interval = setInterval(() => {
          setActiveMusic(prev => prev === 'french' ? 'german' : 'french');
        }, 3000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid md:grid-cols-3 gap-6">
            {/* French Music */}
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
              style={{ background: activeMusic === 'french' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', border: activeMusic === 'french' ? '2px solid rgba(8, 145, 178, 0.5)' : '2px solid #e5e5e5', boxShadow: activeMusic === 'french' ? '0 0 30px rgba(8, 145, 178, 0.2)' : 'none' }}
              className="rounded-2xl p-6 text-center transition-all duration-500">
              <motion.div animate={{ scale: activeMusic === 'french' ? [1, 1.1, 1] : 1 }} transition={{ duration: 0.5, repeat: activeMusic === 'french' ? Infinity : 0 }}
                className="w-14 h-14 rounded-xl mx-auto mb-4 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, #0891b2, #0e7490)' }}>
                <Icons.Music />
              </motion.div>
              <p className={`text-lg font-bold mb-2 ${activeMusic === 'french' ? 'text-white' : 'text-neutral-900'}`}>{WINE_EXPERIMENT.french.music}</p>
              <p className={`text-4xl font-bold mb-2 ${activeMusic === 'french' ? 'text-cyan-400' : 'text-cyan-600'}`}>
                <AnimatedCounter target={WINE_EXPERIMENT.french.value} suffix={WINE_EXPERIMENT.french.suffix} />
              </p>
              <p className={`text-sm ${activeMusic === 'french' ? 'text-neutral-400' : 'text-neutral-500'}`}>{WINE_EXPERIMENT.french.result}</p>
            </motion.div>

            {/* Center - Awareness */}
            <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 40px rgba(239, 68, 68, 0.2)' }}
              className="rounded-2xl p-6 text-center relative overflow-hidden">
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
              <div className="w-14 h-14 rounded-xl mx-auto mb-4 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}>
                <Icons.Brain />
              </div>
              <p className="text-lg font-bold text-white mb-2">{WINE_EXPERIMENT.awareness.label}</p>
              <p className="text-5xl font-bold text-red-400 mb-2">
                <AnimatedCounter target={WINE_EXPERIMENT.awareness.value} suffix={WINE_EXPERIMENT.awareness.suffix} />
              </p>
              <p className="text-sm text-neutral-400">{WINE_EXPERIMENT.awareness.result}</p>
            </motion.div>

            {/* German Music */}
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
              style={{ background: activeMusic === 'german' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', border: activeMusic === 'german' ? '2px solid rgba(245, 158, 11, 0.5)' : '2px solid #e5e5e5', boxShadow: activeMusic === 'german' ? '0 0 30px rgba(245, 158, 11, 0.2)' : 'none' }}
              className="rounded-2xl p-6 text-center transition-all duration-500">
              <motion.div animate={{ scale: activeMusic === 'german' ? [1, 1.1, 1] : 1 }} transition={{ duration: 0.5, repeat: activeMusic === 'german' ? Infinity : 0 }}
                className="w-14 h-14 rounded-xl mx-auto mb-4 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, #f59e0b, #d97706)' }}>
                <Icons.Music />
              </motion.div>
              <p className={`text-lg font-bold mb-2 ${activeMusic === 'german' ? 'text-white' : 'text-neutral-900'}`}>{WINE_EXPERIMENT.german.music}</p>
              <p className={`text-4xl font-bold mb-2 ${activeMusic === 'german' ? 'text-amber-400' : 'text-amber-600'}`}>
                <AnimatedCounter target={WINE_EXPERIMENT.german.value} suffix={WINE_EXPERIMENT.german.suffix} />
              </p>
              <p className={`text-sm ${activeMusic === 'german' ? 'text-neutral-400' : 'text-neutral-500'}`}>{WINE_EXPERIMENT.german.result}</p>
            </motion.div>
          </div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
            className="text-center text-neutral-500 text-sm mt-6 italic">
            The decision was made BEFORE they looked at the bottles.
          </motion.p>
        </div>
      );
    };

    // Priming Tactics Grid
    const PrimingTacticsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-4">
          {PRESUASION_TACTICS.map((tactic, i) => {
            const IconComp = IconComponents[tactic.icon];
            return (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.08 }}
                style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}
                className="rounded-xl p-5 relative overflow-hidden">
                <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
                <div className="flex items-start gap-4">
                  <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
                    {IconComp && <IconComp />}
                  </div>
                  <div>
                    <h3 className="font-bold text-white text-base mb-2">{tactic.title}</h3>
                    <p className="text-neutral-400 text-sm leading-relaxed">{tactic.desc}</p>
                  </div>
                </div>
              </motion.div>
            );
          })}
        </div>
      </div>
    );

    // Attention Window Slide - Visual flow
    const AttentionWindowSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => {
          setActivePhase(prev => (prev + 1) % 3);
        }, 2500);
        return () => clearInterval(interval);
      }, []);

      const phases = [ATTENTION_WINDOW.before, ATTENTION_WINDOW.offer, ATTENTION_WINDOW.perception];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-3">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">Control what's in the attention window, control perception.</motion.p>

          <div className="flex items-center justify-center gap-4 mb-8">
            {phases.map((phase, i) => (
              <React.Fragment key={i}>
                <motion.div animate={{ scale: activePhase === i ? 1.05 : 0.95, opacity: activePhase === i ? 1 : 0.5 }}
                  style={{ background: activePhase === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', border: activePhase === i ? `2px solid ${phase.color}` : '2px solid #e5e5e5', boxShadow: activePhase === i ? `0 0 20px ${phase.color}30` : 'none' }}
                  className="rounded-xl p-4 text-center w-40 transition-all duration-500">
                  <p className={`text-xs font-bold uppercase tracking-wider mb-2 ${activePhase === i ? 'text-white' : 'text-neutral-500'}`}>{phase.label}</p>
                  <div className="space-y-1">
                    {phase.examples.slice(0, 2).map((ex, j) => (
                      <p key={j} className={`text-xs ${activePhase === i ? 'text-neutral-300' : 'text-neutral-600'}`}>{ex}</p>
                    ))}
                  </div>
                </motion.div>
                {i < 2 && (
                  <motion.div animate={{ x: [0, 5, 0] }} transition={{ duration: 1.5, repeat: Infinity }} className="text-neutral-300">
                    <Icons.ArrowRightCircle />
                  </motion.div>
                )}
              </React.Fragment>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}
            className="rounded-xl p-5 text-center">
            <p className="text-cyan-400 font-bold mb-2">The Golden Rule</p>
            <p className="text-neutral-300 text-sm">Whatever you want them to feel about your offer, make them feel it FIRST.</p>
          </motion.div>
        </div>
      );
    };

    // Touchpoint Flow Slide
    const TouchpointFlowSlide = ({ data }) => {
      const [activeStep, setActiveStep] = useState(0);
      useEffect(() => {
        const interval = setInterval(() => {
          setActiveStep(prev => (prev + 1) % 4);
        }, 2000);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="flex items-center justify-center gap-2 md:gap-4">
            {TOUCHPOINT_SEQUENCE.map((touch, i) => {
              const IconComp = IconComponents[touch.icon];
              return (
                <React.Fragment key={i}>
                  <motion.div animate={{ scale: activeStep === i ? 1.1 : 1, opacity: activeStep === i ? 1 : 0.6 }}
                    style={{ background: activeStep === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5', border: activeStep === i ? `2px solid ${touch.color}` : '2px solid #e5e5e5', boxShadow: activeStep === i ? `0 0 25px ${touch.color}30` : 'none' }}
                    className="rounded-xl p-4 text-center transition-all duration-500 w-28 md:w-36">
                    <div className={`w-10 h-10 rounded-lg mx-auto mb-2 flex items-center justify-center ${activeStep === i ? 'text-white' : 'text-neutral-500'}`}
                      style={{ background: activeStep === i ? touch.color : '#e5e5e5' }}>
                      {IconComp && <IconComp />}
                    </div>
                    <p className={`font-bold text-sm mb-1 ${activeStep === i ? 'text-white' : 'text-neutral-700'}`}>{touch.stage}</p>
                    <p className={`text-xs ${activeStep === i ? 'text-neutral-300' : 'text-neutral-500'}`}>{touch.prime}</p>
                  </motion.div>
                  {i < 3 && (
                    <motion.div animate={{ x: activeStep > i ? [0, 5, 0] : 0 }} transition={{ duration: 0.5 }} className="text-neutral-300 hidden md:block">
                      <Icons.ArrowRightCircle />
                    </motion.div>
                  )}
                </React.Fragment>
              );
            })}
          </div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
            className="text-center text-neutral-500 text-sm mt-8 italic">
            Each touchpoint primes the next. By the time they see the price, they're already sold.
          </motion.p>
        </div>
      );
    };

    // Impact Stats Slide
    const ImpactStatsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-6">
          {IMPACT_STATS.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(8, 145, 178, 0.15)' }}
              className="rounded-2xl p-6 text-center relative overflow-hidden">
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <p className="text-4xl md:text-5xl font-bold text-white mb-2">
                <AnimatedCounter target={stat.value} suffix={stat.suffix} />
              </p>
              <p className="font-bold text-cyan-400 mb-1">{stat.label}</p>
              <p className="text-neutral-500 text-sm">{stat.subtext}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Elite Insight Slide
    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
          style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 60px rgba(8, 145, 178, 0.2)' }}
          className="rounded-2xl p-8 text-center relative overflow-hidden w-full">
          <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
          <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="w-16 h-16 rounded-2xl mx-auto mb-6 flex items-center justify-center text-white"
            style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
            <Icons.Lightbulb />
          </motion.div>
          <motion.h3 initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="text-2xl md:text-3xl font-bold text-white mb-4">{data.title}</motion.h3>
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="text-neutral-300 text-lg leading-relaxed">{data.insight}</motion.p>
        </motion.div>
      </div>
    );

    // ============ STANDARD SLIDES ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);
      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
        </div>
        {data.personImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-[5%] z-0 pointer-events-none" style={{ height: '45%', maxHeight: '350px' }}>
            <img src={data.personImage} alt={data.personName || ''} className="h-full w-auto object-contain object-bottom" />
          </motion.div>
        )}
      </div>
    );

    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Real Example</span>
          <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-red-50 border-2 border-red-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div><span className="font-semibold text-red-700 text-sm">{data.before.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed italic">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="bg-green-50 border-2 border-green-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white"><Icons.Check /></div><span className="font-semibold text-green-700 text-sm">{data.after.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed italic">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-neutral-900 rounded-xl p-4 text-center">
          <p className="text-neutral-300 text-sm">{data.insight}</p>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;
      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);
      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand Pre-Suasion: the art of winning the sale before the pitch even starts. Control what they see BEFORE your offer, and you control their perception.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ SLIDES DATA ============
    const slides = [
      { type: 'welcome', learningGoals: ['Why what happens BEFORE your offer matters more than the offer itself', 'The wine store experiment that proves priming works', 'How to "set the stage" so customers are ready to buy'] },
      { type: 'hook', headline: 'A wine store played French music. French wine sales jumped 5x. German music? German wine sales spiked.', subtext: 'The customers had no idea the music influenced them. When asked, they gave logical reasons: "I just felt like French wine today." But their decision was made BEFORE they looked at the bottles. The music primed their brain. This is Pre-Suasion: winning the sale before the pitch even starts.' },
      { type: 'wine-experiment', title: 'The Wine Store Experiment' },
      { type: 'content', title: 'What Is Pre-Suasion?', body: 'Pre-Suasion is the art of framing your customer\'s mindset BEFORE they encounter your offer. It\'s not about what you say during the pitch - it\'s about what happens in the moments leading up to it. Robert Cialdini discovered that the highest-performing persuaders spend more time preparing their audience than actually presenting. They "set the stage" so the customer arrives at the offer already leaning toward "yes."', personImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Robert+Cialdini-removebg-preview.png', personName: 'Robert Cialdini' },
      { type: 'content', title: 'Why It Works: Priming', body: 'Your brain uses recent experiences to interpret new information. If you just saw images of clouds, you\'ll rate things as "lighter." If you just thought about money, you become more self-focused. This is called priming. The first thing you expose someone to colors EVERYTHING that comes after. In marketing, what your customer sees right before your offer shapes how they perceive it. The offer hasn\'t changed - but their perception has.' },
      { type: 'priming-tactics', title: 'Pre-Suasion In Action' },
      { type: 'example', scenario: 'Furniture Store Landing Page', before: { label: 'No Pre-Suasion', text: 'Homepage shows: Product catalog → Price list → "Shop Now" button. Cold. Transactional. Customer is in analytical mode.' }, after: { label: 'Pre-Suasion Applied', text: 'Homepage shows: Video of family on couch, laughing → "Where memories are made" → Products. Customer is in emotional mode.' }, insight: 'The products are identical. But the family video primed them to see furniture as "memory-making investments."' },
      { type: 'attention-window', title: 'The Attention Window' },
      { type: 'touchpoint-flow', title: 'Pre-Suasion Touchpoints' },
      { type: 'example', scenario: 'Online Course Sales Page', before: { label: 'Standard Flow', text: '"Course Curriculum → Pricing → Checkout" - Customer sees price and thinks: "Is this worth $497?"' }, after: { label: 'Pre-Suasion Flow', text: '"Student Success Stories → Earnings Calculator → Pricing" - Customer thinks: "This could make me $10K, only $497?"' }, insight: 'Same price. But showing earning potential RIGHT BEFORE primes them to see cost as investment.' },
      { type: 'impact-stats', title: 'The Pre-Suasion Effect' },
      { type: 'elite-insight', title: 'The Pre-Suasion Paradox', insight: 'The best persuaders don\'t focus on their pitch - they focus on what happens before it. Control the attention window, and the sale is made before your offer appears.' },
      { type: 'quiz', question: 'A skincare brand wants customers to perceive their $89 serum as "worth it." What should they show RIGHT BEFORE the price?', options: ['"Free shipping on orders over $50"', '"Ingredient list: Retinol, Vitamin C, Hyaluronic Acid"', '"Before/After photos + testimonial: \'I stopped spending $200/month on treatments\'"', '"30-day money-back guarantee"'], correctIndex: 2, feedback: { correct: 'Perfect! The before/after photos plus the "$200/month" reference primes the customer to evaluate $89 as a bargain compared to alternatives. This is Pre-Suasion: controlling what\'s in their mind RIGHT BEFORE they see the price.', incorrect: 'Not quite. The before/after photos + "$200/month" reference primes them to see $89 as a steal compared to alternatives. That\'s Pre-Suasion: placing the right reference point in their mind right before the price reveal.' }},
      { type: 'completion', sources: [] }
    ];

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE', slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'wine-experiment': return <WineExperimentSlide data={slide} />;
          case 'priming-tactics': return <PrimingTacticsSlide data={slide} />;
          case 'attention-window': return <AttentionWindowSlide data={slide} />;
          case 'touchpoint-flow': return <TouchpointFlowSlide data={slide} />;
          case 'impact-stats': return <ImpactStatsSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
