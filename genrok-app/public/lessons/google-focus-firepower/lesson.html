<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Focus Your Firepower on Bestsellers | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #f97316; --accent-dark: #ea580c; --accent-light: #fdba74; --accent-rgb: 249, 115, 22; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'google-focus-firepower',
      title: 'Focus Your Firepower on Bestsellers',
      description: 'Stop spreading thin - consolidate budget on winners',
      accentColor: '#f97316',
      duration: '4 min',
      nextLesson: { id: 'google-influencer-creative', title: 'Outsource Your Creative Genius', teaser: 'The scaling hack: hire influencers to create your ad content.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why spreading budget across many products starves the algorithm', 'How consolidating spend on bestsellers accelerates learning', 'The difference between cold traffic and remarketing strategies', 'Why winners generate the cash flow to expand profitably'] },
      { type: 'hook', headline: 'You have a $500 daily budget. Do you spread it across 50 products ($10 each) or concentrate it on your top 5 bestsellers ($100 each)? One feeds the algorithm. One starves it.', subtext: 'Small budgets spread thin give Google no data to optimize. Focused budgets on proven winners create a learning flywheel that compounds.' },
      { type: 'content', title: 'The Common Mistake: Spreading Too Thin', body: 'Here\'s what most entrepreneurs do wrong:\n\nThey have 50 products in their catalog. They want to give each product "a fair shot" at success. So they spread their $500 daily budget across all 50 products.\n\nResult: Each product gets $10/day.\n\nThe Problem:\n$10/day generates maybe 5 clicks. With a 2% conversion rate, that\'s 0.1 sales per day. Google\'s algorithm needs hundreds of conversions to optimize for time of day, audience demographics, device types, and placements.\n\nAt this rate, you\'ll wait months for meaningful optimization. Meanwhile, you\'re bleeding budget on products that may never be winners.\n\nThis is the slow death of spreading too thin.' },
      { type: 'mockup', title: 'The Budget Spread Problem', description: 'Spreading budget thin across many products gives each one too little data to optimize. The algorithm starves.', mockupType: 'budget-spread' },
      { type: 'content', title: 'The Pro\'s Edge: Consolidate on Winners', body: 'Here\'s what the pros do differently:\n\nThey identify their 3-5 bestselling products. The ones already proven to convert organically. Then they consolidate their entire cold traffic budget onto just these winners.\n\nResult: Each product gets $100-150/day.\n\nThe Benefit:\n$150/day generates 50-75 clicks. With a 2% conversion rate, that\'s 1-1.5 sales per day. Google gets meaningful data within weeks, not months.\n\nThe algorithm learns:\n• What time of day converts best\n• Which demographics respond\n• Which placements perform\n• Which devices convert\n\nOptimization compounds. Performance improves. You hit profitability faster.\n\nAnd here\'s the kicker: Profitable winners generate cash flow to test new products.' },
      { type: 'mockup', title: 'The Focused Budget Strategy', description: 'Consolidating budget on proven bestsellers gives the algorithm rich data to optimize quickly. Winners fund expansion.', mockupType: 'budget-focused' },
      { type: 'content', title: 'Cold Traffic vs Remarketing', body: 'Important distinction - this focused strategy applies to COLD TRAFFIC only.\n\nCold Traffic (New Customers):\nConsolidate budget on 3-5 bestsellers. Give Google rich data to optimize. Hit profitability faster. Generate cash flow.\n\nRemarketing (Warm Audiences):\nAdvertise your full catalog. These are people who already visited your store or engaged with your brand. They have higher intent. You can profitably show them variety.\n\nThe Strategy:\n1. Use cold traffic campaigns to acquire new customers profitably (bestsellers only)\n2. Use remarketing campaigns to maximize lifetime value (full catalog)\n3. Let winners from cold campaigns fund expansion into new products\n\nThis is how you scale sustainably without burning cash on unproven products.' },
      { type: 'quiz', question: 'Why should you consolidate cold traffic budget on bestsellers instead of spreading it across your full catalog?', options: ['It\'s cheaper to advertise fewer products', 'Focused spend gives Google rich data to optimize quickly, hitting profitability faster', 'Google charges more for advertising many products', 'Customers prefer stores with fewer products'], correctIndex: 1, feedback: { correct: 'Exactly right! When you consolidate budget on proven bestsellers, each product gets enough daily spend to generate meaningful conversion data. This allows Google\'s algorithm to optimize for time of day, demographics, placements, and devices much faster. You hit profitability on winners quickly, which generates cash flow to expand. Spreading thin starves the algorithm of data, delaying optimization for months.', incorrect: 'Not quite. The real reason is data volume for optimization. When you spread a small budget across many products, each one gets too few clicks and conversions for Google\'s algorithm to learn effectively. But when you consolidate on 3-5 bestsellers, each product gets enough daily data for rapid optimization. This accelerates profitability on winners, creating cash flow to test new products. Focus feeds the algorithm. Spreading starves it.' }},
      { type: 'completion', sources: [{ name: 'Google Ads - Smart Shopping Campaigns', url: 'https://support.google.com/google-ads/answer/7684791' }] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none" style={{ height: '30%', maxHeight: '200px', marginRight: '3%', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed whitespace-pre-line">{data.body}</motion.p>
      
        {data.characterVideo && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4, duration: 0.5 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-4' : 'right-4'} z-0 pointer-events-none`}
            style={{ height: '25%', maxHeight: '180px', marginBottom: '3%' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
      </div>
    );

    const MockupSlide = ({ data }) => {
      if (data.mockupType === 'budget-spread') {
        return (
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
            <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
            <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-sm text-neutral-600 text-center mb-8 max-w-2xl mx-auto">{data.description}</motion.p>
            <div className="relative w-full max-w-3xl mx-auto">
              <svg viewBox="0 0 500 350" className="w-full">
                <defs>
                  <linearGradient id="redGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stopColor="#ef4444" stopOpacity="0.8" />
                    <stop offset="100%" stopColor="#dc2626" stopOpacity="0.3" />
                  </linearGradient>
                </defs>

                {/* Title */}
                <text x="250" y="30" fontSize="14" fontWeight="700" textAnchor="middle" fill="#374151">Spreading Budget Thin</text>
                <text x="250" y="48" fontSize="11" textAnchor="middle" fill="#9ca3af">$500/day ÷ 50 products = $10 per product</text>

                {/* Watering can */}
                <motion.g initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}>
                  {/* Can body */}
                  <ellipse cx="250" cy="95" rx="25" ry="15" fill="#9ca3af" stroke="#6b7280" strokeWidth="2"/>
                  <rect x="225" y="85" width="50" height="40" fill="#9ca3af" stroke="#6b7280" strokeWidth="2" rx="5"/>
                  {/* Spout */}
                  <path d="M 275 100 L 295 95 L 295 105 Z" fill="#9ca3af" stroke="#6b7280" strokeWidth="2"/>
                  {/* Handle */}
                  <path d="M 225 95 Q 210 95 210 110 Q 210 115 215 115" stroke="#6b7280" strokeWidth="3" fill="none"/>
                  {/* Label */}
                  <text x="250" y="110" fontSize="9" fontWeight="600" textAnchor="middle" fill="#ffffff">$500</text>
                </motion.g>

                {/* Water droplets (many small drops) */}
                <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5, staggerChildren: 0.05 }}>
                  {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => (
                    <motion.path
                      key={i}
                      initial={{ opacity: 0, y: 0 }}
                      animate={{ opacity: [0, 1, 0.6], y: [0, 80, 80] }}
                      transition={{ delay: 0.6 + i * 0.1, duration: 1.2, repeat: Infinity, repeatDelay: 1 }}
                      d={`M ${240 + i * 7} 125 Q ${240 + i * 7} 130 ${240 + i * 7} 135 Q ${237 + i * 7} 135 ${237 + i * 7} 130 Z`}
                      fill="#93c5fd"
                      opacity="0.6"
                    />
                  ))}
                </motion.g>

                {/* Many small plants */}
                <motion.g initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.8 }}>
                  {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9].map((i) => (
                    <g key={i}>
                      {/* Pot */}
                      <rect x={70 + i * 38} y="260" width="25" height="30" fill="#e5e7eb" stroke="#9ca3af" strokeWidth="1" rx="2"/>
                      {/* Small plant */}
                      <circle cx={82.5 + i * 38} cy="255" r="8" fill="#86efac" opacity="0.4"/>
                      <rect x={80 + i * 38} y="250" width="5" height="15" fill="#22c55e" opacity="0.3" rx="1"/>
                      {/* Budget label */}
                      <text x={82.5 + i * 38} y="310" fontSize="7" textAnchor="middle" fill="#ef4444" fontWeight="600">$10</text>
                    </g>
                  ))}
                </motion.g>

                {/* Result label */}
                <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1.2 }}>
                  <rect x="150" y="325" width="200" height="20" fill="#fee2e2" stroke="#ef4444" strokeWidth="1" rx="4"/>
                  <text x="250" y="339" fontSize="10" fontWeight="700" textAnchor="middle" fill="#dc2626">Too little data = slow learning</text>
                </motion.g>
              </svg>
            </div>
          </div>
        );
      }

      if (data.mockupType === 'budget-focused') {
        return (
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
            <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
            <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-sm text-neutral-600 text-center mb-8 max-w-2xl mx-auto">{data.description}</motion.p>
            <div className="relative w-full max-w-3xl mx-auto">
              <svg viewBox="0 0 500 350" className="w-full">
                <defs>
                  <linearGradient id="orangeGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stopColor="#f97316" stopOpacity="0.9" />
                    <stop offset="100%" stopColor="#ea580c" stopOpacity="0.4" />
                  </linearGradient>
                  <linearGradient id="greenGradient" x1="0%" y1="0%" x2="0%" y2="100%">
                    <stop offset="0%" stopColor="#22c55e" stopOpacity="1" />
                    <stop offset="100%" stopColor="#16a34a" stopOpacity="0.7" />
                  </linearGradient>
                </defs>

                {/* Title */}
                <text x="250" y="30" fontSize="14" fontWeight="700" textAnchor="middle" fill="#374151">Focused Budget Strategy</text>
                <text x="250" y="48" fontSize="11" textAnchor="middle" fill="#ea580c">$500/day ÷ 5 bestsellers = $100 per product</text>

                {/* Watering can */}
                <motion.g initial={{ opacity: 0, y: -20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}>
                  {/* Can body - orange */}
                  <ellipse cx="250" cy="95" rx="30" ry="18" fill="url(#orangeGradient)" stroke="#ea580c" strokeWidth="2"/>
                  <rect x="220" y="83" width="60" height="50" fill="url(#orangeGradient)" stroke="#ea580c" strokeWidth="2" rx="6"/>
                  {/* Spout */}
                  <path d="M 280 103 L 305 98 L 305 110 Z" fill="url(#orangeGradient)" stroke="#ea580c" strokeWidth="2"/>
                  {/* Handle */}
                  <path d="M 220 100 Q 200 100 200 120 Q 200 127 207 127" stroke="#ea580c" strokeWidth="3" fill="none"/>
                  {/* Label */}
                  <text x="250" y="113" fontSize="10" fontWeight="700" textAnchor="middle" fill="#ffffff">$500</text>
                </motion.g>

                {/* Concentrated water stream */}
                <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}>
                  <motion.path
                    initial={{ opacity: 0, scaleY: 0 }}
                    animate={{ opacity: [0, 0.9, 0.9], scaleY: [0, 1, 1] }}
                    transition={{ delay: 0.6, duration: 1, repeat: Infinity, repeatDelay: 0.5 }}
                    d="M 175 125 Q 173 180 170 210"
                    stroke="#60a5fa"
                    strokeWidth="8"
                    fill="none"
                    opacity="0.7"
                    style={{ transformOrigin: 'top' }}
                  />
                </motion.g>

                {/* One big thriving plant */}
                <motion.g initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.8 }}>
                  {/* Big pot */}
                  <rect x="130" y="240" width="80" height="70" fill="#f97316" stroke="#ea580c" strokeWidth="2" rx="4"/>
                  <text x="170" y="280" fontSize="12" fontWeight="700" textAnchor="middle" fill="#ffffff">Bestseller</text>

                  {/* Large thriving plant */}
                  <motion.g
                    initial={{ scale: 0.3 }}
                    animate={{ scale: 1 }}
                    transition={{ delay: 1, duration: 0.6, type: 'spring' }}
                  >
                    {/* Main leaves */}
                    <ellipse cx="145" cy="210" rx="22" ry="28" fill="url(#greenGradient)"/>
                    <ellipse cx="170" cy="200" rx="28" ry="35" fill="url(#greenGradient)"/>
                    <ellipse cx="195" cy="210" rx="22" ry="28" fill="url(#greenGradient)"/>
                    {/* Stem */}
                    <rect x="165" y="220" width="10" height="30" fill="#16a34a" rx="2"/>
                    {/* Small top leaves */}
                    <circle cx="155" cy="195" r="12" fill="#4ade80"/>
                    <circle cx="185" cy="195" r="12" fill="#4ade80"/>
                    <circle cx="170" cy="185" r="15" fill="#22c55e"/>
                  </motion.g>

                  {/* Budget label */}
                  <text x="170" y="330" fontSize="11" fontWeight="700" textAnchor="middle" fill="#15803d">$100/day</text>
                </motion.g>

                {/* Small plants on the right (not watered) */}
                <motion.g initial={{ opacity: 0 }} animate={{ opacity: 0.3 }} transition={{ delay: 1.1 }}>
                  {[0, 1, 2, 3].map((i) => (
                    <g key={i}>
                      <rect x={280 + i * 45} y="270" width="30" height="35" fill="#e5e7eb" stroke="#d1d5db" strokeWidth="1" rx="2"/>
                      <circle cx={295 + i * 45} cy="265" r="10" fill="#86efac" opacity="0.3"/>
                      <text x={295 + i * 45} y="320" fontSize="8" textAnchor="middle" fill="#9ca3af">Next</text>
                    </g>
                  ))}
                </motion.g>

                {/* Result label */}
                <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1.3 }}>
                  <rect x="130" y="345" width="240" height="22" fill="#dcfce7" stroke="#22c55e" strokeWidth="2" rx="4"/>
                  <text x="250" y="360" fontSize="10" fontWeight="700" textAnchor="middle" fill="#15803d">Rich data = fast optimization = quick profits</text>
                </motion.g>
              </svg>
            </div>
          </div>
        );
      }
    };

    const QuizSlide = ({ data, onAnswer, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [answered, setAnswered] = useState(false);
      const handleSelect = (index) => {
        if (answered) return;
        setSelected(index);
        setAnswered(true);
        const isCorrect = index === data.correctIndex;
        const gif = isCorrect ? getRandomCelebrationGif() : getRandomEmpathyGif();
        onShowGif(gif, '50%', 'center');
        setTimeout(() => onHideGif(), 3000);
        onAnswer(isCorrect);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Knowledge Check</span>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>
          <div className="space-y-3 mb-6">
            {data.options.map((option, i) => (
              <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.05 }} onClick={() => handleSelect(i)} disabled={answered} className={`w-full text-left p-4 rounded-xl border-2 transition-all ${answered ? (i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-500 bg-red-50' : 'border-neutral-200 bg-neutral-50') : 'border-neutral-200 bg-white hover:border-orange-300 hover:bg-orange-50'}`}>
                <div className="flex items-center gap-3">
                  <div className={`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 ${answered ? (i === data.correctIndex ? 'bg-green-500' : i === selected ? 'bg-red-500' : 'bg-neutral-300') : 'bg-neutral-200'}`}>
                    {answered && i === data.correctIndex && <Icons.Check className="text-white" />}
                    {answered && i === selected && i !== data.correctIndex && <Icons.X className="text-white" />}
                  </div>
                  <span className="text-sm md:text-base text-neutral-700">{option}</span>
                </div>
              </motion.button>
            ))}
          </div>
          <AnimatePresence>
            {answered && (
              <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className={`rounded-xl p-4 ${selected === data.correctIndex ? 'bg-green-50 border-2 border-green-200' : 'bg-orange-50 border-2 border-orange-200'}`}>
                <p className="text-sm text-neutral-700 leading-relaxed">{selected === data.correctIndex ? data.feedback.correct : data.feedback.incorrect}</p>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center text-center px-6 py-10">
        <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', duration: 0.6 }}>
          <div className="w-20 h-20 rounded-full flex items-center justify-center mb-4 mx-auto" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
            <Icons.Check className="text-white" />
          </div>
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="slide-title text-3xl md:text-4xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="text-neutral-600 text-base md:text-lg mb-6 max-w-md">You now understand why consolidating budget on bestsellers accelerates optimization and profitability.</motion.p>
        {data.sources && data.sources.length > 0 && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-neutral-50 rounded-xl p-4 max-w-md w-full mb-6">
            <p className="text-xs uppercase tracking-wider text-neutral-400 mb-2">Sources</p>
            {data.sources.map((source, i) => (
              <a key={i} href={source.url} target="_blank" rel="noopener noreferrer" className="text-sm hover:underline block mb-1" style={{ color: 'var(--accent)' }}>{source.name}</a>
            ))}
          </motion.div>
        )}
        <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} onClick={() => window.location.href = '/dashboard'} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Back to Dashboard</motion.button>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(0);
      const [userName] = useState(getUserName());
      const [gif, setGif] = useState({ src: null, opacity: 0, side: 'center' });

      const showGif = useCallback((src, opacity, side) => { setGif({ src, opacity, side }); }, []);
      const hideGif = useCallback(() => { setGif(prev => ({ ...prev, opacity: 0 })); }, []);

      const nextSlide = useCallback(() => {
        if (currentSlide < slides.length - 1) {
          setDirection(1);
          setCurrentSlide(prev => prev + 1);
        }
      }, [currentSlide]);

      const prevSlide = useCallback(() => {
        if (currentSlide > 0) {
          setDirection(-1);
          setCurrentSlide(prev => prev - 1);
        }
      }, [currentSlide]);

      const startLesson = useCallback(() => {
        setDirection(1);
        setCurrentSlide(1);
      }, []);

      const handleAnswer = useCallback((correct) => {
        setTimeout(nextSlide, 3000);
      }, [nextSlide]);

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={startLesson} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'mockup': return <MockupSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onAnswer={handleAnswer} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return <ContentSlide data={slide} />;
        }
      };

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction}>
              <motion.div key={currentSlide} custom={direction} initial={{ opacity: 0, x: direction > 0 ? 100 : -100 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: direction > 0 ? -100 : 100 }} transition={{ duration: 0.3 }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {currentSlide > 0 && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome' && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => { setDirection(i > currentSlide ? 1 : -1); setCurrentSlide(i); }} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gif.src && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gif.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gif.opacity }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gif.src} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
