<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Operator's Dashboard | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #f97316; --accent-dark: #ea580c; --accent-light: #fb923c; --accent-rgb: 249, 115, 22; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'biz-ltv-cac-dashboard',
      title: 'The Operator\'s Dashboard',
      description: 'The LTV:CAC ratios that separate struggling businesses from unstoppable ones.',
      accentColor: '#f97316',
      duration: '6 min',
      nextLesson: { id: 'biz-ltv-levers', title: 'The LTV Control Panel', teaser: '7 levers to increase LTV and maximize customer profitability.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    // Per-slide bug reporting for admin users
    let __isAdmin = false;

    // Listen for admin status from parent
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') {
        __isAdmin = e.data.isAdmin;
      }
    });

    // Request admin status on load
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    // Admin Report Button Component
    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      // TEMP: if (!__isAdmin) return null; // TODO: restore before going live

      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button
          onClick={handleReport}
          title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{
            position: 'absolute',
            top: '12px',
            right: '12px',
            width: '32px',
            height: '32px',
            borderRadius: '8px',
            backgroundColor: 'rgba(239, 68, 68, 0.9)',
            color: 'white',
            border: 'none',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            opacity: 0.6,
            transition: 'opacity 0.2s, transform 0.2s',
            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
          }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/>
            <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/>
            <path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/>
            <path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============


    // welcomeAnimations and getTimeBasedWelcome are loaded from ../shared/greetings.js

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_above_head_world_champion_celebration_484bd560-f049-41ca-b3d1-c03d7468ab56_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_starting_with_slow_clap_accelerating_to_fast_c_ee478a38-0ee7-437d-bd13-d687f7dd624a_0.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_wiping_away_a_small_tear_sad_but_gentle_disapp_8d78571b-3c36-4502-abee-81683255843c_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_sighing_sadly_exhaling_with_disappointment_hea_f6014f2a-3a99-4378-a2a8-414e16b3e72d_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_slouching_with_disappointment_body_curling_inw_caedddbe-413c-492a-9fdf-1e8433f5e2a8_2%20(1).mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_placing_hand_on_forehead_sadly_eyes_closed_fru_3e048895-f365-4ff2-9e88-0d0a35b2a9e1_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_nodding_slowly_with_sadness_what_a_shame_expre_377f67ca-63da-41aa-9072-4926fc2f6e82_3.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['What LTV:CAC ratios actually mean for your business', 'The automation multiplier nobody talks about', 'Why CAC always rises over time (and what to do)'] },
      { type: 'hook', headline: 'Everyone asks: "What\'s a good LTV:CAC ratio?" The answer depends on how automated your business is.', subtext: 'A 3:1 ratio is amazing for fully automated businesses. But it\'s bankruptcy waiting to happen if you\'re manually fulfilling orders. The more people involved, the more profit padding you need. This is the operator\'s dashboard—the one metric that tells you if you\'re building a machine or digging a hole.'  },
      { type: 'content', title: 'What LTV:CAC Actually Measures', body: 'LTV is Lifetime Value—total profit from a customer over their entire relationship with you. CAC is Customer Acquisition Cost—what you spend to get one customer. The ratio tells you: for every dollar spent acquiring customers, how many dollars do you make back? A 3:1 ratio means you make $3 for every $1 spent. Simple math. Massive implications.' },
      { type: 'content', title: 'The Automation Multiplier', body: 'Fully automated businesses—lead gen, ecommerce with dropshipping, digital products—can run on thin margins. A 3:1 ratio works because there\'s no labor cost eating profits. But the moment you add people—customer service, manual fulfillment, personal delivery—you need more buffer. Why? Because people cost money. Lots of it.' },
      { type: 'automation-spectrum', title: 'LTV:CAC Targets by Automation Level' },
      { type: 'content', title: 'Why More People = Higher Ratio Needed', body: 'Manual businesses have human costs that eat into margins. Salaries. Training. Mistakes. Sick days. Turnover. These costs compound. A 3:1 ratio in a manual business means you\'re probably losing money once you factor in labor. That\'s why high-touch businesses need 9:1 or even 12:1 ratios to stay profitable.' },
      { type: 'example', scenario: 'Same LTV:CAC, Different Outcomes', before: { label: 'Automated Business (3:1)', text: 'Customer worth $300. CAC is $100. Profit: $200. No labor costs. Pure margin. Business scales effortlessly.' }, after: { label: 'Manual Business (3:1)', text: 'Customer worth $300. CAC is $100. Profit: $200. But labor eats $150. Real profit: $50. Barely surviving.' }, insight: 'The ratio means nothing without knowing your labor costs.' },
      { type: 'cards', title: 'LTV:CAC Benchmarks', items: [
        { title: '3:1+ Fully Automated', description: 'Lead generation, digital fulfillment, auto-everything. Minimal human touch. Runs while you sleep.' },
        { title: '6:1+ Mostly Automated', description: 'Two-thirds automated. Some customer service, light manual work. People involved but not dominant.' },
        { title: '9:1+ Partially Automated', description: 'One-third automated. High-touch service, manual fulfillment, lots of people. Labor-intensive.' },
        { title: '12:1+ Fully Manual', description: 'Everything done by hand. Custom services, personal delivery, human-heavy operations. Labor is everything.' }
      ]},
      { type: 'cac-rise', title: 'CAC Always Rises Over Time' },
      { type: 'content', title: 'The Real Dashboard', body: 'Smart operators watch LTV:CAC like a hawk. It\'s their health check. If the ratio drops, something broke. Maybe CAC spiked. Maybe LTV declined. Maybe both. This single metric tells you if your business model is working or dying. Everything else is noise. This is the signal.' },
      { type: 'dashboard-gauge', title: 'What the Ratios Mean' },
      { type: 'track-dashboard' },
      { type: 'cards', title: 'How to Improve Your Ratio', items: [
        { title: 'Increase LTV', description: 'Get customers to buy more often, spend more per order, and stay longer. This multiplies your profit per customer.' },
        { title: 'Decrease CAC', description: 'Better targeting, better creative, better conversion. Every dollar saved on acquisition drops straight to profit.' },
        { title: 'Automate More', description: 'Replace manual processes with systems. Every person removed from operations improves your margin and ratio.' }
      ], characterVideo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_climbing_a_ladder_progressgrowth_100_pure_whit_4fc6107a-c510-4afc-ac20-a4cf12e8180b_3.mp4', characterPosition: 'left'},
      { type: 'quiz', question: 'What LTV:CAC ratio is ideal for a fully automated ecommerce business?', options: ['1:1', '3:1+', '9:1+', '12:1+'], correctIndex: 1, feedback: { correct: 'Exactly. Fully automated businesses—digital products, lead gen, auto-fulfillment—can operate efficiently at 3:1 or higher. No labor costs means less profit padding needed. The lower the human involvement, the thinner the margins you can run.', incorrect: 'Not quite. Fully automated businesses can operate comfortably at 3:1 or higher. Since there\'s minimal labor cost, you don\'t need huge profit padding. Manual businesses need 9:1+ because people eat margins. Automation = efficiency.' }},
      { type: 'completion', sources: [] }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      Gauge: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 2a10 10 0 1 0 10 10"/><path d="M12 12l5-5"/><circle cx="12" cy="12" r="2"/></svg>,
      Users: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Settings: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>,
      TrendingUp: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      AlertTriangle: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      DollarSign: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Activity: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg> };

    // AnimatedCounter Component
    const AnimatedCounter = ({ value, suffix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(value);
        if (isNaN(end)) { setCount(value); return; }
        const stepTime = Math.abs(Math.floor(duration / end));
        const timer = setInterval(() => {
          start += 1;
          setCount(start);
          if (start >= end) { clearInterval(timer); setCount(end); }
        }, stepTime);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{typeof count === 'number' ? count : value}{suffix}</span>;
    };

    // ============ CUSTOM SLIDE COMPONENTS ============

    // Dashboard Gauge Slide - Animated gauge showing LTV:CAC ratio zones
    const DashboardGaugeSlide = ({ data }) => {
      const [gaugeValue, setGaugeValue] = useState(0);
      const [activeZone, setActiveZone] = useState(null);

      useEffect(() => {
        const timers = [
          setTimeout(() => { setGaugeValue(2); setActiveZone('danger'); }, 500),
          setTimeout(() => { setGaugeValue(4); setActiveZone('warning'); }, 1500),
          setTimeout(() => { setGaugeValue(6); setActiveZone('target'); }, 2500),
          setTimeout(() => { setGaugeValue(9); setActiveZone('winning'); }, 3500)
        ];
        return () => timers.forEach(t => clearTimeout(t));
      }, []);

      const zones = [
        { id: 'danger', label: 'Below 3:1', status: 'DANGER', color: '#ef4444', desc: 'Losing money' },
        { id: 'warning', label: '3:1 - 5:1', status: 'WARNING', color: '#f59e0b', desc: 'Thin margins' },
        { id: 'target', label: '6:1', status: 'TARGET', color: '#f97316', desc: 'Comfortable scale' },
        { id: 'winning', label: '9:1+', status: 'WINNING', color: '#22c55e', desc: 'Printing money' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto bg-white">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
            The Operator's Dashboard
          </motion.h2>

          {/* Gauge Display */}
          <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="flex justify-center mb-8">
            <div style={{
              width: '200px',
              height: '120px',
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              borderRadius: '16px',
              padding: '20px',
              position: 'relative',
              boxShadow: '0 10px 40px rgba(0,0,0,0.3)'
            }}>
              <div style={{ position: 'absolute', top: '8px', left: '0', right: '0', height: '6px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="text-center">
                <p style={{ color: '#888', fontSize: '10px', textTransform: 'uppercase', letterSpacing: '2px', marginBottom: '8px' }}>LTV:CAC Ratio</p>
                <motion.div
                  animate={{ scale: [1, 1.1, 1] }}
                  transition={{ duration: 0.5, repeat: Infinity, repeatDelay: 2 }}
                  style={{ fontSize: '48px', fontWeight: 'bold', color: zones.find(z => z.id === activeZone)?.color || '#fff' }}>
                  {gaugeValue}:1
                </motion.div>
                <motion.p
                  key={activeZone}
                  initial={{ opacity: 0 }}
                  animate={{ opacity: 1 }}
                  style={{ color: zones.find(z => z.id === activeZone)?.color || '#888', fontSize: '12px', fontWeight: '600' }}>
                  {zones.find(z => z.id === activeZone)?.status || 'CALCULATING...'}
                </motion.p>
              </div>
            </div>
          </motion.div>

          {/* Zone Cards */}
          <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
            {zones.map((zone, i) => (
              <motion.div
                key={zone.id}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: 1, y: 0, scale: activeZone === zone.id ? 1.05 : 1 }}
                transition={{ delay: 0.3 + i * 0.1 }}
                style={{
                  background: activeZone === zone.id ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#f5f5f5',
                  borderRadius: '12px',
                  padding: '16px',
                  textAlign: 'center',
                  border: activeZone === zone.id ? `2px solid ${zone.color}` : '2px solid transparent',
                  boxShadow: activeZone === zone.id ? `0 0 20px ${zone.color}30` : 'none',
                  transition: 'all 0.3s ease'
                }}>
                <div style={{ fontSize: '18px', fontWeight: 'bold', color: zone.color, marginBottom: '4px' }}>{zone.label}</div>
                <div style={{ fontSize: '10px', fontWeight: '600', color: activeZone === zone.id ? '#fff' : '#666', textTransform: 'uppercase', letterSpacing: '1px' }}>{zone.status}</div>
                <div style={{ fontSize: '11px', color: activeZone === zone.id ? '#aaa' : '#888', marginTop: '4px' }}>{zone.desc}</div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // Automation Spectrum Slide - Visual spectrum from fully automated to manual
    const AutomationSpectrumSlide = ({ data }) => {
      const [activeLevel, setActiveLevel] = useState(0);

      useEffect(() => {
        const interval = setInterval(() => {
          setActiveLevel(prev => (prev + 1) % 4);
        }, 2000);
        return () => clearInterval(interval);
      }, []);

      const levels = [
        { ratio: '3:1+', label: 'Fully Automated', icon: 'Settings', color: '#22c55e', humans: 0, desc: 'Digital, lead gen, auto-fulfill. Runs while you sleep.' },
        { ratio: '6:1+', label: 'Mostly Automated', icon: 'Settings', color: '#3b82f6', humans: 1, desc: '2/3 automated, some manual. Light human touch.' },
        { ratio: '9:1+', label: 'Partially Automated', icon: 'Users', color: '#f97316', humans: 2, desc: '1/3 automated, lots of people. Labor-intensive.' },
        { ratio: '12:1+', label: 'Fully Manual', icon: 'Users', color: '#ef4444', humans: 3, desc: 'Everything by hand. Custom, personal, human-heavy.' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto bg-white">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            LTV:CAC by Automation Level
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }}
            className="text-neutral-500 text-center text-sm mb-6">
            More people = higher ratio needed
          </motion.p>

          <div className="space-y-3">
            {levels.map((level, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, x: -30 }}
                animate={{ opacity: 1, x: 0, scale: activeLevel === i ? 1.02 : 1 }}
                transition={{ delay: 0.2 + i * 0.1 }}
                style={{
                  background: activeLevel === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#fff',
                  border: activeLevel === i ? `2px solid ${level.color}` : '2px solid #e5e5e5',
                  borderRadius: '16px',
                  padding: '16px 20px',
                  display: 'flex',
                  alignItems: 'center',
                  gap: '16px',
                  boxShadow: activeLevel === i ? `0 0 25px ${level.color}25` : 'none',
                  transition: 'all 0.3s ease'
                }}>
                {/* Ratio Badge */}
                <div style={{
                  background: `linear-gradient(135deg, ${level.color}, ${level.color}dd)`,
                  borderRadius: '12px',
                  padding: '12px 16px',
                  minWidth: '80px',
                  textAlign: 'center'
                }}>
                  <div style={{ color: '#fff', fontWeight: 'bold', fontSize: '20px' }}>{level.ratio}</div>
                </div>

                {/* Content */}
                <div style={{ flex: 1 }}>
                  <div style={{ color: activeLevel === i ? '#fff' : '#1a1a1a', fontWeight: '600', fontSize: '16px', marginBottom: '4px' }}>
                    {level.label}
                  </div>
                  <div style={{ color: activeLevel === i ? '#aaa' : '#666', fontSize: '12px' }}>
                    {level.desc}
                  </div>
                </div>

                {/* Human Icons */}
                <div style={{ display: 'flex', gap: '4px' }}>
                  {[...Array(3)].map((_, j) => (
                    <div key={j} style={{
                      width: '24px',
                      height: '24px',
                      borderRadius: '50%',
                      background: j < level.humans ? level.color : (activeLevel === i ? '#444' : '#ddd'),
                      display: 'flex',
                      alignItems: 'center',
                      justifyContent: 'center',
                      transition: 'all 0.3s ease'
                    }}>
                      <Icons.Users style={{ width: '14px', height: '14px', color: j < level.humans ? '#fff' : '#999' }} />
                    </div>
                  ))}
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // TrackYourDashboardSlide - How to actually track LTV:CAC
    const TrackYourDashboardSlide = () => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto bg-white">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>How To Do It</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Track Your Own LTV:CAC</h2>
            <p className="text-neutral-500 text-sm mt-2">Two ways to build your operator dashboard</p>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4">
            {/* Manual Method */}
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #94a3b8, transparent)' }} />
              <div className="flex items-center gap-2 mb-4">
                <span className="text-neutral-400 font-semibold text-sm">Option A: Spreadsheet</span>
                <span className="text-xs px-2 py-0.5 bg-neutral-700 text-neutral-400 rounded">Complex</span>
              </div>
              <div className="space-y-2">
                {['Export all orders monthly', 'Calculate revenue per customer', 'Track over time for LTV', 'Pull ad spend for CAC', 'Build formulas & update weekly'].map((step, i) => (
                  <p key={i} className="text-neutral-400 text-xs flex items-start gap-2">
                    <span className="text-neutral-500 font-mono">{i + 1}.</span>{step}
                  </p>
                ))}
              </div>
              <div className="mt-4 pt-3 border-t border-neutral-700">
                <p className="text-neutral-500 text-xs">Prone to errors. Constant maintenance.</p>
              </div>
            </motion.div>

            {/* Automated Method */}
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', position: 'relative', overflow: 'hidden', border: '2px solid var(--accent)' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="flex items-center gap-2 mb-4">
                <span className="font-semibold text-sm" style={{ color: 'var(--accent)' }}>Option B: Auto-Dashboard</span>
                <span className="text-xs px-2 py-0.5 rounded" style={{ background: 'rgba(var(--accent-rgb), 0.2)', color: 'var(--accent)' }}>Real-time</span>
              </div>
              <div className="space-y-2 mb-4">
                {['Install DataDrew (free)', 'Syncs your Shopify data', 'Auto-calculates LTV per customer', 'See cohort LTV over time'].map((step, i) => (
                  <p key={i} className="text-neutral-300 text-xs flex items-start gap-2">
                    <span style={{ color: 'var(--accent)' }} className="font-mono">{i + 1}.</span>{step}
                  </p>
                ))}
              </div>
              <a href="https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva" target="_blank" rel="noopener noreferrer"
                className="inline-flex items-center gap-1.5 text-xs font-medium px-3 py-1.5 rounded-lg transition-opacity hover:opacity-80"
                style={{ background: 'var(--accent)', color: 'white' }}>
                Get DataDrew (Free)
                <Icons.ExternalLink />
              </a>
            </motion.div>
          </div>

          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}
            className="text-center text-neutral-500 text-xs mt-5">
            DataDrew auto-tracks LTV by customer segment, cohort, and product category.
          </motion.p>
        </div>
      );
    };

    // CAC Rise Visualizer - Shows CAC always rises over time
    const CACRiseVisualizerSlide = ({ data }) => {
      const [currentYear, setCurrentYear] = useState(0);

      useEffect(() => {
        const interval = setInterval(() => {
          setCurrentYear(prev => prev < 3 ? prev + 1 : prev);
        }, 1000);
        return () => clearInterval(interval);
      }, []);

      const years = [
        { year: '2021', cac: 20, color: '#22c55e' },
        { year: '2022', cac: 35, color: '#3b82f6' },
        { year: '2023', cac: 55, color: '#f97316' },
        { year: '2024', cac: 80, color: '#ef4444' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto bg-white">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            CAC Always Rises Over Time
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }}
            className="text-neutral-500 text-center text-sm mb-8">
            This is inevitable. Your ratio must account for it.
          </motion.p>

          {/* Timeline Visualization */}
          <div className="flex items-end justify-center gap-4 mb-6" style={{ height: '180px' }}>
            {years.map((y, i) => (
              <motion.div
                key={i}
                initial={{ height: 0 }}
                animate={{ height: i <= currentYear ? `${(y.cac / 80) * 150}px` : '20px' }}
                transition={{ duration: 0.8, delay: i * 0.2 }}
                style={{
                  width: '60px',
                  background: i <= currentYear ? `linear-gradient(135deg, ${y.color}, ${y.color}dd)` : '#e5e5e5',
                  borderRadius: '8px 8px 0 0',
                  position: 'relative',
                  boxShadow: i <= currentYear ? `0 0 20px ${y.color}40` : 'none'
                }}>
                <motion.div
                  initial={{ opacity: 0 }}
                  animate={{ opacity: i <= currentYear ? 1 : 0.3 }}
                  style={{
                    position: 'absolute',
                    top: '-40px',
                    left: '50%',
                    transform: 'translateX(-50%)',
                    textAlign: 'center'
                  }}>
                  <div style={{ fontWeight: 'bold', fontSize: '18px', color: i <= currentYear ? y.color : '#ccc' }}>${y.cac}</div>
                  <div style={{ fontSize: '11px', color: '#888' }}>CAC</div>
                </motion.div>
                <div style={{
                  position: 'absolute',
                  bottom: '-30px',
                  left: '50%',
                  transform: 'translateX(-50%)',
                  fontSize: '12px',
                  fontWeight: '600',
                  color: i <= currentYear ? '#1a1a1a' : '#ccc'
                }}>{y.year}</div>
              </motion.div>
            ))}
          </div>

          {/* Insight Card */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: currentYear >= 3 ? 1 : 0.5, y: 0 }}
            transition={{ delay: 0.5 }}
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              borderRadius: '16px',
              padding: '20px',
              marginTop: '40px',
              textAlign: 'center'
            }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)', borderRadius: '16px 16px 0 0' }} />
            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', gap: '12px' }}>
              <Icons.TrendingUp style={{ color: '#ef4444', width: '24px', height: '24px' }} />
              <div>
                <p style={{ color: '#fff', fontWeight: '600', fontSize: '16px' }}>
                  {currentYear >= 3 ? '4x increase in 4 years' : 'Watch CAC climb...'}
                </p>
                <p style={{ color: '#888', fontSize: '12px' }}>
                  A healthy ratio gives you room to absorb rising costs
                </p>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.characterVideo && (
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3, duration: 0.6 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none hidden md:block`}
            style={{ height: '52%', maxHeight: '400px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    
    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6 relative z-10">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed relative z-10">{data.body}</motion.p>
      
        {data.characterVideo && (
          <motion.div
            initial={{ opacity: 0, y: 40 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4, duration: 0.6 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none`}
            style={{ height: '35%', maxHeight: '280px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
      </div>
    );

    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Real Example</span>
          <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4 mb-6 relative z-10">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-green-50 border-2 border-green-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-green-500 flex items-center justify-center text-white"><Icons.Check /></div><span className="font-semibold text-green-700 text-sm">{data.before.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed italic">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="bg-red-50 border-2 border-red-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-3"><div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div><span className="font-semibold text-red-700 text-sm">{data.after.label}</span></div>
            <p className="text-neutral-700 text-sm leading-relaxed italic">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-neutral-900 rounded-xl p-4 text-center">
          <p className="text-neutral-300 text-sm"><Icons.Zap className="inline mr-2" />{data.insight}</p>
        </motion.div>
      </div>
    );

    const VisualSlide = ({ data }) => {
      if (data.visualType === 'comparison') {
        return (
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
            <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
            <div className="grid grid-cols-3 gap-3 md:gap-6">
              <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="bg-neutral-100 rounded-xl p-4 md:p-6 text-center">
                <div className="text-3xl md:text-4xl font-bold mb-2" style={{ color: data.data.left.color }}>{data.data.left.value}</div>
                <div className="text-xs md:text-sm font-semibold text-neutral-700 mb-2">{data.data.left.label}</div>
                <div className="text-[10px] md:text-xs text-neutral-500">{data.data.left.result}</div>
              </motion.div>
              <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="rounded-xl p-4 md:p-6 text-center transform scale-105 shadow-lg" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>
                <div className="text-3xl md:text-4xl font-bold text-white mb-2">{data.data.center.value}</div>
                <div className="text-xs md:text-sm font-semibold text-white/90 mb-2">{data.data.center.label}</div>
                <div className="text-[10px] md:text-xs text-white/70">{data.data.center.result}</div>
              </motion.div>
              <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-neutral-100 rounded-xl p-4 md:p-6 text-center">
                <div className="text-3xl md:text-4xl font-bold mb-2" style={{ color: data.data.right.color }}>{data.data.right.value}</div>
                <div className="text-xs md:text-sm font-semibold text-neutral-700 mb-2">{data.data.right.label}</div>
                <div className="text-[10px] md:text-xs text-neutral-500">{data.data.right.result}</div>
              </motion.div>
            </div>
          </div>
        );
      }
      if (data.visualType === 'stats') {
        return (
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
            <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
            <div className="grid md:grid-cols-3 gap-4">
              {data.data.map((stat, i) => (
                <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="bg-neutral-900 rounded-xl p-6 text-center">
                  <div className="text-4xl md:text-5xl font-bold mb-2" style={{ color: 'var(--accent)' }}>{stat.value}</div>
                  <div className="text-sm font-semibold text-white mb-1">{stat.label}</div>
                  <div className="text-xs text-neutral-400">{stat.subtext}</div>
                </motion.div>
              ))}
            </div>
          </div>
        );
      }
      return null;
    };

    const CardsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className={`grid gap-3 relative z-10 ${data.items.length === 5 ? 'md:grid-cols-3' : data.items.length === 3 ? 'md:grid-cols-3' : data.items.length === 4 ? 'md:grid-cols-2' : 'md:grid-cols-2'}`}>
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.06 }} className="bg-white border-2 border-neutral-200 rounded-xl p-4 hover:border-neutral-300 transition-colors">
              <h3 className="font-bold text-neutral-900 mb-2 text-sm md:text-base">{item.title}</h3>
              <p className="text-neutral-600 text-xs md:text-sm leading-relaxed">{item.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6 relative z-10">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand the operator\'s dashboard. LTV:CAC ratios depend on automation. More people = higher ratio needed. This is the metric that tells you if your business model works.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      // Send slide update to parent for admin issue tracking
      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'visual': return <VisualSlide data={slide} />;
          case 'cards': return <CardsSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          case 'dashboard-gauge': return <DashboardGaugeSlide data={slide} />;
          case 'track-dashboard': return <TrackYourDashboardSlide />;
          case 'automation-spectrum': return <AutomationSpectrumSlide data={slide} />;
          case 'cac-rise': return <CACRiseVisualizerSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
