<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Complete Meta Ads Campaign Structure | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #3b82f6; --accent-dark: #2563eb; --accent-light: #60a5fa; --accent-rgb: 59, 130, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'meta-1-1-x-structure',
      title: 'The Complete Campaign Structure',
      description: 'The 3-phase Meta Ads strategy: Testing, Scaling, and Remarketing.',
      accentColor: '#3b82f6',
      duration: '9 min',
      nextLesson: { id: 'meta-auction-formula', title: 'The Auction Formula', teaser: 'The exact equation Meta uses to decide who wins every ad auction.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    // Per-slide bug reporting for admin users
    let __isAdmin = false;

    // Listen for admin status from parent
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') {
        __isAdmin = e.data.isAdmin;
      }
    });

    // Request admin status on load
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    // Admin Report Button Component
    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      // TEMP: if (!__isAdmin) return null; // TODO: restore before going live

      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button
          onClick={handleReport}
          title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{
            position: 'absolute',
            top: '12px',
            right: '12px',
            width: '32px',
            height: '32px',
            borderRadius: '8px',
            backgroundColor: 'rgba(239, 68, 68, 0.9)',
            color: 'white',
            border: 'none',
            cursor: 'pointer',
            display: 'flex',
            alignItems: 'center',
            justifyContent: 'center',
            zIndex: 1000,
            opacity: 0.6,
            transition: 'opacity 0.2s, transform 0.2s',
            boxShadow: '0 2px 8px rgba(0,0,0,0.15)'
          }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}
        >
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/>
            <path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/>
            <path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/>
            <path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/>
            <path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/>
            <path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============


    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // Clean SVG Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      ArrowDown: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Beaker: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/></svg>,
      TrendingUp: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Users: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Target: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      DollarSign: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Folder: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"/></svg>,
      Layers: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
      Image: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>,
      Star: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Crown: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
      Heart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
      Globe: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>,
      ExternalLink: () => <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Sparkles: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      ChevronRight: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      Repeat: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="17 1 21 5 17 9"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/><polyline points="7 23 3 19 7 15"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: ['Phase 1: Creative Testing with ABO (find winners fast)', 'Phase 2: Scaling Campaign with CBO (7 strategic ad sets)', 'Remarketing: Always-on (Web 180D + Video 50%)'] },
      { type: 'hook', headline: 'One structure does NOT fit all.', subtext: 'The biggest mistake? Using the same campaign structure for testing AND scaling. Testing requires isolation. Scaling requires consolidation. Mix them up and you waste budget on both. Let me show you the exact structure top media buyers use.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Meta_Platforms_Inc._logo_(cropped).svg.png', brandName: 'Meta' },
      { type: 'overview', title: 'The Campaign Strategy', phases: [
        { number: 1, name: 'Creative Testing', type: 'ABO', goal: 'Find winners fast', icon: 'Beaker', color: '#f59e0b' },
        { number: 2, name: 'Scaling', type: 'CBO', goal: 'Maximize winners', icon: 'TrendingUp', color: '#10b981' }
      ], remarketing: { audience: 'Web 180D + Video 50%', note: 'Runs ALWAYS in separate campaign' }},
      { type: 'phase-header', phase: 1, title: 'Creative Testing', subtitle: 'Find your winners before you scale', budgetType: 'ABO', color: '#f59e0b' },
      { type: 'testing-structure', title: 'Phase 1: Creative Testing Structure', description: 'One creative per ad set. Identical targeting. Let the creative be the only variable.' },
      { type: 'content', title: 'Why ABO for Testing?', body: 'Ad Set Budget Optimization (ABO) gives each creative equal opportunity. With CBO, Meta might dump all budget into one ad set before others get a fair chance. ABO forces equal distribution. Every creative gets tested. No premature winners or losers.' },
      { type: 'testing-rules', title: 'Creative Testing Rules', rules: [
        { rule: 'One creative per ad set', why: 'Isolate the variable. Know exactly what won.' },
        { rule: 'Identical targeting across all ad sets', why: 'Broad interests, largest possible audience. Let creative do the targeting.' },
        { rule: 'Equal budget per ad set', why: 'ABO ensures fair testing. No favoritism.' },
        { rule: 'Test 4-10 creatives at once', why: 'More tests = faster learnings = faster scaling.' }
      ]},
      { type: 'phase-header', phase: 2, title: 'Scaling Campaign', subtitle: 'Maximize your proven winners', budgetType: 'CBO', color: '#10b981' },
      { type: 'scaling-structure', title: 'Phase 2: Scaling Structure (CBO)', description: 'One campaign. Seven strategic ad sets. All winning creatives in each.' },
      { type: 'adset-breakdown', title: 'The 7 Scaling Ad Sets', adsets: [
        { name: 'Top 10% Spenders', description: 'Your highest-value customers', icon: 'Crown', free: true, link: 'https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva' },
        { name: 'Top 25% Spenders', description: 'Strong repeat buyers', icon: 'Star', free: true, link: 'https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva' },
        { name: 'RFM Segments', description: 'Champion, Loyal, Promising', icon: 'Heart', free: true, link: 'https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva' },
        { name: '5% Purchase Lookalike', description: 'Clone your best buyers', icon: 'Users', free: false },
        { name: '6-8 Winning Interests', description: 'Winners from testing phase', icon: 'Target', free: false },
        { name: 'Open Targeting', description: 'No interests, no demographics', icon: 'Globe', free: false },
        { name: 'Advantage+ Targeting', description: 'Let Meta find buyers', icon: 'Sparkles', free: false }
      ]},
      { type: 'content', title: 'Why CBO for Scaling?', body: 'Campaign Budget Optimization (CBO) lets Meta shift budget to whoever is performing best RIGHT NOW. Your Top 10% might crush it Monday, but Open Targeting wins Tuesday. CBO adapts in real-time. You set the budget once. Meta optimizes 24/7.' },
      { type: 'scaling-visual', title: 'Scaling Campaign Visual', subtitle: 'All winning creatives live under EVERY ad set' },
      { type: 'comparison', title: 'Testing vs Scaling: The Key Difference', items: [
        { aspect: 'Budget Type', testing: 'ABO (equal distribution)', scaling: 'CBO (dynamic allocation)' },
        { aspect: 'Ad Sets', testing: 'Multiple identical (1 creative each)', scaling: '7 strategic audiences' },
        { aspect: 'Creatives', testing: '1 unique creative per ad set', scaling: 'ALL winners in EVERY ad set' },
        { aspect: 'Goal', testing: 'Find what works', scaling: 'Maximize what works' },
        { aspect: 'Targeting', testing: 'Broad, identical across all', scaling: 'Segmented by value/intent' }
      ]},
      { type: 'quiz', question: 'You have 5 new creatives to test. What structure should you use?', options: ['1 CBO campaign with 5 creatives in 1 ad set', '1 ABO campaign with 5 ad sets, each with 1 creative', '5 separate campaigns, one for each creative', '1 CBO campaign with 7 ad sets, 5 creatives in each'], correctIndex: 1, feedback: { correct: 'Exactly! For testing, use ABO with one creative per ad set. This ensures equal budget distribution and isolates each creative as the only variable. Once you find winners, THEN move them to your scaling CBO campaign.', incorrect: 'Not quite. For creative testing, you want ABO (Ad Set Budget Optimization) with one creative per ad set. This gives each creative equal budget and isolates it as the only variable. CBO is for scaling proven winners, not testing new ones.' }},
      { type: 'action-checklist', title: 'Set Up Your 3-Phase Structure', items: [
        { task: 'Create Testing Campaign (ABO) with 4-6 ad sets, 1 creative each', done: false },
        { task: 'Set identical broad targeting for all testing ad sets', done: false },
        { task: 'After 3-5 days, identify winning creatives (lowest CPA, highest ROAS)', done: false },
        { task: 'Create Scaling Campaign (CBO) with 7 ad sets', done: false },
        { task: 'Add ALL winning creatives to EVERY scaling ad set', done: false },
        { task: 'Set up Remarketing campaign for abandoned carts/viewers', done: false }
      ], bottomNote: 'Test in ABO. Scale in CBO. Never mix them up.' },
      { type: 'completion', sources: [] }
    ];

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.characterVideo && (
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3, duration: 0.6 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none hidden md:block`}
            style={{ height: '52%', maxHeight: '400px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    
    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      
        {data.characterVideo && (
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.4, duration: 0.5 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-4' : 'right-4'} z-0 pointer-events-none`}
            style={{ height: '25%', maxHeight: '180px', marginBottom: '3%' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
              <source src={data.characterVideo} type="video/mp4" />
            </video>
          </motion.div>
        )}
      </div>
    );

    // Campaign Overview with Remarketing below
    const OverviewSlide = ({ data }) => {
      const getIcon = (iconName) => {
        const IconComponent = Icons[iconName];
        return IconComponent ? <IconComponent /> : null;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          {/* Two Phases */}
          <div className="flex flex-col md:flex-row items-center justify-center gap-4 md:gap-6 mb-6">
            {data.phases.map((phase, i) => (
              <React.Fragment key={i}>
                <motion.div
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.15 }}
                  className="bg-white border-2 rounded-2xl p-6 text-center w-full md:w-56"
                  style={{ borderColor: phase.color }}
                >
                  <div className="w-12 h-12 rounded-xl mx-auto mb-3 flex items-center justify-center" style={{ backgroundColor: `${phase.color}20`, color: phase.color }}>
                    {getIcon(phase.icon)}
                  </div>
                  <div className="text-xs font-bold uppercase tracking-wider mb-1" style={{ color: phase.color }}>Phase {phase.number}</div>
                  <h3 className="font-bold text-lg text-neutral-900 mb-1">{phase.name}</h3>
                  <div className="text-sm text-neutral-500 mb-2">{phase.goal}</div>
                  <div className="inline-block px-3 py-1 rounded-full text-xs font-semibold" style={{ backgroundColor: `${phase.color}15`, color: phase.color }}>
                    {phase.type}
                  </div>
                </motion.div>
                {i < data.phases.length - 1 && (
                  <motion.div
                    initial={{ opacity: 0 }}
                    animate={{ opacity: 1 }}
                    transition={{ delay: 0.3 + i * 0.15 }}
                    className="text-neutral-300 hidden md:block"
                  >
                    <Icons.ArrowRight />
                  </motion.div>
                )}
              </React.Fragment>
            ))}
          </div>

          {/* Remarketing - Always On (Below) */}
          {data.remarketing && (
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.5 }}
              className="bg-purple-50 border-2 border-purple-300 rounded-xl p-4 text-center max-w-xl mx-auto"
            >
              <div className="flex items-center justify-center gap-2 mb-2">
                <div className="w-8 h-8 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600">
                  <Icons.Repeat />
                </div>
                <span className="font-bold text-purple-700">Remarketing</span>
                <span className="px-2 py-0.5 bg-purple-200 text-purple-700 text-[10px] font-bold rounded-full uppercase">Always On</span>
              </div>
              <p className="text-sm text-purple-600">{data.remarketing.note}</p>
              <p className="text-xs text-purple-500 mt-1">Audience: {data.remarketing.audience}</p>
            </motion.div>
          )}
        </div>
      );
    };

    // Phase Header
    const PhaseHeaderSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-8 text-center">
        <motion.div
          initial={{ opacity: 0, scale: 0.9 }}
          animate={{ opacity: 1, scale: 1 }}
          className="mb-4"
        >
          <span className="inline-block px-4 py-2 rounded-full text-sm font-bold text-white" style={{ backgroundColor: data.color }}>
            Phase {data.phase} - {data.budgetType}
          </span>
        </motion.div>
        <motion.h2
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1 }}
          className="slide-title text-4xl md:text-5xl lg:text-6xl mb-4"
          style={{ color: data.color }}
        >
          {data.title}
        </motion.h2>
        <motion.p
          initial={{ opacity: 0, y: 15 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.2 }}
          className="text-lg md:text-xl text-neutral-500"
        >
          {data.subtitle}
        </motion.p>
      </div>
    );

    // Testing Structure Visual - Clean minimalist blocks
    const TestingStructureSlide = ({ data }) => {
      const adSets = [
        { name: 'Ad Set 1', creative: 'Creative 1' },
        { name: 'Ad Set 2', creative: 'Creative 2' },
        { name: 'Ad Set 3', creative: 'Creative 3' },
        { name: 'Ad Set 4', creative: 'Creative 4' },
      ];

      return (
        <div className="h-full flex flex-col justify-center px-4 md:px-8 max-w-4xl mx-auto slide-scroll overflow-y-auto py-6">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-2xl text-black text-center mb-2">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-sm text-neutral-500 text-center mb-6">{data.description}</motion.p>

          {/* Visual Structure */}
          <div className="flex flex-col items-center">
            {/* Campaign */}
            <motion.div
              initial={{ opacity: 0, y: -10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
              className="bg-white border-2 border-amber-500 rounded-xl px-6 py-3 mb-4"
            >
              <div className="text-center">
                <div className="text-xs text-amber-600 font-semibold uppercase tracking-wider">Campaign</div>
                <div className="font-bold text-neutral-900">1 ABO Campaign</div>
              </div>
            </motion.div>

            {/* Arrow */}
            <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }} className="text-amber-400 mb-4">
              <Icons.ArrowDown />
            </motion.div>

            {/* Ad Sets Row */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 w-full max-w-2xl">
              {adSets.map((adSet, i) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.35 + i * 0.08 }}
                  className="bg-white border border-neutral-900 rounded-lg p-3 text-center"
                >
                  <div className="text-[10px] text-neutral-500 uppercase tracking-wider">Ad Set</div>
                  <div className="font-semibold text-neutral-900 text-sm">{adSet.name}</div>
                  <div className="text-[10px] text-neutral-400 mt-1">Broad targeting</div>
                </motion.div>
              ))}
            </div>

            {/* Arrows */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-4 w-full max-w-2xl">
              {adSets.map((_, i) => (
                <motion.div key={i} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 + i * 0.05 }} className="flex justify-center text-neutral-300">
                  <Icons.ArrowDown />
                </motion.div>
              ))}
            </div>

            {/* Creatives Row */}
            <div className="grid grid-cols-2 md:grid-cols-4 gap-3 w-full max-w-2xl">
              {adSets.map((adSet, i) => (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 10 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.55 + i * 0.08 }}
                  className="bg-white border border-neutral-900 rounded-lg p-3 text-center"
                >
                  <div className="w-8 h-8 mx-auto mb-2 rounded bg-neutral-100 flex items-center justify-center text-neutral-400">
                    <Icons.Image />
                  </div>
                  <div className="font-semibold text-neutral-900 text-sm">{adSet.creative}</div>
                </motion.div>
              ))}
            </div>

            {/* Note */}
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.8 }}
              className="mt-6 px-4 py-3 bg-amber-50 border border-amber-200 rounded-xl text-center max-w-lg"
            >
              <p className="text-sm text-amber-800">
                <strong>Goal:</strong> Test as many signals as possible. Each creative gets equal budget.
              </p>
            </motion.div>
          </div>
        </div>
      );
    };

    // Testing Rules
    const TestingRulesSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="space-y-4">
          {data.rules.map((item, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0, x: -20 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.1 + i * 0.1 }}
              className="bg-white border border-neutral-200 rounded-xl p-4"
            >
              <div className="flex items-start gap-3">
                <div className="w-8 h-8 rounded-lg bg-amber-100 flex items-center justify-center text-amber-600 flex-shrink-0">
                  <Icons.Check />
                </div>
                <div>
                  <h3 className="font-bold text-neutral-900 text-sm md:text-base">{item.rule}</h3>
                  <p className="text-neutral-500 text-sm mt-1">{item.why}</p>
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Scaling Structure Visual
    const ScalingStructureSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-4 md:px-8 max-w-4xl mx-auto slide-scroll overflow-y-auto py-6">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-2xl text-black text-center mb-2">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-sm text-neutral-500 text-center mb-6">{data.description}</motion.p>

        <div className="flex flex-col items-center">
          {/* Campaign */}
          <motion.div
            initial={{ opacity: 0, y: -10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.2 }}
            className="bg-white border-2 border-emerald-500 rounded-xl px-6 py-3 mb-4"
          >
            <div className="text-center">
              <div className="text-xs text-emerald-600 font-semibold uppercase tracking-wider">Campaign</div>
              <div className="font-bold text-neutral-900">1 CBO Campaign</div>
            </div>
          </motion.div>

          {/* Arrow */}
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }} className="text-emerald-400 mb-4">
            <Icons.ArrowDown />
          </motion.div>

          {/* 7 Ad Sets */}
          <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-7 gap-2 mb-4 w-full">
            {['Top 10%', 'Top 25%', 'RFM', 'LLA 5%', 'Interests', 'Open', 'Adv+'].map((name, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.35 + i * 0.05 }}
                className="bg-white border border-neutral-900 rounded-lg p-2 text-center"
              >
                <div className="text-[9px] text-neutral-500 uppercase">Ad Set {i + 1}</div>
                <div className="font-semibold text-neutral-900 text-[11px]">{name}</div>
              </motion.div>
            ))}
          </div>

          {/* Arrows */}
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.6 }} className="text-neutral-300 mb-4">
            <Icons.ArrowDown />
          </motion.div>

          {/* All Winning Creatives */}
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.65 }}
            className="bg-white border-2 border-neutral-900 rounded-xl px-8 py-4 text-center"
          >
            <div className="text-[10px] text-neutral-500 uppercase tracking-wider mb-1">Under Every Ad Set</div>
            <div className="font-bold text-neutral-900">All Winning Creatives</div>
            <div className="flex justify-center gap-2 mt-2">
              {[1,2,3,4,5].map((_, i) => (
                <div key={i} className="w-6 h-6 rounded bg-neutral-100 flex items-center justify-center text-neutral-400 text-xs">
                  <Icons.Image />
                </div>
              ))}
            </div>
          </motion.div>

          {/* Note */}
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.8 }}
            className="mt-6 px-4 py-3 bg-emerald-50 border border-emerald-200 rounded-xl text-center max-w-lg"
          >
            <p className="text-sm text-emerald-800">
              <strong>CBO Magic:</strong> Meta shifts budget to the best-performing ad set in real-time.
            </p>
          </motion.div>

          {/* RFM Audience Link */}
          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.9 }}
            className="mt-4 text-center"
          >
            <button
              onClick={() => window.open('https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva', '_blank', 'noopener,noreferrer')}
              className="inline-flex items-center gap-1.5 px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-semibold rounded-lg transition-colors"
            >
              Create RFM Audiences FREE <Icons.ExternalLink />
            </button>
          </motion.div>
        </div>
      </div>
    );

    // Ad Set Breakdown with clickable FREE badges
    const AdSetBreakdownSlide = ({ data }) => {
      const getIcon = (iconName) => {
        const IconComponent = Icons[iconName];
        return IconComponent ? <IconComponent /> : null;
      };

      const handleFreeClick = (link) => {
        if (link) {
          window.open(link, '_blank', 'noopener,noreferrer');
        }
      };

      return (
        <div className="h-full flex flex-col justify-center px-4 md:px-8 max-w-4xl mx-auto slide-scroll overflow-y-auto py-6">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-2xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-3">
            {data.adsets.map((adset, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, y: 15 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.1 + i * 0.06 }}
                className="bg-white border border-neutral-200 rounded-xl p-4 flex items-center gap-4"
              >
                <div className="w-10 h-10 rounded-lg bg-emerald-100 flex items-center justify-center text-emerald-600 flex-shrink-0">
                  {getIcon(adset.icon)}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <h3 className="font-bold text-neutral-900 text-sm truncate">{adset.name}</h3>
                    {adset.free && adset.link && (
                      <button
                        onClick={() => handleFreeClick(adset.link)}
                        className="inline-flex items-center gap-1 px-2 py-0.5 bg-green-100 hover:bg-green-200 text-green-700 text-[10px] font-semibold rounded-full transition-colors cursor-pointer"
                      >
                        FREE <Icons.ExternalLink />
                      </button>
                    )}
                    {adset.free && !adset.link && (
                      <span className="px-2 py-0.5 bg-green-100 text-green-700 text-[10px] font-semibold rounded-full">FREE</span>
                    )}
                  </div>
                  <p className="text-neutral-500 text-xs">{adset.description}</p>
                </div>
              </motion.div>
            ))}
          </div>

          {/* RFM Explanation Block */}
          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.6 }}
            className="mt-6 bg-neutral-800 rounded-xl p-4"
          >
            <div className="flex items-start gap-3">
              <div className="w-8 h-8 rounded-lg bg-neutral-700 flex items-center justify-center text-neutral-300 flex-shrink-0">
                <Icons.Heart />
              </div>
              <div className="flex-1">
                <h4 className="font-bold text-white text-sm mb-1">What is RFM?</h4>
                <p className="text-neutral-400 text-xs leading-relaxed mb-2">
                  RFM (Recency, Frequency, Monetary) segments your customers by purchase behavior. Identify Champions, Loyal buyers, and Promising leads automatically.
                </p>
                <button
                  onClick={() => window.open('https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva', '_blank', 'noopener,noreferrer')}
                  className="inline-flex items-center gap-1.5 px-3 py-1.5 bg-green-500 hover:bg-green-600 text-white text-xs font-semibold rounded-lg transition-colors"
                >
                  Create RFM Audiences FREE <Icons.ExternalLink />
                </button>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // Scaling Visual
    const ScalingVisualSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto text-center">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black mb-2">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-500 mb-8">{data.subtitle}</motion.p>

        <motion.div
          initial={{ opacity: 0, scale: 0.95 }}
          animate={{ opacity: 1, scale: 1 }}
          transition={{ delay: 0.2 }}
          className="bg-neutral-900 rounded-2xl p-6 md:p-8"
        >
          <div className="grid grid-cols-3 md:grid-cols-7 gap-3 mb-6">
            {['Top 10%', 'Top 25%', 'RFM', 'LLA', 'Interest', 'Open', 'Adv+'].map((name, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, y: 10 }}
                animate={{ opacity: 1, y: 0 }}
                transition={{ delay: 0.3 + i * 0.05 }}
                className="bg-neutral-800 border border-neutral-700 rounded-lg py-2 px-1"
              >
                <div className="text-[10px] text-neutral-400 truncate">{name}</div>
              </motion.div>
            ))}
          </div>

          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            transition={{ delay: 0.6 }}
            className="flex items-center justify-center gap-2 text-neutral-400 mb-4"
          >
            <Icons.ArrowDown />
          </motion.div>

          <motion.div
            initial={{ opacity: 0, y: 10 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.7 }}
            className="bg-emerald-500/20 border-2 border-emerald-500 rounded-xl py-4 px-6"
          >
            <div className="flex items-center justify-center gap-3 flex-wrap">
              {[1,2,3,4,5,6,7,8].map((_, i) => (
                <div key={i} className="w-8 h-8 rounded bg-white/10 flex items-center justify-center text-white/60">
                  <Icons.Image />
                </div>
              ))}
            </div>
            <div className="text-emerald-400 font-semibold mt-3 text-sm">All Winning Creatives</div>
            <div className="text-emerald-300/60 text-xs">Same creatives in every ad set</div>
          </motion.div>
        </motion.div>

        {/* RFM Audience Link */}
        <motion.div
          initial={{ opacity: 0, y: 10 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.8 }}
          className="mt-6 text-center"
        >
          <button
            onClick={() => window.open('https://apps.shopify.com/customer-lifetime-value?mref=lsbqcbva', '_blank', 'noopener,noreferrer')}
            className="inline-flex items-center gap-1.5 px-4 py-2 bg-green-500 hover:bg-green-600 text-white text-sm font-semibold rounded-lg transition-colors"
          >
            Create RFM Audiences FREE <Icons.ExternalLink />
          </button>
        </motion.div>
      </div>
    );

    // Remarketing Structure
    const RemarketingStructureSlide = ({ data }) => {
      const segments = [
        { name: 'Cart Abandoners', window: '1-7 days', priority: 'High' },
        { name: 'Product Viewers', window: '1-14 days', priority: 'Medium' },
        { name: 'Past Purchasers', window: '30-90 days', priority: 'Upsell' },
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-6">{data.description}</motion.p>

          <div className="space-y-3">
            {segments.map((seg, i) => (
              <motion.div
                key={i}
                initial={{ opacity: 0, x: -20 }}
                animate={{ opacity: 1, x: 0 }}
                transition={{ delay: 0.2 + i * 0.1 }}
                className="bg-white border border-neutral-200 rounded-xl p-4 flex items-center gap-4"
              >
                <div className="w-10 h-10 rounded-lg bg-purple-100 flex items-center justify-center text-purple-600 flex-shrink-0">
                  <Icons.Users />
                </div>
                <div className="flex-1">
                  <h3 className="font-bold text-neutral-900 text-sm">{seg.name}</h3>
                  <p className="text-neutral-500 text-xs">Window: {seg.window}</p>
                </div>
                <span className={`px-2 py-1 rounded-full text-xs font-semibold ${
                  seg.priority === 'High' ? 'bg-red-100 text-red-700' :
                  seg.priority === 'Medium' ? 'bg-amber-100 text-amber-700' :
                  'bg-blue-100 text-blue-700'
                }`}>
                  {seg.priority}
                </span>
              </motion.div>
            ))}
          </div>

          <motion.div
            initial={{ opacity: 0, y: 15 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: 0.5 }}
            className="mt-6 p-4 bg-purple-50 border border-purple-200 rounded-xl"
          >
            <p className="text-sm text-purple-800 text-center">
              Remarketing can be separate or integrated with scaling. Key is to not compete with your prospecting campaigns.
            </p>
          </motion.div>
        </div>
      );
    };

    // Comparison Table
    const ComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-4 md:px-8 max-w-4xl mx-auto slide-scroll overflow-y-auto py-6">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-xl md:text-2xl text-black text-center mb-6">{data.title}</motion.h2>

        <motion.div
          initial={{ opacity: 0, y: 20 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.1 }}
          className="bg-white border border-neutral-200 rounded-xl overflow-hidden"
        >
          {/* Header */}
          <div className="grid grid-cols-3 bg-neutral-100">
            <div className="p-3 text-xs font-bold text-neutral-500 uppercase tracking-wider">Aspect</div>
            <div className="p-3 text-xs font-bold text-amber-600 uppercase tracking-wider text-center border-l border-neutral-200">Testing (ABO)</div>
            <div className="p-3 text-xs font-bold text-emerald-600 uppercase tracking-wider text-center border-l border-neutral-200">Scaling (CBO)</div>
          </div>

          {/* Rows */}
          {data.items.map((item, i) => (
            <motion.div
              key={i}
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.15 + i * 0.05 }}
              className="grid grid-cols-3 border-t border-neutral-200"
            >
              <div className="p-3 text-sm font-medium text-neutral-700">{item.aspect}</div>
              <div className="p-3 text-sm text-neutral-600 text-center border-l border-neutral-200 bg-amber-50/50">{item.testing}</div>
              <div className="p-3 text-sm text-neutral-600 text-center border-l border-neutral-200 bg-emerald-50/50">{item.scaling}</div>
            </motion.div>
          ))}
        </motion.div>

        <motion.div
          initial={{ opacity: 0, y: 15 }}
          animate={{ opacity: 1, y: 0 }}
          transition={{ delay: 0.5 }}
          className="mt-4 text-center"
        >
          <p className="text-sm text-neutral-500">
            <strong>Key insight:</strong> Find winners in ABO, then scale them in CBO.
          </p>
        </motion.div>
      </div>
    );

    const ActionChecklistSlide = ({ data }) => {
      const [checkedItems, setCheckedItems] = useState({});
      const toggleItem = (index) => setCheckedItems(prev => ({ ...prev, [index]: !prev[index] }));

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="space-y-3 mb-6">
            {data.items.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.08 }} onClick={() => toggleItem(i)} className={`bg-white border-2 rounded-xl p-4 cursor-pointer transition-all ${checkedItems[i] ? 'border-green-400 bg-green-50' : 'border-neutral-200 hover:border-neutral-300'}`}>
                <div className="flex items-center gap-3">
                  <div className={`w-6 h-6 rounded-lg flex items-center justify-center transition-all ${checkedItems[i] ? 'bg-green-500 text-white' : 'bg-neutral-100'}`}>
                    {checkedItems[i] && <Icons.Check />}
                  </div>
                  <span className={`text-sm ${checkedItems[i] ? 'text-green-700 line-through' : 'text-neutral-700'}`}>{item.task}</span>
                </div>
              </motion.div>
            ))}
          </div>
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="bg-blue-50 border border-blue-200 rounded-xl p-4 text-center">
            <p className="text-blue-800 text-sm font-medium">{data.bottomNote}</p>
          </motion.div>
        </div>
      );
    };

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand the complete campaign structure: Phase 1 tests creatives with ABO (1 per ad set), Phase 2 scales winners with CBO (7 strategic ad sets), and Remarketing runs ALWAYS in a separate campaign (Web 180D + Video 50%).</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      // Send slide update to parent for admin issue tracking
      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'overview': return <OverviewSlide data={slide} />;
          case 'phase-header': return <PhaseHeaderSlide data={slide} />;
          case 'testing-structure': return <TestingStructureSlide data={slide} />;
          case 'testing-rules': return <TestingRulesSlide data={slide} />;
          case 'scaling-structure': return <ScalingStructureSlide data={slide} />;
          case 'adset-breakdown': return <AdSetBreakdownSlide data={slide} />;
          case 'scaling-visual': return <ScalingVisualSlide data={slide} />;
          case 'remarketing-structure': return <RemarketingStructureSlide data={slide} />;
          case 'comparison': return <ComparisonSlide data={slide} />;
          case 'action-checklist': return <ActionChecklistSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
