<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The $0 CAC Engine | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #D4A017; --accent-dark: #c08c03; --accent-light: #e8b42b; --accent-rgb: 212, 160, 23; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'biz-zero-cac-engine',
      title: 'The $0 CAC Engine',
      description: 'Why organic content beats paid ads early on',
      accentColor: '#D4A017',
      duration: '7 min',
      nextLesson: { id: 'biz-creative-targeting', title: 'Creative is the New Targeting', teaser: 'Learn why creative volume beats audience targeting in 2024.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_above_head_world_champion_celebration_484bd560-f049-41ca-b3d1-c03d7468ab56_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why organic content beats paid ads early on', 'How to use organic as your R&D lab', 'The $0 to $10M roadmap'] },
      { type: 'hook', headline: 'Stop burning money on ads.', subtext: 'Every dollar spent before mastering organic is a dollar wasted. Most founders rush to paid ads and burn $10K-$50K learning what could be discovered for free.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Ridge-Wallet-Logo-1.webp', brandName: 'Ridge' },
      { type: 'quote-spotlight', quote: 'If you\'re starting, don\'t spend money on ads. Get really good at short form content. That can take you to $10M in sales.', author: 'Sean Frank', context: 'CEO of Ridge ($200M+ Revenue)' },
      { type: 'cost-comparison', title: 'The Brutal Truth About Paid Ads', paid: { label: 'PAID ADS FIRST', cost: '$10K-$50K', outcome: 'Wasted discovering what works', icon: 'DollarSign' }, organic: { label: 'ORGANIC FIRST', cost: '$0', outcome: 'Free testing ground', icon: 'Video' }, insight: 'If people scroll past your organic content for free, they\'ll scroll past your paid ad even faster.' },
      { type: 'stats-grid', title: 'The Numbers That Matter', stats: [{ value: '$10K-$50K', label: 'Wasted on ads that don\'t work', color: '#ef4444' }, { value: '100+', label: 'Videos before you find what works', color: '#22c55e' }, { value: '3 sec', label: 'To stop someone from scrolling', color: '#D4A017' }, { value: '$0', label: 'Cost to test with organic', color: '#3b82f6' }] },
      { type: 'two-paths', title: 'Two Paths to Revenue', expensive: { label: 'THE EXPENSIVE WAY', items: ['Spend $10K-$50K testing ads', 'Guess what hooks work', 'Burn through budget fast', 'No learning, just loss'] }, free: { label: 'THE $0 CAC WAY', items: ['Post 100+ videos for free', 'See what hooks stop scroll', 'Validate before spending', 'Turn winners into ads'] } },
      { type: 'rd-lab', title: 'Organic = Free R&D Lab', concept: 'Think of organic content as free market research', tests: [{ question: 'Does this hook stop the scroll?', answer: 'Instant feedback' }, { question: 'Does this angle resonate?', answer: 'Comments tell you' }, { question: 'Which format performs?', answer: 'Views don\'t lie' }], insight: 'Once you find hooks that work organically, those are your paid ad winners.' },
      { type: 'playbook-grid', title: 'The $0 CAC Playbook', cards: [{ icon: 'Video', number: '100+', title: 'Videos/Month', desc: 'Volume is the game. Test relentlessly.' }, { icon: 'Zap', number: '3-7', title: 'Second Hooks', desc: 'You have 3 seconds to stop the scroll.' }, { icon: 'Target', number: '10+', title: 'Angles', desc: 'Same product, different pain points.' }, { icon: 'TrendingUp', number: '$10M', title: 'Ceiling', desc: 'Where organic taps out, paid begins.' }] },
      { type: 'roadmap-visual', title: 'The $0 to $10M Roadmap', phases: [{ phase: 1, name: 'Content Grind', timeline: 'Months 1-6', desc: 'Post 3-5 videos daily. Track what works.', status: 'start' }, { phase: 2, name: 'Double Down', timeline: 'Months 6-12', desc: 'Scale winning formats. Build audience.', status: 'grow' }, { phase: 3, name: 'Organic Ceiling', timeline: 'Year 1-2', desc: 'Hit $10M organic. Max out reach.', status: 'peak' }, { phase: 4, name: 'Layer Paid', timeline: 'Post $10M', desc: 'Turn top content into paid ads.', status: 'scale' }] },
      { type: 'flywheel', title: 'The Winner Creation Cycle', stages: [{ icon: 'Video', label: 'CREATE', desc: 'Post content daily' }, { icon: 'BarChart', label: 'MEASURE', desc: 'Track what works' }, { icon: 'Star', label: 'IDENTIFY', desc: 'Find winners' }, { icon: 'Rocket', label: 'SCALE', desc: 'Turn into paid' }], insight: 'Paid ads amplify signal. Organic creates signal.' },
      { type: 'quiz', question: 'When should you start spending on paid ads?', options: ['Day 1 - Need sales immediately', 'After you have proven organic content that performs', 'When you hit $1M in revenue', 'Never - organic is enough'], correctIndex: 1, feedback: { correct: 'Exactly! Paid ads scale what already works organically. Prove it first, then pour gas on the fire.', incorrect: 'Not quite. Paid ads should scale proven winners, not discover them.' } },
      { type: 'action-checklist', title: 'Build Your $0 CAC Engine', items: [{ text: 'Post 3-5 short-form videos per day', priority: 'high' }, { text: 'Track which hooks get the most engagement', priority: 'high' }, { text: 'Build a swipe file of your top performers', priority: 'medium' }, { text: 'After $10M organic, layer in paid using winners', priority: 'low' }] },
      { type: 'mindset-shift', title: 'The $0 CAC Mindset', insight: 'Organic forces you to be GOOD. No budget to hide behind. You either capture attention or you don\'t. This discipline builds muscle. When you finally run ads, you\'re scaling machines you\'ve already built.' },
      { type: 'completion', sources: ['Sean Frank (Ridge CEO)', 'Organic Content Strategy', '$0 CAC Methodology'] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      DollarSign: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Video: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>,
      Zap: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      TrendingUp: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      BarChart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      Star: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Rocket: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M4.5 16.5c-1.5 1.26-2 5-2 5s3.74-.5 5-2c.71-.84.7-2.13-.09-2.91a2.18 2.18 0 0 0-2.91-.09z"/><path d="m12 15-3-3a22 22 0 0 1 2-3.95A12.88 12.88 0 0 1 22 2c0 2.72-.78 7.5-6 11a22.35 22.35 0 0 1-4 2z"/></svg>,
      Lightbulb: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Quote: () => <svg width="32" height="32" viewBox="0 0 24 24" fill="currentColor"><path d="M6 17h3l2-4V7H5v6h3zm8 0h3l2-4V7h-6v6h3z"/></svg>,
      CheckCircle: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>,
      Play: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="5 3 19 12 5 21 5 3"/></svg>
    };

    const getIcon = (name) => {
      const IconComponent = Icons[name];
      return IconComponent ? <IconComponent /> : null;
    };

    // AnimatedCounter
    const AnimatedCounter = ({ target, duration = 1500, prefix = '', suffix = '' }) => {
      const [count, setCount] = useState(0);
      const numericTarget = parseInt(target.replace(/[^0-9]/g, '')) || 0;
      useEffect(() => {
        if (numericTarget === 0) { setCount(target); return; }
        let start = 0;
        const timer = setInterval(() => {
          start += Math.ceil(numericTarget / (duration / 50));
          if (start >= numericTarget) { setCount(numericTarget); clearInterval(timer); }
          else { setCount(start); }
        }, 50);
        return () => clearInterval(timer);
      }, [numericTarget, duration]);
      return <span>{prefix}{typeof count === 'number' ? count : target}{suffix}</span>;
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: 'rgba(212, 160, 23, 0.1)', color: '#D4A017' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }} className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" />
          </motion.div>
        )}
      </div>
    );

    // Quote Spotlight Slide
    const QuoteSpotlightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-4xl mx-auto">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="relative rounded-2xl p-8 md:p-12" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.1 }} className="absolute top-4 left-4" style={{ color: '#D4A017' }}><Icons.Quote /></motion.div>
          <p className="text-xl md:text-3xl text-white font-medium leading-relaxed mb-6 relative z-10" style={{ fontFamily: 'Fraunces, serif' }}>"{data.quote}"</p>
          <div className="flex items-center gap-4">
            <div className="w-12 h-12 rounded-full flex items-center justify-center text-white font-bold" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>{data.author.charAt(0)}</div>
            <div>
              <p className="text-white font-semibold">{data.author}</p>
              <p className="text-neutral-400 text-sm">{data.context}</p>
            </div>
          </div>
        </motion.div>
      </div>
    );

    // Cost Comparison Slide
    const CostComparisonSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6 mb-8">
          {/* Paid Ads First */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} className="relative rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: 'rgba(239, 68, 68, 0.2)' }}>
                <span className="text-red-400">{getIcon(data.paid.icon)}</span>
              </div>
              <span className="text-red-400 font-bold text-sm">{data.paid.label}</span>
            </div>
            <div className="text-center py-4">
              <span className="text-4xl md:text-5xl font-bold text-red-400">{data.paid.cost}</span>
              <p className="text-neutral-400 text-sm mt-2">{data.paid.outcome}</p>
            </div>
          </motion.div>

          {/* Organic First */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(212, 160, 23, 0.2)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="flex items-center gap-3 mb-4">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: 'rgba(212, 160, 23, 0.2)' }}>
                <span style={{ color: '#D4A017' }}>{getIcon(data.organic.icon)}</span>
              </div>
              <span style={{ color: '#D4A017' }} className="font-bold text-sm">{data.organic.label}</span>
            </div>
            <div className="text-center py-4">
              <span className="text-4xl md:text-5xl font-bold" style={{ color: '#D4A017' }}>{data.organic.cost}</span>
              <p className="text-neutral-400 text-sm mt-2">{data.organic.outcome}</p>
            </div>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="text-center rounded-xl p-4" style={{ background: 'rgba(212, 160, 23, 0.1)', border: '1px solid rgba(212, 160, 23, 0.3)' }}>
          <p style={{ color: '#D4A017' }} className="font-medium">{data.insight}</p>
        </motion.div>
      </div>
    );

    // Stats Grid Slide
    const StatsGridSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid grid-cols-2 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 + i * 0.1 }} className="relative rounded-2xl p-6 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${stat.color}, transparent)`, borderRadius: '2px 2px 0 0' }} />
              <span className="text-3xl md:text-4xl font-bold" style={{ color: stat.color }}>{stat.value}</span>
              <p className="text-neutral-400 text-sm mt-2">{stat.label}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Two Paths Slide
    const TwoPathsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          {/* Expensive Path */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} className="relative rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="absolute -top-3 left-4 px-3 py-1 rounded-full text-xs font-bold text-white" style={{ background: '#ef4444' }}>{data.expensive.label}</div>
            <ul className="space-y-3 mt-4">
              {data.expensive.items.map((item, i) => (
                <motion.li key={i} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 + i * 0.05 }} className="flex items-start gap-3">
                  <span className="text-red-400 mt-1"><Icons.X /></span>
                  <span className="text-neutral-300 text-sm">{item}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>

          {/* Free Path */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="relative rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 0 30px rgba(212, 160, 23, 0.15)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="absolute -top-3 left-4 px-3 py-1 rounded-full text-xs font-bold text-white" style={{ background: '#D4A017' }}>{data.free.label}</div>
            <ul className="space-y-3 mt-4">
              {data.free.items.map((item, i) => (
                <motion.li key={i} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.05 }} className="flex items-start gap-3">
                  <span style={{ color: '#D4A017' }} className="mt-1"><Icons.Check /></span>
                  <span className="text-neutral-300 text-sm">{item}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>
        </div>
      </div>
    );

    // R&D Lab Slide
    const RDLabSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-center mb-6">{data.concept}</motion.p>
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }} className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
          <div className="space-y-4">
            {data.tests.map((test, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-center justify-between py-3" style={{ borderBottom: i < data.tests.length - 1 ? '1px solid rgba(255,255,255,0.1)' : 'none' }}>
                <span className="text-neutral-300 text-sm">{test.question}</span>
                <span className="px-3 py-1 rounded-full text-xs font-medium" style={{ background: 'rgba(212, 160, 23, 0.2)', color: '#D4A017' }}>{test.answer}</span>
              </motion.div>
            ))}
          </div>
        </motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="mt-6 text-center rounded-xl p-4" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>
          <p className="text-white font-bold">{data.insight}</p>
        </motion.div>
      </div>
    );

    // Playbook Grid Slide
    const PlaybookGridSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid grid-cols-2 gap-4">
          {data.cards.map((card, i) => (
            <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 + i * 0.1 }} className="relative rounded-2xl p-5" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
              <div className="flex items-center gap-3 mb-3">
                <div className="w-10 h-10 rounded-lg flex items-center justify-center" style={{ background: 'rgba(212, 160, 23, 0.2)' }}>
                  <span style={{ color: '#D4A017' }}>{getIcon(card.icon)}</span>
                </div>
                <span className="text-2xl font-bold" style={{ color: '#D4A017' }}>{card.number}</span>
              </div>
              <h3 className="text-white font-bold mb-1">{card.title}</h3>
              <p className="text-neutral-400 text-sm">{card.desc}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Roadmap Visual Slide
    const RoadmapVisualSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => {
          setActivePhase(prev => (prev + 1) % data.phases.length);
        }, 2500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="space-y-3">
            {data.phases.map((phase, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="relative rounded-xl p-4 transition-all duration-300" style={{ background: i === activePhase ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'rgba(0,0,0,0.03)', boxShadow: i === activePhase ? '0 0 20px rgba(212, 160, 23, 0.2)' : 'none', border: i === activePhase ? '1px solid rgba(212, 160, 23, 0.3)' : '1px solid transparent' }}>
                {i === activePhase && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '2px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />}
                <div className="flex items-center gap-4">
                  <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0 font-bold text-lg" style={{ background: i === activePhase ? 'linear-gradient(135deg, #D4A017, #c08c03)' : 'rgba(212, 160, 23, 0.1)', color: i === activePhase ? 'white' : '#D4A017' }}>{phase.phase}</div>
                  <div className="flex-1">
                    <div className="flex items-center gap-3 mb-1">
                      <h3 className={`font-bold ${i === activePhase ? 'text-white' : 'text-neutral-800'}`}>{phase.name}</h3>
                      <span className="text-xs px-2 py-0.5 rounded-full" style={{ background: 'rgba(212, 160, 23, 0.2)', color: '#D4A017' }}>{phase.timeline}</span>
                    </div>
                    <p className={`text-sm ${i === activePhase ? 'text-neutral-300' : 'text-neutral-500'}`}>{phase.desc}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // Flywheel Slide
    const FlywheelSlide = ({ data }) => {
      const [activeStage, setActiveStage] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => {
          setActiveStage(prev => (prev + 1) % data.stages.length);
        }, 1500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="relative rounded-2xl p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="flex items-center justify-between gap-2">
              {data.stages.map((stage, i) => (
                <React.Fragment key={i}>
                  <motion.div animate={{ scale: i === activeStage ? 1.1 : 1, opacity: i === activeStage ? 1 : 0.6 }} className="flex flex-col items-center text-center">
                    <div className="w-14 h-14 rounded-xl flex items-center justify-center mb-2 transition-all" style={{ background: i === activeStage ? 'linear-gradient(135deg, #D4A017, #c08c03)' : 'rgba(212, 160, 23, 0.2)' }}>
                      <span style={{ color: i === activeStage ? 'white' : '#D4A017' }}>{getIcon(stage.icon)}</span>
                    </div>
                    <span className={`font-bold text-sm ${i === activeStage ? 'text-amber-400' : 'text-neutral-400'}`}>{stage.label}</span>
                    <span className="text-neutral-500 text-xs">{stage.desc}</span>
                  </motion.div>
                  {i < data.stages.length - 1 && (
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#D4A017" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>
                  )}
                </React.Fragment>
              ))}
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="mt-6 text-center rounded-xl p-4" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>
            <p className="text-white font-bold">{data.insight}</p>
          </motion.div>
        </div>
      );
    };

    // Action Checklist Slide
    const ActionChecklistSlide = ({ data }) => {
      const priorityColors = { high: '#22c55e', medium: '#D4A017', low: '#6b7280' };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #D4A017, transparent)', borderRadius: '2px 2px 0 0' }} />
            <div className="space-y-4">
              {data.items.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="flex items-start gap-4">
                  <div className="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0" style={{ background: `rgba(${item.priority === 'high' ? '34, 197, 94' : item.priority === 'medium' ? '212, 160, 23' : '107, 114, 128'}, 0.2)` }}>
                    <Icons.CheckCircle />
                  </div>
                  <div className="flex-1">
                    <span className="text-neutral-200">{item.text}</span>
                  </div>
                  <span className="px-2 py-0.5 rounded text-xs font-medium uppercase" style={{ background: `rgba(${item.priority === 'high' ? '34, 197, 94' : item.priority === 'medium' ? '212, 160, 23' : '107, 114, 128'}, 0.2)`, color: priorityColors[item.priority] }}>{item.priority}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      );
    };

    // Mindset Shift Slide
    const MindsetShiftSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 md:px-12 max-w-3xl mx-auto text-center">
        <motion.div initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} className="w-20 h-20 rounded-2xl flex items-center justify-center mb-6" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)' }}>
          <Icons.Lightbulb />
        </motion.div>
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-2xl md:text-3xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.insight}</motion.p>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: 'linear-gradient(135deg, #D4A017, #c08c03)', boxShadow: '0 6px 24px rgba(212, 160, 23, 0.35)' }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete!</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You now understand the $0 CAC Engine. Master organic content before spending on ads. Prove it free, then scale it paid.</motion.p>
        <motion.a initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} href={`/lessons/${LESSON_CONFIG.nextLesson.id}/lesson.html`} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4 block hover:bg-neutral-800 transition-colors">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.a>
        {data.sources && data.sources.length > 0 && (
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.45 }} className="text-neutral-400 text-xs">Sources: {data.sources.join(', ')}</motion.p>
        )}
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'quote-spotlight': return <QuoteSpotlightSlide data={slide} />;
          case 'cost-comparison': return <CostComparisonSlide data={slide} />;
          case 'stats-grid': return <StatsGridSlide data={slide} />;
          case 'two-paths': return <TwoPathsSlide data={slide} />;
          case 'rd-lab': return <RDLabSlide data={slide} />;
          case 'playbook-grid': return <PlaybookGridSlide data={slide} />;
          case 'roadmap-visual': return <RoadmapVisualSlide data={slide} />;
          case 'flywheel': return <FlywheelSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'action-checklist': return <ActionChecklistSlide data={slide} />;
          case 'mindset-shift': return <MindsetShiftSlide data={slide} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? '#D4A017' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
