<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The 4-Step Learning Loop That Powers Meta's AI | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #3b82f6; --accent-dark: #2563eb; --accent-light: #60a5fa; --accent-rgb: 59, 130, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'meta-learning-loop',
      title: 'The 4-Step Learning Loop That Powers Meta\'s AI',
      description: 'Understand how Meta actually finds your customers - and why it changes everything.',
      accentColor: '#3b82f6',
      duration: '5 min',
      nextLesson: { id: 'meta-creative-matrix', title: 'The 3Ã—5 Creative Matrix', teaser: '15 ads in 30 minutes - the system that feeds Meta\'s AI properly.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const Icons = {
      Check: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2.5} d="M5 13l4 4L19 7" /></svg>),
      ArrowRight: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>),
      Brain: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>),
      Eye: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z" /></svg>),
      Search: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" /></svg>),
      Users: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>),
      Zap: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>),
      Target: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth={2} /><circle cx="12" cy="12" r="6" strokeWidth={2} /><circle cx="12" cy="12" r="2" strokeWidth={2} /></svg>)
    };

    const slides = [
      { type: 'welcome', learningGoals: ['Why Meta is a learning machine, not a targeting tool', 'The 4-step loop that powers the entire algorithm', 'How to feed the loop properly for better results'] },

      { type: 'hook', headline: 'Most advertisers think Meta is a targeting tool. Wrong. Meta is a learning machine.', subtext: 'You don\'t "target" people on Meta. You feed the algorithm signals - and IT finds people who resemble your best customers. Understanding this fundamental shift is the difference between burning money and printing it.' },

      { type: 'content', title: 'Here\'s What Most People Get Wrong', body: 'They treat Meta Ads Manager like Google Ads. "I want to target women 25-45 who like yoga." That\'s 2019 thinking. In 2024, Meta doesn\'t need you to tell it WHO to target. It needs you to show it WHAT WORKS - then it finds more of those people automatically.' },

      { type: 'visual', title: 'The Fundamental Shift', visualType: 'comparison', data: {
        left: { label: 'Old Thinking (2019)', points: ['Narrow targeting', 'Detailed interests', 'Age/gender restrictions', 'YOU tell Meta who to find'], color: '#ef4444' },
        right: { label: 'New Reality (2024)', points: ['Broad audiences', 'Let AI decide', 'Minimal restrictions', 'META tells you who converts'], color: '#10b981' }
      }},

      { type: 'content', title: 'Meta Is a Learning Machine', body: 'Think of Meta like a bloodhound. You don\'t describe what the person looks like. You give the dog a scent - and it tracks them down. Your job isn\'t to target. Your job is to provide high-quality signals so the algorithm learns WHO converts and finds MORE of them.' },

      { type: 'cards', title: 'The 4-Step Learning Loop', items: [
        { icon: Icons.Zap, title: 'STEP 1: TEST', description: 'Meta sends traffic to your ads. It starts broad - testing different people to see who responds.', color: '#3b82f6' },
        { icon: Icons.Eye, title: 'STEP 2: OBSERVE', description: 'The Pixel and CAPI watch everything. Who clicked? Who added to cart? Who bought? Every action is a signal.', color: '#8b5cf6' },
        { icon: Icons.Brain, title: 'STEP 3: ANALYZE', description: 'Meta\'s AI deconstructs patterns. "Women 35+ from California who browse on iPhone buy 3x more." It finds invisible connections.', color: '#ec4899' },
        { icon: Icons.Search, title: 'STEP 4: FIND MORE', description: 'The algorithm hunts for people with similar patterns. It builds lookalikes in real-time, constantly refining who sees your ads.', color: '#10b981' }
      ]},

      { type: 'loopVisualization', title: 'The Never-Ending Cycle', steps: [
        { step: 1, label: 'TEST', sublabel: 'Send traffic', color: '#3b82f6' },
        { step: 2, label: 'OBSERVE', sublabel: 'Track signals', color: '#8b5cf6' },
        { step: 3, label: 'ANALYZE', sublabel: 'Find patterns', color: '#ec4899' },
        { step: 4, label: 'FIND MORE', sublabel: 'Hunt lookalikes', color: '#10b981' }
      ]},

      { type: 'content', title: 'Why This Changes Everything', body: 'When you understand the loop, you stop trying to outsmart the algorithm. Instead, you FEED it. More volume. More diversity. More signals. The algorithm gets smarter with every conversion. Your job is to give it fuel - in the form of purchases, add-to-carts, and engagement.' },

      { type: 'signalQuality', title: 'Signal Quality Matters', signals: [
        { event: 'Purchase', quality: 10, label: 'Strongest Signal', description: 'Money changed hands. The ultimate proof someone wanted your product.', color: '#10b981' },
        { event: 'Add to Cart', quality: 7, label: 'Strong Signal', description: 'High intent. They\'re seriously considering buying. Meta prioritizes these people.', color: '#3b82f6' },
        { event: 'View Content', quality: 4, label: 'Medium Signal', description: 'Interest confirmed. They landed and stayed. Better than a click.', color: '#f59e0b' },
        { event: 'Click', quality: 2, label: 'Weak Signal', description: 'Curiosity. Could mean anything. Don\'t optimize for clicks alone.', color: '#ef4444' }
      ]},

      { type: 'content', title: 'The Andromeda Update Changed Everything', body: 'Before 2024, you could succeed with narrow targeting and one winning ad. Andromeda flipped the script. Now the algorithm CRAVES volume and diversity. It wants multiple creatives to test. Broad audiences to explore. More data to learn from. Old strategies are obsolete.' },

      { type: 'visual', title: 'What The Algorithm Wants Now', visualType: 'stats', data: [
        { value: '15+', label: 'Diverse Creatives', sublabel: 'Feed it options, not one winner', color: '#3b82f6' },
        { value: 'Broad', label: 'Audience Size', sublabel: 'Let it explore and learn', color: '#8b5cf6' },
        { value: '50+', label: 'Conversions/Week', sublabel: 'Fuel the learning loop', color: '#ec4899' }
      ]},

      { type: 'quiz', question: 'What is the STRONGEST signal you can give Meta\'s algorithm?', options: [
        { text: 'Link Click', isCorrect: false, feedback: 'Clicks are weak signals. They show curiosity, not intent. The algorithm needs stronger proof.' },
        { text: 'Add to Cart', isCorrect: false, feedback: 'Close! Add to cart is strong, but there\'s one signal that\'s even more powerful.' },
        { text: 'Purchase', isCorrect: true, feedback: 'Exactly! A purchase is the ultimate signal. Money changed hands. This tells Meta: "Find MORE people exactly like this." Every purchase makes the algorithm smarter.' },
        { text: 'Page View', isCorrect: false, feedback: 'Page views show interest, but they\'re medium-strength signals. Meta needs proof of intent.' }
      ]},

      { type: 'completion', title: 'You Now Understand the Loop', summary: [
        'Meta is a learning machine that finds people who resemble your converters',
        'The 4-step loop (TEST â†’ OBSERVE â†’ ANALYZE â†’ FIND MORE) runs constantly',
        'Your job is to feed it high-quality signals through purchases and conversions',
        'Post-Andromeda, the algorithm craves volume and diversity - not one perfect ad'
      ]}
    ];

    // Slide Components
    const WelcomeSlide = ({ goals, onStart }) => (
      <div className="min-h-screen bg-white flex flex-col items-center justify-center p-6 text-center">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }}>
          <div className="inline-flex items-center gap-2 px-4 py-2 bg-blue-50 rounded-full mb-6">
            <Icons.Brain />
            <span className="text-sm font-semibold text-blue-900">Meta AI Deep Dive</span>
          </div>
          <h1 id="lesson-title" className="text-4xl md:text-6xl font-black mb-4 text-neutral-900 title-font">
            {LESSON_CONFIG.title}
          </h1>
          <p className="text-xl text-neutral-600 mb-8 max-w-2xl mx-auto">{LESSON_CONFIG.description}</p>
          <div className="bg-neutral-50 rounded-2xl p-8 mb-8 max-w-xl mx-auto text-left">
            <h3 className="text-lg font-bold mb-4 text-neutral-900">What You'll Discover:</h3>
            <ul className="space-y-3">
              {goals.map((goal, i) => (
                <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.1 }} className="flex items-start gap-3">
                  <div className="w-5 h-5 rounded-full bg-blue-500 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <Icons.Check />
                  </div>
                  <span className="text-neutral-700">{goal}</span>
                </motion.li>
              ))}
            </ul>
          </div>
          <motion.button onClick={onStart} whileHover={{ scale: 1.05 }} whileTap={{ scale: 0.95 }} className="px-8 py-4 bg-blue-500 text-white rounded-full font-semibold text-lg hover:bg-blue-600 transition-colors">
            Start Learning â†’
          </motion.button>
        </motion.div>
      </div>
    );

    const HookSlide = ({ headline, subtext }) => (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-6">
        <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.7 }} className="max-w-3xl text-center">
          <h2 className="text-3xl md:text-5xl font-black mb-6 text-neutral-900 title-font leading-tight">{headline}</h2>
          <p className="text-xl text-neutral-600 leading-relaxed">{subtext}</p>
        </motion.div>
      </div>
    );

    const ContentSlide = ({ title, body, ranking }) => (
      <div className="min-h-screen bg-white flex items-center justify-center p-6">
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ duration: 0.5 }} className="max-w-3xl">
          <h2 className="text-3xl md:text-4xl font-black mb-6 text-neutral-900 title-font">{title}</h2>
          <p className="text-lg md:text-xl text-neutral-700 leading-relaxed">{body}</p>
          {ranking && (
            <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-8">
              {ranking.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.1 }} className="bg-neutral-50 rounded-xl p-4 text-center">
                  <div className="text-2xl font-bold text-blue-600 mb-1">{item.value}</div>
                  <div className="text-sm text-neutral-600">{item.name}</div>
                </motion.div>
              ))}
            </div>
          )}
        </motion.div>
      </div>
    );

    const CardsSlide = ({ title, items }) => (
      <div className="min-h-screen bg-white flex items-center justify-center p-6 slide-scroll overflow-y-auto">
        <div className="max-w-5xl w-full py-12">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-black mb-8 text-neutral-900 title-font text-center">{title}</motion.h2>
          <div className="grid md:grid-cols-2 gap-6">
            {items.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="bg-gradient-to-br from-neutral-50 to-white rounded-2xl p-6 border border-neutral-200">
                <div className="flex items-start gap-4">
                  {item.icon && (
                    <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0" style={{ backgroundColor: item.color + '20', color: item.color }}>
                      <item.icon />
                    </div>
                  )}
                  <div>
                    <h3 className="text-xl font-bold mb-2 text-neutral-900">{item.title}</h3>
                    <p className="text-neutral-600 leading-relaxed">{item.description}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      </div>
    );

    const LoopVisualizationSlide = ({ title, steps }) => (
      <div className="min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 flex items-center justify-center p-6">
        <div className="max-w-4xl w-full">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-black mb-12 text-neutral-900 title-font text-center">{title}</motion.h2>
          <div className="relative">
            <svg className="absolute inset-0 w-full h-full" style={{ zIndex: 0 }}>
              <motion.circle cx="50%" cy="50%" r="45%" fill="none" stroke="#e5e7eb" strokeWidth="2" strokeDasharray="5,5" initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ duration: 2, ease: "easeInOut" }} />
            </svg>
            <div className="grid grid-cols-2 gap-8 relative z-10">
              {steps.map((step, i) => (
                <motion.div key={i} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.2 }} className="flex flex-col items-center text-center">
                  <div className="w-32 h-32 rounded-full flex flex-col items-center justify-center mb-4 shadow-lg" style={{ backgroundColor: step.color }}>
                    <div className="text-white text-2xl font-black">{step.step}</div>
                    <div className="text-white text-lg font-bold mt-1">{step.label}</div>
                  </div>
                  <div className="text-sm text-neutral-600 font-medium">{step.sublabel}</div>
                </motion.div>
              ))}
            </div>
          </div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }} className="text-center text-neutral-600 mt-12 text-lg">
            This loop runs continuously. Every conversion makes it smarter.
          </motion.p>
        </div>
      </div>
    );

    const SignalQualitySlide = ({ title, signals }) => (
      <div className="min-h-screen bg-white flex items-center justify-center p-6">
        <div className="max-w-4xl w-full">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-black mb-8 text-neutral-900 title-font text-center">{title}</motion.h2>
          <div className="space-y-4">
            {signals.map((signal, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.15 }} className="bg-neutral-50 rounded-xl p-6">
                <div className="flex items-center justify-between mb-3">
                  <div className="flex items-center gap-4">
                    <div className="text-2xl font-black" style={{ color: signal.color }}>{signal.event}</div>
                    <div className="px-3 py-1 rounded-full text-xs font-semibold" style={{ backgroundColor: signal.color + '20', color: signal.color }}>
                      {signal.label}
                    </div>
                  </div>
                  <div className="text-3xl font-black" style={{ color: signal.color }}>{signal.quality}/10</div>
                </div>
                <div className="w-full bg-neutral-200 rounded-full h-2 mb-3">
                  <motion.div initial={{ width: 0 }} animate={{ width: `${signal.quality * 10}%` }} transition={{ duration: 1, delay: 0.3 + i * 0.15 }} className="h-2 rounded-full" style={{ backgroundColor: signal.color }} />
                </div>
                <p className="text-neutral-600">{signal.description}</p>
              </motion.div>
            ))}
          </div>
        </div>
      </div>
    );

    const VisualSlide = ({ title, visualType, data }) => {
      if (visualType === 'comparison') {
        return (
          <div className="min-h-screen bg-white flex items-center justify-center p-6">
            <div className="max-w-5xl w-full">
              <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-black mb-8 text-neutral-900 title-font text-center">{title}</motion.h2>
              <div className="grid md:grid-cols-2 gap-8">
                <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-2xl p-8 border-4" style={{ borderColor: data.left.color, backgroundColor: data.left.color + '10' }}>
                  <h3 className="text-2xl font-bold mb-6 text-neutral-900">{data.left.label}</h3>
                  <ul className="space-y-3">
                    {data.left.points.map((point, i) => (
                      <li key={i} className="flex items-start gap-3">
                        <span className="text-neutral-700">{point}</span>
                      </li>
                    ))}
                  </ul>
                </motion.div>
                <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-2xl p-8 border-4" style={{ borderColor: data.right.color, backgroundColor: data.right.color + '10' }}>
                  <h3 className="text-2xl font-bold mb-6 text-neutral-900">{data.right.label}</h3>
                  <ul className="space-y-3">
                    {data.right.points.map((point, i) => (
                      <li key={i} className="flex items-start gap-3">
                        <span className="text-neutral-700">{point}</span>
                      </li>
                    ))}
                  </ul>
                </motion.div>
              </div>
            </div>
          </div>
        );
      }

      if (visualType === 'stats') {
        return (
          <div className="min-h-screen bg-gradient-to-br from-blue-50 to-purple-50 flex items-center justify-center p-6">
            <div className="max-w-5xl w-full">
              <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-black mb-12 text-neutral-900 title-font text-center">{title}</motion.h2>
              <div className="grid md:grid-cols-3 gap-8">
                {data.map((stat, i) => (
                  <motion.div key={i} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.15 }} className="bg-white rounded-2xl p-8 text-center shadow-lg">
                    <div className="text-5xl md:text-6xl font-black mb-3" style={{ color: stat.color }}>{stat.value}</div>
                    <div className="text-xl font-bold text-neutral-900 mb-2">{stat.label}</div>
                    <div className="text-sm text-neutral-600">{stat.sublabel}</div>
                  </motion.div>
                ))}
              </div>
            </div>
          </div>
        );
      }

      return null;
    };

    const QuizSlide = ({ question, options, onAnswer }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);

      const handleSelect = (index) => {
        setSelected(index);
        setShowFeedback(true);
        setTimeout(() => {
          if (options[index].isCorrect) {
            onAnswer(true);
          }
        }, 3000);
      };

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-white flex items-center justify-center p-6">
          <div className="max-w-3xl w-full">
            <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-2xl md:text-3xl font-black mb-8 text-neutral-900 title-font text-center">{question}</motion.h2>
            <div className="space-y-4">
              {options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }} onClick={() => !showFeedback && handleSelect(i)} disabled={showFeedback} className={`w-full p-6 rounded-xl text-left transition-all ${selected === i ? (option.isCorrect ? 'bg-green-500 text-white' : 'bg-red-500 text-white') : 'bg-white hover:bg-neutral-50 border-2 border-neutral-200'} ${showFeedback && 'cursor-not-allowed'}`}>
                  <div className="font-semibold text-lg">{option.text}</div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && selected !== null && (
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className="mt-8 p-6 bg-neutral-900 text-white rounded-2xl">
                  <div className="flex items-start gap-4">
                    <video autoPlay loop muted playsInline className="w-32 h-32 rounded-xl object-cover">
                      <source src={options[selected].isCorrect ? getRandomCelebrationGif() : getRandomEmpathyGif()} type="video/mp4" />
                    </video>
                    <div>
                      <h3 className="font-bold text-xl mb-2">{options[selected].isCorrect ? 'Exactly right!' : 'Not quite!'}</h3>
                      <p className="text-neutral-300 leading-relaxed">{options[selected].feedback}</p>
                    </div>
                  </div>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ title, summary, onNext }) => (
      <div className="min-h-screen bg-gradient-to-br from-blue-600 to-purple-600 flex items-center justify-center p-6">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.6 }} className="max-w-3xl w-full text-center text-white">
          <div className="text-6xl mb-6">ðŸŽ¯</div>
          <h2 className="text-4xl md:text-5xl font-black mb-6 title-font">{title}</h2>
          <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-8 mb-8 text-left">
            <h3 className="text-xl font-bold mb-4">Key Takeaways:</h3>
            <ul className="space-y-3">
              {summary.map((item, i) => (
                <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.1 }} className="flex items-start gap-3">
                  <div className="w-6 h-6 rounded-full bg-white/20 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <Icons.Check />
                  </div>
                  <span className="text-white/90">{item}</span>
                </motion.li>
              ))}
            </ul>
          </div>
          {LESSON_CONFIG.nextLesson && (
            <div className="bg-white/10 backdrop-blur-sm rounded-2xl p-6 mb-6">
              <div className="text-sm font-semibold mb-2 text-white/70">Up Next:</div>
              <div className="text-2xl font-bold mb-2">{LESSON_CONFIG.nextLesson.title}</div>
              <div className="text-white/80 mb-4">{LESSON_CONFIG.nextLesson.teaser}</div>
              <button onClick={onNext} className="px-6 py-3 bg-white text-blue-600 rounded-full font-semibold hover:bg-blue-50 transition-colors">
                Continue Learning â†’
              </button>
            </div>
          )}
          <button onClick={() => window.parent.postMessage({ type: 'LESSON_COMPLETE', lessonId: LESSON_CONFIG.id }, '*')} className="px-6 py-3 bg-white/20 backdrop-blur-sm text-white rounded-full font-semibold hover:bg-white/30 transition-colors">
            Back to Dashboard
          </button>
        </motion.div>
      </div>
    );

    // Main App
    function LessonApp() {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);

      const nextSlide = useCallback(() => {
        setDirection(1);
        setCurrentSlide(prev => Math.min(prev + 1, slides.length - 1));
      }, []);

      const prevSlide = useCallback(() => {
        setDirection(-1);
        setCurrentSlide(prev => Math.max(prev - 1, 0));
      }, []);

      useEffect(() => {
        const handleKeyPress = (e) => {
          if (e.key === 'ArrowRight') nextSlide();
          if (e.key === 'ArrowLeft') prevSlide();
        };
        window.addEventListener('keydown', handleKeyPress);
        return () => window.removeEventListener('keydown', handleKeyPress);
      }, [nextSlide, prevSlide]);

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide goals={slide.learningGoals} onStart={nextSlide} />;
          case 'hook': return <HookSlide headline={slide.headline} subtext={slide.subtext} />;
          case 'content': return <ContentSlide title={slide.title} body={slide.body} ranking={slide.ranking} />;
          case 'cards': return <CardsSlide title={slide.title} items={slide.items} />;
          case 'loopVisualization': return <LoopVisualizationSlide title={slide.title} steps={slide.steps} />;
          case 'signalQuality': return <SignalQualitySlide title={slide.title} signals={slide.signals} />;
          case 'visual': return <VisualSlide title={slide.title} visualType={slide.visualType} data={slide.data} />;
          case 'quiz': return <QuizSlide question={slide.question} options={slide.options} onAnswer={nextSlide} />;
          case 'completion': return <CompletionSlide title={slide.title} summary={slide.summary} onNext={() => window.location.href = `/lessons/${LESSON_CONFIG.nextLesson.id}/lesson.html`} />;
          default: return null;
        }
      };

      return (
        <div className="relative w-full h-screen overflow-hidden bg-white">
          <AnimatePresence mode="wait" custom={direction}>
            <motion.div key={currentSlide} custom={direction} initial={{ opacity: 0, x: direction * 100 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: direction * -100 }} transition={{ duration: 0.5, ease: [0.25, 0.4, 0.25, 1] }}>
              {renderSlide(slides[currentSlide])}
            </motion.div>
          </AnimatePresence>

          {currentSlide > 0 && currentSlide < slides.length - 1 && (
            <div className="fixed bottom-8 left-1/2 transform -translate-x-1/2 flex items-center gap-4 bg-white/90 backdrop-blur-sm px-6 py-3 rounded-full shadow-lg border border-neutral-200 z-50">
              <button onClick={prevSlide} disabled={currentSlide === 0} className="w-10 h-10 rounded-full bg-neutral-100 hover:bg-neutral-200 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors">
                <svg className="w-5 h-5 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>
              </button>
              <div className="flex gap-1.5">
                {slides.map((_, i) => (
                  <div key={i} className={`h-2 rounded-full transition-all ${i === currentSlide ? 'w-8 bg-blue-500' : 'w-2 bg-neutral-300'}`} />
                ))}
              </div>
              <button onClick={nextSlide} disabled={currentSlide === slides.length - 1} className="w-10 h-10 rounded-full bg-blue-500 hover:bg-blue-600 disabled:opacity-30 disabled:cursor-not-allowed flex items-center justify-center transition-colors text-white">
                <Icons.ArrowRight />
              </button>
            </div>
          )}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
