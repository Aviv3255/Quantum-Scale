<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Familiar Surprise Secret | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #88da1c;
      --accent-dark: #6fb816;
      --accent-rgb: 136, 218, 28;
      --error: #EF4444;
      --success: #88da1c;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #fff;
      -webkit-font-smoothing: antialiased;
    }
    ::selection { background: var(--accent); color: #000; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    // ============================================
    // USER NAME FROM URL
    // ============================================
    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    // ============================================
    // LESSON CONFIG
    // ============================================
    const LESSON_CONFIG = {
      id: 'familiar-surprise-secret',
      title: 'The Familiar Surprise Secret',
      subtitle: 'Why 70% familiar + 30% novel is the formula that makes customers say "I need this."',
      duration: '5 min',
      nextLesson: {
        id: 'red-button-effect',
        title: 'The Red Button Effect',
        teaser: 'How to create irresistible CTAs that customers physically cannot ignore.'
      }
    };

    // ============================================
    // CELEBRATION & EMPATHY VIDEOS
    // ============================================
    const celebrationVideos = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
    ];
    const empathyVideos = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
    ];
    const getRandomVideo = (arr) => arr[Math.floor(Math.random() * arr.length)];

    // ============================================
    // ICONS (Lucide-style SVGs)
    // ============================================
    const Icons = {
      Clock: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
      X: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Sparkles: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      Zap: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Brain: ({ size = 16 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/></svg>,
    };

    // ============================================
    // SLIDE DATA
    // ============================================
    const slides = [
      // 0: Welcome
      { type: 'welcome', learningGoals: [
        'The "MAYA Principle" that makes products irresistible',
        'Why 100% unique products FAIL on Shopify',
        'The 70/30 formula top stores use to convert browsers'
      ]},
      // 1: Hook
      { type: 'hook', headline: 'Spotify almost killed their biggest feature.', body: 'Their "Discover Weekly" playlist served users 100% new music. Songs they\'d never heard. Artists they\'d never seen. The result? Engagement tanked. Users stopped clicking. Until they discovered the secret...' },
      // 2: Content - The Fix
      { type: 'content', title: 'The Fix That Changed Everything', body: 'When Spotify added just 30% familiar songs - tracks users already loved - engagement skyrocketed 40%. Save rates tripled. Return rates doubled. Users didn\'t want ALL new. They wanted new wrapped in familiar.' },
      // 3: Visual - MAYA Principle
      { type: 'maya', title: 'The MAYA Principle', subtitle: 'Most Advanced Yet Acceptable' },
      // 4: Content - Why This Matters
      { type: 'content', title: 'Why This Matters for Your Store', body: 'Your Shopify store faces the same challenge. Show customers something TOO familiar - they think "I\'ve seen this before." Show them something TOO new - their brain flags it as risky. The sweet spot? 70% familiar foundation, 30% novel twist.' },
      // 5: Example - Posture
      { type: 'example', scenario: 'Posture Corrector Store', before: { title: 'Too Generic', text: '"Fix your posture with our back brace. Comfortable and adjustable."' }, after: { title: 'MAYA Applied', text: '"The posture fix that works while you\'re sitting at your desk - no awkward straps visible under your shirt."' }, insight: 'Familiar problem (posture) + Novel twist (invisible, works while sitting)' },
      // 6: Formula Cards
      { type: 'cards', title: 'The 4-Part MAYA Formula', items: [
        { number: '01', title: 'Their Language', description: 'Use exact words your customers use. If they say "my back kills me" - say that, not "lumbar discomfort."' },
        { number: '02', title: 'Known Problems', description: 'Anchor to struggles they instantly recognize. "You know that 3pm slump when your back starts aching..."' },
        { number: '03', title: 'The Twist', description: 'Once they\'re nodding, reveal your unique angle. "But what if the problem isn\'t your chair - it\'s your first 10 minutes?"' },
        { number: '04', title: 'Bridge to Solution', description: 'Connect your novel mechanism to their familiar goal. Same destination, surprising new path.' }
      ]},
      // 7: Example - Pet
      { type: 'example', scenario: 'Pet Products Store', before: { title: 'Too Novel', text: '"Revolutionary AI-powered smart collar with biometric sensors and cloud connectivity."' }, after: { title: 'MAYA Applied', text: '"Finally - a collar that tells you when your dog needs a vet visit. Before they even show symptoms."' }, insight: 'Familiar product (collar) + Familiar concern (vet visits) + Novel benefit (early detection)' },
      // 8: Stats - Brain Science
      { type: 'stats', title: 'The Brain Science', stats: [
        { value: '40%', label: 'Faster Processing', description: 'Brain handles familiar things 40% faster' },
        { value: '0', label: 'Dopamine Spike', description: 'Pure familiarity = no excitement' },
        { value: '2x', label: 'Engagement', description: 'Novel-familiar mix doubles attention' }
      ]},
      // 9: Content - Application
      { type: 'content', title: 'The Shopify Application', body: 'Your product page needs both anchors. Start with what they KNOW (the problem, the desire, familiar product category). Then reveal what makes YOU different (your mechanism, your angle, your proof). This order matters - familiar first, then novel.' },
      // 10: Example - Skincare
      { type: 'example', scenario: 'Skincare Store', before: { title: 'Wrong Order', text: '"Our patented CeraMatrix-7 technology uses nano-encapsulation to deliver actives at the cellular level."' }, after: { title: 'MAYA Applied', text: '"That stubborn dark spot that won\'t fade? There\'s a reason - and it\'s not your serum. It\'s the barrier your skin builds at night."' }, insight: 'Lead with familiar frustration, then introduce novel mechanism' },
      // 11: Checklist Cards
      { type: 'checklist', title: 'Quick MAYA Checklist', items: [
        { title: 'Headline', description: 'Does it reference a problem they\'d describe in their own words?' },
        { title: 'Subheadline', description: 'Does it hint at a fresh angle without being confusing?' },
        { title: 'Body Copy', description: 'Do you anchor to familiar desires before explaining your mechanism?' },
        { title: 'CTA', description: 'Does it feel safe enough to click but exciting enough to want to?' }
      ]},
      // 12: Quiz
      { type: 'quiz', question: 'What\'s the optimal balance for the MAYA Principle in your product page copy?', options: [
        { text: '100% familiar language - comfort is everything', correct: false },
        { text: '50% familiar / 50% novel - perfect balance', correct: false },
        { text: '70% familiar / 30% novel - comfort then surprise', correct: true },
        { text: '30% familiar / 70% novel - mostly unique', correct: false }
      ], feedback: { correct: 'Exactly! 70% familiar foundation creates trust, 30% novel twist creates desire. This is the formula that converts.', incorrect: 'Not quite. The magic ratio is 70% familiar to build comfort, then 30% novel to create excitement. Comfort first, then surprise.' }},
      // 13: Completion
      { type: 'completion' }
    ];

    // ============================================
    // SLIDE COMPONENTS
    // ============================================

    // Welcome Slide - Dark variant
    const WelcomeSlide = ({ data, onStart, userName }) => {
      const welcomeData = useMemo(() => typeof getTimeBasedWelcome === 'function' ? getTimeBasedWelcome() : { greeting: 'Welcome back, {name}!', gif: null }, []);

      return (
        <div className="h-full w-full bg-white p-6">
          <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center">
            <div className="max-w-2xl mx-auto w-full">
              {/* Duration Badge */}
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
                <span className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[#88da1c] text-black text-sm font-semibold">
                  <Icons.Clock size={14} />
                  {LESSON_CONFIG.duration}
                </span>
              </motion.div>

              {/* Title */}
              <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-4xl md:text-5xl font-bold text-white mb-4 tracking-tight leading-tight">
                {LESSON_CONFIG.title}
              </motion.h1>

              {/* Subtitle/Greeting */}
              <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg text-white/60 mb-8">
                {welcomeData.greeting.replace('{name}', userName)}
              </motion.p>

              {/* Learning Goals */}
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="mb-8">
                <h3 className="text-xs font-semibold uppercase tracking-widest text-white/40 mb-4">What you'll learn</h3>
                <ul className="space-y-3">
                  {data.learningGoals.map((goal, i) => (
                    <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.08 }} className="flex items-start gap-3">
                      <span className="flex-shrink-0 w-6 h-6 rounded-full bg-[#88da1c] flex items-center justify-center mt-0.5">
                        <Icons.Check size={12} className="text-black" />
                      </span>
                      <span className="text-white text-base">{goal}</span>
                    </motion.li>
                  ))}
                </ul>
              </motion.div>

              {/* Start Button */}
              <motion.button initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-8 py-4 rounded-xl bg-[#88da1c] text-black font-semibold text-base">
                Start Learning
              </motion.button>
            </div>
          </div>
        </div>
      );
    };

    // Hook Slide
    const HookSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center">
          <div className="max-w-3xl mx-auto">
            <motion.span initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-[#88da1c]/10 text-[#88da1c] text-xs font-semibold mb-6">
              <Icons.Zap size={12} />
              The Hook
            </motion.span>
            <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-3xl md:text-4xl font-bold text-white mb-6 leading-tight">
              {data.headline}
            </motion.h2>
            <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-lg text-white/70 leading-relaxed">
              {data.body}
            </motion.p>
          </div>
        </div>
      </div>
    );

    // Content Slide
    const ContentSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center">
          <div className="max-w-3xl mx-auto">
            <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-3xl md:text-4xl font-bold text-white mb-6 leading-tight">
              {data.title}
            </motion.h2>
            <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-lg text-white/70 leading-relaxed">
              {data.body}
            </motion.p>
          </div>
        </div>
      </div>
    );

    // MAYA Visual Slide
    const MAYASlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center">
          <div className="max-w-4xl mx-auto w-full">
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-10">
              <h2 className="text-3xl md:text-4xl font-bold text-white mb-2">{data.title}</h2>
              <p className="text-white/50 text-sm uppercase tracking-widest">{data.subtitle}</p>
            </motion.div>

            <div className="grid grid-cols-3 gap-4">
              {/* Too Familiar */}
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="bg-white/5 rounded-2xl p-6 text-center border-t-2 border-white/20">
                <div className="text-white/40 text-sm font-semibold uppercase tracking-wide mb-3">Too Familiar</div>
                <div className="text-2xl font-bold text-white/60 mb-2">100% Known</div>
                <div className="text-white/40 text-sm">Boring - They scroll past</div>
              </motion.div>

              {/* MAYA Zone */}
              <motion.div initial={{ opacity: 0, y: 30, scale: 0.95 }} animate={{ opacity: 1, y: 0, scale: 1 }} transition={{ delay: 0.2 }} className="bg-[#88da1c]/10 rounded-2xl p-6 text-center border-t-2 border-[#88da1c] relative">
                <div className="absolute -top-3 left-1/2 -translate-x-1/2 px-3 py-1 bg-[#88da1c] text-black text-xs font-bold rounded-full">SWEET SPOT</div>
                <div className="text-[#88da1c] text-sm font-semibold uppercase tracking-wide mb-3 mt-2">MAYA Zone</div>
                <div className="text-3xl font-bold text-white mb-2">70/30 Mix</div>
                <div className="text-[#88da1c] text-sm font-medium">Irresistible - They BUY</div>
              </motion.div>

              {/* Too Novel */}
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-white/5 rounded-2xl p-6 text-center border-t-2 border-white/20">
                <div className="text-white/40 text-sm font-semibold uppercase tracking-wide mb-3">Too Novel</div>
                <div className="text-2xl font-bold text-white/60 mb-2">100% New</div>
                <div className="text-white/40 text-sm">Scary - They back away</div>
              </motion.div>
            </div>
          </div>
        </div>
      </div>
    );

    // Example/BeforeAfter Slide
    const ExampleSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center overflow-y-auto slide-scroll">
          <div className="max-w-4xl mx-auto w-full">
            {/* Header */}
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
              <span className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-[#88da1c]/10 text-[#88da1c] text-xs font-semibold mb-3">
                Real Example
              </span>
              <h2 className="text-2xl md:text-3xl font-bold text-white">{data.scenario}</h2>
            </motion.div>

            {/* Before/After Cards */}
            <div className="grid md:grid-cols-2 gap-4 mb-6">
              {/* Before */}
              <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="bg-white/5 rounded-2xl overflow-hidden">
                <div className="h-1.5 bg-[#EF4444]" />
                <div className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <span className="w-8 h-8 rounded-full bg-[#EF4444] flex items-center justify-center">
                      <Icons.X size={14} className="text-white" />
                    </span>
                    <h3 className="text-lg font-bold text-white">{data.before.title}</h3>
                  </div>
                  <p className="text-white/60 text-sm leading-relaxed italic">"{data.before.text}"</p>
                </div>
              </motion.div>

              {/* After */}
              <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="bg-white/5 rounded-2xl overflow-hidden">
                <div className="h-1.5 bg-[#88da1c]" />
                <div className="p-6">
                  <div className="flex items-center gap-3 mb-4">
                    <span className="w-8 h-8 rounded-full bg-[#88da1c] flex items-center justify-center">
                      <Icons.Check size={14} className="text-black" />
                    </span>
                    <h3 className="text-lg font-bold text-white">{data.after.title}</h3>
                  </div>
                  <p className="text-white/60 text-sm leading-relaxed italic">"{data.after.text}"</p>
                </div>
              </motion.div>
            </div>

            {/* Insight */}
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="bg-[#88da1c]/10 rounded-xl p-4 text-center">
              <p className="text-[#88da1c] text-sm font-medium flex items-center justify-center gap-2">
                <Icons.Zap size={14} />
                {data.insight}
              </p>
            </motion.div>
          </div>
        </div>
      </div>
    );

    // Cards Slide
    const CardsSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center overflow-y-auto slide-scroll">
          <div className="max-w-4xl mx-auto w-full">
            <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-2xl md:text-3xl font-bold text-white text-center mb-8">
              {data.title}
            </motion.h2>

            <div className="grid md:grid-cols-2 gap-4">
              {data.items.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.08 }} className="bg-white/5 rounded-2xl p-6 border border-white/10 hover:border-[#88da1c]/30 transition-colors">
                  {item.number && <span className="text-[#88da1c] text-xs font-bold mb-2 block">{item.number}</span>}
                  <h3 className="text-lg font-bold text-white mb-2">{item.title}</h3>
                  <p className="text-white/60 text-sm leading-relaxed">{item.description}</p>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );

    // Stats Slide
    const StatsSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center">
          <div className="max-w-4xl mx-auto w-full">
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-10">
              <span className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-[#88da1c]/10 text-[#88da1c] text-xs font-semibold mb-4">
                <Icons.Brain size={14} />
                Brain Science
              </span>
              <h2 className="text-3xl md:text-4xl font-bold text-white">{data.title}</h2>
            </motion.div>

            <div className="grid md:grid-cols-3 gap-4">
              {data.stats.map((stat, i) => (
                <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="bg-white/5 rounded-2xl p-8 text-center border border-white/10">
                  <div className="text-4xl md:text-5xl font-bold text-[#88da1c] mb-2">{stat.value}</div>
                  <div className="text-white font-semibold text-sm mb-1">{stat.label}</div>
                  <div className="text-white/50 text-xs">{stat.description}</div>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );

    // Checklist Slide
    const ChecklistSlide = ({ data }) => (
      <div className="h-full w-full bg-white p-6">
        <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center overflow-y-auto slide-scroll">
          <div className="max-w-3xl mx-auto w-full">
            <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-2xl md:text-3xl font-bold text-white text-center mb-8">
              {data.title}
            </motion.h2>

            <div className="space-y-4">
              {data.items.map((item, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.08 }} className="bg-white/5 rounded-xl p-5 flex items-start gap-4 border border-white/10">
                  <span className="flex-shrink-0 w-6 h-6 rounded-md bg-[#88da1c]/20 flex items-center justify-center mt-0.5">
                    <Icons.Check size={12} className="text-[#88da1c]" />
                  </span>
                  <div>
                    <h3 className="text-white font-semibold mb-1">{item.title}</h3>
                    <p className="text-white/50 text-sm">{item.description}</p>
                  </div>
                </motion.div>
              ))}
            </div>
          </div>
        </div>
      </div>
    );

    // Quiz Slide
    const QuizSlide = ({ data, onShowVideo, onHideVideo }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationVideo = useMemo(() => getRandomVideo(celebrationVideos), []);
      const empathyVideo = useMemo(() => getRandomVideo(empathyVideos), []);

      const isCorrect = selected !== null && data.options[selected]?.correct;

      const handleSelect = (index) => {
        if (showFeedback) return;
        setSelected(index);
        setTimeout(() => {
          setShowFeedback(true);
          if (data.options[index]?.correct) {
            onShowVideo(celebrationVideo);
          } else {
            onShowVideo(empathyVideo);
          }
        }, 300);
      };

      useEffect(() => {
        return () => onHideVideo();
      }, [onHideVideo]);

      return (
        <div className="h-full w-full bg-white p-6">
          <div className="h-full bg-black rounded-3xl p-8 md:p-12 flex flex-col justify-center overflow-y-auto slide-scroll relative">
            <div className="max-w-2xl mx-auto w-full relative z-10">
              {/* Header */}
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
                <span className="inline-flex items-center gap-2 px-3 py-1.5 rounded-full bg-[#88da1c]/10 text-[#88da1c] text-xs font-semibold mb-4">
                  <Icons.Sparkles size={14} />
                  Knowledge Check
                </span>
                <h2 className="text-2xl md:text-3xl font-bold text-white">{data.question}</h2>
              </motion.div>

              {/* Options */}
              <div className="space-y-3 mb-6">
                {data.options.map((option, i) => {
                  const isSelected = selected === i;
                  const isOptionCorrect = option.correct;
                  let optionClass = 'bg-white/5 border-white/10 text-white';

                  if (showFeedback) {
                    if (isSelected && isOptionCorrect) {
                      optionClass = 'bg-[#88da1c] border-[#88da1c] text-black';
                    } else if (isSelected && !isOptionCorrect) {
                      optionClass = 'bg-[#EF4444] border-[#EF4444] text-white';
                    } else if (isOptionCorrect) {
                      optionClass = 'bg-[#88da1c]/20 border-[#88da1c] text-white';
                    } else {
                      optionClass = 'bg-white/5 border-white/10 text-white/40';
                    }
                  }

                  return (
                    <motion.button key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-5 rounded-xl text-left border transition-all ${optionClass} ${!showFeedback ? 'hover:bg-white/10 hover:border-white/20 cursor-pointer' : ''}`}>
                      <div className="flex items-center justify-between">
                        <span className="font-medium">{option.text}</span>
                        {showFeedback && isSelected && (
                          <motion.span initial={{ scale: 0 }} animate={{ scale: 1 }}>
                            {isOptionCorrect ? <Icons.Check size={20} /> : <Icons.X size={20} />}
                          </motion.span>
                        )}
                      </div>
                    </motion.button>
                  );
                })}
              </div>

              {/* Feedback */}
              <AnimatePresence>
                {showFeedback && (
                  <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className={`p-6 rounded-xl ${isCorrect ? 'bg-[#88da1c]/10' : 'bg-[#EF4444]/10'}`}>
                    <div className="flex items-start gap-4">
                      <span className={`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center ${isCorrect ? 'bg-[#88da1c]' : 'bg-[#EF4444]'}`}>
                        {isCorrect ? <Icons.Check size={18} className="text-black" /> : <Icons.X size={18} className="text-white" />}
                      </span>
                      <div>
                        <h3 className="text-lg font-bold text-white mb-1">{isCorrect ? 'Correct!' : 'Not Quite'}</h3>
                        <p className="text-white/60 text-sm">{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                      </div>
                    </div>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </div>
        </div>
      );
    };

    // Completion Slide - BRIGHT (white background)
    const CompletionSlide = () => (
      <div className="h-full w-full bg-white p-6 flex flex-col items-center justify-center">
        <div className="max-w-lg mx-auto text-center">
          {/* Success Icon */}
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', duration: 0.6 }} className="w-20 h-20 rounded-2xl bg-[#88da1c] flex items-center justify-center mx-auto mb-6 shadow-lg">
            <Icons.Check size={36} className="text-black" />
          </motion.div>

          {/* Title */}
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-3xl md:text-4xl font-bold text-black mb-4">
            Lesson Complete
          </motion.h2>

          {/* Summary */}
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="text-neutral-500 text-lg mb-8 leading-relaxed">
            You now know the secret: <span className="text-black font-semibold">70% familiar + 30% novel</span>. Use this ratio in every product page, every ad, every email. Watch conversions climb.
          </motion.p>

          {/* Next Lesson Preview */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-black rounded-2xl p-6 text-left">
            <p className="text-white/50 text-xs uppercase tracking-widest mb-2">Up Next</p>
            <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
            <p className="text-white/60 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
          </motion.div>
        </div>
      </div>
    );

    // ============================================
    // MAIN APP
    // ============================================
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const [isAnimating, setIsAnimating] = useState(false);
      const [videoUrl, setVideoUrl] = useState(null);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      // Send slide update to parent
      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length,
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const showVideo = useCallback((url) => setVideoUrl(url), []);
      const hideVideo = useCallback(() => setVideoUrl(null), []);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'maya': return <MAYASlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'cards': return <CardsSlide data={slide} />;
          case 'checklist': return <ChecklistSlide data={slide} />;
          case 'stats': return <StatsSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowVideo={showVideo} onHideVideo={hideVideo} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative overflow-hidden">
          {/* Slide Content */}
          <div className="flex-1 relative overflow-hidden">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.35, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
              </motion.div>
            </AnimatePresence>

            {/* Navigation Arrows */}
            {showPrev && (
              <button onClick={prevSlide} className="absolute left-8 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white shadow-lg border border-neutral-200 flex items-center justify-center text-neutral-500 hover:text-black hover:shadow-xl transition-all z-20">
                <Icons.ArrowLeft size={20} />
              </button>
            )}
            {showNext && (
              <button onClick={nextSlide} className="absolute right-8 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white shadow-lg border border-neutral-200 flex items-center justify-center text-neutral-500 hover:text-black hover:shadow-xl transition-all z-20">
                <Icons.ArrowRight size={20} />
              </button>
            )}
          </div>

          {/* Progress Dots */}
          <div className="py-5 border-t border-neutral-100 flex-shrink-0 bg-white">
            <div className="flex items-center justify-center gap-2">
              {slides.map((_, i) => (
                <button key={i} onClick={() => goToSlide(i)} className={`w-2 h-2 rounded-full transition-all duration-300 ${i === currentSlide ? 'bg-[#88da1c] scale-125' : 'bg-neutral-300 hover:bg-neutral-400'}`} />
              ))}
            </div>
          </div>

          {/* Video Overlay */}
          <AnimatePresence>
            {videoUrl && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} className="absolute bottom-20 right-8 z-30 pointer-events-none" style={{ height: '50%', maxHeight: '350px' }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain">
                  <source src={videoUrl} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
