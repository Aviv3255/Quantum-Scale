<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Email VS SMS for Recovering Abandoned Carts | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #88da1c; --accent-dark: #6fb815; --accent-light: #a3e635; --accent-rgb: 136, 218, 28; --error: #EF4444; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: #fff; -webkit-font-smoothing: antialiased; }
    h1, h2, h3, .slide-title { font-family: 'Inter', sans-serif; font-weight: 700; letter-spacing: -0.02em; line-height: 1.15; }
    ::selection { background: var(--accent); color: #000; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'abandoned-cart-recovery',
      title: 'Email VS SMS for Recovering Abandoned Carts',
      description: 'Industry data shows AI SMS can recover up to 85% of opened carts vs Email\'s typical 60%. Here\'s why.',
      accentColor: '#88da1c',
      duration: '7 min',
      nextLesson: { id: 'email-vs-sms', title: 'Email vs SMS Revenue', teaser: 'Which channel generates more revenue? The answer will surprise you.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1}`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/>
            <path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/>
          </svg>
        </button>
      );
    };

    // PRESERVED: All existing images/videos - NEVER TOUCH
    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_above_head_world_champion_celebration_484bd560-f049-41ca-b3d1-c03d7468ab56_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_starting_with_slow_clap_accelerating_to_fast_c_ee478a38-0ee7-437d-bd13-d687f7dd624a_0.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_wiping_away_a_small_tear_sad_but_gentle_disapp_8d78571b-3c36-4502-abee-81683255843c_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_sighing_sadly_exhaling_with_disappointment_hea_f6014f2a-3a99-4378-a2a8-414e16b3e72d_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_slouching_with_disappointment_body_curling_inw_caedddbe-413c-492a-9fdf-1e8433f5e2a8_2%20(1).mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_placing_hand_on_forehead_sadly_eyes_closed_fru_3e048895-f365-4ff2-9e88-0d0a35b2a9e1_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_nodding_slowly_with_sadness_what_a_shame_expre_377f67ca-63da-41aa-9072-4926fc2f6e82_3.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why AI SMS can recover up to 85% of carts vs Email\'s typical 60%', 'The revenue difference per recipient between channels', 'The critical SMS compliance issue most brands miss'] },
      { type: 'hook', headline: 'Email typically recovers 60% of opened abandoned carts. AI SMS? Up to 85%.', subtext: 'Industry data shows a clear pattern. When someone abandons a cart, AI SMS starts a real conversation. Email sends a template. One feels human. The other feels automated. Guess which one wins more often?' },
      { type: 'funnelChart', title: 'The Cart Abandonment Problem' },
      { type: 'comparisonBars', title: 'Email vs AI SMS: The Numbers' },
      { type: 'beforeAfter', title: 'Email vs AI SMS Recovery', before: { label: 'Email Recovery', items: ['25-27% open rate', '60% recovery when opened', '$2.60 per recipient average', 'One-way template message', 'No real-time objection handling'] }, after: { label: 'AI SMS Recovery', items: ['91-97% open rate', 'Up to 85% recovery when opened', '$7-8 per recipient potential', 'Two-way conversation', 'Real-time objection handling'] } },
      { type: 'quoteBlock', quote: 'Most people don\'t check email immediately. By the time they see it hours or days later, the buying moment has passed.', author: 'The Email Limitation' },
      { type: 'statCards', title: 'AI SMS Performance Benchmarks', stats: [{ value: '95%', label: 'Avg Open Rate', subtext: 'Read within 3 minutes', color: '#88da1c' }, { value: '85%', label: 'Recovery Potential', subtext: 'When conversation happens', color: '#88da1c' }, { value: '$7', label: 'Revenue/Recipient', subtext: 'Industry average range', color: '#88da1c' }] },
      { type: 'content', title: 'The AI Conversation Advantage', body: 'What makes AI SMS different? It starts a REAL conversation. Customer asks "Do you have it in blue?" AI answers "Yes, here\'s the link." Customer asks "Does it ship to Canada?" AI responds "Yes, 5-7 days." It handles objections in real-time. Email sends one message and waits. AI converses and converts.', characterVideo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_listening_carefully_hand_cupped_to_ear_100_pur_01938e87-bc4d-4e54-8675-cf6bdcd739c2_3.mp4', characterPosition: 'right' },
      { type: 'processSteps', title: 'Typical AI SMS Cart Recovery Flow', steps: [{ title: 'Cart Left', description: 'Hour 0' }, { title: 'Email Sent', description: '1 hour later' }, { title: 'AI SMS', description: '4 hours later' }, { title: 'Conversation', description: '2-5 minutes' }, { title: 'Purchase', description: 'Same day' }] },
      { type: 'conversationFlow', title: 'Real-Time Objection Handling' },
      { type: 'highlightBox', title: 'The Critical Compliance Issue', body: 'SMS has strict legal requirements under TCPA. If you spam customers, use wrong tactics, or don\'t get proper consent, you risk serious legal consequences.', highlight: 'One lawsuit can cost $500-$1,500 per message. The wrong SMS strategy can destroy your business.' },
      { type: 'iconGrid', title: 'SMS Compliance Essentials', items: [{ title: 'Explicit Consent', description: 'Customer must opt-in specifically for SMS. Email consent doesn\'t count.' }, { title: 'Message Limits', description: 'Don\'t spam. 3-4 cart recovery messages max. No messages after 9 PM.' }, { title: 'Easy Opt-Out', description: 'Every message needs clear unsubscribe. "Reply STOP" must always work.' }] },
      { type: 'beforeAfter', title: 'The Winning Strategy: Layered Recovery', before: { label: 'Single Channel', items: ['Email OR SMS only', 'One chance to recover', 'Lower overall recovery', 'Leaving money on table'] }, after: { label: 'Multi-Channel Sequence', items: ['Email at 1hr, SMS at 4hr', 'Multiple touchpoints', 'Potential 40-60% lift', 'Maximum cart recovery'] } },
      { type: 'content', title: 'Proven Recovery Systems Exist', body: 'Successful brands have spent years perfecting cart recovery timing, message sequences, and AI conversation flows. Industry best practices show that combining Email and SMS in the right sequence, with proper compliance and real-time AI conversations, can achieve recovery rates significantly higher than email alone.', characterVideo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_connecting_the_dots_drawing_lines_between_poin_66a88945-b2d0-442a-b48e-0c20060e3fcf_2.mp4', characterPosition: 'left' },
      { type: 'quiz', question: 'What\'s the typical AI SMS recovery rate potential vs Email?', options: ['AI SMS: 65% vs Email: 50%', 'AI SMS: up to 85% vs Email: 60%', 'AI SMS: 75% vs Email: 55%', 'Both have similar rates around 60%'], correctIndex: 1, feedback: { correct: 'Exactly! Industry data shows AI SMS can recover up to 85% of carts when opened vs Email\'s typical 60%. Combined with AI SMS\'s 91-97% open rate (vs Email\'s 25-27%), this explains the $7-8 per recipient potential compared to Email\'s $2.6 average.', incorrect: 'Not quite. Industry benchmarks show AI SMS can achieve up to 85% cart recovery vs Email\'s typical 60%. Combined with AI SMS\'s 91-97% open rate, that\'s why AI SMS shows $7-8 per recipient potential vs Email\'s $2.6 average.' }},
      { type: 'completion', sources: [{ name: 'TxtCart (AI SMS Recovery)', url: 'https://txtcartapp.com/affiliate/?mref=lsbqcbva' }, { name: 'Klaviyo (Email Flows)', url: 'https://www.klaviyo.com/partner/signup?utm_source=001Nu00000NY5EeIAL&utm_medium=partner' }] }
    ];

    // ============================================
    // ICONS
    // ============================================
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Mail: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="20" height="16" x="2" y="4" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>,
      MessageSquare: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>,
      TrendingUp: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      AlertTriangle: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      ShoppingCart: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="8" cy="21" r="1"/><circle cx="19" cy="21" r="1"/><path d="M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ChevronRight: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      Link: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/></svg>,
      Shield: ({ size = 20 }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
    };

    // ============================================
    // ANIMATED COUNTER
    // ============================================
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000, delay = 0 }) => {
      const [count, setCount] = useState(0);
      const [started, setStarted] = useState(false);
      useEffect(() => { const t = setTimeout(() => setStarted(true), delay * 1000); return () => clearTimeout(t); }, [delay]);
      useEffect(() => {
        if (!started) return;
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [started, target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // ============================================
    // SLIDE COMPONENTS - LIBRARY PATTERNS
    // ============================================

    // Welcome Slide
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full bg-white relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-4">
              <span className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold" style={{ background: 'var(--accent)', color: '#000' }}>
                <Icons.Clock /> {LESSON_CONFIG.duration}
              </span>
            </motion.div>
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-3xl md:text-4xl lg:text-5xl font-bold text-black mb-3 max-w-3xl">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-neutral-600 text-lg mb-6 max-w-lg" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-black">${userName}</span>`) }} />

            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-black rounded-2xl p-6 mb-6 max-w-md w-full">
              <p className="text-white/50 text-xs uppercase tracking-widest mb-4">What you'll learn</p>
              <ul className="space-y-3">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.08 }} className="flex items-start gap-3 text-left">
                    <span className="flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center mt-0.5" style={{ background: 'var(--accent)' }}>
                      <Icons.Check />
                    </span>
                    <span className="text-white text-sm leading-relaxed">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>

            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-8 py-3 rounded-xl text-black font-semibold text-base" style={{ background: 'var(--accent)' }}>
              Start Learning
            </motion.button>
          </div>
        </div>
      );
    };

    // Hook Slide
    const HookSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto py-10">
        <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
          <span className="inline-block px-4 py-1.5 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>The Hook</span>
          <h2 className="text-3xl md:text-4xl lg:text-5xl font-bold text-black leading-tight">{data.headline}</h2>
        </motion.div>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
      </div>
    );

    // Funnel Chart (Library Pattern)
    const FunnelChartSlide = ({ data }) => {
      const [step, setStep] = useState(0);
      useEffect(() => {
        const timers = [setTimeout(() => setStep(1), 400), setTimeout(() => setStep(2), 800), setTimeout(() => setStep(3), 1200), setTimeout(() => setStep(4), 1600), setTimeout(() => setStep(5), 2200)];
        return () => timers.forEach(t => clearTimeout(t));
      }, []);

      const stages = [
        { label: '100 Visitors', count: 100, color: '#22c55e', width: '100%' },
        { label: 'Add to Cart', count: 30, color: '#f59e0b', width: '70%' },
        { label: 'Start Checkout', count: 15, color: '#f59e0b', width: '50%' },
        { label: 'Complete Purchase', count: 8, color: '#88da1c', width: '30%' },
      ];

      return (
        <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(239, 68, 68, 0.1)', color: '#ef4444' }}>
              <Icons.ShoppingCart size={14} /> The Problem
            </span>
            <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
          </motion.div>

          {/* Dark funnel block */}
          <div className="bg-black rounded-2xl p-6">
            <div className="space-y-3 mb-6">
              {stages.map((stage, i) => (
                <motion.div key={stage.label}
                  initial={{ opacity: 0, scaleX: 0 }}
                  animate={{ opacity: step > i ? 1 : 0.2, scaleX: step > i ? 1 : 0 }}
                  style={{ transformOrigin: 'center', width: stage.width, margin: '0 auto' }}
                  transition={{ duration: 0.5 }}>
                  <div className="rounded-lg p-3 text-center" style={{ background: `linear-gradient(90deg, ${stage.color}30, ${stage.color}50)`, border: `1px solid ${stage.color}50` }}>
                    <div className="flex justify-between items-center text-white px-2">
                      <span className="text-sm">{stage.label}</span>
                      <span className="font-bold">{stage.count}</span>
                    </div>
                  </div>
                </motion.div>
              ))}
            </div>

            {/* Lost Revenue Highlight */}
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: step >= 5 ? 1 : 0, y: step >= 5 ? 0 : 20 }}
              className="p-4 rounded-xl text-center" style={{ background: 'rgba(239, 68, 68, 0.2)', border: '2px solid #ef4444' }}>
              <div className="text-4xl font-bold text-red-400 mb-1">70-80%</div>
              <div className="text-red-300 text-sm">Carts Abandoned = Lost Revenue</div>
            </motion.div>
          </div>
        </div>
      );
    };

    // Comparison Bars (Library Pattern)
    const ComparisonBarsSlide = ({ data }) => {
      const [step, setStep] = useState(0);
      useEffect(() => {
        const timers = [setTimeout(() => setStep(1), 500), setTimeout(() => setStep(2), 1200), setTimeout(() => setStep(3), 1900)];
        return () => timers.forEach(t => clearTimeout(t));
      }, []);

      const metrics = [
        { label: 'Open Rate', email: 26, sms: 95, emailLabel: '26%', smsLabel: '95%' },
        { label: 'Recovery Rate', email: 60, sms: 85, emailLabel: '60%', smsLabel: '85%' },
        { label: 'Revenue/Recipient', email: 26, sms: 75, emailLabel: '$2.60', smsLabel: '$7.50' },
      ];

      return (
        <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.TrendingUp size={14} /> Channel Battle
            </span>
            <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
          </motion.div>

          {/* Dark comparison block */}
          <div className="bg-black rounded-2xl p-6 space-y-5">
            {metrics.map((metric, i) => (
              <motion.div key={metric.label}
                initial={{ opacity: 0, y: 20 }}
                animate={{ opacity: step > i ? 1 : 0.3, y: step > i ? 0 : 20 }}
                className="p-4 rounded-xl" style={{ background: 'rgba(255,255,255,0.05)' }}>
                <div className="text-center text-white text-sm font-semibold mb-3">{metric.label}</div>
                <div className="grid grid-cols-2 gap-4">
                  {/* Email */}
                  <div className="text-center">
                    <div className="flex items-center justify-center gap-2 mb-2">
                      <Icons.Mail size={16} />
                      <span className="text-white/50 text-xs">Email</span>
                    </div>
                    <div className="h-3 bg-white/10 rounded-full overflow-hidden mb-2">
                      <motion.div initial={{ width: 0 }} animate={{ width: step > i ? `${metric.email}%` : 0 }} transition={{ duration: 0.8, delay: 0.3 }}
                        className="h-full rounded-full bg-neutral-500" />
                    </div>
                    <span className="text-white/70 text-lg font-bold">{metric.emailLabel}</span>
                  </div>
                  {/* SMS */}
                  <div className="text-center">
                    <div className="flex items-center justify-center gap-2 mb-2">
                      <Icons.MessageSquare size={16} />
                      <span className="text-white text-xs font-semibold">AI SMS</span>
                    </div>
                    <div className="h-3 bg-white/10 rounded-full overflow-hidden mb-2">
                      <motion.div initial={{ width: 0 }} animate={{ width: step > i ? `${metric.sms}%` : 0 }} transition={{ duration: 0.8, delay: 0.5 }}
                        className="h-full rounded-full" style={{ background: 'linear-gradient(90deg, var(--accent), var(--accent-light))', boxShadow: '0 0 15px rgba(136, 218, 28, 0.5)' }} />
                    </div>
                    <span className="text-lg font-bold" style={{ color: 'var(--accent)' }}>{metric.smsLabel}</span>
                  </div>
                </div>
              </motion.div>
            ))}

            <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: step >= 3 ? 1 : 0, scale: step >= 3 ? 1 : 0.9 }} className="text-center pt-2">
              <span className="inline-block px-4 py-2 rounded-full text-sm font-bold" style={{ background: 'var(--accent)', color: '#000' }}>
                SMS wins every metric
              </span>
            </motion.div>
          </div>
        </div>
      );
    };

    // Before/After Slide
    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="text-2xl md:text-3xl font-bold text-black">{data.title}</h2>
        </motion.div>

        <div className="grid md:grid-cols-2 gap-4">
          {/* Before */}
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
            className="bg-red-50 border-2 border-red-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div>
              <span className="font-semibold text-red-700 text-sm">{data.before.label}</span>
            </div>
            <ul className="space-y-2">
              {data.before.items.map((item, i) => (
                <li key={i} className="text-sm text-red-700 flex items-start gap-2">
                  <span className="text-red-400">-</span>{item}
                </li>
              ))}
            </ul>
          </motion.div>

          {/* After */}
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="bg-green-50 border-2 border-green-200 rounded-xl p-5">
            <div className="flex items-center gap-2 mb-4">
              <div className="w-6 h-6 rounded-full flex items-center justify-center text-black" style={{ background: 'var(--accent)' }}><Icons.Check /></div>
              <span className="font-semibold text-green-700 text-sm">{data.after.label}</span>
            </div>
            <ul className="space-y-2">
              {data.after.items.map((item, i) => (
                <li key={i} className="text-sm text-green-700 flex items-start gap-2">
                  <span style={{ color: 'var(--accent)' }}>+</span>{item}
                </li>
              ))}
            </ul>
          </motion.div>
        </div>
      </div>
    );

    // Quote Block
    const QuoteBlockSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-6 md:px-16 max-w-4xl mx-auto py-10">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="relative">
          <div className="absolute left-0 top-0 bottom-0 w-1 rounded-full" style={{ background: 'var(--accent)' }} />
          <div className="pl-8">
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
              className="text-2xl md:text-3xl lg:text-4xl font-bold text-black leading-relaxed mb-6">"{data.quote}"</motion.p>
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }} className="text-neutral-500 text-sm font-medium">â€” {data.author}</motion.p>
          </div>
        </motion.div>
      </div>
    );

    // Stat Cards
    const StatCardsSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
        </motion.div>

        <div className="grid md:grid-cols-3 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="bg-black rounded-2xl p-6 text-center">
              <div className="text-4xl font-bold mb-2" style={{ color: stat.color }}>{stat.value}</div>
              <div className="text-white text-sm font-medium mb-1">{stat.label}</div>
              <div className="text-white/50 text-xs">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Content Slide with Character
    const ContentSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto py-10 relative">
        <motion.h2 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="text-2xl md:text-3xl lg:text-4xl font-bold text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
        {data.characterVideo && (
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className={`absolute bottom-0 ${data.characterPosition === 'left' ? 'left-6' : 'right-6'} z-0 pointer-events-none hidden md:block`} style={{ height: '35%', maxHeight: '250px' }}>
            <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom"><source src={data.characterVideo} type="video/mp4" /></video>
          </motion.div>
        )}
      </div>
    );

    // Process Steps
    const ProcessStepsSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
        </motion.div>

        {/* Light background for variety */}
        <div className="bg-neutral-50 border border-neutral-200 rounded-2xl p-6">
          <div className="flex items-start justify-between overflow-x-auto">
            {data.steps.map((step, i) => (
              <React.Fragment key={i}>
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: i * 0.12 }}
                  className="flex flex-col items-center text-center flex-shrink-0 min-w-[80px]">
                  <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2 + i * 0.12, type: 'spring' }}
                    className="w-10 h-10 rounded-xl flex items-center justify-center font-bold text-sm mb-2"
                    style={{ background: 'var(--accent)', color: '#000' }}>{i + 1}</motion.div>
                  <h4 className="text-neutral-800 text-xs font-semibold mb-1">{step.title}</h4>
                  <p className="text-neutral-500 text-[10px]">{step.description}</p>
                </motion.div>
                {i < data.steps.length - 1 && (
                  <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.12 }}
                    className="flex items-center pt-4 px-1" style={{ color: 'var(--accent)' }}><Icons.ChevronRight size={16} /></motion.div>
                )}
              </React.Fragment>
            ))}
          </div>
        </div>
      </div>
    );

    // Conversation Flow (SMS vs Email animated)
    const ConversationFlowSlide = ({ data }) => {
      const [messageIndex, setMessageIndex] = useState(0);
      const conversation = [
        { sender: 'ai', text: 'Hey! Still thinking about those Blue Sneakers?' },
        { sender: 'customer', text: 'Yeah but $15 shipping is steep...' },
        { sender: 'ai', text: 'I can give you FREE shipping today. Want me to apply it?' },
        { sender: 'customer', text: 'Yes please!' },
        { sender: 'ai', text: 'Done! Here is your cart with free shipping:' },
      ];

      useEffect(() => {
        if (messageIndex < conversation.length) {
          const timer = setTimeout(() => setMessageIndex(prev => prev + 1), 1200);
          return () => clearTimeout(timer);
        }
      }, [messageIndex]);

      return (
        <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.MessageSquare size={14} /> Live Conversation
            </span>
            <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4">
            {/* Email (static) */}
            <div className="bg-neutral-100 border border-neutral-200 rounded-2xl p-4">
              <div className="flex items-center gap-2 mb-3 pb-2 border-b border-neutral-300">
                <Icons.Mail size={16} />
                <span className="text-neutral-600 text-sm font-semibold">Email</span>
                <span className="ml-auto text-neutral-400 text-xs">One-way</span>
              </div>
              <div className="bg-white rounded-lg p-3 border border-neutral-200">
                <div className="text-neutral-500 text-xs mb-2">Subject: You left items in your cart!</div>
                <div className="text-neutral-700 text-sm">Hey! Complete your order and get 10% off. [Link]</div>
              </div>
              <div className="mt-4 text-center">
                <span className="text-neutral-400 text-xs italic">No response possible...</span>
              </div>
            </div>

            {/* SMS (animated) */}
            <div className="bg-black rounded-2xl p-4 relative overflow-hidden">
              <div className="absolute top-0 left-0 w-full h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="flex items-center gap-2 mb-3 pb-2 border-b border-white/10">
                <Icons.MessageSquare size={16} />
                <span className="text-white text-sm font-semibold">AI SMS</span>
                <span className="ml-auto text-xs px-2 py-0.5 rounded-full" style={{ background: 'rgba(136, 218, 28, 0.2)', color: 'var(--accent)' }}>Two-way</span>
              </div>
              <div className="space-y-2 min-h-[160px]">
                {conversation.slice(0, messageIndex).map((msg, i) => (
                  <motion.div key={i} initial={{ opacity: 0, y: 10, scale: 0.95 }} animate={{ opacity: 1, y: 0, scale: 1 }}
                    className={`flex ${msg.sender === 'ai' ? 'justify-start' : 'justify-end'}`}>
                    <div className={`max-w-[80%] rounded-2xl px-3 py-2 ${msg.sender === 'ai' ? 'rounded-bl-sm' : 'rounded-br-sm'}`}
                      style={{ background: msg.sender === 'ai' ? 'var(--accent)' : '#374151' }}>
                      <div className={`text-sm ${msg.sender === 'ai' ? 'text-black' : 'text-white'}`}>{msg.text}</div>
                    </div>
                  </motion.div>
                ))}
              </div>
            </div>
          </div>

          <motion.div initial={{ opacity: 0 }} animate={{ opacity: messageIndex >= conversation.length ? 1 : 0 }} className="mt-4 text-center">
            <span className="inline-block px-4 py-2 rounded-xl text-sm font-semibold" style={{ background: 'rgba(34, 197, 94, 0.1)', color: '#22c55e', border: '1px solid rgba(34, 197, 94, 0.3)' }}>
              Objection handled. Cart recovered.
            </span>
          </motion.div>
        </div>
      );
    };

    // Highlight Box
    const HighlightBoxSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto py-10">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(239, 68, 68, 0.1)', color: '#ef4444' }}>
            <Icons.AlertTriangle size={14} /> Warning
          </span>
          <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
        </motion.div>

        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
          className="text-base md:text-lg text-neutral-600 leading-relaxed mb-6 text-center">{data.body}</motion.p>

        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
          className="rounded-xl p-6 text-center" style={{ background: 'linear-gradient(135deg, #ef4444, #dc2626)' }}>
          <p className="text-white text-lg font-bold">{data.highlight}</p>
        </motion.div>
      </div>
    );

    // Icon Grid
    const IconGridSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
          <span className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
            <Icons.Shield size={14} /> Compliance
          </span>
          <h2 className="text-2xl md:text-3xl lg:text-4xl font-bold text-black">{data.title}</h2>
        </motion.div>

        <div className="grid md:grid-cols-3 gap-4">
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="bg-neutral-50 border border-neutral-200 rounded-2xl p-5 text-center">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center mx-auto mb-4" style={{ background: 'var(--accent)', color: '#000' }}>
                <span className="text-xl font-bold">{i + 1}</span>
              </div>
              <h3 className="font-bold text-neutral-900 mb-2">{item.title}</h3>
              <p className="text-neutral-600 text-sm">{item.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Quiz Slide
    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { onShowGif(isCorrect ? celebrationGif : empathyGif, '55%', gifSide); } }, [showFeedback, isCorrect]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full bg-white w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-10 md:px-12 max-w-2xl mx-auto py-8 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <span className="inline-flex items-center gap-2 px-4 py-1.5 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>Knowledge Check</span>
              <h2 className="text-xl md:text-2xl font-bold text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback}
                  className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`} style={showFeedback && i === data.correctIndex ? { background: 'var(--accent)', color: '#000' } : {}}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // Completion Slide
    const CompletionSlide = ({ data }) => (
      <div className="h-full bg-white flex flex-col items-center justify-center text-center px-8 py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }}
          className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-black" style={{ background: 'var(--accent)' }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-2xl md:text-3xl font-bold text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">
          You now understand why AI SMS can achieve up to 85% recovery rates vs Email's typical 60%. Layer both channels strategically for maximum cart recovery.
        </motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-black rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-white/50 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-white/50 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
        {data?.sources && data.sources.length > 0 && (
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} className="bg-neutral-50 border border-neutral-200 rounded-xl p-4 max-w-md w-full">
            <p className="text-neutral-400 text-xs uppercase tracking-wider mb-2 flex items-center justify-center gap-1"><Icons.Link /> Relevant Sources</p>
            <div className="space-y-1.5">
              {data.sources.map((source, i) => (
                <a key={i} href={source.url} target="_blank" rel="noopener noreferrer" className="flex items-center justify-center gap-2 text-sm font-medium transition-colors hover:underline" style={{ color: 'var(--accent)' }}>
                  {source.name}
                  <Icons.ExternalLink />
                </a>
              ))}
            </div>
          </motion.div>
        )}
      </div>
    );

    // ============================================
    // MAIN APP
    // ============================================
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE', totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'funnelChart': return <FunnelChartSlide data={slide} />;
          case 'comparisonBars': return <ComparisonBarsSlide data={slide} />;
          case 'beforeAfter': return <BeforeAfterSlide data={slide} />;
          case 'quoteBlock': return <QuoteBlockSlide data={slide} />;
          case 'statCards': return <StatCardsSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'processSteps': return <ProcessStepsSlide data={slide} />;
          case 'conversationFlow': return <ConversationFlowSlide data={slide} />;
          case 'highlightBox': return <HighlightBoxSlide data={slide} />;
          case 'iconGrid': return <IconGridSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-2 md:left-5 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-2 md:right-5 top-1/2 -translate-y-1/2 w-10 h-10 md:w-12 md:h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }}
                className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom"><source src={gifConfig.url} type="video/mp4" /></video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
