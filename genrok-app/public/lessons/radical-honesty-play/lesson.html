<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Inside Joke Effect | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #f97316; --accent-dark: #ea580c; --accent-light: #fb923c; --accent-rgb: 249, 115, 22; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'radical-honesty-play',
      title: 'The Inside Joke Effect',
      description: 'When your audience has seen EVERY marketing trick, admit you are marketing.',
      accentColor: '#f97316',
      duration: '7 min',
      nextLesson: { id: 'reciprocity-engine', title: 'The Reciprocity Engine', teaser: 'Give first. The psychology of obligation that creates customers.' }
    };

    // ============ CONFIGURATION ARRAYS ============
    const PSYCHOLOGY_PILLARS = [
      { id: 1, name: 'Disarms Skepticism', icon: 'Shield', color: '#f97316', description: 'Hard to be cynical about someone MORE cynical than you.', quote: '"They get it. They are not trying to trick me."' },
      { id: 2, name: 'Creates In-Group', icon: 'Users', color: '#8b5cf6', description: 'You are not the target - you are part of the joke.', quote: '"We are both laughing at how absurd marketing is."' },
      { id: 3, name: 'Parasocial Bond', icon: 'Heart', color: '#ef4444', description: 'Feels like a real person, not a corporate robot.', quote: '"These are MY people. They think like me."' },
      { id: 4, name: 'Shareability', icon: 'Share2', color: '#10b981', description: 'You can not WAIT to show friends.', quote: '"Look at this insane job title!" - Free viral marketing.' }
    ];

    const BRAND_EXAMPLES = [
      {
        brand: 'Liquid Death',
        logo: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Liquid-Death-Emblem.png',
        color: '#000000',
        examples: [
          { label: 'Job Title', traditional: 'VP of Marketing', radical: 'VP of Cult Indoctrination' },
          { label: 'Product', traditional: 'Premium spring water', radical: 'Murder your thirst' },
          { label: 'Tagline', traditional: 'Pure, refreshing hydration', radical: 'Death to plastic' }
        ]
      },
      {
        brand: 'dbrand',
        logo: null,
        color: '#FF0000',
        examples: [
          { label: 'Manifesto', traditional: 'Our company values...', radical: '"This is propaganda"' },
          { label: 'Donation Page', traditional: 'Support our mission', radical: 'Extortion Portal' },
          { label: 'Customer Service', traditional: 'We apologize for...', radical: '"Yeah, it is late. Chill."' }
        ]
      }
    ];

    const COPY_TRANSFORMATION = {
      traditional: {
        label: 'TRADITIONAL SKINCARE',
        copy: '"Our revolutionary serum harnesses the power of rare botanicals to transform your skin."',
        reaction: 'Generic. Ignored. Eye roll.'
      },
      radical: {
        label: 'RADICAL HONESTY',
        copy: '"Look, it is overpriced face goo. But it works, it smells good, and the bottle looks sick on your shelf. Your call."',
        reaction: 'Shared. Quoted. Memed. Purchased.'
      }
    };

    const CUSTOMER_JOURNEY = {
      traditional: { label: 'TRADITIONAL', role: 'TARGET', description: 'Customer is the mark. Hide the selling.', result: 'Resistance. Skepticism. Distrust.' },
      radical: { label: 'RADICAL HONESTY', role: 'CO-CONSPIRATOR', description: 'Customer is in on the joke. Acknowledge the absurdity.', result: 'Connection. Loyalty. Advocacy.' }
    };

    const ELITE_INSIGHT = {
      title: 'The Meta-Game Paradox',
      insight: 'When everyone knows the marketing game, acknowledging the game becomes the winning move.',
      quote: 'Make them laugh at the absurdity of consumerism WHILE participating in it.'
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') __isAdmin = e.data.isAdmin;
    });
    if (window.parent !== window) window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Users: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Heart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      Share2: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></svg>,
      Eye: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      EyeOff: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Handshake: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m11 17 2 2a1 1 0 0 0 1.4 0l3-3a1 1 0 0 0 0-1.4L15 12"/><path d="m8 8 2.5 2.5"/><path d="M15 3a3 3 0 0 1 3 3v2"/><path d="M6 21a3 3 0 0 1-3-3v-2"/><path d="m3 9 4-4 3.9 3.9"/><path d="m21 15-4 4-3.9-3.9"/></svg>,
      Laugh: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><path d="M8 14s1.5 2 4 2 4-2 4-2"/><line x1="9" y1="9" x2="9.01" y2="9"/><line x1="15" y1="9" x2="15.01" y2="9"/></svg>,
      Brain: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 4.44-1.54z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-4.44-1.54z"/></svg>,
      Lightbulb: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M9 18h6"/><path d="M10 22h4"/><path d="M15.09 14c.18-.98.65-1.74 1.41-2.5A4.65 4.65 0 0 0 18 8 6 6 0 0 0 6 8c0 1 .23 2.23 1.5 3.5A4.61 4.61 0 0 1 8.91 14"/></svg>,
      Skull: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="12" r="1"/><circle cx="15" cy="12" r="1"/><path d="M8 20v2h8v-2"/><path d="m12.5 17-.5-1-.5 1h1z"/><path d="M16 20a2 2 0 0 0 1.56-3.25 8 8 0 1 0-11.12 0A2 2 0 0 0 8 20"/></svg>,
    };

    const PillarIcons = {
      Shield: Icons.Shield,
      Users: Icons.Users,
      Heart: Icons.Heart,
      Share2: Icons.Share2
    };

    // ============ CELEBRATION/EMPATHY GIFS ============
    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ SLIDES DATA ============
    const slides = [
      { type: 'welcome', learningGoals: ['Why traditional marketing backfires with skeptical audiences', 'The psychology of radical honesty (Liquid Death, dbrand)', 'How to make customers feel like co-conspirators, not targets'] },
      { type: 'hook', headline: 'Admit you are marketing. It IS the marketing.', subtext: 'Modern consumers have seen EVERY trick. They are exhausted by persuasion. The only surprise left? Total transparency. Liquid Death has a "VP of Cult Indoctrination." dbrand admits their manifesto is "propaganda." They are SO honest it disarms skepticism.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Liquid-Death-Emblem.png', brandName: 'Liquid Death' },
      { type: 'psychology-grid' },
      { type: 'brand-case-study', brandIndex: 0 },
      { type: 'brand-case-study', brandIndex: 1 },
      { type: 'copy-transformation' },
      { type: 'customer-journey' },
      { type: 'when-it-works' },
      { type: 'quiz', question: 'Your DTC brand gets a 1-star review: "This is overpriced and overhyped." What is the RADICAL HONESTY response?', options: ['Delete it and pretend it does not exist', '"We apologize you feel that way..."', '"You are right, it IS overpriced. Premium materials cost money. Not for everyone."', 'Attack the customer for not understanding quality'], correctIndex: 2, feedback: { correct: 'PERFECT. You acknowledged their point without getting defensive. This shows confidence and honesty - actually INCREASES trust with other customers reading reviews. You are not for everyone, and that is the point.', incorrect: 'The instinct is to defend or apologize. But the move is: AGREE with the criticism, own your positioning. This builds respect with customers who value your trade-offs.' }},
      { type: 'elite-insight' },
      { type: 'completion' }
    ];

    // ============ UNIQUE SLIDE COMPONENTS ============

    // Psychology Grid - 4 pillars with auto-cycling
    const PsychologyGridSlide = () => {
      const [activePillar, setActivePillar] = useState(0);

      useEffect(() => {
        const interval = setInterval(() => {
          setActivePillar(prev => (prev + 1) % 4);
        }, 2500);
        return () => clearInterval(interval);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-4xl text-black text-center mb-3">
            Why Radical Honesty Works
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }} className="text-neutral-500 text-center mb-8 text-sm">
            The psychology of disarming skeptical audiences
          </motion.p>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
            {PSYCHOLOGY_PILLARS.map((pillar, i) => {
              const IconComponent = PillarIcons[pillar.icon];
              const isActive = activePillar === i;
              return (
                <motion.div
                  key={pillar.id}
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.3 + i * 0.1 }}
                  onClick={() => setActivePillar(i)}
                  style={{
                    background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white',
                    border: isActive ? `2px solid ${pillar.color}` : '2px solid #e5e5e5',
                    boxShadow: isActive ? `0 0 30px ${pillar.color}30` : 'none',
                    cursor: 'pointer'
                  }}
                  className="rounded-2xl p-5 transition-all duration-500"
                >
                  <div className="flex flex-col items-center text-center">
                    <motion.div
                      animate={{ scale: isActive ? [1, 1.1, 1] : 1 }}
                      transition={{ duration: 1, repeat: isActive ? Infinity : 0 }}
                      className="w-12 h-12 rounded-xl flex items-center justify-center mb-3"
                      style={{ background: `${pillar.color}20`, color: pillar.color }}
                    >
                      <IconComponent />
                    </motion.div>
                    <h3 className={`font-bold text-sm mb-2 ${isActive ? 'text-white' : 'text-neutral-900'}`}>
                      {pillar.name}
                    </h3>
                    <p className={`text-xs ${isActive ? 'text-neutral-400' : 'text-neutral-500'}`}>
                      {pillar.description}
                    </p>
                    {isActive && (
                      <motion.p
                        initial={{ opacity: 0 }}
                        animate={{ opacity: 1 }}
                        className="text-xs italic mt-2"
                        style={{ color: pillar.color }}
                      >
                        {pillar.quote}
                      </motion.p>
                    )}
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Brand Case Study - Deep dive with examples
    const BrandCaseStudySlide = ({ brandIndex }) => {
      const brand = BRAND_EXAMPLES[brandIndex];
      const [activeExample, setActiveExample] = useState(0);

      useEffect(() => {
        const interval = setInterval(() => {
          setActiveExample(prev => (prev + 1) % brand.examples.length);
        }, 3000);
        return () => clearInterval(interval);
      }, [brand.examples.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-4xl mx-auto py-8">
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            className="text-center mb-6"
          >
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-bold mb-4" style={{ background: `${brand.color}20`, color: brand.color }}>
              CASE STUDY
            </div>
            <h2 className="slide-title text-3xl md:text-5xl text-black">{brand.brand}</h2>
          </motion.div>

          {brand.logo && (
            <motion.div
              initial={{ opacity: 0, scale: 0.9 }}
              animate={{ opacity: 1, scale: 1 }}
              className="flex justify-center mb-6"
            >
              <img src={brand.logo} alt={brand.brand} className="h-16 object-contain" />
            </motion.div>
          )}

          <div className="space-y-4">
            {brand.examples.map((example, i) => {
              const isActive = activeExample === i;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.3 + i * 0.1 }}
                  onClick={() => setActiveExample(i)}
                  className="rounded-xl overflow-hidden cursor-pointer"
                  style={{
                    background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white',
                    border: isActive ? `2px solid ${LESSON_CONFIG.accentColor}` : '2px solid #e5e5e5',
                    boxShadow: isActive ? `0 0 20px ${LESSON_CONFIG.accentColor}20` : 'none'
                  }}
                >
                  <div className="p-4">
                    <div className="flex items-center gap-2 mb-3">
                      <span className={`text-xs font-bold ${isActive ? 'text-white' : 'text-neutral-500'}`}>
                        {example.label}
                      </span>
                    </div>
                    <div className="grid md:grid-cols-2 gap-4">
                      <div className={`p-3 rounded-lg ${isActive ? 'bg-red-900/30' : 'bg-red-50'}`}>
                        <div className="flex items-center gap-2 mb-2">
                          <Icons.X />
                          <span className={`text-xs font-semibold ${isActive ? 'text-red-400' : 'text-red-600'}`}>Traditional</span>
                        </div>
                        <p className={`text-sm ${isActive ? 'text-neutral-300' : 'text-neutral-600'}`}>{example.traditional}</p>
                      </div>
                      <div className={`p-3 rounded-lg ${isActive ? 'bg-green-900/30' : 'bg-green-50'}`}>
                        <div className="flex items-center gap-2 mb-2">
                          <Icons.Check />
                          <span className={`text-xs font-semibold ${isActive ? 'text-green-400' : 'text-green-600'}`}>Radical Honesty</span>
                        </div>
                        <p className={`text-sm font-medium ${isActive ? 'text-white' : 'text-neutral-900'}`}>{example.radical}</p>
                      </div>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Copy Transformation - Side-by-side comparison
    const CopyTransformationSlide = () => {
      const [showWinner, setShowWinner] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 1500);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            The Copy Transformation
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8 text-sm">
            Same product. Different approach. Different results.
          </motion.p>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Traditional */}
            <motion.div
              initial={{ opacity: 0, x: -30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.2 }}
              className="rounded-2xl p-6 border-2 border-neutral-200 bg-white relative"
            >
              <div className="flex items-center gap-2 mb-4">
                <div className="w-10 h-10 rounded-xl bg-neutral-300 flex items-center justify-center">
                  <Icons.Eye />
                </div>
                <h3 className="font-bold text-neutral-700">{COPY_TRANSFORMATION.traditional.label}</h3>
              </div>
              <p className="text-neutral-600 italic text-sm leading-relaxed mb-4">
                {COPY_TRANSFORMATION.traditional.copy}
              </p>
              <div className="px-3 py-2 rounded-lg bg-red-50 text-red-600 text-xs font-medium">
                {COPY_TRANSFORMATION.traditional.reaction}
              </div>

              {showWinner && (
                <motion.div
                  initial={{ opacity: 0, scale: 0 }}
                  animate={{ opacity: 1, scale: 1 }}
                  className="absolute -top-3 -right-3 px-3 py-1 rounded-full bg-neutral-400 text-white text-xs font-bold"
                >
                  IGNORED
                </motion.div>
              )}
            </motion.div>

            {/* Radical Honesty */}
            <motion.div
              initial={{ opacity: 0, x: 30 }}
              animate={{ opacity: 1, x: 0 }}
              transition={{ delay: 0.3 }}
              className="rounded-2xl p-6 relative"
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                border: `2px solid ${LESSON_CONFIG.accentColor}`,
                boxShadow: `0 0 30px ${LESSON_CONFIG.accentColor}20`
              }}
            >
              <div className="flex items-center gap-2 mb-4">
                <div className="w-10 h-10 rounded-xl flex items-center justify-center" style={{ background: `${LESSON_CONFIG.accentColor}30`, color: LESSON_CONFIG.accentColor }}>
                  <Icons.Laugh />
                </div>
                <h3 className="font-bold text-white">{COPY_TRANSFORMATION.radical.label}</h3>
              </div>
              <p className="text-white italic text-sm leading-relaxed mb-4">
                {COPY_TRANSFORMATION.radical.copy}
              </p>
              <div className="px-3 py-2 rounded-lg text-xs font-medium" style={{ background: `${LESSON_CONFIG.accentColor}20`, color: LESSON_CONFIG.accentColor }}>
                {COPY_TRANSFORMATION.radical.reaction}
              </div>

              {showWinner && (
                <motion.div
                  initial={{ opacity: 0, scale: 0 }}
                  animate={{ opacity: 1, scale: 1 }}
                  className="absolute -top-3 -right-3 px-4 py-1.5 rounded-full text-white text-xs font-bold"
                  style={{ background: LESSON_CONFIG.accentColor }}
                >
                  SHARED
                </motion.div>
              )}
            </motion.div>
          </div>
        </div>
      );
    };

    // Customer Journey - Target vs Co-Conspirator
    const CustomerJourneySlide = () => {
      const [showTransform, setShowTransform] = useState(false);

      useEffect(() => {
        const timer = setTimeout(() => setShowTransform(true), 1000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            The Role Shift
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8 text-sm">
            Change how customers see themselves in your marketing
          </motion.p>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Traditional - TARGET */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.2 }}
              className="rounded-2xl p-6 border-2 border-red-200 bg-red-50 relative"
            >
              <div className="text-center">
                <motion.div
                  animate={{ scale: showTransform ? [1, 1.1, 1] : 1 }}
                  transition={{ duration: 1.5, repeat: Infinity }}
                  className="w-20 h-20 rounded-full bg-red-500 flex items-center justify-center mx-auto mb-4 text-white"
                >
                  <Icons.Target />
                </motion.div>
                <div className="text-xs font-bold text-red-500 mb-2">{CUSTOMER_JOURNEY.traditional.label}</div>
                <h3 className="font-bold text-2xl text-red-700 mb-3">{CUSTOMER_JOURNEY.traditional.role}</h3>
                <p className="text-red-800 text-sm mb-4">{CUSTOMER_JOURNEY.traditional.description}</p>
                <div className="px-4 py-2 rounded-lg bg-red-100 text-red-700 text-xs font-medium">
                  Result: {CUSTOMER_JOURNEY.traditional.result}
                </div>
              </div>
            </motion.div>

            {/* Radical - CO-CONSPIRATOR */}
            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="rounded-2xl p-6 relative"
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                border: `2px solid ${LESSON_CONFIG.accentColor}`,
                boxShadow: `0 0 30px ${LESSON_CONFIG.accentColor}20`
              }}
            >
              <div className="text-center">
                <motion.div
                  animate={{ rotate: showTransform ? [0, 5, -5, 0] : 0 }}
                  transition={{ duration: 2, repeat: Infinity }}
                  className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-4"
                  style={{ background: `${LESSON_CONFIG.accentColor}30`, color: LESSON_CONFIG.accentColor }}
                >
                  <Icons.Handshake />
                </motion.div>
                <div className="text-xs font-bold mb-2" style={{ color: LESSON_CONFIG.accentColor }}>{CUSTOMER_JOURNEY.radical.label}</div>
                <h3 className="font-bold text-2xl text-white mb-3">{CUSTOMER_JOURNEY.radical.role}</h3>
                <p className="text-neutral-300 text-sm mb-4">{CUSTOMER_JOURNEY.radical.description}</p>
                <div className="px-4 py-2 rounded-lg text-xs font-medium" style={{ background: `${LESSON_CONFIG.accentColor}20`, color: LESSON_CONFIG.accentColor }}>
                  Result: {CUSTOMER_JOURNEY.radical.result}
                </div>
              </div>
            </motion.div>
          </div>
        </div>
      );
    };

    // When It Works - Conditions
    const WhenItWorksSlide = () => {
      const conditions = [
        { icon: 'Users', text: 'Audience is marketing-savvy (Gen Z, Millennials, tech workers)', color: '#f97316' },
        { icon: 'Target', text: 'Product category is saturated and commoditized', color: '#8b5cf6' },
        { icon: 'Laugh', text: 'Brand voice can handle irreverence and humor', color: '#10b981' },
        { icon: 'Skull', text: 'Willing to alienate some to deeply connect with others', color: '#ef4444' }
      ];

      const ConditionIcons = {
        Users: Icons.Users,
        Target: Icons.Target,
        Laugh: Icons.Laugh,
        Skull: Icons.Skull
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            When Radical Honesty Works
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8 text-sm">
            Not for everyone. Know your audience first.
          </motion.p>

          <div className="space-y-4">
            {conditions.map((condition, i) => {
              const IconComponent = ConditionIcons[condition.icon];
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, x: -20 }}
                  animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.2 + i * 0.1 }}
                  className="flex items-center gap-4 p-4 rounded-xl"
                  style={{
                    background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                    border: `2px solid ${condition.color}30`
                  }}
                >
                  <div
                    className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                    style={{ background: `${condition.color}20`, color: condition.color }}
                  >
                    <IconComponent />
                  </div>
                  <p className="text-white text-sm md:text-base">{condition.text}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Elite Insight - The Meta-Game Paradox
    const EliteInsightSlide = () => {
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto py-8">
          <motion.div
            initial={{ opacity: 0, y: 30 }}
            animate={{ opacity: 1, y: 0 }}
            className="rounded-2xl p-8 md:p-12 text-center relative overflow-hidden"
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              boxShadow: `0 0 60px ${LESSON_CONFIG.accentColor}15`
            }}
          >
            {/* Top accent line */}
            <div
              className="absolute top-0 left-0 right-0 h-1"
              style={{ background: `linear-gradient(90deg, transparent, ${LESSON_CONFIG.accentColor}, transparent)` }}
            />

            <motion.div
              initial={{ opacity: 0, scale: 0 }}
              animate={{ opacity: 1, scale: 1 }}
              transition={{ delay: 0.2 }}
              className="w-16 h-16 rounded-2xl mx-auto mb-6 flex items-center justify-center"
              style={{ background: `${LESSON_CONFIG.accentColor}20`, color: LESSON_CONFIG.accentColor }}
            >
              <Icons.Brain />
            </motion.div>

            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.3 }}
              className="text-xs font-bold tracking-wider mb-4"
              style={{ color: LESSON_CONFIG.accentColor }}
            >
              ELITE INSIGHT
            </motion.div>

            <motion.h2
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.4 }}
              className="slide-title text-3xl md:text-4xl text-white mb-6"
            >
              {ELITE_INSIGHT.title}
            </motion.h2>

            <motion.p
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 0.5 }}
              className="text-neutral-300 text-lg md:text-xl leading-relaxed mb-8"
            >
              "{ELITE_INSIGHT.insight}"
            </motion.p>

            <motion.div
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.7 }}
              className="inline-flex items-center gap-2 px-5 py-3 rounded-xl"
              style={{ background: `${LESSON_CONFIG.accentColor}15`, border: `1px solid ${LESSON_CONFIG.accentColor}30` }}
            >
              <Icons.Lightbulb />
              <span className="text-sm font-medium" style={{ color: LESSON_CONFIG.accentColor }}>
                {ELITE_INSIGHT.quote}
              </span>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ STANDARD SLIDE COMPONENTS ============
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 0.8 }} />
          </motion.div>
        )}
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">You understand the radical honesty play. When traditional persuasion backfires with skeptical audiences, make them co-conspirators, not targets. Admit you are marketing - it IS the marketing.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'psychology-grid': return <PsychologyGridSlide />;
          case 'brand-case-study': return <BrandCaseStudySlide brandIndex={slide.brandIndex} />;
          case 'copy-transformation': return <CopyTransformationSlide />;
          case 'customer-journey': return <CustomerJourneySlide />;
          case 'when-it-works': return <WhenItWorksSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
