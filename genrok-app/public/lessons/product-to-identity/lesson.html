<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>From Product to Identity Purchase | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #ec4899;
      --accent-dark: #db2777;
      --accent-light: #f472b6;
      --accent-rgb: 236, 72, 153;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'product-to-identity',
      title: 'From Product to Identity Purchase',
      description: 'Transform what you sell from a commodity to an identity purchase.',
      accentColor: '#ec4899',
      duration: '6 min',
      nextLesson: {
        id: 'commodity-escape',
        title: 'The Commodity Trap',
        teaser: 'Why Starbucks charges $6 for coffee that costs them $0.50.'
      }
    };

    // Configuration Arrays
    const BRAND_EXAMPLES = [
      { id: 1, brand: 'Rolex', icon: 'Watch', color: '#c9a227', product: 'Luxury timepiece with Swiss craftsmanship', identity: 'I have arrived. Success is visible.', price: '$8,000+' },
      { id: 2, brand: 'Tesla', icon: 'Car', color: '#e82127', product: 'Electric vehicle with autopilot features', identity: 'I am the future. Innovation drives me.', price: '$45,000+' },
      { id: 3, brand: 'Lululemon', icon: 'Activity', color: '#d31334', product: 'Premium athletic wear, moisture-wicking', identity: 'I invest in myself. Wellness is my lifestyle.', price: '$98+' },
      { id: 4, brand: 'Apple', icon: 'Smartphone', color: '#555555', product: 'Smartphone with iOS ecosystem', identity: 'I value design and creativity. I think different.', price: '$999+' }
    ];

    const TRANSFORMATION_STEPS = [
      { step: 1, title: 'Define Desired Identity', icon: 'User', description: 'Who do they WANT to become? Not what they want to have.', example: 'Entrepreneur? Elite athlete? Conscious consumer?' },
      { step: 2, title: 'Position as Bridge', icon: 'ArrowRight', description: 'Your product enables their transformation, not the destination.', example: '"For builders who execute, not dreamers who plan"' },
      { step: 3, title: 'Use Tribal Language', icon: 'Users', description: 'Stop saying "customers." Create belonging with identity words.', example: '"Builders," "Creators," "The 1%," "Serious athletes"' }
    ];

    const IDENTITY_IMPACT = [
      { value: 40, suffix: '%', label: 'Higher Prices', subtext: 'Identity buyers pay premium' },
      { value: 3, suffix: 'x', label: 'More Loyalty', subtext: 'Return rate vs product buyers' },
      { value: 10, suffix: 'x', label: 'More Referrals', subtext: 'Identity = advocacy' }
    ];

    const LANGUAGE_EXAMPLES = [
      { type: 'product', phrase: 'Customers who buy watches', brand: 'Generic' },
      { type: 'identity', phrase: 'Those who understand what a Rolex represents', brand: 'Rolex' },
      { type: 'product', phrase: 'People who wear our clothes', brand: 'Generic' },
      { type: 'identity', phrase: 'The sweat life community', brand: 'Lululemon' }
    ];

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') __isAdmin = e.data.isAdmin;
    });
    if (window.parent !== window) {
      window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');
    }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: [
        'Why people buy identity, not products',
        'How Rolex, Tesla, and Lululemon reframed their value',
        'The 3-step transformation framework for your product'
      ]},
      { type: 'hook', headline: 'People don\'t buy products. They buy versions of themselves.', subtext: 'A Rolex isn\'t a watch. Tesla isn\'t a car. Lululemon isn\'t yoga pants. They\'re identity purchases disguised as products. Your customers aren\'t paying for features - they\'re paying for who they become when they use what you sell.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/pngimg.com%20-%20tesla_logo_PNG12.png', brandName: 'Tesla' },
      { type: 'mentor', text: 'The Identity Shift: When you buy a Rolex, you\'re not buying superior timekeeping. Your iPhone tells time better. You\'re buying "I\'ve made it." When someone buys a Tesla, they\'re not buying transportation. They\'re buying "I\'m the future." The product is the vehicle. The identity is the destination.' },
      { type: 'identity-transformation', title: 'The Real Purchase Flow' },
      { type: 'brand-examples-grid', title: 'Products vs Identities' },
      { type: 'brand-detail', brandIndex: 0 },
      { type: 'brand-detail', brandIndex: 1 },
      { type: 'transformation-framework', title: 'The 3-Step Identity Transformation' },
      { type: 'step-detail', stepIndex: 0 },
      { type: 'step-detail', stepIndex: 1 },
      { type: 'step-detail', stepIndex: 2 },
      { type: 'language-comparison', title: 'The Language of Identity' },
      { type: 'identity-impact', title: 'The Identity Advantage' },
      { type: 'elite-insight' },
      { type: 'quiz', question: 'Why do identity-based products command higher prices than feature-based products?', options: ['They have better materials', 'They create emotional value that transcends physical features', 'They target wealthier customers', 'They spend more on marketing'], correctIndex: 1, feedback: { correct: 'Exactly. Identity purchases create emotional and psychological value that goes far beyond the physical product. People will pay premium prices for products that help them become who they want to be.', incorrect: 'Not quite. The power is in the emotional transformation. When a product becomes part of someone\'s identity - who they are or want to be - price becomes secondary to the identity shift.' }},
      { type: 'completion' }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Watch: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="6"/><polyline points="12 10 12 12 13 13"/><path d="m16.13 7.66-.81-4.05a2 2 0 0 0-2-1.61h-2.68a2 2 0 0 0-2 1.61l-.78 4.05"/><path d="m7.88 16.36.8 4a2 2 0 0 0 2 1.61h2.72a2 2 0 0 0 2-1.61l.81-4.05"/></svg>,
      Car: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 16H9m10 0h3v-3.15a1 1 0 0 0-.84-.99L16 11l-2.7-3.6a1 1 0 0 0-.8-.4H5.24a2 2 0 0 0-1.8 1.1l-.8 1.63A6 6 0 0 0 2 12.42V16h2"/><circle cx="6.5" cy="16.5" r="2.5"/><circle cx="16.5" cy="16.5" r="2.5"/></svg>,
      Activity: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>,
      Smartphone: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="5" y="2" width="14" height="20" rx="2" ry="2"/><line x1="12" y1="18" x2="12.01" y2="18"/></svg>,
      User: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
      Users: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Package: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m7.5 4.27 9 5.15"/><path d="M21 8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16Z"/><path d="m3.3 7 8.7 5 8.7-5"/><path d="M12 22V12"/></svg>,
      Star: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Crown: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
      Heart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      TrendingUp: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      DollarSign: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      Lightbulb: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      MessageCircle: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z"/></svg>
    };

    const BrandIcons = {
      Watch: Icons.Watch,
      Car: Icons.Car,
      Activity: Icons.Activity,
      Smartphone: Icons.Smartphone
    };

    const StepIcons = {
      User: Icons.User,
      ArrowRight: Icons.ArrowRight,
      Users: Icons.Users
    };

    // AnimatedCounter Component
    const AnimatedCounter = ({ value, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseInt(value);
        const stepTime = Math.abs(Math.floor(duration / end));
        const timer = setInterval(() => {
          start += 1;
          setCount(start);
          if (start >= end) clearInterval(timer);
        }, stepTime);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // ============ SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const MentorSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="rounded-2xl p-6 md:p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <div className="w-2 h-16 rounded-full mb-4" style={{ background: `linear-gradient(180deg, var(--accent), var(--accent-dark))` }} />
          <p className="text-white text-lg md:text-xl leading-relaxed">{data.text}</p>
        </motion.div>
      </div>
    );

    // UNIQUE: Identity Transformation Flow Slide
    const IdentityTransformationSlide = ({ data }) => {
      const [activePhase, setActivePhase] = useState(0);
      const phases = [
        { label: 'PRODUCT', description: 'Physical features & specs', icon: 'Package', color: '#94a3b8' },
        { label: 'VEHICLE', description: 'Bridge to transformation', icon: 'ArrowRight', color: '#f59e0b' },
        { label: 'IDENTITY', description: 'Who they become', icon: 'Crown', color: '#ec4899' }
      ];

      useEffect(() => {
        const timer = setInterval(() => {
          setActivePhase(prev => (prev + 1) % phases.length);
        }, 2000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

          <div className="flex items-center justify-center gap-4 md:gap-8 mb-8">
            {phases.map((phase, i) => {
              const IconComponent = phase.icon === 'Package' ? Icons.Package : phase.icon === 'ArrowRight' ? Icons.ArrowRight : Icons.Crown;
              const isActive = i === activePhase;
              return (
                <React.Fragment key={i}>
                  <motion.div
                    initial={{ opacity: 0, scale: 0.8 }}
                    animate={{ opacity: 1, scale: isActive ? 1.1 : 1 }}
                    transition={{ delay: 0.1 + i * 0.1 }}
                    className="flex flex-col items-center"
                  >
                    <div
                      className="w-16 h-16 md:w-20 md:h-20 rounded-2xl flex items-center justify-center mb-3 transition-all duration-500"
                      style={{
                        background: isActive ? `linear-gradient(135deg, ${phase.color}, ${phase.color}dd)` : 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                        boxShadow: isActive ? `0 0 30px ${phase.color}40` : 'none',
                        transform: isActive ? 'scale(1.1)' : 'scale(1)'
                      }}
                    >
                      <div style={{ color: isActive ? 'white' : phase.color }}><IconComponent /></div>
                    </div>
                    <div className="text-sm md:text-base font-bold" style={{ color: isActive ? phase.color : '#6b7280' }}>{phase.label}</div>
                    <div className="text-xs text-neutral-500 text-center max-w-[100px]">{phase.description}</div>
                  </motion.div>
                  {i < phases.length - 1 && (
                    <motion.div
                      initial={{ opacity: 0, scaleX: 0 }}
                      animate={{ opacity: 1, scaleX: 1 }}
                      transition={{ delay: 0.3 + i * 0.1 }}
                      className="w-8 md:w-16 h-1 rounded-full"
                      style={{ background: i < activePhase ? `linear-gradient(90deg, ${phases[i].color}, ${phases[i+1].color})` : '#d4d4d4' }}
                    />
                  )}
                </React.Fragment>
              );
            })}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            className="text-center p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <p className="text-neutral-300 text-sm md:text-base">
              <span className="text-white font-bold">The Truth:</span> People don't buy what you sell. They buy who they become when they use it.
            </p>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Brand Examples Grid with Auto-Cycling
    const BrandExamplesGridSlide = ({ data }) => {
      const [activeBrand, setActiveBrand] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveBrand(prev => (prev + 1) % BRAND_EXAMPLES.length);
        }, 2500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <div className="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
            {BRAND_EXAMPLES.map((brand, i) => {
              const IconComponent = BrandIcons[brand.icon];
              const isActive = i === activeBrand;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.08 }}
                  className="rounded-xl p-4 transition-all duration-500 cursor-pointer"
                  onClick={() => setActiveBrand(i)}
                  style={{
                    background: isActive ? `linear-gradient(135deg, ${brand.color}15, ${brand.color}05)` : 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                    border: isActive ? `2px solid ${brand.color}` : '2px solid transparent',
                    boxShadow: isActive ? `0 0 20px ${brand.color}30` : 'none'
                  }}
                >
                  <div className="w-10 h-10 rounded-lg flex items-center justify-center mb-3" style={{ background: `${brand.color}20` }}>
                    <div style={{ color: brand.color }}><IconComponent /></div>
                  </div>
                  <div className="font-bold text-sm md:text-base mb-1" style={{ color: isActive ? brand.color : 'white' }}>{brand.brand}</div>
                  <div className="text-xs text-neutral-400">{brand.price}</div>
                </motion.div>
              );
            })}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            className="mt-6 p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderTop: `3px solid ${BRAND_EXAMPLES[activeBrand].color}` }}>
            <div className="flex items-start gap-4">
              <div className="flex-1">
                <div className="text-xs text-neutral-500 uppercase tracking-wider mb-1">Product</div>
                <div className="text-white text-sm">{BRAND_EXAMPLES[activeBrand].product}</div>
              </div>
              <div className="w-px h-12 bg-neutral-700" />
              <div className="flex-1">
                <div className="text-xs uppercase tracking-wider mb-1" style={{ color: BRAND_EXAMPLES[activeBrand].color }}>Identity</div>
                <div className="text-white text-sm font-semibold">"{BRAND_EXAMPLES[activeBrand].identity}"</div>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Individual Brand Detail Slide
    const BrandDetailSlide = ({ data }) => {
      const brand = BRAND_EXAMPLES[data.brandIndex];
      const IconComponent = BrandIcons[brand.icon];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            className="rounded-2xl p-6 md:p-8"
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              borderTop: `4px solid ${brand.color}`
            }}
          >
            <div className="flex items-center gap-4 mb-6">
              <div className="w-14 h-14 rounded-xl flex items-center justify-center" style={{ background: `${brand.color}20` }}>
                <div style={{ color: brand.color }}><IconComponent /></div>
              </div>
              <div>
                <div className="px-2 py-0.5 rounded text-xs font-bold inline-block mb-1" style={{ background: `${brand.color}30`, color: brand.color }}>BRAND #{brand.id}</div>
                <h3 className="text-white text-2xl font-bold">{brand.brand}</h3>
              </div>
            </div>

            <div className="grid md:grid-cols-2 gap-4 mb-6">
              <div className="bg-neutral-800/50 rounded-xl p-4">
                <div className="flex items-center gap-2 mb-2">
                  <Icons.Package />
                  <span className="text-neutral-400 text-xs uppercase tracking-wider">The Product</span>
                </div>
                <p className="text-white text-sm">{brand.product}</p>
              </div>
              <div className="rounded-xl p-4" style={{ background: `${brand.color}15` }}>
                <div className="flex items-center gap-2 mb-2">
                  <div style={{ color: brand.color }}><Icons.Crown /></div>
                  <span className="text-xs uppercase tracking-wider" style={{ color: brand.color }}>The Identity</span>
                </div>
                <p className="text-white text-sm font-semibold">"{brand.identity}"</p>
              </div>
            </div>

            <div className="flex items-center justify-between p-3 rounded-lg bg-neutral-800/30">
              <span className="text-neutral-400 text-sm">Price Point</span>
              <span className="text-white font-bold">{brand.price}</span>
            </div>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Transformation Framework Overview
    const TransformationFrameworkSlide = ({ data }) => {
      const [activeStep, setActiveStep] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveStep(prev => (prev + 1) % TRANSFORMATION_STEPS.length);
        }, 2000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <div className="flex items-start gap-2 md:gap-4">
            {TRANSFORMATION_STEPS.map((step, i) => {
              const IconComponent = StepIcons[step.icon];
              const isActive = i === activeStep;
              return (
                <motion.div
                  key={i}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  className="flex-1 rounded-xl p-4 transition-all duration-500"
                  style={{
                    background: isActive ? 'linear-gradient(135deg, var(--accent), var(--accent-dark))' : 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                    boxShadow: isActive ? '0 0 30px rgba(var(--accent-rgb), 0.3)' : 'none'
                  }}
                >
                  <div className="flex items-center gap-2 mb-3">
                    <div className="w-8 h-8 rounded-lg flex items-center justify-center" style={{ background: isActive ? 'rgba(255,255,255,0.2)' : 'rgba(var(--accent-rgb), 0.2)' }}>
                      <span className="text-sm font-bold" style={{ color: isActive ? 'white' : 'var(--accent)' }}>{step.step}</span>
                    </div>
                    <div style={{ color: isActive ? 'white' : 'var(--accent)' }}><IconComponent /></div>
                  </div>
                  <h3 className="font-bold text-sm md:text-base mb-2" style={{ color: isActive ? 'white' : '#e5e5e5' }}>{step.title}</h3>
                  <p className="text-xs" style={{ color: isActive ? 'rgba(255,255,255,0.8)' : '#9ca3af' }}>{step.description}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // UNIQUE: Step Detail Slide
    const StepDetailSlide = ({ data }) => {
      const step = TRANSFORMATION_STEPS[data.stepIndex];
      const IconComponent = StepIcons[step.icon];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
            className="rounded-2xl p-6 md:p-8"
            style={{
              background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
              position: 'relative',
              overflow: 'hidden'
            }}
          >
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex items-center gap-4 mb-6">
              <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: 'rgba(var(--accent-rgb), 0.2)' }}>
                <div style={{ color: 'var(--accent)' }}><IconComponent /></div>
              </div>
              <div>
                <div className="px-2 py-0.5 rounded text-xs font-bold inline-block mb-1" style={{ background: 'rgba(var(--accent-rgb), 0.2)', color: 'var(--accent)' }}>STEP {step.step}</div>
                <h3 className="text-white text-xl md:text-2xl font-bold">{step.title}</h3>
              </div>
            </div>

            <p className="text-neutral-300 text-base md:text-lg mb-6">{step.description}</p>

            <div className="bg-neutral-800/50 rounded-xl p-4">
              <div className="flex items-center gap-2 mb-2">
                <Icons.Lightbulb />
                <span className="text-neutral-400 text-xs uppercase tracking-wider">Example</span>
              </div>
              <p className="text-white text-sm italic">{step.example}</p>
            </div>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Language Comparison Slide
    const LanguageComparisonSlide = ({ data }) => {
      const [activeExample, setActiveExample] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveExample(prev => (prev + 1) % 2);
        }, 3000);
        return () => clearInterval(timer);
      }, []);

      const productExamples = LANGUAGE_EXAMPLES.filter(e => e.type === 'product');
      const identityExamples = LANGUAGE_EXAMPLES.filter(e => e.type === 'identity');

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <div className="grid md:grid-cols-2 gap-4">
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
              className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="flex items-center gap-2 mb-4">
                <div className="w-2 h-6 rounded-full bg-neutral-500" />
                <span className="text-neutral-400 font-semibold text-sm uppercase tracking-wider">Product Language</span>
              </div>
              {productExamples.map((ex, i) => (
                <div key={i} className={`p-3 rounded-lg mb-2 transition-all duration-500 ${i === activeExample ? 'bg-neutral-700' : 'bg-neutral-800/50'}`}>
                  <p className="text-white text-sm">"{ex.phrase}"</p>
                  <p className="text-neutral-500 text-xs mt-1">- {ex.brand}</p>
                </div>
              ))}
            </motion.div>

            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, rgba(var(--accent-rgb), 0.1), rgba(var(--accent-rgb), 0.05))', border: '1px solid rgba(var(--accent-rgb), 0.3)' }}>
              <div className="flex items-center gap-2 mb-4">
                <div className="w-2 h-6 rounded-full" style={{ background: 'linear-gradient(180deg, var(--accent), var(--accent-dark))' }} />
                <span className="font-semibold text-sm uppercase tracking-wider" style={{ color: 'var(--accent)' }}>Identity Language</span>
              </div>
              {identityExamples.map((ex, i) => (
                <div key={i} className={`p-3 rounded-lg mb-2 transition-all duration-500 ${i === activeExample ? 'bg-white/10' : 'bg-white/5'}`} style={{ border: i === activeExample ? '1px solid var(--accent)' : '1px solid transparent' }}>
                  <p className="text-white text-sm font-semibold">"{ex.phrase}"</p>
                  <p className="text-xs mt-1" style={{ color: 'var(--accent)' }}>- {ex.brand}</p>
                </div>
              ))}
            </motion.div>
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="mt-4 text-center p-3 rounded-lg" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <p className="text-neutral-300 text-sm">
              <span style={{ color: 'var(--accent)' }}><Icons.MessageCircle /></span> Every word you use either strengthens or weakens the identity you're selling.
            </p>
          </motion.div>
        </div>
      );
    };

    // UNIQUE: Identity Impact Stats Slide
    const IdentityImpactSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>

        <div className="grid grid-cols-3 gap-4 md:gap-6">
          {IDENTITY_IMPACT.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-5 text-center"
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                boxShadow: '0 0 30px rgba(var(--accent-rgb), 0.1)'
              }}
            >
              <div className="h-1 w-12 mx-auto mb-4 rounded-full" style={{ background: 'linear-gradient(90deg, var(--accent), var(--accent-dark))' }} />
              <div className="text-3xl md:text-4xl font-bold mb-2" style={{ color: 'var(--accent)' }}>
                <AnimatedCounter value={stat.value} suffix={stat.suffix} />
              </div>
              <div className="text-white font-semibold text-sm mb-1">{stat.label}</div>
              <div className="text-neutral-500 text-xs">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>

        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
          className="mt-6 flex items-center justify-center gap-3 p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, rgba(var(--accent-rgb), 0.1), rgba(var(--accent-rgb), 0.05))' }}>
          <Icons.TrendingUp />
          <p className="text-sm" style={{ color: 'var(--accent)' }}>Identity purchases create customers for life</p>
        </motion.div>
      </div>
    );

    // UNIQUE: Elite Insight Slide
    const EliteInsightSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
          className="rounded-2xl p-6 md:p-8"
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            boxShadow: '0 0 40px rgba(var(--accent-rgb), 0.15)'
          }}
        >
          <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

          <div className="flex items-center gap-3 mb-4">
            <div className="w-10 h-10 rounded-xl flex items-center justify-center" style={{ background: 'rgba(var(--accent-rgb), 0.2)' }}>
              <Icons.Lightbulb />
            </div>
            <span className="text-sm font-bold uppercase tracking-wider" style={{ color: 'var(--accent)' }}>Elite Insight</span>
          </div>

          <h3 className="text-white text-2xl md:text-3xl font-bold mb-4">"The Identity Paradox"</h3>

          <p className="text-neutral-300 text-base md:text-lg leading-relaxed mb-6">
            The companies that focus least on their product often have the strongest brands. Rolex barely mentions timekeeping. Tesla rarely talks about range. Apple doesn't lead with specs. They sell transformation, not features. The paradox: by making your product secondary to identity, you make it infinitely more valuable.
          </p>

          <div className="flex items-center gap-3 p-3 rounded-lg" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
            <Icons.Crown />
            <p className="text-sm" style={{ color: 'var(--accent)' }}>Stop selling what you make. Start selling who they become.</p>
          </div>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">Stop selling products. Start selling identity. Your customers don't want features - they want to become someone better.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const slideParam = params.get('slide');
        if (slideParam) {
          const slideIndex = parseInt(slideParam, 10) - 1;
          if (slideIndex >= 0 && slideIndex < slides.length) {
            setCurrentSlide(slideIndex);
          }
        }
      }, []);

      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'mentor': return <MentorSlide data={slide} />;
          case 'identity-transformation': return <IdentityTransformationSlide data={slide} />;
          case 'brand-examples-grid': return <BrandExamplesGridSlide data={slide} />;
          case 'brand-detail': return <BrandDetailSlide data={slide} />;
          case 'transformation-framework': return <TransformationFrameworkSlide data={slide} />;
          case 'step-detail': return <StepDetailSlide data={slide} />;
          case 'language-comparison': return <LanguageComparisonSlide data={slide} />;
          case 'identity-impact': return <IdentityImpactSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
