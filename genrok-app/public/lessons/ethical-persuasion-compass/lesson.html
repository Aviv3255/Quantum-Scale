<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Magic Show Test: Influence vs Manipulation | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #10B981; --accent-dark: #059669; --accent-light: #34D399; --accent-rgb: 16, 185, 129; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes pulse-glow { 0%, 100% { opacity: 0.4; } 50% { opacity: 0.8; } }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    // Animated Counter Component
    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    const LESSON_CONFIG = {
      id: 'ethical-persuasion-compass',
      title: 'The Magic Show Test',
      description: 'One simple question that separates ethical persuasion from manipulative tactics.',
      accentColor: '#10B981',
      duration: '8 min',
      nextLesson: { id: 'two-worlds-mastery', title: 'The Two Worlds Every DTC Founder Must Master', teaser: 'Why most founders plateau by living in only one world.' }
    };

    // Admin Reporter System
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    const celebrationGifs = ['https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4','https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = ['https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4'];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Eye: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>,
      EyeOff: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/><line x1="1" y1="1" x2="23" y2="23"/></svg>,
      Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      AlertTriangle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Heart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>,
      Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Star: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      TrendingDown: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
      Wand: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 4V2"/><path d="M15 16v-2"/><path d="M8 9h2"/><path d="M20 9h2"/><path d="M17.8 11.8L19 13"/><path d="M15 9h0"/><path d="M17.8 6.2L19 5"/><path d="m3 21 9-9"/><path d="M12.2 6.2L11 5"/></svg>,
      Sparkles: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M19 17v4"/><path d="M3 5h4"/><path d="M17 19h4"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: ['The difference between manipulation and ethical influence', 'The Magic Show Test framework for decision-making', 'Five principles for building sustainable trust'] },
      { type: 'hook', headline: 'Every brand is influencing customers. But there is a line.', subtext: 'Every ad. Every product page. Every email. You are guiding decisions. Shaping perceptions. Persuading people to buy. On one side: ethical influence that builds trust. On the other: manipulation that destroys it. Most brands cannot tell the difference.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Allbirds_logo.svg.png', brandName: 'Allbirds' },
      { type: 'stat-showcase', title: 'The Decision Overload', stats: [{ value: 35000, label: 'Daily Decisions', subtext: 'Average person makes per day' }, { value: 100, suffix: '%', label: 'Use Shortcuts', subtext: 'Everyone relies on mental shortcuts' }, { value: 2, label: 'Paths Forward', subtext: 'Use psychology ethically or exploit it' }]},
      { type: 'content', title: 'The Psychology Everyone Uses', body: 'With 35,000 decisions a day, your customers rely on mental shortcuts. Social proof. Scarcity. Authority. Reciprocity. These shortcuts are REAL. They work because they are based on genuine human psychology. But here is where it gets dangerous: You can use real psychology to provide reliable information. Or you can use it to exploit with counterfeit evidence.' },
      { type: 'magic-test', title: 'The Magic Show Test', question: 'Is your audience in on the joke?', left: { label: 'Entertainment', description: 'Audience willingly suspends disbelief because they are entertained.', examples: ['They know it is marketing', 'They appreciate the creativity', 'They feel respected'], icon: 'Sparkles' }, right: { label: 'Deception', description: 'You are convincing them the magic is real—deceiving for your gain.', examples: ['They believe false claims', 'They feel tricked later', 'Trust is destroyed'], icon: 'EyeOff' }},
      { type: 'scenario-test', title: 'Apply The Test', scenarios: [
        { category: 'Scarcity', manipulation: 'Only 3 left! (You have 300 units, timer resets for every visitor)', education: '12 in stock at this location, restocking next Tuesday (Real inventory data)' },
        { category: 'Social Proof', manipulation: '47,000 happy customers! (Fake number, bots wrote reviews)', education: '4.8/5 stars from 247 verified buyers (Linked to actual purchase records)' },
        { category: 'Urgency', manipulation: 'Sale ends tonight! (Has been running 6 months, continues tomorrow)', education: '20% off until Dec 25, then back to regular price (Real date, honored)' }
      ]},
      { type: 'content', title: 'Why This Actually Matters', body: 'You might think: But manipulation works! People fall for it! Short term? Sure. Long term? It destroys your brand. Because customers are not stupid. They catch on. They feel tricked. They tell others. They never come back. Manipulation is a sprint. Education is a marathon. And in DTC, where customer lifetime value determines survival, you need the marathon.' },
      { type: 'ethics-compass', title: 'The Ethical Persuasion Compass', principles: [
        { number: 1, title: 'Never Fake Evidence', description: 'Use real data, real reviews, real inventory. If you cannot prove it, do not claim it.', icon: 'Shield' },
        { number: 2, title: 'Make Benefit Theirs', description: 'Does this tactic help THEM make a better decision? Or just trick them into buying?', icon: 'Heart' },
        { number: 3, title: 'The Magic Show Test', description: 'Are they in on it? Would you be embarrassed to explain how it works?', icon: 'Wand' },
        { number: 4, title: 'Build for Repeats', description: 'Every decision should strengthen trust for the NEXT purchase, not just secure this one.', icon: 'TrendingUp' },
        { number: 5, title: 'Transparency Wins', description: 'When in doubt, be MORE honest than necessary. It is the only sustainable advantage.', icon: 'Eye' }
      ]},
      { type: 'outcome-compare', title: 'The Long Game', left: { label: 'Manipulation', stats: [{ value: '1', label: 'Sale Secured' }, { value: '0', label: 'Repeat Customers' }, { value: '-100%', label: 'Trust Lost' }], color: '#ef4444' }, right: { label: 'Education', stats: [{ value: '1', label: 'Sale Earned' }, { value: '5x', label: 'LTV Increase' }, { value: '+100%', label: 'Referrals' }], color: '#10B981' }},
      { type: 'quiz', question: 'What is the key difference between manipulation and education?', options: ['Manipulation uses psychology, education does not', 'Manipulation benefits you without their consent, education benefits them with consent', 'Manipulation is illegal, education is legal', 'There is no real difference'], correctIndex: 1, feedback: { correct: 'Exactly. This is the core distinction. Manipulation uses psychological triggers for YOUR benefit without the customer truly understanding or consenting. Education uses the same psychology to help THEM make better decisions with full transparency. Both influence behavior—but only one builds sustainable trust.', incorrect: 'Not quite. Both manipulation and education use the same psychological principles—social proof, scarcity, authority. The difference is intent and transparency. Manipulation benefits YOU without their true consent. Education benefits THEM with full transparency. One destroys trust. One builds it.' }},
      { type: 'completion' }
    ];

    // ============ SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '25%', maxHeight: '150px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" />
          </motion.div>
        )}
      </div>
    );

    // UNIQUE: Stat Showcase with AnimatedCounter
    const StatShowcaseSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-3 gap-4">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.15 }}
              className="relative rounded-2xl p-6 text-center overflow-hidden"
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: '0 8px 32px rgba(0,0,0,0.4), 0 0 40px rgba(var(--accent-rgb),0.15)' }}>
              <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <div className="text-4xl md:text-5xl font-bold mb-2" style={{ color: 'var(--accent)', textShadow: '0 0 30px rgba(var(--accent-rgb),0.5)' }}>
                <AnimatedCounter target={stat.value} suffix={stat.suffix || ''} prefix={stat.prefix || ''} />
              </div>
              <div className="text-sm md:text-base font-semibold text-white mb-1">{stat.label}</div>
              <div className="text-xs text-neutral-400">{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    // UNIQUE: Magic Show Test - Two-sided comparison
    const MagicTestSlide = ({ data }) => {
      const [activePanel, setActivePanel] = useState(null);

      const IconComponent = ({ name }) => {
        const IconMap = { Sparkles: Icons.Sparkles, EyeOff: Icons.EyeOff };
        return IconMap[name] ? IconMap[name]() : <Icons.Star />;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-3">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-lg text-neutral-600 text-center mb-8">{data.question}</motion.p>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Left - Entertainment */}
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              onClick={() => setActivePanel('left')}
              className="relative rounded-2xl p-6 cursor-pointer transition-all duration-500"
              style={{
                background: activePanel === 'left' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#fafafa',
                border: activePanel === 'left' ? '2px solid rgba(var(--accent-rgb), 0.5)' : '2px solid #e5e5e5',
                boxShadow: activePanel === 'left' ? '0 0 40px rgba(var(--accent-rgb), 0.2)' : 'none'
              }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: activePanel === 'left' ? 'linear-gradient(90deg, transparent, var(--accent), transparent)' : 'transparent' }} />
              <div className="flex items-center gap-3 mb-4">
                <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: activePanel === 'left' ? 'linear-gradient(135deg, var(--accent), var(--accent-dark))' : '#e5e5e5', color: activePanel === 'left' ? 'white' : '#737373' }}>
                  <IconComponent name={data.left.icon} />
                </div>
                <h3 className="text-xl font-bold" style={{ color: activePanel === 'left' ? 'var(--accent)' : '#171717' }}>{data.left.label}</h3>
              </div>
              <p className="text-sm mb-4" style={{ color: activePanel === 'left' ? '#a3a3a3' : '#525252' }}>{data.left.description}</p>
              <ul className="space-y-2">
                {data.left.examples.map((ex, i) => (
                  <li key={i} className="flex items-center gap-2 text-sm" style={{ color: activePanel === 'left' ? '#d4d4d4' : '#525252' }}>
                    <span style={{ color: 'var(--accent)' }}><Icons.Check /></span>
                    {ex}
                  </li>
                ))}
              </ul>
            </motion.div>

            {/* Right - Deception */}
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              onClick={() => setActivePanel('right')}
              className="relative rounded-2xl p-6 cursor-pointer transition-all duration-500"
              style={{
                background: activePanel === 'right' ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#fafafa',
                border: activePanel === 'right' ? '2px solid rgba(239, 68, 68, 0.5)' : '2px solid #e5e5e5',
                boxShadow: activePanel === 'right' ? '0 0 40px rgba(239, 68, 68, 0.2)' : 'none'
              }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: activePanel === 'right' ? 'linear-gradient(90deg, transparent, #ef4444, transparent)' : 'transparent' }} />
              <div className="flex items-center gap-3 mb-4">
                <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: activePanel === 'right' ? 'linear-gradient(135deg, #ef4444, #dc2626)' : '#e5e5e5', color: activePanel === 'right' ? 'white' : '#737373' }}>
                  <IconComponent name={data.right.icon} />
                </div>
                <h3 className="text-xl font-bold" style={{ color: activePanel === 'right' ? '#ef4444' : '#171717' }}>{data.right.label}</h3>
              </div>
              <p className="text-sm mb-4" style={{ color: activePanel === 'right' ? '#a3a3a3' : '#525252' }}>{data.right.description}</p>
              <ul className="space-y-2">
                {data.right.examples.map((ex, i) => (
                  <li key={i} className="flex items-center gap-2 text-sm" style={{ color: activePanel === 'right' ? '#d4d4d4' : '#525252' }}>
                    <span style={{ color: '#ef4444' }}><Icons.X /></span>
                    {ex}
                  </li>
                ))}
              </ul>
            </motion.div>
          </div>
        </div>
      );
    };

    // UNIQUE: Scenario Test - Cycling through manipulation vs education examples
    const ScenarioTestSlide = ({ data }) => {
      const [activeScenario, setActiveScenario] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveScenario(s => (s + 1) % data.scenarios.length);
        }, 4000);
        return () => clearInterval(timer);
      }, [data.scenarios.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          {/* Category Badge */}
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
            className="text-center mb-6 p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="flex items-center justify-center gap-2 mb-2">
              <Icons.Target style={{ color: 'var(--accent)' }} />
              <span className="text-xs text-neutral-400 uppercase tracking-wider">Testing: {data.scenarios[activeScenario].category}</span>
            </div>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4 mb-6">
            {/* Manipulation */}
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              className="rounded-2xl p-5 border-2 border-red-300" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
              <div className="flex items-center gap-2 mb-3">
                <div className="w-8 h-8 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div>
                <span className="font-bold text-red-400 text-sm">Manipulation</span>
              </div>
              <p className="text-neutral-300 text-sm leading-relaxed">{data.scenarios[activeScenario].manipulation}</p>
              <div className="mt-3 flex items-center gap-1 text-xs text-red-400">
                <Icons.AlertTriangle />
                <span>They feel tricked later</span>
              </div>
            </motion.div>

            {/* Education */}
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
              className="rounded-2xl p-5 border-2" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderColor: 'rgba(var(--accent-rgb), 0.5)' }}>
              <div className="flex items-center gap-2 mb-3">
                <div className="w-8 h-8 rounded-full flex items-center justify-center text-white" style={{ background: 'var(--accent)' }}><Icons.Check /></div>
                <span className="font-bold text-sm" style={{ color: 'var(--accent)' }}>Education</span>
              </div>
              <p className="text-neutral-300 text-sm leading-relaxed">{data.scenarios[activeScenario].education}</p>
              <div className="mt-3 flex items-center gap-1 text-xs" style={{ color: 'var(--accent)' }}>
                <Icons.Heart />
                <span>Trust is built</span>
              </div>
            </motion.div>
          </div>

          {/* Navigation Dots */}
          <div className="flex justify-center gap-2">
            {data.scenarios.map((_, i) => (
              <button key={i} onClick={() => setActiveScenario(i)}
                className="w-2.5 h-2.5 rounded-full transition-all duration-300"
                style={{ background: i === activeScenario ? 'var(--accent)' : '#d4d4d4', transform: i === activeScenario ? 'scale(1.3)' : 'scale(1)' }} />
            ))}
          </div>
        </div>
      );
    };

    // UNIQUE: Ethics Compass - 5 Principles
    const EthicsCompassSlide = ({ data }) => {
      const [activePrinciple, setActivePrinciple] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActivePrinciple(p => (p + 1) % data.principles.length);
        }, 3500);
        return () => clearInterval(timer);
      }, [data.principles.length]);

      const IconComponent = ({ name }) => {
        const IconMap = { Shield: Icons.Shield, Heart: Icons.Heart, Wand: Icons.Wand, TrendingUp: Icons.TrendingUp, Eye: Icons.Eye };
        return IconMap[name] ? IconMap[name]() : <Icons.Star />;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div className="space-y-3">
            {data.principles.map((principle, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.08 }}
                onClick={() => setActivePrinciple(i)}
                className="relative rounded-xl p-4 cursor-pointer transition-all duration-500"
                style={{
                  background: activePrinciple === i ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : '#fafafa',
                  border: activePrinciple === i ? '2px solid rgba(var(--accent-rgb), 0.5)' : '2px solid #e5e5e5',
                  boxShadow: activePrinciple === i ? '0 0 30px rgba(var(--accent-rgb), 0.2)' : 'none'
                }}>
                <div className="absolute top-0 left-0 right-0 h-0.5 rounded-t-xl transition-all duration-500" style={{ background: activePrinciple === i ? 'linear-gradient(90deg, transparent, var(--accent), transparent)' : 'transparent' }} />
                <div className="flex items-start gap-4">
                  <div className="w-10 h-10 rounded-lg flex items-center justify-center flex-shrink-0 transition-all duration-500"
                    style={{ background: activePrinciple === i ? 'linear-gradient(135deg, var(--accent), var(--accent-dark))' : '#e5e5e5', color: activePrinciple === i ? 'white' : '#737373' }}>
                    <IconComponent name={principle.icon} />
                  </div>
                  <div className="flex-1">
                    <div className="flex items-center gap-2 mb-1">
                      <span className="text-xs font-bold px-2 py-0.5 rounded transition-all duration-500" style={{ background: activePrinciple === i ? 'rgba(var(--accent-rgb), 0.2)' : '#e5e5e5', color: activePrinciple === i ? 'var(--accent)' : '#737373' }}>#{principle.number}</span>
                      <h3 className="font-bold text-sm transition-colors duration-500" style={{ color: activePrinciple === i ? 'white' : '#171717' }}>{principle.title}</h3>
                    </div>
                    <p className="text-xs transition-colors duration-500" style={{ color: activePrinciple === i ? '#a3a3a3' : '#525252' }}>{principle.description}</p>
                  </div>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // UNIQUE: Outcome Compare - Manipulation vs Education outcomes
    const OutcomeCompareSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          {/* Left - Manipulation */}
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
            className="relative rounded-2xl p-6 overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${data.left.color}20` }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${data.left.color}, transparent)` }} />
            <div className="flex items-center gap-2 mb-6">
              <Icons.TrendingDown style={{ color: data.left.color }} />
              <h3 className="text-xl font-bold" style={{ color: data.left.color }}>{data.left.label}</h3>
            </div>
            <div className="space-y-4">
              {data.left.stats.map((stat, i) => (
                <div key={i} className="flex justify-between items-center p-3 rounded-lg" style={{ background: `${data.left.color}15`, border: `1px solid ${data.left.color}30` }}>
                  <span className="text-neutral-400 text-sm">{stat.label}</span>
                  <span className="text-xl font-bold" style={{ color: data.left.color }}>{stat.value}</span>
                </div>
              ))}
            </div>
          </motion.div>

          {/* Right - Education */}
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="relative rounded-2xl p-6 overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', boxShadow: `0 0 30px ${data.right.color}20` }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: `linear-gradient(90deg, transparent, ${data.right.color}, transparent)` }} />
            <div className="flex items-center gap-2 mb-6">
              <Icons.TrendingUp style={{ color: data.right.color }} />
              <h3 className="text-xl font-bold" style={{ color: data.right.color }}>{data.right.label}</h3>
              <span className="px-2 py-0.5 rounded text-xs font-bold" style={{ background: `${data.right.color}20`, color: data.right.color }}>WINS</span>
            </div>
            <div className="space-y-4">
              {data.right.stats.map((stat, i) => (
                <div key={i} className="flex justify-between items-center p-3 rounded-lg" style={{ background: `${data.right.color}15`, border: `1px solid ${data.right.color}30` }}>
                  <span className="text-neutral-400 text-sm">{stat.label}</span>
                  <span className="text-xl font-bold" style={{ color: data.right.color }}>{stat.value}</span>
                </div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback}
                  className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">You now understand the difference between manipulation and ethical persuasion. Use the Magic Show Test: Are they in on it, or are you deceiving them?</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'stat-showcase': return <StatShowcaseSlide data={slide} />;
          case 'magic-test': return <MagicTestSlide data={slide} />;
          case 'scenario-test': return <ScenarioTestSlide data={slide} />;
          case 'ethics-compass': return <EthicsCompassSlide data={slide} />;
          case 'outcome-compare': return <OutcomeCompareSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
