<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Blind Spot Effect | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #88da1c; --accent-dark: #6fb816; --accent-light: #a3e635; --accent-rgb: 136, 218, 28; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'blind-spot-effect',
      title: 'The Blind Spot Effect',
      description: 'Why the most powerful persuasion is the persuasion you never see coming.',
      accentColor: '#88da1c',
      duration: '7 min',
      nextLesson: { id: 'ocpb-formula', title: 'The OCPB Formula', teaser: 'The 4-part framework for crafting irresistible offers that convert.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why your brain has a literal blind spot - and what it teaches about persuasion', 'The 4 cognitive biases that drive every purchase decision', 'How to speak the language your customer\'s brain actually understands'] },
      { type: 'hook', headline: 'Your brain has been lying to you since birth.', subtext: 'There\'s a spot in your eye where the optic nerve connects. No vision. Complete darkness. But you\'ve never noticed it. Why? Your brain fills in what it cannot see. Your customers\' brains work the same way. They make decisions using shortcuts you never see.' },
      { type: 'mind-map', title: 'How Your Brain Makes Decisions' },
      { type: 'split-content', title: 'The Hidden Decision Engine', content: 'Here\'s what neuroscience reveals: 95% of your brain\'s processing happens outside your awareness. You think you\'re making rational choices, but the real decisions happen before conscious thought even begins.\n\nThese aren\'t bugs in the system - they\'re features. Mental shortcuts that evolved over millions of years to help humans survive.', media: { type: 'video', src: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_having_a_lightbulb_moment_pure_100_white_backg_bd88fbc3-b501-446f-a37f-09b80e6320fc_3.mp4' }, reversed: false },
      { type: 'venn-diagram', title: 'The 95/5 Split: Where Decisions Happen' },
      { type: 'before-after', scenario: 'Pet Supplies Store - Halo Effect', before: { label: 'Generic Product Page', text: '"Premium Dog Food - High Quality Ingredients - $39.99 - Order Now"' }, after: { label: 'Halo Effect Applied', text: 'Clean hero image: happy golden retriever in sunlight. Minimalist design. White space. Premium typography. Price unchanged: $39.99. Conversion rate: +127%.' }, insight: 'Beautiful design isn\'t decoration. It\'s a cognitive bias trigger that changes perception of value.' },
      { type: 'decision-tree', title: 'The Customer\'s Hidden Decision Path' },
      { type: 'before-after', scenario: 'Jewelry Store - Anchoring', before: { label: 'Single Price Only', text: '"Handcrafted Silver Bracelet - $79 - Shop Now"' }, after: { label: 'Strategic Anchoring', text: '"Handcrafted Silver Bracelet - Was $189 - Now $79 (Limited Time) - Save $110 Today"' }, insight: 'Same product. Same price. Different perception. The $189 anchor makes $79 feel irresistible.' },
      { type: 'split-content', title: 'Loss Aversion: The 2x Multiplier', content: 'Nobel Prize-winning research proves it: humans feel losses twice as intensely as equivalent gains. Losing $100 hurts more than gaining $100 feels good.\n\nThis is why "Don\'t miss out" outperforms "Get this benefit" every single time. FOMO isn\'t just a marketing buzzword - it\'s a fundamental feature of human psychology.', media: { type: 'video', src: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_connecting_the_dots_drawing_lines_between_poin_66a88945-b2d0-442a-b48e-0c20060e3fcf_2.mp4' }, reversed: true },
      { type: 'before-after', scenario: 'Fashion Store - Loss Aversion', before: { label: 'Gain-Focused Message', text: '"Get 20% off when you buy 3 items!"' }, after: { label: 'Loss-Focused Message', text: '"Don\'t lose your 20% discount - add 1 more item before this deal expires in 3:47:12"' }, insight: 'Loss framing + countdown timer = 2x the psychological pressure. Same offer, different emotion.' },
      { type: 'slope-chart', title: 'Before vs After: Conversion Rates' },
      { type: 'quote', quote: 'The biases work whether you use them or not. Ignoring them doesn\'t make you ethical - it makes you invisible.', author: 'Behavioral Economics', role: 'Core Principle' },
      { type: 'quiz', question: 'According to neuroscience research, what percentage of decision-making happens below conscious awareness?', options: ['25% - Most decisions are conscious', '50% - It\'s about half and half', '75% - Mostly subconscious', '95% - Almost entirely subconscious'], correctIndex: 3, feedback: { correct: 'Exactly! 95% of decision-making happens subconsciously. This is why understanding cognitive biases isn\'t manipulation - it\'s speaking the language your customer\'s brain actually uses.', incorrect: 'Not quite. Research shows that 95% of decision-making happens below conscious awareness. The rational mind thinks it\'s in control, but the subconscious is making decisions before conscious thought even begins.' }},
      { type: 'completion' }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      ArrowDown: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ChevronRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="9 18 15 12 9 6"/></svg>,
      Brain: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Users: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Quote: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/></svg>,
      GitBranch: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="6" y1="3" x2="6" y2="15"/><circle cx="18" cy="6" r="3"/><circle cx="6" cy="18" r="3"/><path d="M18 9a9 9 0 0 1-9 9"/></svg>,
      Layers: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
    };

    // ============ UNIQUE COMPONENT 1: MIND MAP ============
    const MindMapSlide = ({ data }) => {
      const mindMapData = {
        label: 'Purchase Decision',
        children: [
          {
            label: 'Subconscious (95%)',
            color: '#88da1c',
            children: [
              { label: 'Halo Effect', color: '#F59E0B' },
              { label: 'Anchoring', color: '#3B82F6' },
              { label: 'Loss Aversion', color: '#EF4444' },
              { label: 'Bandwagon', color: '#22C55E' }
            ]
          },
          {
            label: 'Conscious (5%)',
            color: '#6B7280',
            children: [
              { label: 'Price Compare', color: '#9CA3AF' },
              { label: 'Feature Analysis', color: '#9CA3AF' }
            ]
          }
        ]
      };

      const width = 600;
      const height = 560;
      const cx = width / 2;
      const cy = height / 2 - 50;
      const colors = ['#88da1c', '#22C55E', '#3B82F6', '#A855F7', '#F59E0B', '#EF4444'];

      const positions = [];

      const calculatePositions = (node, level, angle, angleSpread, parent, colorIndex = 0) => {
        const radius = level === 0 ? 0 : 45 + level * 50;
        const x = cx + radius * Math.cos(angle);
        const y = cy + radius * Math.sin(angle);
        const color = node.color || colors[colorIndex % colors.length];

        const pos = { x, y, label: node.label, level, color, parent };
        positions.push(pos);

        if (node.children && node.children.length > 0) {
          const childAngleSpread = angleSpread / node.children.length;
          const startAngle = angle - angleSpread / 2 + childAngleSpread / 2;

          node.children.forEach((child, i) => {
            calculatePositions(child, level + 1, startAngle + i * childAngleSpread, childAngleSpread * 0.85, pos, i);
          });
        }
      };

      // Start at -PI/2 so main branches go left and right
      calculatePositions(mindMapData, 0, -Math.PI / 2, 2 * Math.PI, null);

      const createCurvedPath = (from, to) => {
        const midX = (from.x + to.x) / 2;
        const midY = (from.y + to.y) / 2;
        const dx = to.x - from.x;
        const dy = to.y - from.y;
        const perpX = -dy * 0.15;
        const perpY = dx * 0.15;
        return `M ${from.x} ${from.y} Q ${midX + perpX} ${midY + perpY} ${to.x} ${to.y}`;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Brain />
              <span>Mind Map</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.08)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              <defs>
                <filter id="mindmapGlow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="4" result="glow"/>
                  <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
              </defs>

              {/* Connections */}
              {positions.map((pos, i) =>
                pos.parent ? (
                  <motion.path
                    key={`path-${i}`}
                    initial={{ pathLength: 0 }}
                    animate={{ pathLength: 1 }}
                    transition={{ delay: pos.level * 0.15, duration: 0.5 }}
                    d={createCurvedPath(pos.parent, pos)}
                    fill="none"
                    stroke={pos.color}
                    strokeWidth="2"
                    strokeOpacity="0.6"
                  />
                ) : null
              )}

              {/* Nodes */}
              {positions.map((pos, i) => {
                const isCenter = pos.level === 0;
                const nodeWidth = isCenter ? 110 : 75;
                const nodeHeight = isCenter ? 40 : 28;

                return (
                  <motion.g key={`node-${i}`}>
                    <motion.rect
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{ delay: pos.level * 0.1 + 0.1, type: 'spring' }}
                      x={pos.x - nodeWidth / 2}
                      y={pos.y - nodeHeight / 2}
                      width={nodeWidth}
                      height={nodeHeight}
                      rx={nodeHeight / 2}
                      fill={pos.color}
                      filter={isCenter ? 'url(#mindmapGlow)' : undefined}
                      style={{ transformOrigin: `${pos.x}px ${pos.y}px` }}
                    />
                    <motion.text
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: pos.level * 0.1 + 0.2 }}
                      x={pos.x}
                      y={pos.y + (isCenter ? 5 : 4)}
                      textAnchor="middle"
                      fill="white"
                      fontSize={isCenter ? 11 : 8}
                      fontWeight="bold"
                      style={{ textShadow: '0 1px 2px rgba(0,0,0,0.5)' }}
                    >
                      {pos.label}
                    </motion.text>
                  </motion.g>
                );
              })}
            </svg>

            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 1.2 }}
              className="text-center mt-4">
              <span className="inline-block px-4 py-2 rounded-lg text-sm font-semibold" style={{ background: 'rgba(136, 218, 28, 0.15)', color: 'var(--accent)' }}>
                Subconscious biases branch into every purchase decision
              </span>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ UNIQUE COMPONENT 2: VENN DIAGRAM ============
    // Using exact pattern from library: equal-sized overlapping circles
    const VennDiagramSlide = ({ data }) => {
      const sets = [
        { label: 'Conscious', color: '#6B7280' },
        { label: 'Subconscious', color: '#88da1c' }
      ];
      const intersectionLabel = 'Biases Active';

      const width = 450;
      const height = 350;
      const cx = width / 2;
      const cy = height / 2;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Layers />
              <span>Venn Diagram</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.08)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {/* Set A - Conscious (smaller visual weight) */}
              <motion.circle
                initial={{ scale: 0, opacity: 0 }}
                animate={{ scale: 1, opacity: 0.5 }}
                transition={{ delay: 0.1, duration: 0.5 }}
                cx={cx - 50}
                cy={cy}
                r="100"
                fill={sets[0].color}
                style={{ transformOrigin: `${cx - 50}px ${cy}px` }}
              />

              {/* Set B - Subconscious (larger visual weight via glow) */}
              <motion.circle
                initial={{ scale: 0, opacity: 0 }}
                animate={{ scale: 1, opacity: 0.5 }}
                transition={{ delay: 0.2, duration: 0.5 }}
                cx={cx + 50}
                cy={cy}
                r="100"
                fill={sets[1].color}
                style={{ transformOrigin: `${cx + 50}px ${cy}px` }}
              />

              {/* Labels for Conscious */}
              <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}>
                <text x={cx - 100} y={cy - 20} textAnchor="middle" fill="white" fontSize="12" fontWeight="bold">{sets[0].label}</text>
                <text x={cx - 100} y={cy + 5} textAnchor="middle" fill="white" fontSize="24" fontWeight="bold">5%</text>
                <text x={cx - 100} y={cy + 25} textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="9">Rational</text>
                <text x={cx - 100} y={cy + 37} textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="9">Analysis</text>
              </motion.g>

              {/* Labels for Subconscious */}
              <motion.g initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.6 }}>
                <text x={cx + 100} y={cy - 20} textAnchor="middle" fill="white" fontSize="12" fontWeight="bold">{sets[1].label}</text>
                <text x={cx + 100} y={cy + 5} textAnchor="middle" fill="white" fontSize="24" fontWeight="bold">95%</text>
                <text x={cx + 100} y={cy + 25} textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="9">Cognitive Biases</text>
                <text x={cx + 100} y={cy + 37} textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="9">Auto Responses</text>
              </motion.g>

              {/* Intersection label */}
              <motion.text
                initial={{ opacity: 0, scale: 0 }}
                animate={{ opacity: 1, scale: 1 }}
                transition={{ delay: 0.8, type: 'spring' }}
                x={cx}
                y={cy}
                textAnchor="middle"
                dominantBaseline="middle"
                fill="white"
                fontSize="11"
                fontWeight="bold"
              >
                {intersectionLabel}
              </motion.text>
            </svg>

            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 1.3 }}
              className="text-center mt-4">
              <span className="inline-block px-4 py-2 rounded-lg text-sm font-semibold" style={{ background: 'rgba(136, 218, 28, 0.15)', color: 'var(--accent)' }}>
                95% of decisions happen before you're consciously aware
              </span>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ UNIQUE COMPONENT 3: DECISION TREE ============
    const DecisionTreeSlide = ({ data }) => {
      const nodes = [
        { id: 'start', label: 'Sees Product', type: 'decision', yes: 'halo', no: 'exit1' },
        { id: 'halo', label: 'Good Design?', type: 'decision', yes: 'anchor', no: 'exit2' },
        { id: 'anchor', label: 'Price Anchored?', type: 'decision', yes: 'loss', no: 'consider' },
        { id: 'loss', label: 'Scarcity?', type: 'decision', yes: 'buy', no: 'cart' },
        { id: 'buy', label: 'PURCHASE', type: 'outcome', color: '#22C55E' },
        { id: 'cart', label: 'Add to Cart', type: 'outcome', color: '#F59E0B' },
        { id: 'consider', label: 'Maybe Later', type: 'outcome', color: '#6B7280' },
        { id: 'exit1', label: 'Bounce', type: 'outcome', color: '#EF4444' },
        { id: 'exit2', label: 'Exit', type: 'outcome', color: '#EF4444' },
      ];

      const decisionColor = '#3B82F6';
      const yesColor = '#22C55E';
      const noColor = '#EF4444';
      const outcomeColor = '#A855F7';

      const width = 600;
      const height = 420;

      const positionedNodes = [];
      const connections = [];

      const positionNode = (nodeId, x, y, level, spread) => {
        const node = nodes.find(n => n.id === nodeId);
        if (!node || positionedNodes.find(p => p.node.id === nodeId)) return;

        const posNode = { node, x, y, level };
        positionedNodes.push(posNode);

        const nextY = y + 85;
        const nextSpread = spread * 0.55;

        if (node.yes) {
          const yesX = x - spread;
          positionNode(node.yes, yesX, nextY, level + 1, nextSpread);
          const targetNode = positionedNodes.find(p => p.node.id === node.yes);
          if (targetNode) connections.push({ from: posNode, to: targetNode, type: 'yes' });
        }

        if (node.no) {
          const noX = x + spread;
          positionNode(node.no, noX, nextY, level + 1, nextSpread);
          const targetNode = positionedNodes.find(p => p.node.id === node.no);
          if (targetNode) connections.push({ from: posNode, to: targetNode, type: 'no' });
        }
      };

      positionNode('start', width / 2, 50, 0, 130);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.GitBranch />
              <span>Decision Tree</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.08)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              <defs>
                <marker id="decisionArrow" markerWidth="8" markerHeight="6" refX="7" refY="3" orient="auto">
                  <polygon points="0 0, 8 3, 0 6" fill="rgba(255,255,255,0.5)" />
                </marker>
                <filter id="treeShadow" x="-20%" y="-20%" width="140%" height="140%">
                  <feDropShadow dx="0" dy="2" stdDeviation="3" floodOpacity="0.3" />
                </filter>
                <filter id="treeGlow" x="-50%" y="-50%" width="200%" height="200%">
                  <feGaussianBlur stdDeviation="4" result="glow"/>
                  <feMerge><feMergeNode in="glow"/><feMergeNode in="SourceGraphic"/></feMerge>
                </filter>
              </defs>

              {/* Connections */}
              {connections.map((conn, i) => {
                const fromY = conn.from.y + 26;
                const toY = conn.to.y - (conn.to.node.type === 'decision' ? 26 : 18);
                const midY = (fromY + toY) / 2;
                const pathD = `M ${conn.from.x} ${fromY} C ${conn.from.x} ${midY}, ${conn.to.x} ${midY}, ${conn.to.x} ${toY}`;

                return (
                  <motion.g key={`conn-${i}`}>
                    <motion.path
                      initial={{ pathLength: 0, opacity: 0 }}
                      animate={{ pathLength: 1, opacity: 1 }}
                      transition={{ delay: 0.4 + i * 0.08, duration: 0.4 }}
                      d={pathD}
                      stroke={conn.type === 'yes' ? yesColor : noColor}
                      strokeWidth="2"
                      fill="none"
                      markerEnd="url(#decisionArrow)"
                    />
                    <motion.text
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.6 + i * 0.08 }}
                      x={(conn.from.x + conn.to.x) / 2 + (conn.type === 'yes' ? -12 : 12)}
                      y={midY}
                      textAnchor="middle"
                      fill={conn.type === 'yes' ? yesColor : noColor}
                      fontSize="9"
                      fontWeight="600"
                    >
                      {conn.type === 'yes' ? 'Yes' : 'No'}
                    </motion.text>
                  </motion.g>
                );
              })}

              {/* Nodes */}
              {positionedNodes.map((posNode, i) => {
                const { node, x, y } = posNode;
                const isDecision = node.type === 'decision';
                const color = node.color || (isDecision ? decisionColor : outcomeColor);
                const isPurchase = node.id === 'buy';

                return (
                  <motion.g key={node.id} filter="url(#treeShadow)">
                    {isDecision ? (
                      <motion.g
                        initial={{ scale: 0, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        transition={{ delay: 0.1 + i * 0.06, type: 'spring', stiffness: 200 }}
                        style={{ transformOrigin: `${x}px ${y}px` }}>
                        <polygon
                          points={`${x},${y - 26} ${x + 50},${y} ${x},${y + 26} ${x - 50},${y}`}
                          fill={color}
                        />
                        <text x={x} y={y + 4} textAnchor="middle" fill="white" fontSize="9" fontWeight="600">{node.label}</text>
                      </motion.g>
                    ) : (
                      <motion.g
                        initial={{ scale: 0, opacity: 0 }}
                        animate={{ scale: 1, opacity: 1 }}
                        transition={{ delay: 0.1 + i * 0.06, type: 'spring', stiffness: 200 }}
                        style={{ transformOrigin: `${x}px ${y}px` }}
                        filter={isPurchase ? 'url(#treeGlow)' : undefined}>
                        <rect x={x - 45} y={y - 18} width="90" height="36" rx="18" fill={color} />
                        <text x={x} y={y + 4} textAnchor="middle" fill="white" fontSize="9" fontWeight="600">{node.label}</text>
                      </motion.g>
                    )}
                  </motion.g>
                );
              })}
            </svg>

            {/* Legend */}
            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 1.2 }}
              className="flex justify-center gap-6 mt-4 flex-wrap">
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 rotate-45" style={{ backgroundColor: decisionColor }} />
                <span className="text-xs text-white/60">Decision Point</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 rounded-full" style={{ backgroundColor: outcomeColor }} />
                <span className="text-xs text-white/60">Outcome</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-0.5" style={{ backgroundColor: yesColor }} />
                <span className="text-xs" style={{ color: yesColor }}>Yes (Bias Active)</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-0.5" style={{ backgroundColor: noColor }} />
                <span className="text-xs" style={{ color: noColor }}>No (Bias Missing)</span>
              </div>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ UNIQUE COMPONENT 4: SLOPE CHART ============
    // Using exact pattern from library with well-spaced data
    const SlopeChartSlide = ({ data }) => {
      // Spread out start values vertically for clarity
      const chartData = [
        { label: 'Loss Aversion', start: 2.3, end: 5.8, color: '#EF4444' },
        { label: 'Anchoring', start: 1.9, end: 5.4, color: '#3B82F6' },
        { label: 'Halo Effect', start: 2.1, end: 4.6, color: '#F59E0B' },
        { label: 'Bandwagon', start: 1.4, end: 3.5, color: '#22C55E' },
      ];

      const width = 550;
      const height = 350;
      const padding = { top: 60, right: 180, bottom: 40, left: 80 };

      const allValues = chartData.flatMap(d => [d.start, d.end]);
      const maxValue = Math.max(...allValues);
      const minValue = Math.min(...allValues);

      const scaleY = (val) =>
        height - padding.bottom - ((val - minValue) / (maxValue - minValue)) * (height - padding.top - padding.bottom);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.TrendingUp />
              <span>Slope Chart</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div
            initial={{ opacity: 0, scale: 0.95 }}
            animate={{ opacity: 1, scale: 1 }}
            transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.08)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {/* Column lines */}
              <motion.line
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                x1={padding.left} y1={padding.top}
                x2={padding.left} y2={height - padding.bottom}
                stroke="rgba(255,255,255,0.2)" strokeWidth="2"
              />
              <motion.line
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                x1={width - padding.right} y1={padding.top}
                x2={width - padding.right} y2={height - padding.bottom}
                stroke="rgba(255,255,255,0.2)" strokeWidth="2"
              />

              {/* Column headers */}
              <motion.text
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                x={padding.left} y={padding.top - 20}
                textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="12" fontWeight="bold"
              >Before</motion.text>
              <motion.text
                initial={{ opacity: 0 }}
                animate={{ opacity: 1 }}
                x={width - padding.right} y={padding.top - 20}
                textAnchor="middle" fill="rgba(255,255,255,0.6)" fontSize="12" fontWeight="bold"
              >After</motion.text>

              {/* Slopes */}
              {chartData.map((d, i) => {
                const color = d.color;
                const y1 = scaleY(d.start);
                const y2 = scaleY(d.end);
                const isIncrease = d.end >= d.start;

                return (
                  <motion.g key={i}>
                    {/* Line */}
                    <motion.line
                      initial={{ x2: padding.left, y2: y1 }}
                      animate={{ x2: width - padding.right, y2 }}
                      transition={{ delay: 0.2 + i * 0.1, duration: 0.6 }}
                      x1={padding.left} y1={y1}
                      stroke={color} strokeWidth="3"
                    />

                    {/* Start point */}
                    <motion.circle
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{ delay: 0.1 + i * 0.1 }}
                      cx={padding.left} cy={y1} r="8" fill={color}
                    />

                    {/* End point */}
                    <motion.circle
                      initial={{ scale: 0 }}
                      animate={{ scale: 1 }}
                      transition={{ delay: 0.5 + i * 0.1 }}
                      cx={width - padding.right} cy={y2} r="8" fill={color}
                    />

                    {/* Start value */}
                    <motion.text
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.2 + i * 0.1 }}
                      x={padding.left - 15} y={y1 + 4}
                      textAnchor="end" fill="rgba(255,255,255,0.7)" fontSize="11"
                    >{d.start}</motion.text>

                    {/* End value */}
                    <motion.text
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.6 + i * 0.1 }}
                      x={width - padding.right + 15} y={y2 + 4}
                      textAnchor="start" fill="rgba(255,255,255,0.7)" fontSize="11"
                    >{d.end}</motion.text>

                    {/* Label - positioned to the right of end point */}
                    <motion.text
                      initial={{ opacity: 0 }}
                      animate={{ opacity: 1 }}
                      transition={{ delay: 0.4 + i * 0.1 }}
                      x={width - padding.right + 50}
                      y={y2 + 4}
                      textAnchor="start" fill={color} fontSize="10" fontWeight="bold"
                    >{d.label}</motion.text>
                  </motion.g>
                );
              })}
            </svg>

            <motion.div
              initial={{ opacity: 0 }}
              animate={{ opacity: 1 }}
              transition={{ delay: 1.4 }}
              className="text-center mt-4">
              <span className="inline-block px-4 py-2 rounded-lg text-sm font-semibold" style={{ background: 'rgba(136, 218, 28, 0.15)', color: 'var(--accent)' }}>
                Average conversion increase: +189% when biases are strategically applied
              </span>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ STANDARD SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data }) => {
      const userName = getUserName();
      const [greeting, setGreeting] = useState('');
      useEffect(() => {
        if (typeof window !== 'undefined' && window.getPersonalizedGreeting) {
          setGreeting(window.getPersonalizedGreeting(userName));
        } else {
          setGreeting(`Welcome, ${userName}!`);
        }
      }, [userName]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6 overflow-y-auto slide-scroll">
          <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.6 }} className="text-center mb-6">
            <motion.div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }} initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}>
              <Icons.Zap />
              <span>{LESSON_CONFIG.duration}</span>
            </motion.div>
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-sm text-black/60 mb-2">{greeting}</motion.p>
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="title-font text-3xl md:text-5xl text-black mb-4">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }} className="text-base md:text-lg text-black/70 max-w-xl mx-auto">{LESSON_CONFIG.description}</motion.p>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="rounded-2xl p-5 md:p-7" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <h3 className="text-white text-base font-semibold mb-4 flex items-center gap-2"><Icons.Target className="text-[var(--accent)]" /> What You'll Learn</h3>
            <ul className="space-y-3">
              {data.learningGoals.map((goal, i) => (
                <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.6 + i * 0.1 }} className="flex items-start gap-3">
                  <span className="flex-shrink-0 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold mt-0.5" style={{ background: 'var(--accent)', color: 'black' }}>{i + 1}</span>
                  <span className="text-white/80 text-sm">{goal}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6 overflow-y-auto slide-scroll">
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="text-center">
          <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2, duration: 0.7 }} className="title-font text-3xl md:text-5xl text-black mb-6 leading-tight">{data.headline}</motion.h1>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }} className="text-base md:text-lg text-black/70 max-w-2xl mx-auto leading-relaxed">{data.subtext}</motion.p>
        </motion.div>
      </div>
    );

    const SplitContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6 overflow-y-auto slide-scroll">
        <div className={`flex flex-col ${data.reversed ? 'md:flex-row-reverse' : 'md:flex-row'} gap-6 items-center`}>
          <motion.div className="flex-1" initial={{ opacity: 0, x: data.reversed ? 30 : -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}>
            <h2 className="slide-title text-2xl md:text-3xl text-black mb-4">{data.title}</h2>
            <p className="text-black/70 leading-relaxed whitespace-pre-line text-sm md:text-base">{data.content}</p>
          </motion.div>
          <motion.div className="flex-1 flex justify-center" initial={{ opacity: 0, x: data.reversed ? -30 : 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}>
            {data.media?.type === 'video' && (
              <video src={data.media.src} autoPlay loop muted playsInline className="rounded-xl max-h-[320px] w-auto shadow-lg" style={{ background: '#f5f5f5' }} />
            )}
          </motion.div>
        </div>
      </div>
    );

    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6 overflow-y-auto slide-scroll">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-5">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>Case Study</div>
          <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
        </motion.div>

        <div className="grid md:grid-cols-2 gap-4 mb-4">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #fee2e2, #fecaca)', border: '1px solid #fca5a5' }}>
            <div className="flex items-center gap-2 mb-3">
              <Icons.X className="text-red-500" />
              <span className="font-semibold text-red-700 text-sm">{data.before.label}</span>
            </div>
            <p className="text-red-900/80 text-sm leading-relaxed">{data.before.text}</p>
          </motion.div>

          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} className="rounded-xl p-5" style={{ background: 'linear-gradient(135deg, #dcfce7, #bbf7d0)', border: '1px solid #86efac' }}>
            <div className="flex items-center gap-2 mb-3">
              <Icons.Check className="text-green-600" />
              <span className="font-semibold text-green-700 text-sm">{data.after.label}</span>
            </div>
            <p className="text-green-900/80 text-sm leading-relaxed">{data.after.text}</p>
          </motion.div>
        </div>

        <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="rounded-xl p-4 text-center" style={{ background: 'rgba(136, 218, 28, 0.1)', border: '1px solid rgba(136, 218, 28, 0.3)' }}>
          <p className="text-black/80 font-medium text-sm"><Icons.Zap className="inline mr-2" style={{ color: 'var(--accent)' }} />{data.insight}</p>
        </motion.div>
      </div>
    );

    const QuoteSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="text-center">
          <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} className="mb-6"><Icons.Quote className="w-12 h-12 mx-auto" style={{ color: 'var(--accent)' }} /></motion.div>
          <motion.blockquote initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="title-font text-2xl md:text-4xl text-black mb-6 leading-snug">"{data.quote}"</motion.blockquote>
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}>
            <p className="font-semibold text-black">{data.author}</p>
            <p className="text-black/60 text-sm">{data.role}</p>
          </motion.div>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const [feedbackGif, setFeedbackGif] = useState('');
      const isCorrect = selected === data.correctIndex;

      const handleSelect = (index) => {
        if (selected !== null) return;
        setSelected(index);
        setFeedbackGif(index === data.correctIndex ? getRandomCelebrationGif() : getRandomEmpathyGif());
        setTimeout(() => setShowFeedback(true), 300);
        if (onAnswer) onAnswer(index === data.correctIndex);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6 overflow-y-auto slide-scroll">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-5">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>Quick Check</div>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>

          <div className="space-y-3 max-w-2xl mx-auto w-full">
            {data.options.map((option, i) => {
              let style = { background: '#f5f5f5', border: '2px solid #e5e5e5' };
              if (selected !== null) {
                if (i === data.correctIndex) style = { background: '#dcfce7', border: '2px solid #22c55e' };
                else if (i === selected) style = { background: '#fee2e2', border: '2px solid #ef4444' };
              }
              return (
                <motion.button key={i} onClick={() => handleSelect(i)} disabled={selected !== null} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.1 }} className="w-full text-left p-4 rounded-xl transition-all duration-200 flex items-center gap-3" style={style}>
                  <span className="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" style={{ background: selected === i ? (i === data.correctIndex ? '#22c55e' : '#ef4444') : '#e5e5e5', color: selected === i ? 'white' : '#666' }}>{String.fromCharCode(65 + i)}</span>
                  <span className="text-sm font-medium text-black/80">{option}</span>
                </motion.button>
              );
            })}
          </div>

          <AnimatePresence>
            {showFeedback && (
              <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className="mt-5 rounded-xl p-4 flex items-start gap-4 max-w-2xl mx-auto" style={{ background: isCorrect ? '#dcfce7' : '#fee2e2', border: `1px solid ${isCorrect ? '#22c55e' : '#ef4444'}` }}>
                <video src={feedbackGif} autoPlay loop muted playsInline className="w-20 h-20 rounded-lg object-cover flex-shrink-0" />
                <div>
                  <p className="font-bold mb-1" style={{ color: isCorrect ? '#166534' : '#991b1b' }}>{isCorrect ? 'Correct!' : 'Not Quite'}</p>
                  <p className="text-sm" style={{ color: isCorrect ? '#166534' : '#991b1b' }}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6 overflow-y-auto slide-scroll">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} className="text-center">
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2, type: 'spring' }} className="w-20 h-20 rounded-full mx-auto mb-6 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>
            <Icons.Check className="w-10 h-10 text-white" />
          </motion.div>
          <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="title-font text-3xl md:text-4xl text-black mb-4">Lesson Complete!</motion.h1>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }} className="text-black/70 mb-8 max-w-md mx-auto">You've unlocked the secrets of cognitive biases. Now go make your customers' brains work for you.</motion.p>

          {LESSON_CONFIG.nextLesson && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="rounded-xl p-5 text-left max-w-md mx-auto" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
              <p className="text-white/50 text-xs uppercase tracking-wider mb-2">Up Next</p>
              <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
              <p className="text-white/70 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
            </motion.div>
          )}
        </motion.div>
      </div>
    );

    // ============ SLIDE RENDERER ============
    const SlideRenderer = ({ slide, onAnswer }) => {
      switch (slide.type) {
        case 'welcome': return <WelcomeSlide data={slide} />;
        case 'hook': return <HookSlide data={slide} />;
        case 'mind-map': return <MindMapSlide data={slide} />;
        case 'venn-diagram': return <VennDiagramSlide data={slide} />;
        case 'decision-tree': return <DecisionTreeSlide data={slide} />;
        case 'slope-chart': return <SlopeChartSlide data={slide} />;
        case 'split-content': return <SplitContentSlide data={slide} />;
        case 'before-after': return <BeforeAfterSlide data={slide} />;
        case 'quote': return <QuoteSlide data={slide} />;
        case 'quiz': return <QuizSlide data={slide} onAnswer={onAnswer} />;
        case 'completion': return <CompletionSlide data={slide} />;
        default: return <div className="h-full flex items-center justify-center text-black/50">Unknown slide type: {slide.type}</div>;
      }
    };

    // ============ MAIN APP ============
    const App = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const totalSlides = slides.length;

      const goNext = useCallback(() => { if (currentSlide < totalSlides - 1) setCurrentSlide(s => s + 1); }, [currentSlide, totalSlides]);
      const goPrev = useCallback(() => { if (currentSlide > 0) setCurrentSlide(s => s - 1); }, [currentSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); goNext(); }
          else if (e.key === 'ArrowLeft') { e.preventDefault(); goPrev(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [goNext, goPrev]);

      useEffect(() => {
        const url = new URL(window.location.href);
        url.searchParams.set('slide', currentSlide.toString());
        window.history.replaceState({}, '', url.toString());
      }, [currentSlide]);

      const progress = ((currentSlide + 1) / totalSlides) * 100;

      return (
        <div className="h-screen w-full flex flex-col bg-[#fafafa] relative overflow-hidden">
          {/* Progress Bar */}
          <div className="h-1 w-full bg-black/5 relative z-50">
            <motion.div className="h-full" style={{ background: 'var(--accent)' }} initial={{ width: 0 }} animate={{ width: `${progress}%` }} transition={{ duration: 0.3 }} />
          </div>

          {/* Slide Content */}
          <div className="flex-1 relative overflow-hidden">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 50 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -50 }} transition={{ duration: 0.3 }} className="absolute inset-0">
                <SlideRenderer slide={slides[currentSlide]} />
              </motion.div>
            </AnimatePresence>
          </div>

          {/* Navigation */}
          <div className="flex items-center justify-between px-6 py-4 bg-white border-t border-black/5">
            <button onClick={goPrev} disabled={currentSlide === 0} className="flex items-center gap-2 px-4 py-2 rounded-lg text-sm font-medium transition-all disabled:opacity-30 disabled:cursor-not-allowed hover:bg-black/5" style={{ color: '#333' }}>
              <Icons.ArrowLeft /> Back
            </button>

            <div className="flex items-center gap-2">
              <span className="text-sm font-medium text-black/60">{currentSlide + 1} / {totalSlides}</span>
            </div>

            <button onClick={goNext} disabled={currentSlide === totalSlides - 1} className="flex items-center gap-2 px-5 py-2 rounded-lg text-sm font-medium transition-all disabled:opacity-30 disabled:cursor-not-allowed" style={{ background: 'var(--accent)', color: 'black' }}>
              {currentSlide === totalSlides - 1 ? 'Finish' : 'Continue'} <Icons.ArrowRight />
            </button>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
