<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Yes-Loop: How to 3X Your AOV | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #10b981;
      --accent-dark: #059669;
      --accent-light: #34d399;
      --accent-rgb: 16, 185, 129;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'price-chunking-yesloop',
      title: 'The Yes-Loop: How to 3X Your AOV',
      description: 'Instead of asking for $49.99 upfront, break it into smaller yeses. Each small yes makes the next yes easier.',
      accentColor: '#10b981',
      duration: '5 min',
      nextLesson: {
        id: 'objection-destroyer',
        title: 'The At First I Thought Framework',
        teaser: 'The best reviews address objections. Mine Amazon 1-stars and bake them into your product pages.'
      }
    };

    // ============ ELITE CONFIGURATION ARRAYS ============

    const YES_LOOP_STEPS = [
      { label: 'Entry', amount: '$19.99', desc: 'Base product', color: '#10b981', takeRate: '100%' },
      { label: 'Checkout', amount: '+$4.99', desc: 'Add-on upsell', color: '#22c55e', takeRate: '70%' },
      { label: 'Cart', amount: '+$9.99', desc: 'Bundle upgrade', color: '#84cc16', takeRate: '50%' },
      { label: 'Shipping', amount: '+$4.99', desc: 'Flat rate', color: '#eab308', takeRate: '100%' },
      { label: 'Post-Purchase', amount: '+$20', desc: 'Complementary', color: '#f59e0b', takeRate: '30%' }
    ];

    const COMMITMENT_LADDER = [
      { step: 1, title: 'Entry Offer', percentage: '40-50%', desc: 'Foot in the door. Low friction, high perceived value.', icon: 'DoorOpen' },
      { step: 2, title: 'Checkout Upsell', percentage: '10-20%', desc: '"Add protection for $4.99?" 60-80% take rate.', icon: 'Plus' },
      { step: 3, title: 'Cart Upgrade', percentage: '20-30%', desc: '"Upgrade to deluxe for $9.99 more?" Obvious value.', icon: 'TrendingUp' },
      { step: 4, title: 'Post-Purchase', percentage: '30-50%', desc: 'After payment confirmed. 25-35% conversion. Pure profit.', icon: 'Gift' }
    ];

    const CARPAY_TIERS = [
      { qty: 1, price: '$29.99', each: '$29.99', savings: '$0', popular: false },
      { qty: 2, price: '$53.98', each: '$26.99', savings: '$6', popular: false },
      { qty: 3, price: '$71.97', each: '$23.99', savings: '$18', popular: true }
    ];

    const PSYCHOLOGY_PRINCIPLES = [
      { title: 'Commitment Escalation', desc: 'Each small yes builds momentum for the next', icon: 'TrendingUp', color: '#10b981' },
      { title: 'Loss Aversion', desc: 'Backing out feels like losing progress', icon: 'Shield', color: '#f59e0b' },
      { title: 'Foot-in-Door Effect', desc: 'Small commitment increases larger future ones', icon: 'DoorOpen', color: '#8b5cf6' },
      { title: 'Anchoring', desc: 'First low price makes subsequent feel reasonable', icon: 'Anchor', color: '#0891b2' }
    ];

    const IMPACT_STATS = [
      { value: 99, suffix: '%', label: 'Revenue Increase', subtext: 'Same traffic, double revenue' },
      { value: 3, suffix: 'x', label: 'Order Size', subtext: 'From quantity gamification' },
      { value: 68, suffix: '%', label: 'Choose Bundle', subtext: 'vs single item' }
    ];

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) {
      if (e.data?.type === 'ADMIN_STATUS') __isAdmin = e.data.isAdmin;
    });
    if (window.parent !== window) window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation();
        e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({
            type: 'ADMIN_REPORT_REQUEST',
            slideIndex: slideIndex,
            slideType: slideType,
            lessonSlug: LESSON_CONFIG.id,
            elementId: slideType + '-' + slideIndex
          }, '*');
        }
      };

      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px',
            backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer',
            display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6,
            transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <img src="https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/bug-icon.svg"
            width="16" height="16" alt="Report" style={{ filter: 'invert(1)' }}
            onError={(e) => { e.target.style.display = 'none'; e.target.parentNode.innerHTML = 'ðŸ›'; }} />
        </button>
      );
    };
    // ============ END ADMIN REPORTER SYSTEM ============

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============ ICONS ============
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      ArrowDown: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      DollarSign: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/></svg>,
      TrendingUp: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      DoorOpen: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M13 4h3a2 2 0 0 1 2 2v14"/><path d="M2 20h3"/><path d="M13 20h9"/><path d="M10 12v.01"/><path d="M13 4.562v16.157a1 1 0 0 1-1.242.97L5 20V5.562a2 2 0 0 1 1.515-1.94l4-1A2 2 0 0 1 13 4.561Z"/></svg>,
      Plus: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>,
      Gift: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="20 12 20 22 4 22 4 12"/><rect x="2" y="7" width="20" height="5"/><line x1="12" y1="22" x2="12" y2="7"/><path d="M12 7H7.5a2.5 2.5 0 0 1 0-5C11 2 12 7 12 7z"/><path d="M12 7h4.5a2.5 2.5 0 0 0 0-5C13 2 12 7 12 7z"/></svg>,
      Anchor: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="5" r="3"/><line x1="12" y1="22" x2="12" y2="8"/><path d="M5 12H2a10 10 0 0 0 20 0h-3"/></svg>,
      ShoppingCart: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="9" cy="21" r="1"/><circle cx="20" cy="21" r="1"/><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Lightbulb: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      Package: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="16.5" y1="9.4" x2="7.5" y2="4.21"/><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/><polyline points="3.27 6.96 12 12.01 20.73 6.96"/><line x1="12" y1="22.08" x2="12" y2="12"/></svg>,
      Star: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
    };

    const IconComponents = {
      DoorOpen: Icons.DoorOpen,
      Plus: Icons.Plus,
      TrendingUp: Icons.TrendingUp,
      Gift: Icons.Gift,
      Shield: Icons.Shield,
      Anchor: Icons.Anchor,
      ShoppingCart: Icons.ShoppingCart,
      Target: Icons.Target,
      Lightbulb: Icons.Lightbulb,
      Package: Icons.Package
    };

    // ============ ANIMATED COUNTER ============
    const AnimatedCounter = ({ value, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseInt(value);
        if (start === end) return;
        const timer = setInterval(() => {
          start += Math.ceil(end / (duration / 50));
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(start); }
        }, 50);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // ============ SLIDES DATA ============
    const slides = [
      { type: 'welcome', learningGoals: [
        'How to break $49.99 into multiple small yeses that feel easier to say',
        'The psychology of commitment escalation (why each yes makes the next easier)',
        'Real examples: Carpay quantity gamification, post-purchase upsells'
      ]},
      { type: 'hook', headline: 'Asking for $49.99 upfront? That\'s a big yes. Scary. Risky. Easy to say no.', subtext: 'But what if you asked for $19.99 first? Then $4.99. Then $9.99. Then $4.99 shipping. Then $20 post-purchase. Same final price. WAY higher conversion. Because each small yes makes the next yes easier. Welcome to the Yes-Loop.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/after%20pay%20(1).png', brandName: 'Afterpay' },
      { type: 'content', title: 'The Psychology of Micro-Commitments', body: 'Your brain HATES big decisions. "Should I spend $50?" triggers fear, analysis paralysis, objections. But small decisions? Easy. "Is this worth $20?" feels manageable. Once you say yes to $20, saying yes to $5 feels tiny. Then $10 feels normal. By the time you hit $50 total, you\'ve already committed 3 times. You\'re in the loop.' },
      { type: 'yesloop-visual' },
      { type: 'commitment-ladder' },
      { type: 'example', scenario: 'Real Store: Resistance Bands', before: { label: 'Before Yes-Loop', text: 'Single offer: $49.99 for complete set\n\nConversion: 2.1%\nAOV: $49.99\nRevenue per 1,000 visitors: $1,050' }, after: { label: 'With Yes-Loop', text: 'Base: $19.99 (resistance band)\nUpsell 1: $4.99 (door anchor, 70% take)\nUpsell 2: $9.99 (exercise guide, 50% take)\nShipping: $4.99\nPost-purchase: $19.99 (yoga mat, 30% take)\n\nConversion: 4.3%\nAOV: $48.50\nRevenue per 1,000 visitors: $2,086 (+99%)' }, insight: 'Same final price. Double the revenue. All from breaking it into yeses.' },
      { type: 'carpay-gamification' },
      { type: 'psychology-pillars' },
      { type: 'example', scenario: 'The Post-Purchase Goldmine', before: { label: 'No Post-Purchase', text: 'Customer buys protein powder: $39.99\nOrder complete.\n\nAOV: $39.99' }, after: { label: 'With Post-Purchase Upsell', text: 'Customer buys protein powder: $39.99\nOrder confirmed!\n"Add a shaker bottle for $14.99?"\n30% take rate\n\nAOV: $44.49 (+11% pure profit)' }, insight: 'They already committed to buying. Post-purchase is the easiest yes they\'ll ever give you.' },
      { type: 'impact-stats' },
      { type: 'elite-insight' },
      { type: 'quiz', question: 'Why does breaking $49.99 into smaller yeses increase conversion?', options: ['It tricks customers into spending more money', 'Small decisions feel safer and build commitment momentum', 'The total price appears lower than it actually is', 'It confuses customers so they buy without thinking'], correctIndex: 1, feedback: { correct: 'Exactly! Each small yes reduces friction and builds psychological commitment. The customer feels in control of small decisions, which makes larger total spending feel natural and safe.', incorrect: 'Not quite. It\'s not about tricks or confusion - it\'s about commitment psychology. Small decisions feel safer and create momentum. Each yes makes the next yes easier because we\'re wired to stay consistent with our choices.' }},
      { type: 'completion' }
    ];

    // ============ SLIDE COMPONENTS ============

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6 relative z-10">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed relative z-10">{data.body}</motion.p>
      </div>
    );

    // ============ CUSTOM ELITE SLIDES ============

    // Yes-Loop Visual: Traditional vs Yes-Loop with animated stacking
    const YesLoopVisualSlide = () => {
      const [activeStep, setActiveStep] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveStep(prev => (prev + 1) % YES_LOOP_STEPS.length);
        }, 2000);
        return () => clearInterval(timer);
      }, []);

      const runningTotal = YES_LOOP_STEPS.slice(0, activeStep + 1).reduce((sum, step) => {
        const amount = parseFloat(step.amount.replace(/[^0-9.]/g, ''));
        return sum + amount;
      }, 0);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
            Traditional vs Yes-Loop
          </motion.h2>

          <div className="grid md:grid-cols-2 gap-6">
            {/* Traditional - One Big Ask */}
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', border: '2px solid #dc2626' }}>
              <div style={{ height: '4px', background: 'linear-gradient(90deg, transparent, #dc2626, transparent)', marginBottom: '20px', borderRadius: '2px' }} />
              <div className="text-center">
                <p className="text-red-400 text-xs font-semibold uppercase tracking-wider mb-4">One Big Scary Ask</p>
                <div className="text-5xl md:text-6xl font-bold text-white mb-4">$49.99</div>
                <div className="flex items-center justify-center gap-2 text-red-400">
                  <Icons.X />
                  <span className="text-sm">High friction, easy to say NO</span>
                </div>
              </div>
            </motion.div>

            {/* Yes-Loop - Small Yeses */}
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
              style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', border: '2px solid #10b981' }}>
              <div style={{ height: '4px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)', marginBottom: '20px', borderRadius: '2px' }} />
              <p className="text-emerald-400 text-xs font-semibold uppercase tracking-wider mb-4 text-center">5 Easy Yeses</p>

              <div className="space-y-2">
                {YES_LOOP_STEPS.map((step, i) => (
                  <motion.div key={i}
                    initial={{ opacity: 0.3, x: -10 }}
                    animate={{ opacity: i <= activeStep ? 1 : 0.3, x: 0, scale: i === activeStep ? 1.02 : 1 }}
                    transition={{ duration: 0.3 }}
                    className="flex items-center justify-between p-2 rounded-lg"
                    style={{ background: i <= activeStep ? `${step.color}15` : 'transparent', border: i === activeStep ? `1px solid ${step.color}` : '1px solid transparent' }}>
                    <div className="flex items-center gap-2">
                      <div className="w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold"
                        style={{ background: i <= activeStep ? step.color : '#444', color: 'white' }}>
                        {i <= activeStep ? <Icons.Check /> : i + 1}
                      </div>
                      <span className="text-white text-sm">{step.label}</span>
                    </div>
                    <span className="font-bold" style={{ color: step.color }}>{step.amount}</span>
                  </motion.div>
                ))}
              </div>

              <div className="mt-4 pt-4 border-t border-neutral-700 flex items-center justify-between">
                <span className="text-neutral-400 text-sm">Running Total:</span>
                <span className="text-2xl font-bold text-emerald-400">${runningTotal.toFixed(2)}</span>
              </div>
            </motion.div>
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }}
            className="text-center mt-6">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full" style={{ background: 'rgba(16, 185, 129, 0.1)' }}>
              <Icons.Target />
              <span className="text-emerald-600 font-semibold text-sm">Same final price. WAY easier to say yes.</span>
            </div>
          </motion.div>
        </div>
      );
    };

    // Commitment Ladder: 4-step progression
    const CommitmentLadderSlide = () => {
      const [activeStep, setActiveStep] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActiveStep(prev => (prev + 1) % COMMITMENT_LADDER.length);
        }, 2500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            Building Your Yes-Loop
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">
            Each step as % of target AOV
          </motion.p>

          <div className="grid md:grid-cols-4 gap-4">
            {COMMITMENT_LADDER.map((step, i) => {
              const IconComponent = IconComponents[step.icon];
              return (
                <motion.div key={i}
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0, scale: i === activeStep ? 1.03 : 1 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  style={{
                    background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                    borderRadius: '16px',
                    padding: '20px',
                    border: i === activeStep ? '2px solid #10b981' : '1px solid rgba(255,255,255,0.1)',
                    boxShadow: i === activeStep ? '0 0 30px rgba(16, 185, 129, 0.2)' : 'none'
                  }}>
                  <div style={{ height: '3px', background: i === activeStep ? 'linear-gradient(90deg, transparent, #10b981, transparent)' : 'linear-gradient(90deg, transparent, #444, transparent)', marginBottom: '16px', borderRadius: '2px' }} />

                  <div className="flex items-center gap-2 mb-3">
                    <div className="w-8 h-8 rounded-lg flex items-center justify-center text-white"
                      style={{ background: i === activeStep ? '#10b981' : '#333' }}>
                      {IconComponent && <IconComponent />}
                    </div>
                    <span className="text-xs font-bold text-neutral-400">STEP {step.step}</span>
                  </div>

                  <h3 className="text-white font-bold mb-1">{step.title}</h3>
                  <div className="text-emerald-400 font-bold text-lg mb-2">{step.percentage}</div>
                  <p className="text-neutral-400 text-xs leading-relaxed">{step.desc}</p>
                </motion.div>
              );
            })}
          </div>

          {/* Progress arrows */}
          <div className="hidden md:flex justify-center mt-6 gap-4">
            {[0, 1, 2].map(i => (
              <motion.div key={i}
                animate={{ x: [0, 5, 0] }}
                transition={{ repeat: Infinity, duration: 1, delay: i * 0.2 }}>
                <Icons.ArrowRight />
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // Carpay Gamification: Quantity tiers visualization
    const CarpayGamificationSlide = () => {
      const [selectedTier, setSelectedTier] = useState(2);

      useEffect(() => {
        const timer = setInterval(() => {
          setSelectedTier(prev => prev === 2 ? 0 : prev + 1);
        }, 2000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">
            The Carpay Quantity Gamification
          </motion.h2>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">
            3 small yeses = 3x revenue
          </motion.p>

          <div className="grid md:grid-cols-3 gap-4">
            {CARPAY_TIERS.map((tier, i) => (
              <motion.div key={i}
                initial={{ opacity: 0, y: 30 }}
                animate={{ opacity: 1, y: 0, scale: i === selectedTier ? 1.05 : 1 }}
                transition={{ delay: 0.1 + i * 0.1 }}
                onClick={() => setSelectedTier(i)}
                style={{
                  background: tier.popular ? 'linear-gradient(135deg, #059669, #10b981)' : 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                  borderRadius: '16px',
                  padding: '24px',
                  cursor: 'pointer',
                  border: i === selectedTier ? '2px solid #10b981' : '1px solid rgba(255,255,255,0.1)',
                  position: 'relative',
                  overflow: 'hidden'
                }}>
                {tier.popular && (
                  <div className="absolute top-0 right-0 bg-yellow-400 text-black text-[10px] font-bold px-3 py-1 rounded-bl-lg">
                    MOST POPULAR
                  </div>
                )}

                <div className="text-center">
                  <div className="text-5xl font-bold text-white mb-2">{tier.qty}</div>
                  <p className="text-neutral-300 text-sm mb-4">units</p>

                  <div className="space-y-2">
                    <div className="flex justify-between text-sm">
                      <span className="text-neutral-400">Each:</span>
                      <span className={tier.popular ? 'text-white font-bold' : 'text-emerald-400 font-bold'}>{tier.each}</span>
                    </div>
                    <div className="flex justify-between text-sm">
                      <span className="text-neutral-400">Total:</span>
                      <span className="text-white">{tier.price}</span>
                    </div>
                    {tier.savings !== '$0' && (
                      <div className="mt-3 py-2 px-3 rounded-lg" style={{ background: 'rgba(16, 185, 129, 0.2)' }}>
                        <span className="text-emerald-400 font-bold text-sm">Save {tier.savings}!</span>
                      </div>
                    )}
                  </div>
                </div>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }}
            className="mt-6 p-4 rounded-xl text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <p className="text-neutral-300 text-sm">
              <span className="text-emerald-400 font-bold">68%</span> of customers choose the bundle.
              They said "yes" to buying, then "yes" to 2, then "yes" to 3.
            </p>
          </motion.div>
        </div>
      );
    };

    // Psychology Pillars: 4 principles grid
    const PsychologyPillarsSlide = () => {
      const [activePillar, setActivePillar] = useState(0);

      useEffect(() => {
        const timer = setInterval(() => {
          setActivePillar(prev => (prev + 1) % PSYCHOLOGY_PRINCIPLES.length);
        }, 2500);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
            Why Yes-Loop Works (Science)
          </motion.h2>

          <div className="grid md:grid-cols-2 gap-4">
            {PSYCHOLOGY_PRINCIPLES.map((principle, i) => {
              const IconComponent = IconComponents[principle.icon];
              return (
                <motion.div key={i}
                  initial={{ opacity: 0, y: 30 }}
                  animate={{ opacity: 1, y: 0, scale: i === activePillar ? 1.02 : 1 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  style={{
                    background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                    borderRadius: '16px',
                    padding: '20px',
                    border: i === activePillar ? `2px solid ${principle.color}` : '1px solid rgba(255,255,255,0.1)',
                    boxShadow: i === activePillar ? `0 0 30px ${principle.color}20` : 'none'
                  }}>
                  <div style={{ height: '3px', background: `linear-gradient(90deg, transparent, ${principle.color}, transparent)`, marginBottom: '16px', borderRadius: '2px' }} />

                  <div className="flex items-start gap-4">
                    <div className="w-12 h-12 rounded-xl flex items-center justify-center flex-shrink-0"
                      style={{ background: `${principle.color}20`, color: principle.color }}>
                      {IconComponent && <IconComponent />}
                    </div>
                    <div>
                      <h3 className="text-white font-bold mb-1">{principle.title}</h3>
                      <p className="text-neutral-400 text-sm">{principle.desc}</p>
                    </div>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // Impact Stats: AnimatedCounter stats
    const ImpactStatsSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">
          The Yes-Loop Effect
        </motion.h2>

        <div className="grid md:grid-cols-3 gap-6">
          {IMPACT_STATS.map((stat, i) => (
            <motion.div key={i}
              initial={{ opacity: 0, y: 30 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 + i * 0.15 }}
              style={{
                background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
                borderRadius: '16px',
                padding: '32px',
                textAlign: 'center'
              }}>
              <div style={{ height: '4px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)', marginBottom: '24px', borderRadius: '2px' }} />

              <div className="text-5xl md:text-6xl font-bold mb-3" style={{ color: '#10b981' }}>
                <AnimatedCounter value={stat.value} suffix={stat.suffix} />
              </div>
              <p className="text-white font-semibold mb-1">{stat.label}</p>
              <p className="text-neutral-400 text-sm">{stat.subtext}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // Elite Insight: The Yes-Loop Mindset
    const EliteInsightSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
          style={{
            background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)',
            borderRadius: '24px',
            padding: '40px',
            border: '1px solid rgba(16, 185, 129, 0.3)',
            boxShadow: '0 0 60px rgba(16, 185, 129, 0.1)'
          }}>
          <div style={{ height: '4px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)', marginBottom: '32px', borderRadius: '2px' }} />

          <div className="flex items-center justify-center gap-3 mb-6">
            <div className="w-12 h-12 rounded-xl flex items-center justify-center" style={{ background: 'rgba(16, 185, 129, 0.2)' }}>
              <Icons.Lightbulb />
            </div>
            <span className="text-emerald-400 text-xs font-bold uppercase tracking-wider">Elite Insight</span>
          </div>

          <h3 className="slide-title text-2xl md:text-3xl text-white text-center mb-6">
            "The Momentum Paradox"
          </h3>

          <p className="text-neutral-300 text-center text-lg leading-relaxed mb-6">
            Each small yes isn't just a purchase - it's a psychological commitment. The customer isn't just buying products, they're building an identity as "someone who buys from you." By the fifth yes, they're not deciding anymore. They're just... continuing.
          </p>

          <div className="flex items-center justify-center gap-2 text-emerald-400">
            <Icons.Target />
            <span className="font-semibold">Stack the yeses. Watch the loop compound.</span>
          </div>
        </motion.div>
      </div>
    );

    // ============ STANDARD SLIDES ============

    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-2" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>Real Example</span>
          <h2 className="slide-title text-xl md:text-2xl text-black">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4 mb-6">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '2px solid #dc2626', borderRadius: '16px', padding: '20px' }}>
            <div style={{ height: '3px', background: 'linear-gradient(90deg, transparent, #dc2626, transparent)', marginBottom: '16px', borderRadius: '2px' }} />
            <div className="flex items-center gap-2 mb-3">
              <div className="w-6 h-6 rounded-full bg-red-500 flex items-center justify-center text-white"><Icons.X /></div>
              <span className="font-semibold text-red-400 text-sm">{data.before.label}</span>
            </div>
            <p className="text-neutral-300 text-sm leading-relaxed whitespace-pre-line">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '2px solid #10b981', borderRadius: '16px', padding: '20px' }}>
            <div style={{ height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)', marginBottom: '16px', borderRadius: '2px' }} />
            <div className="flex items-center gap-2 mb-3">
              <div className="w-6 h-6 rounded-full bg-emerald-500 flex items-center justify-center text-white"><Icons.Check /></div>
              <span className="font-semibold text-emerald-400 text-sm">{data.after.label}</span>
            </div>
            <p className="text-neutral-300 text-sm leading-relaxed whitespace-pre-line">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
          className="p-4 text-center rounded-xl" style={{ background: 'rgba(16, 185, 129, 0.1)' }}>
          <p className="text-emerald-700 text-sm font-medium"><Icons.Zap className="inline mr-2" />{data.insight}</p>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => {
        if (showFeedback) {
          if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); }
        }
      }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);

      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">You now understand the Yes-Loop. Break your price into small yeses. Stack the commitments. Watch your AOV climb without touching traffic.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============ MAIN APP ============

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({
          type: 'LESSON_SLIDE_UPDATE',
          slideIndex: currentSlide,
          slideType: slides[currentSlide]?.type,
          lessonSlug: LESSON_CONFIG.id
        }, '*');
      }, [currentSlide]);

      // URL parameter for direct slide access
      useEffect(() => {
        const params = new URLSearchParams(window.location.search);
        const slideParam = params.get('slide');
        if (slideParam) {
          const slideIndex = parseInt(slideParam, 10);
          if (!isNaN(slideIndex) && slideIndex >= 0 && slideIndex < slides.length) {
            setCurrentSlide(slideIndex);
          }
        }
      }, []);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'yesloop-visual': return <YesLoopVisualSlide />;
          case 'commitment-ladder': return <CommitmentLadderSlide />;
          case 'carpay-gamification': return <CarpayGamificationSlide />;
          case 'psychology-pillars': return <PsychologyPillarsSlide />;
          case 'impact-stats': return <ImpactStatsSlide />;
          case 'elite-insight': return <EliteInsightSlide />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
