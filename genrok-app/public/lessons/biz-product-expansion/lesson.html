<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>The Ridge Playbook | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #D4A017;
      --accent-dark: #B8860B;
      --accent-light: #F4D03F;
      --accent-rgb: 212, 160, 23;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: #ffffff;
      overflow: hidden;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
    }
    .title-font { font-family: 'Fraunces', Georgia, serif; }
    ::selection { background: var(--accent); color: white; }
    .hide-scrollbar::-webkit-scrollbar { display: none; }
    .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    @keyframes float { 0%, 100% { transform: translateY(0px); } 50% { transform: translateY(-10px); } }
    .float-animation { animation: float 3s ease-in-out infinite; }
  </style>
</head>
<body>
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useMemo, useCallback, useRef } = React;
    const { motion, AnimatePresence } = window.Motion;

    // ==================== LESSON CONFIG ====================
    const LESSON_CONFIG = {
      id: 'biz-product-expansion',
      title: 'The Ridge Playbook',
      subtitle: 'How to Engineer High LTV',
      accentColor: '#D4A017',
      duration: '7 min',
      nextLesson: {
        id: 'biz-zero-cac-engine',
        title: 'The $0 CAC Engine',
        teaser: 'Build organic systems that drive revenue before you spend on ads.'
      }
    };

    // ==================== GIF LIBRARIES ====================
    const celebrationGifs = [
      'https://media.giphy.com/media/artj92V8o75VPL7AeQ/giphy.gif',
      'https://media.giphy.com/media/l0MYt5jPR6QX5pnqM/giphy.gif',
      'https://media.giphy.com/media/3oz8xAFtqoOUUrsh7W/giphy.gif',
      'https://media.giphy.com/media/xUPGGDNsLvqsBOhuU0/giphy.gif',
      'https://media.giphy.com/media/l3q2Z6S6n38zjPswo/giphy.gif',
      'https://media.giphy.com/media/3o6fJ1BM7R2EBRDnxK/giphy.gif'
    ];

    const empathyGifs = [
      'https://media.giphy.com/media/3o7btYc0vx9pNkgFry/giphy.gif',
      'https://media.giphy.com/media/3o7TKnO6Wve6502iJ2/giphy.gif',
      'https://media.giphy.com/media/l0HlvtIPzPdt2usKs/giphy.gif',
      'https://media.giphy.com/media/26ufnwz3wDUli7GU0/giphy.gif'
    ];

    const getRandomGif = (gifs) => gifs[Math.floor(Math.random() * gifs.length)];

    // ==================== ICONS ====================
    const Icons = {
      Clock: () => (<svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10" strokeWidth="2"/><path strokeWidth="2" d="M12 6v6l4 2"/></svg>),
      ChevronLeft: () => (<svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M15 19l-7-7 7-7"/></svg>),
      ChevronRight: () => (<svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M9 5l7 7-7 7"/></svg>),
      Check: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M5 13l4 4L19 7"/></svg>),
      X: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2.5" d="M6 18L18 6M6 6l12 12"/></svg>),
      Sparkles: () => (<svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M9.813 15.904L9 18.75l-.813-2.846a4.5 4.5 0 00-3.09-3.09L2.25 12l2.846-.813a4.5 4.5 0 003.09-3.09L9 5.25l.813 2.846a4.5 4.5 0 003.09 3.09L15.75 12l-2.846.813a4.5 4.5 0 00-3.09 3.09zM18.259 8.715L18 9.75l-.259-1.035a3.375 3.375 0 00-2.455-2.456L14.25 6l1.036-.259a3.375 3.375 0 002.455-2.456L18 2.25l.259 1.035a3.375 3.375 0 002.456 2.456L21.75 6l-1.035.259a3.375 3.375 0 00-2.456 2.456zM16.894 20.567L16.5 21.75l-.394-1.183a2.25 2.25 0 00-1.423-1.423L13.5 18.75l1.183-.394a2.25 2.25 0 001.423-1.423l.394-1.183.394 1.183a2.25 2.25 0 001.423 1.423l1.183.394-1.183.394a2.25 2.25 0 00-1.423 1.423z"/></svg>),
      ArrowRight: () => (<svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/></svg>),
      Quote: () => (<svg className="w-8 h-8" fill="currentColor" viewBox="0 0 24 24"><path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z"/></svg>)
    };

    // ==================== SLIDE DATA ====================
    const slides = [
      {
        type: 'welcome',
        greeting: true,
        goals: [
          'How Ridge went from wallets to $200M+',
          "Why 'more of the same' kills LTV",
          'The trust transfer strategy for expansion'
        ]
      },
      {
        type: 'hook',
        headline: 'Ridge sells wallets.',
        subtext: "But over 50% of their revenue comes from... not wallets. Here's how they did it."
      },
      {
        type: 'quote',
        text: '"When we emailed happy customers to buy another wallet, they said: Of course not. I already have your wallet."',
        author: 'Sean Frank',
        role: 'CEO of Ridge ($200M+ Revenue)',
        image: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/tGs7erOT_400x400-removebg-preview.png'
      },
      {
        type: 'content',
        title: 'The Trap',
        body: "Ridge had 97% NPS. Customers LOVED the product. But most people only need one wallet. High satisfaction, low repeat revenue. This is the trap most DTC brands fall into.",
        highlight: "You can't sell someone a second wallet."
      },
      {
        type: 'example',
        title: 'The Wrong vs Right Move',
        before: {
          label: 'The Wrong Move',
          items: ['Launch Wallet 2.0', 'Limited edition colors', 'Premium wallet upgrade', 'Same product, same problem']
        },
        after: {
          label: 'The Ridge Move',
          items: ['Launch phone cases', 'Launch rings & keychains', 'Launch luggage & bags', 'Same customer, NEW reasons to buy']
        }
      },
      {
        type: 'cards',
        title: "Ridge's Expansion Strategy",
        cards: [
          { emoji: 'üì±', title: 'Phone Cases', desc: 'Same minimalist design, new category' },
          { emoji: 'üíç', title: 'Rings', desc: 'Trust transferred from wallets' },
          { emoji: 'üß≥', title: 'Luggage', desc: 'Premium quality, loyal customers' },
          { emoji: 'üéí', title: 'Backpacks', desc: 'Everyday carry lifestyle brand' }
        ]
      },
      {
        type: 'visual',
        title: 'The Results',
        subtitle: "Product expansion that actually worked:",
        items: [
          { icon: 'üìä', label: '50%+ Non-Wallet Revenue' },
          { icon: 'üìà', label: '3-5x LTV Increase' },
          { icon: 'üí∞', label: '$200M+ Annual' },
          { icon: '‚≠ê', label: '97% NPS Maintained' }
        ],
        footer: 'Same customers. Multiple purchases. Exploding LTV.'
      },
      {
        type: 'content',
        title: 'The Trust Transfer',
        body: "When customers trust you in one category, they trust you in others. Ridge proved they could make exceptional wallets. When they launched phone cases with the same design language... customers bought.",
        highlight: "Trust transferred. LTV compounded. Revenue exploded."
      },
      {
        type: 'quiz',
        question: 'Why did Ridge expand into rings, phone cases, and luggage instead of making more wallets?',
        options: [
          'To compete with other wallet brands',
          'Because wallet margins were too low',
          'Happy customers only need one wallet‚Äînew categories create repeat purchases',
          'To increase their average order value'
        ],
        correctIndex: 2,
        feedback: {
          correct: "Exactly! 97% NPS but low repeat revenue. You can't sell someone a second wallet. But you CAN sell them phone cases, rings, and luggage.",
          incorrect: "Not quite. Ridge expanded because happy customers don't need another wallet. New categories = new reasons to buy again."
        }
      },
      {
        type: 'content',
        title: 'The Warning',
        body: "This only works if your core product is EXCEPTIONAL. If customers don't love your first product, expansion kills you. Ridge earned 97% NPS before they expanded.",
        highlight: "Earn trust first. Expand second."
      },
      {
        type: 'action-checklist',
        title: 'Apply The Ridge Playbook',
        items: [
          'Calculate your repeat purchase rate for core products',
          'Identify 2-3 adjacent categories your customers already buy',
          'Test ONE expansion product that fits your brand DNA',
          'Watch LTV compound as trust transfers'
        ]
      },
      {
        type: 'completion'
      }
    ];

    // ==================== SLIDE COMPONENTS ====================

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const getGreeting = () => {
        const hour = new Date().getHours();
        if (hour < 12) return { text: 'Early riser?', sub: `${userName || 'Builder'} builds empires before noon.` };
        if (hour < 17) return { text: 'Afternoon session?', sub: `${userName || 'Builder'} never stops learning.` };
        if (hour < 21) return { text: 'Evening study?', sub: `${userName || 'Builder'} plays the long game.` };
        return { text: 'Night owl?', sub: `${userName || 'Builder'} outworks everyone.` };
      };
      const greeting = getGreeting();

      return (
        <div className="h-full flex flex-col items-center justify-center px-6 py-8 md:py-12 text-center overflow-y-auto hide-scrollbar">
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.8, ease: [0.22, 1, 0.36, 1] }} className="max-w-xl w-full">
            <h1 className="title-font text-4xl md:text-5xl lg:text-6xl font-black text-neutral-900 mb-3 tracking-tight">{LESSON_CONFIG.title}</h1>
            <p className="text-lg md:text-xl text-neutral-500 mb-6">{greeting.text} <span className="font-semibold text-neutral-700">{userName || 'Builder'}</span> {greeting.sub.split(userName || 'Builder')[1]}</p>
            <div className="flex items-center justify-center gap-2 text-sm text-neutral-400 mb-8">
              <Icons.Clock /><span>{LESSON_CONFIG.duration}</span>
            </div>
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3, duration: 0.6 }} className="bg-neutral-800 rounded-2xl p-6 text-left mb-8">
              <p className="text-xs font-semibold tracking-widest uppercase mb-4" style={{ color: 'var(--accent)' }}>In This Lesson</p>
              <div className="space-y-3">
                {data.goals.map((goal, i) => (
                  <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.5 + i * 0.1 }} className="flex items-start gap-3">
                    <span className="flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-neutral-900" style={{ backgroundColor: 'var(--accent)' }}>{i + 1}</span>
                    <span className="text-neutral-200 text-sm md:text-base leading-relaxed">{goal}</span>
                  </motion.div>
                ))}
              </div>
            </motion.div>
            <motion.button onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} onHoverStart={onShowGif} onHoverEnd={onHideGif} className="px-8 py-4 rounded-xl font-semibold text-neutral-900 transition-all shadow-lg" style={{ backgroundColor: 'var(--accent)' }}>
              Let's Go
            </motion.button>
          </motion.div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 text-center bg-neutral-900">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.6 }} className="max-w-3xl">
          <h2 className="title-font text-4xl md:text-5xl lg:text-6xl font-black text-white mb-6">{data.headline}</h2>
          <p className="text-xl md:text-2xl text-neutral-400 leading-relaxed">{data.subtext}</p>
        </motion.div>
      </div>
    );

    const QuoteSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 bg-gradient-to-br from-neutral-900 via-neutral-800 to-neutral-900 relative overflow-hidden">
        <motion.div initial={{ opacity: 0 }} animate={{ opacity: 0.03 }} className="absolute -top-20 -left-10 text-[300px] font-black text-white pointer-events-none select-none">"</motion.div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.7 }} className="max-w-3xl text-center relative z-10">
          <Icons.Quote />
          <p className="title-font text-2xl md:text-3xl lg:text-4xl font-bold text-white mt-6 mb-8 leading-snug">{data.text}</p>
          <div className="flex items-center justify-center gap-4">
            <div className="text-right">
              <p className="font-bold text-lg" style={{ color: 'var(--accent)' }}>‚Äî {data.author}</p>
              <p className="text-neutral-400 text-sm">{data.role}</p>
            </div>
          </div>
        </motion.div>
        {data.image && (
          <motion.div initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3, duration: 0.6 }} className="absolute right-4 md:right-12 bottom-0" style={{ zIndex: 15 }}>
            <img src={data.image} alt={data.author} className="h-40 md:h-52 w-auto object-contain" />
          </motion.div>
        )}
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 overflow-y-auto hide-scrollbar">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-2xl w-full">
          <h2 className="title-font text-3xl md:text-4xl font-black text-neutral-900 mb-6">{data.title}</h2>
          <p className="text-lg md:text-xl text-neutral-600 leading-relaxed mb-6">{data.body}</p>
          {data.highlight && (
            <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="p-5 rounded-xl border-l-4" style={{ backgroundColor: 'rgba(var(--accent-rgb), 0.1)', borderColor: 'var(--accent)' }}>
              <p className="text-neutral-800 font-medium">{data.highlight}</p>
            </motion.div>
          )}
        </motion.div>
      </div>
    );

    const ExampleSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 overflow-y-auto hide-scrollbar">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-4xl w-full">
          <h2 className="title-font text-3xl md:text-4xl font-black text-neutral-900 mb-8 text-center">{data.title}</h2>
          <div className="grid md:grid-cols-2 gap-6">
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} className="bg-red-50 border-2 border-red-200 rounded-2xl p-6">
              <div className="flex items-center gap-2 mb-4">
                <span className="text-2xl">‚ùå</span>
                <span className="font-bold text-red-700 text-lg">{data.before.label}</span>
              </div>
              <ul className="space-y-3">
                {data.before.items.map((item, i) => (
                  <li key={i} className="flex items-start gap-2 text-red-900">
                    <span className="text-red-400 mt-1">‚Ä¢</span>
                    <span className="text-sm md:text-base">{item}</span>
                  </li>
                ))}
              </ul>
            </motion.div>
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} className="bg-green-50 border-2 border-green-200 rounded-2xl p-6">
              <div className="flex items-center gap-2 mb-4">
                <span className="text-2xl">‚úÖ</span>
                <span className="font-bold text-green-700 text-lg">{data.after.label}</span>
              </div>
              <ul className="space-y-3">
                {data.after.items.map((item, i) => (
                  <li key={i} className="flex items-start gap-2 text-green-900">
                    <span className="text-green-500 mt-1">‚Ä¢</span>
                    <span className="text-sm md:text-base">{item}</span>
                  </li>
                ))}
              </ul>
            </motion.div>
          </div>
        </motion.div>
      </div>
    );

    const CardsSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 overflow-y-auto hide-scrollbar">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-4xl w-full">
          <h2 className="title-font text-3xl md:text-4xl font-black text-neutral-900 mb-8 text-center">{data.title}</h2>
          <div className="grid grid-cols-2 gap-4">
            {data.cards.map((card, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 * i }} className="bg-white border border-neutral-200 rounded-xl p-4 md:p-5 shadow-sm hover:shadow-md transition-shadow">
                <span className="text-3xl mb-3 block">{card.emoji}</span>
                <h3 className="font-bold text-neutral-900 text-sm md:text-base mb-1">{card.title}</h3>
                <p className="text-neutral-500 text-xs md:text-sm leading-relaxed">{card.desc}</p>
              </motion.div>
            ))}
          </div>
        </motion.div>
      </div>
    );

    const VisualSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-3xl w-full text-center">
          <h2 className="title-font text-3xl md:text-4xl font-black text-neutral-900 mb-2">{data.title}</h2>
          <p className="text-neutral-500 mb-8">{data.subtitle}</p>
          <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
            {data.items.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.1 * i }} className="bg-neutral-900 rounded-xl p-4 md:p-6">
                <span className="text-3xl md:text-4xl mb-2 block">{item.icon}</span>
                <p className="text-white text-xs md:text-sm font-medium">{item.label}</p>
              </motion.div>
            ))}
          </div>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }} className="text-neutral-600 font-medium px-6 py-4 rounded-xl" style={{ backgroundColor: 'rgba(var(--accent-rgb), 0.1)' }}>{data.footer}</motion.p>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer, showFeedback, selectedAnswer, gifConfig }) => {
      const isCorrect = selectedAnswer === data.correctIndex;
      return (
        <div className="h-full flex flex-col items-center justify-center px-6 py-12 overflow-y-auto hide-scrollbar">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-2xl w-full">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-semibold mb-6" style={{ backgroundColor: 'rgba(var(--accent-rgb), 0.15)', color: 'var(--accent-dark)' }}>
              <Icons.Sparkles /> Quick Check
            </div>
            <h2 className="title-font text-2xl md:text-3xl font-black text-neutral-900 mb-8">{data.question}</h2>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => {
                const isSelected = selectedAnswer === i;
                const isCorrectOption = i === data.correctIndex;
                let btnClass = "w-full p-4 md:p-5 text-left rounded-xl border-2 transition-all ";
                if (showFeedback) {
                  if (isCorrectOption) btnClass += "border-green-500 bg-green-50";
                  else if (isSelected && !isCorrectOption) btnClass += "border-red-500 bg-red-50";
                  else btnClass += "border-neutral-200 opacity-50";
                } else {
                  btnClass += "border-neutral-200 hover:border-neutral-400 cursor-pointer";
                }
                return (
                  <motion.button key={i} onClick={() => !showFeedback && onAnswer(i)} disabled={showFeedback} className={btnClass} whileHover={!showFeedback ? { scale: 1.01 } : {}} whileTap={!showFeedback ? { scale: 0.99 } : {}}>
                    <div className="flex items-center gap-3">
                      <span className="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" style={{ backgroundColor: isSelected ? (isCorrectOption ? '#22c55e' : '#ef4444') : 'var(--accent)', color: isSelected ? 'white' : '#1a1a1a' }}>
                        {showFeedback && isSelected ? (isCorrectOption ? <Icons.Check /> : <Icons.X />) : String.fromCharCode(65 + i)}
                      </span>
                      <span className="text-sm md:text-base text-neutral-700">{option}</span>
                    </div>
                  </motion.button>
                );
              })}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0 }} className={`p-5 rounded-xl border-2 ${isCorrect ? 'bg-green-50 border-green-300' : 'bg-amber-50 border-amber-300'}`}>
                  <p className="font-bold mb-2 text-lg">{isCorrect ? 'üéâ Brilliant!' : 'üí™ Almost!'}</p>
                  <p className="text-neutral-700 text-sm md:text-base">{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </motion.div>
          <AnimatePresence>
            {showFeedback && (
              <motion.div initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 50 }} transition={{ delay: 0.2 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <img src={isCorrect ? gifConfig.celebrationGif : gifConfig.empathyGif} alt="" className="h-full w-auto object-contain rounded-lg" />
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const ActionChecklistSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 overflow-y-auto hide-scrollbar">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="max-w-2xl w-full">
          <h2 className="title-font text-3xl md:text-4xl font-black text-neutral-900 mb-8 text-center">{data.title}</h2>
          <div className="space-y-4">
            {data.items.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 * i }} className="flex items-start gap-4 p-4 bg-neutral-50 rounded-xl border border-neutral-200">
                <span className="flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-neutral-900" style={{ backgroundColor: 'var(--accent)' }}>{i + 1}</span>
                <p className="text-neutral-700 text-sm md:text-base leading-relaxed pt-1">{item}</p>
              </motion.div>
            ))}
          </div>
        </motion.div>
      </div>
    );

    const CompletionSlide = ({ nextLesson }) => (
      <div className="h-full flex flex-col items-center justify-center px-6 py-12 bg-neutral-900 text-center">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ duration: 0.6 }} className="max-w-xl">
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.2, type: 'spring', stiffness: 200 }} className="w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6" style={{ backgroundColor: 'var(--accent)' }}>
            <Icons.Check />
          </motion.div>
          <h2 className="title-font text-3xl md:text-4xl font-black text-white mb-4">Ridge Playbook Unlocked</h2>
          <p className="text-neutral-400 text-lg mb-10">Product expansion creates infinite LTV. Earn trust first with one exceptional product. Then expand into adjacent categories your customers already want.</p>
          {nextLesson && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-neutral-800 rounded-2xl p-6 text-left">
              <p className="text-xs font-semibold tracking-widest uppercase mb-3" style={{ color: 'var(--accent)' }}>Up Next</p>
              <h3 className="title-font text-xl font-bold text-white mb-2">{nextLesson.title}</h3>
              <p className="text-neutral-400 text-sm mb-4">{nextLesson.teaser}</p>
              <a href={`../${nextLesson.id}/lesson.html`} className="inline-flex items-center gap-2 px-5 py-3 rounded-xl font-semibold text-neutral-900 transition-all hover:scale-105" style={{ backgroundColor: 'var(--accent)' }}>
                Start Next Lesson <Icons.ArrowRight />
              </a>
            </motion.div>
          )}
        </motion.div>
      </div>
    );

    // ==================== MAIN LESSON APP ====================
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(0);
      const [userName, setUserName] = useState('Builder');
      const [showGif, setShowGif] = useState(false);
      const [selectedAnswer, setSelectedAnswer] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const slideRef = useRef(null);

      const gifConfig = useMemo(() => ({
        celebrationGif: getRandomGif(celebrationGifs),
        empathyGif: getRandomGif(empathyGifs),
        height: `${60 + Math.random() * 5}%`,
        side: Math.random() > 0.5 ? 'left' : 'right'
      }), []);

      const slide = slides[currentSlide];
      const isFirstSlide = currentSlide === 0;
      const isLastSlide = currentSlide === slides.length - 1;

      const nextSlide = useCallback(() => {
        if (!isLastSlide) {
          setDirection(1);
          setCurrentSlide(prev => prev + 1);
          setSelectedAnswer(null);
          setShowFeedback(false);
        }
      }, [isLastSlide]);

      const prevSlide = useCallback(() => {
        if (!isFirstSlide) {
          setDirection(-1);
          setCurrentSlide(prev => prev - 1);
          setSelectedAnswer(null);
          setShowFeedback(false);
        }
      }, [isFirstSlide]);

      const goToSlide = useCallback((index) => {
        if (index >= 0 && index < slides.length) {
          setDirection(index > currentSlide ? 1 : -1);
          setCurrentSlide(index);
          setSelectedAnswer(null);
          setShowFeedback(false);
        }
      }, [currentSlide]);

      const handleAnswer = useCallback((index) => {
        setSelectedAnswer(index);
        setShowFeedback(true);
      }, []);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' && !isLastSlide) nextSlide();
          if (e.key === 'ArrowLeft' && !isFirstSlide) prevSlide();
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide, isFirstSlide, isLastSlide]);

      const slideVariants = {
        enter: (d) => ({ x: d > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (d) => ({ x: d < 0 ? '100%' : '-100%', opacity: 0 })
      };

      const renderSlide = () => {
        switch(slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={() => setShowGif(true)} onHideGif={() => setShowGif(false)} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'quote': return <QuoteSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'example': return <ExampleSlide data={slide} />;
          case 'cards': return <CardsSlide data={slide} />;
          case 'visual': return <VisualSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onAnswer={handleAnswer} showFeedback={showFeedback} selectedAnswer={selectedAnswer} gifConfig={gifConfig} />;
          case 'action-checklist': return <ActionChecklistSlide data={slide} />;
          case 'completion': return <CompletionSlide nextLesson={LESSON_CONFIG.nextLesson} />;
          default: return null;
        }
      };

      const showPrev = !isFirstSlide;
      const showNext = !isLastSlide && slide.type !== 'welcome';

      return (
        <div className="relative w-full h-screen flex flex-col bg-white overflow-hidden">
          <div className="flex-1 relative overflow-hidden">
            <AnimatePresence initial={false} custom={direction} mode="wait">
              <motion.div key={currentSlide} ref={slideRef} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ type: 'spring', stiffness: 300, damping: 30 }} className="absolute inset-0">
                {renderSlide()}
              </motion.div>
            </AnimatePresence>
          </div>

          {showPrev && (
            <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-white shadow-lg border border-neutral-200 flex items-center justify-center text-neutral-600 hover:text-neutral-900 hover:scale-110 transition-all z-20" aria-label="Previous">
              <Icons.ChevronLeft />
            </button>
          )}
          {showNext && (
            <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-neutral-900 hover:scale-110 transition-all z-20" style={{ backgroundColor: 'var(--accent)' }} aria-label="Next">
              <Icons.ChevronRight />
            </button>
          )}

          <AnimatePresence>
            {showGif && (
              <motion.div initial={{ opacity: 0, y: 50 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 50 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <img src={gifConfig.celebrationGif} alt="" className="h-full w-auto object-contain rounded-lg" />
              </motion.div>
            )}
          </AnimatePresence>

          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => (
                <button key={i} onClick={() => goToSlide(i)} className={`w-2.5 h-2.5 rounded-full transition-all ${i === currentSlide ? 'scale-125' : 'bg-neutral-300 hover:bg-neutral-400'}`} style={i === currentSlide ? { backgroundColor: 'var(--accent)' } : {}} aria-label={`Go to slide ${i + 1}`} />
              ))}
            </div>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
