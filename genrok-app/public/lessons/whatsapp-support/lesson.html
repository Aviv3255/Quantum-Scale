<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Should You Add WhatsApp Support? | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #22c55e; --accent-dark: #16a34a; --accent-light: #4ade80; --accent-rgb: 34, 197, 94; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'whatsapp-support',
      title: 'Should You Add WhatsApp Support?',
      description: 'Why the answer is NO - and what to do instead.',
      accentColor: '#22c55e',
      duration: '5 min',
      nextLesson: { id: 'meta-attribution-test', title: 'Meta Attribution Test', teaser: 'Is Meta lying about your creative performance?' }
    };

    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') { __isAdmin = e.data.isAdmin; } });
    if (window.parent !== window) { window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*'); }

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1}`} style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s' }} onMouseEnter={(e) => e.currentTarget.style.opacity = '1'} onMouseLeave={(e) => e.currentTarget.style.opacity = '0.6'}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const AnimatedCounter = ({ target, suffix = '', prefix = '', decimals = 0, duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(decimals > 0 ? parseFloat(start.toFixed(decimals)) : Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration, decimals]);
      return <span>{prefix}{decimals > 0 ? count.toFixed(decimals) : count}{suffix}</span>;
    };

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      MessageCircle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/></svg>,
      AlertTriangle: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Mail: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/></svg>,
      Shield: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Users: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Crown: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m2 4 3 12h14l3-12-6 7-4-7-4 7-6-7zm3 16h14"/></svg>,
      Target: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      FileText: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/><polyline points="10 9 9 9 8 9"/></svg>,
      Square: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect x="3" y="3" width="18" height="18" rx="2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
    };

    const slides = [
      { type: 'welcome', learningGoals: ['Why WhatsApp support creates more problems than it solves', 'The hidden costs of being too accessible', 'What to use instead for premium brand positioning'] },
      { type: 'hook', headline: 'Every store owner thinks adding WhatsApp will increase sales. They are wrong.', subtext: 'WhatsApp feels modern. It feels helpful. But here is what actually happens: you get bombarded at 2 AM, duplicate inquiries across channels, and customers who ghost after 47 messages. Meanwhile, serious buyers cannot find a proper way to reach you.' },
      { type: 'chat-chaos', title: 'WhatsApp Reality Check', messages: [{ text: 'Hey is this available?', time: '2:34 AM' }, { text: 'What about this one?', time: '2:35 AM' }, { text: 'Can you send more pics?', time: '2:37 AM' }, { text: 'Whats your best price?', time: '2:38 AM' }, { text: 'Still there? Hello?', time: '2:42 AM' }], outcome: 'At 9 AM, they ordered from someone else. Zero chance of a sale, maximum chaos.' },
      { type: 'accessibility-paradox', title: 'The Accessibility Paradox', comparisons: [{ label: 'TOO ACCESSIBLE', icon: 'MessageCircle', traits: ['Instant expectations', 'Price haggling', 'Midnight questions', 'Corner store vibe'], result: 'DESTROYS TRUST' }, { label: 'PREMIUM BRAND', icon: 'Crown', traits: ['Structured contact', 'Clear boundaries', 'Professional response', 'Premium positioning'], result: 'BUILDS TRUST' }] },
      { type: 'workload-impact', title: 'The Impact on Your Workload', stats: [{ value: 5, suffix: ' min', label: 'Response Expectation', subtext: 'What customers demand', color: '#ef4444' }, { value: 12, suffix: '%', label: 'Inquiries Convert', subtext: 'Actually buy something', color: '#f59e0b' }, { value: 68, suffix: '%', label: 'Duplicate Questions', subtext: 'Already answered elsewhere', color: '#ef4444' }] },
      { type: 'problem-breakdown', title: 'The 4 Problems WhatsApp Creates', problems: [{ icon: 'AlertTriangle', title: 'Unnecessary Overload', description: 'You become a 24/7 chat support agent. Every question - even ones answered on your product page - lands in your WhatsApp.' }, { icon: 'Users', title: 'Duplicate Inquiries', description: 'Customers message you on WhatsApp, then email, then contact form. You answer the same question three times.' }, { icon: 'Target', title: 'Signal vs Noise', description: 'Serious buyers with real issues cannot reach you because you are drowning in basic questions.' }, { icon: 'Crown', title: 'Brand Positioning', description: 'Premium brands do not use WhatsApp support. When you do, you signal: We are cheap and desperate for sales.' }] },
      { type: 'channel-comparison', title: 'Channel Comparison', before: { label: 'WHATSAPP CHAOS', example: 'Hey is this available? What about this one? Can you send more pics? Whats your best price? Still there?', result: 'ATTRACTS TIRE-KICKERS' }, after: { label: 'STRUCTURED FORM', example: 'I received my order but the sizing seems off. Order #4729. Can you help?', result: 'FILTERS FOR SERIOUS BUYERS' }, winnerText: 'BETTER' },
      { type: 'email-advantage', title: 'Email Is Better. Here Is Why.', insight: 'Email forces customers to think before they ask. They have to articulate their actual problem. This filters out the majority of noise and leaves you with real inquiries from people who are ready to buy or need genuine help.', benefits: ['Creates paper trail', 'Everything organized', 'No midnight obligation', 'Professional positioning'] },
      { type: 'premium-strategy', title: 'The Premium Brand Strategy', leftSide: { heading: 'What Works', points: ['Structured contact form on site', 'Email in the footer', 'Order number field', 'Issue category dropdown', 'Clear message field'] }, rightSide: { heading: 'Why It Works', points: ['Filters lazy inquiries', 'Ensures quality help', 'Positions you as premium', 'Not a desperate seller', 'Builds brand trust'] } },
      { type: 'differentiation-stats', title: 'The Differentiation Factor', stats: [{ value: 30, suffix: 'M+', label: 'Online Stores', subtext: 'Worldwide' }, { value: 89, suffix: '%', label: 'Same Templates', subtext: 'Generic experience' }, { value: 3, suffix: '%', label: 'Professional Forms', subtext: 'Stand out from crowd' }], insight: 'A professional contact form is one way to differentiate. It shows you value organization over chaos.' },
      { type: 'action-checklist', title: 'Implementation Steps', steps: [{ text: 'Remove WhatsApp button from store', rule: 'STEP 1' }, { text: 'Install structured contact form app', rule: 'STEP 2' }, { text: 'Add email to footer only', rule: 'STEP 3' }, { text: 'Set clear response time expectations', rule: 'STEP 4' }], toolUrl: 'https://platform.shoffi.app/r/rl_WvFtTikK', cta: 'Get Contact Form' },
      { type: 'quiz', question: 'According to this lesson, what is the main problem with WhatsApp support?', options: ['It costs too much to set up', 'It creates unnecessary overload and positions you as cheap', 'Customers do not like using it', 'It does not integrate with Shopify'], correctIndex: 1, feedback: { correct: 'Exactly. WhatsApp makes you too accessible which creates chaos, duplicate inquiries, and signals you are desperate. Premium brands use structured contact forms + email instead.', incorrect: 'Not quite. The core issue is that WhatsApp creates unnecessary overload, attracts tire-kickers, and positions you as a cheap brand.' } },
      { type: 'elite-insight', quote: 'Being too accessible does not build trust. It destroys it. Premium brands create structure, not chaos.', actions: [{ icon: 'X', label: 'Remove WhatsApp' }, { icon: 'FileText', label: 'Add Contact Form' }, { icon: 'Crown', label: 'Position Premium' }] },
      { type: 'completion', sources: [{ name: 'Shoffi Contact Form', url: 'https://platform.shoffi.app/r/rl_WvFtTikK' }] }
    ];

    // ==================== CUSTOM ELITE SLIDES ====================

    const ChatChaosSlide = ({ data }) => {
      const [visibleMessages, setVisibleMessages] = useState([]);
      useEffect(() => {
        const timers = data.messages.map((_, i) => setTimeout(() => setVisibleMessages(prev => [...prev, i]), 600 + i * 800));
        return () => timers.forEach(t => clearTimeout(t));
      }, [data.messages.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <div style={{ background: '#e5ddd5', borderRadius: '20px', padding: '20px', marginBottom: '24px' }}>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              {data.messages.map((msg, i) => (
                <AnimatePresence key={i}>
                  {visibleMessages.includes(i) && (
                    <motion.div initial={{ opacity: 0, x: -20, scale: 0.9 }} animate={{ opacity: 1, x: 0, scale: 1 }} style={{ alignSelf: 'flex-start', maxWidth: '85%' }}>
                      <div style={{ background: 'white', borderRadius: '12px', padding: '12px 16px', boxShadow: '0 1px 2px rgba(0,0,0,0.1)' }}>
                        <p style={{ fontSize: '14px', color: '#1a1a1a', marginBottom: '4px' }}>{msg.text}</p>
                        <p style={{ fontSize: '10px', color: '#737373', textAlign: 'right' }}>{msg.time}</p>
                      </div>
                    </motion.div>
                  )}
                </AnimatePresence>
              ))}
            </div>
          </div>
          <motion.div initial={{ opacity: 0 }} animate={{ opacity: visibleMessages.length === data.messages.length ? 1 : 0 }} transition={{ delay: 0.5 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', position: 'relative', overflow: 'hidden', textAlign: 'center' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
            <p style={{ color: '#fca5a5', fontSize: '15px', fontWeight: '600' }}>{data.outcome}</p>
          </motion.div>
        </div>
      );
    };

    const AccessibilityParadoxSlide = ({ data }) => {
      const [activeComparison, setActiveComparison] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveComparison(prev => (prev + 1) % 2), 4000);
        return () => clearInterval(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
            {data.comparisons.map((comp, i) => {
              const Icon = Icons[comp.icon] || Icons.Zap;
              const isActive = i === activeComparison;
              const isBad = i === 0;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }} style={{ background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', borderRadius: '20px', padding: '28px', border: isActive ? `2px solid ${isBad ? '#ef4444' : 'var(--accent)'}` : '2px solid #e5e5e5', boxShadow: isActive ? `0 0 30px ${isBad ? 'rgba(239, 68, 68, 0.2)' : 'rgba(var(--accent-rgb), 0.2)'}` : 'none', transition: 'all 0.3s ease', position: 'relative', overflow: 'hidden' }}>
                  {isActive && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: `linear-gradient(90deg, transparent, ${isBad ? '#ef4444' : 'var(--accent)'}, transparent)` }} />}
                  <div style={{ display: 'flex', alignItems: 'center', gap: '12px', marginBottom: '16px' }}>
                    <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: isBad ? (isActive ? '#ef4444' : '#fef2f2') : (isActive ? 'var(--accent)' : '#f0fdf4'), display: 'flex', alignItems: 'center', justifyContent: 'center', color: isBad ? (isActive ? 'white' : '#ef4444') : (isActive ? 'white' : 'var(--accent)') }}><Icon /></div>
                    <span style={{ fontWeight: '700', fontSize: '14px', color: isActive ? 'white' : '#171717' }}>{comp.label}</span>
                  </div>
                  <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', marginBottom: '16px' }}>
                    {comp.traits.map((trait, j) => (
                      <div key={j} style={{ fontSize: '13px', color: isActive ? '#a3a3a3' : '#737373', display: 'flex', alignItems: 'center', gap: '8px' }}>
                        <span style={{ width: '4px', height: '4px', borderRadius: '50%', background: isBad ? '#ef4444' : 'var(--accent)' }} />
                        {trait}
                      </div>
                    ))}
                  </div>
                  <div style={{ padding: '8px 16px', background: isBad ? (isActive ? 'rgba(239, 68, 68, 0.2)' : '#fef2f2') : (isActive ? 'rgba(var(--accent-rgb), 0.2)' : '#f0fdf4'), borderRadius: '20px', textAlign: 'center' }}>
                    <span style={{ fontSize: '12px', fontWeight: '700', color: isBad ? '#ef4444' : 'var(--accent)' }}>{comp.result}</span>
                  </div>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const WorkloadImpactSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '20px' }}>
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '28px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: `linear-gradient(90deg, transparent, ${stat.color}, transparent)` }} />
              <div style={{ fontSize: '48px', fontWeight: '900', color: stat.color, marginBottom: '8px' }}><AnimatedCounter target={stat.value} suffix={stat.suffix} /></div>
              <div style={{ color: 'white', fontWeight: '700', fontSize: '15px', marginBottom: '4px' }}>{stat.label}</div>
              <div style={{ color: '#a3a3a3', fontSize: '13px' }}>{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const ProblemBreakdownSlide = ({ data }) => {
      const [activeProblem, setActiveProblem] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => setActiveProblem(prev => (prev + 1) % data.problems.length), 3000);
        return () => clearInterval(timer);
      }, [data.problems.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '16px' }}>
            {data.problems.map((problem, i) => {
              const Icon = Icons[problem.icon] || Icons.Zap;
              const isActive = i === activeProblem;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }} style={{ background: isActive ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', borderRadius: '16px', padding: '24px', border: isActive ? '2px solid #ef4444' : '2px solid #e5e5e5', boxShadow: isActive ? '0 0 30px rgba(239, 68, 68, 0.2)' : 'none', transition: 'all 0.3s ease', position: 'relative', overflow: 'hidden' }}>
                  {isActive && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />}
                  <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: isActive ? '#ef4444' : '#fef2f2', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '16px', color: isActive ? 'white' : '#ef4444' }}><Icon /></div>
                  <h3 style={{ fontWeight: '700', fontSize: '16px', marginBottom: '8px', color: isActive ? 'white' : '#171717' }}>{problem.title}</h3>
                  <p style={{ fontSize: '14px', lineHeight: '1.6', color: isActive ? '#a3a3a3' : '#737373' }}>{problem.description}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const ChannelComparisonSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '24px', position: 'relative' }}>
            <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} style={{ background: '#fef2f2', border: '2px solid #fca5a5', borderRadius: '20px', padding: '28px' }}>
              <div style={{ display: 'inline-block', padding: '6px 14px', background: '#ef4444', color: 'white', borderRadius: '20px', fontSize: '12px', fontWeight: '700', marginBottom: '16px' }}>{data.before.label}</div>
              <p style={{ color: '#525252', fontSize: '14px', lineHeight: '1.7', marginBottom: '20px', fontStyle: 'italic' }}>"{data.before.example}"</p>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.X /><span style={{ color: '#dc2626', fontWeight: '700', fontSize: '14px' }}>{data.before.result}</span></div>
            </motion.div>
            <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 }} style={{ background: '#f0fdf4', border: '2px solid #86efac', borderRadius: '20px', padding: '28px' }}>
              <div style={{ display: 'inline-block', padding: '6px 14px', background: '#22c55e', color: 'white', borderRadius: '20px', fontSize: '12px', fontWeight: '700', marginBottom: '16px' }}>{data.after.label}</div>
              <p style={{ color: '#525252', fontSize: '14px', lineHeight: '1.7', marginBottom: '20px', fontStyle: 'italic' }}>"{data.after.example}"</p>
              <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}><Icons.Check /><span style={{ color: '#16a34a', fontWeight: '700', fontSize: '14px' }}>{data.after.result}</span></div>
            </motion.div>
            <AnimatePresence>
              {showWinner && (
                <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }} style={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', color: 'white', padding: '12px 24px', borderRadius: '30px', fontWeight: '900', fontSize: '18px', boxShadow: '0 8px 30px rgba(var(--accent-rgb), 0.4)', zIndex: 10 }}>{data.winnerText}</motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const EmailAdvantageSlide = ({ data }) => {
      const [visibleBenefits, setVisibleBenefits] = useState([]);
      useEffect(() => {
        const timers = data.benefits.map((_, i) => setTimeout(() => setVisibleBenefits(prev => [...prev, i]), 1500 + i * 400));
        return () => timers.forEach(t => clearTimeout(t));
      }, [data.benefits.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '32px', position: 'relative', overflow: 'hidden', marginBottom: '24px' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <div style={{ width: '56px', height: '56px', borderRadius: '14px', background: 'var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: '20px', boxShadow: '0 0 30px rgba(var(--accent-rgb), 0.4)' }}><Icons.Mail /></div>
            <p style={{ color: '#e5e5e5', fontSize: '17px', lineHeight: '1.7' }}>{data.insight}</p>
          </motion.div>
          <div style={{ display: 'grid', gridTemplateColumns: 'repeat(2, 1fr)', gap: '12px' }}>
            {data.benefits.map((benefit, i) => (
              <AnimatePresence key={i}>
                {visibleBenefits.includes(i) && (
                  <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} style={{ background: 'white', border: '2px solid #e5e5e5', borderRadius: '12px', padding: '16px', display: 'flex', alignItems: 'center', gap: '12px' }}>
                    <div style={{ width: '24px', height: '24px', borderRadius: '6px', background: 'var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', flexShrink: 0 }}><Icons.Check /></div>
                    <span style={{ fontSize: '14px', color: '#525252', fontWeight: '500' }}>{benefit}</span>
                  </motion.div>
                )}
              </AnimatePresence>
            ))}
          </div>
        </div>
      );
    };

    const PremiumStrategySlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: '20px' }}>
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '28px', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <h3 style={{ color: 'var(--accent)', fontWeight: '700', fontSize: '18px', marginBottom: '20px' }}>{data.leftSide.heading}</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              {data.leftSide.points.map((point, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 + i * 0.1 }} style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <div style={{ width: '8px', height: '8px', borderRadius: '50%', background: 'var(--accent)', flexShrink: 0 }} />
                  <span style={{ color: '#e5e5e5', fontSize: '14px' }}>{point}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} style={{ background: 'white', border: '2px solid var(--accent)', borderRadius: '20px', padding: '28px' }}>
            <h3 style={{ color: 'var(--accent)', fontWeight: '700', fontSize: '18px', marginBottom: '20px' }}>{data.rightSide.heading}</h3>
            <div style={{ display: 'flex', flexDirection: 'column', gap: '12px' }}>
              {data.rightSide.points.map((point, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: 10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.5 + i * 0.1 }} style={{ display: 'flex', alignItems: 'center', gap: '12px' }}>
                  <div style={{ width: '24px', height: '24px', borderRadius: '6px', background: 'rgba(var(--accent-rgb), 0.1)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--accent)', flexShrink: 0 }}><Icons.Check /></div>
                  <span style={{ color: '#525252', fontSize: '14px' }}>{point}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      </div>
    );

    const DifferentiationStatsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: '20px', marginBottom: '24px' }}>
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} style={{ background: i === 2 ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', borderRadius: '20px', padding: '28px', textAlign: 'center', border: i === 2 ? '2px solid var(--accent)' : '2px solid #e5e5e5', position: 'relative', overflow: 'hidden' }}>
              {i === 2 && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />}
              <div style={{ fontSize: '48px', fontWeight: '900', color: i === 2 ? 'var(--accent)' : '#a3a3a3', marginBottom: '8px' }}><AnimatedCounter target={stat.value} suffix={stat.suffix} /></div>
              <div style={{ color: i === 2 ? 'white' : '#525252', fontWeight: '700', fontSize: '15px', marginBottom: '4px' }}>{stat.label}</div>
              <div style={{ color: i === 2 ? '#a3a3a3' : '#737373', fontSize: '13px' }}>{stat.subtext}</div>
            </motion.div>
          ))}
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.8 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', textAlign: 'center', position: 'relative', overflow: 'hidden' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
          <p style={{ color: '#e5e5e5', fontSize: '15px' }}>{data.insight}</p>
        </motion.div>
      </div>
    );

    const ActionChecklistSlide = ({ data }) => {
      const [checkedItems, setCheckedItems] = useState([]);
      useEffect(() => {
        const timers = data.steps.map((_, i) => setTimeout(() => setCheckedItems(prev => [...prev, i]), 1000 + i * 800));
        return () => timers.forEach(t => clearTimeout(t));
      }, [data.steps.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-8">
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div style={{ display: 'flex', flexDirection: 'column', gap: '16px', marginBottom: '24px' }}>
            {data.steps.map((step, i) => {
              const isChecked = checkedItems.includes(i);
              return (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.1 }} style={{ background: isChecked ? 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' : 'white', border: isChecked ? '2px solid var(--accent)' : '2px solid #e5e5e5', borderRadius: '16px', padding: '20px', display: 'flex', alignItems: 'center', gap: '16px', position: 'relative', overflow: 'hidden', transition: 'all 0.3s ease' }}>
                  {isChecked && <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />}
                  <div style={{ width: '32px', height: '32px', borderRadius: '8px', background: isChecked ? 'var(--accent)' : '#f5f5f5', display: 'flex', alignItems: 'center', justifyContent: 'center', color: isChecked ? 'white' : '#d4d4d4', flexShrink: 0, transition: 'all 0.3s ease' }}>{isChecked ? <Icons.Check /> : <Icons.Square />}</div>
                  <div style={{ flex: 1 }}><p style={{ color: isChecked ? 'white' : '#525252', fontSize: '15px', fontWeight: '500' }}>{step.text}</p></div>
                  <div style={{ padding: '6px 12px', background: isChecked ? 'rgba(var(--accent-rgb), 0.2)' : '#f5f5f5', borderRadius: '20px', fontSize: '11px', fontWeight: '700', color: isChecked ? 'var(--accent)' : '#737373', textTransform: 'uppercase', letterSpacing: '0.05em' }}>{step.rule}</div>
                </motion.div>
              );
            })}
          </div>
          {data.toolUrl && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.8 }} style={{ textAlign: 'center' }}>
              <a href={data.toolUrl} target="_blank" rel="noopener noreferrer" style={{ display: 'inline-flex', alignItems: 'center', gap: '8px', padding: '14px 28px', background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', color: 'white', borderRadius: '12px', fontWeight: '600', fontSize: '15px', textDecoration: 'none', boxShadow: '0 8px 30px rgba(var(--accent-rgb), 0.3)' }}>{data.cta} <Icons.ExternalLink /></a>
            </motion.div>
          )}
        </div>
      );
    };

    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
        <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '40px', position: 'relative', overflow: 'hidden', textAlign: 'center' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
          <div style={{ width: '64px', height: '64px', borderRadius: '16px', background: 'var(--accent)', display: 'flex', alignItems: 'center', justifyContent: 'center', margin: '0 auto 24px', boxShadow: '0 0 40px rgba(var(--accent-rgb), 0.4)' }}><Icons.Shield /></div>
          <p style={{ color: 'white', fontSize: '22px', fontWeight: '600', lineHeight: '1.6', marginBottom: '32px' }}>"{data.quote}"</p>
          <div style={{ display: 'flex', justifyContent: 'center', gap: '24px' }}>
            {data.actions.map((action, i) => {
              const Icon = Icons[action.icon] || Icons.Zap;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 + i * 0.1 }} style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: '8px' }}>
                  <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: 'rgba(var(--accent-rgb), 0.2)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'var(--accent)' }}><Icon /></div>
                  <span style={{ color: '#a3a3a3', fontSize: '12px', fontWeight: '600' }}>{action.label}</span>
                </motion.div>
              );
            })}
          </div>
        </motion.div>
      </div>
    );

    // Standard Slides
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl text-black mb-2">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg mb-2 max-w-lg" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-xs mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl p-4 mb-4 max-w-sm w-full">
              <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">In this lesson</p>
              <ul className="space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-xs font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto py-8 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { onShowGif(isCorrect ? celebrationGif : empathyGif, '60%', gifSide); } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto py-8 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>{showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}</span>
                    <span className="text-neutral-700 text-sm">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = ({ data }) => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 py-8">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring' }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 6px 24px rgba(var(--accent-rgb), 0.35)' }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-6 max-w-md">Skip WhatsApp. Use a structured contact form + email. Position yourself as a premium brand.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-5 max-w-md w-full mb-4">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Up Next</p>
          <h3 className="text-white font-bold text-lg mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
        <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={() => window.parent.postMessage({ type: 'LESSON_COMPLETE', lessonId: LESSON_CONFIG.id }, '*')} className="px-6 py-3 rounded-xl text-white font-semibold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>Complete Lesson</motion.button>
      </div>
    );

    // Main App
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(() => getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(currentSlide);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'chat-chaos': return <ChatChaosSlide data={slide} />;
          case 'accessibility-paradox': return <AccessibilityParadoxSlide data={slide} />;
          case 'workload-impact': return <WorkloadImpactSlide data={slide} />;
          case 'problem-breakdown': return <ProblemBreakdownSlide data={slide} />;
          case 'channel-comparison': return <ChannelComparisonSlide data={slide} />;
          case 'email-advantage': return <EmailAdvantageSlide data={slide} />;
          case 'premium-strategy': return <PremiumStrategySlide data={slide} />;
          case 'differentiation-stats': return <DifferentiationStatsSlide data={slide} />;
          case 'action-checklist': return <ActionChecklistSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom">
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
