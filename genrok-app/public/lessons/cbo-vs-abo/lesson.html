<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CBO vs ABO – The Only Scaling Structure That Works Under Andromeda | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://unpkg.com" crossorigin>
  <link rel="preconnect" href="https://cdn.tailwindcss.com" crossorigin>
  <link rel="preconnect" href="https://pqvvrljykfvhpyvxmwzb.supabase.co" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #3b82f6; --accent-dark: #2563eb; --accent-light: #60a5fa; --accent-rgb: 59, 130, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'cbo-vs-abo',
      title: 'CBO vs ABO – The Only Scaling Structure That Works Under Andromeda',
      description: 'Not alternatives - different jobs. Learn when to test, when to scale.',
      accentColor: '#3b82f6',
      duration: '5 min',
      nextLesson: { id: 'geo-personalization', title: 'The Power of Personalization', teaser: 'How a simple GEO announcement bar doubles CVR by matching economic reality.' }
    };

    // Tool Config for Part 2
    const TOOL_CONFIG = {
      name: 'Triple Whale',
      logo: 'https://cdn.shopify.com/app-store/listing_images/04ddbe00a69dcc39d8eb8d1ee4c09192/icon/CNSPn4a40_4CEAE=.png',
      link: 'https://apps.shopify.com/triple-whale',
      tagline: 'First-Party Attribution & Analytics'
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') __isAdmin = e.data.isAdmin; });
    if (window.parent !== window) window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
        }
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`}
          style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }}
          onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }}
          onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
            <path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/>
          </svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_the_running_man_dance_move_vintage_cool__25682b0f-cf4c-4e93-8dcb-6c3dac8135cd_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_looking_down_sadly_shoulders_slumped_disappoin_790d48bd-e49e-40ea-9979-d3e86fa3a422_2.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const AnimatedCounter = ({ target, suffix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{count}{suffix}</span>;
    };

    // ========== PART 1: THEORY SLIDES ==========
    const slides = [
      { type: 'welcome', learningGoals: ['Why CBO and ABO are not alternatives - they solve different problems', 'The exact testing structure that feeds Andromeda\'s prediction engine', 'The 6-adset scaling structure that works under Andromeda'] },
      { type: 'hook', headline: 'Most store owners treat CBO and ABO like choosing between coffee or tea.', subtext: 'That\'s like asking: "Should I use a hammer or a screwdriver?" Wrong question. They\'re different tools for different jobs. Trying to scale with ABO is like hammering with a screwdriver. And testing with CBO? That\'s screwing with a hammer. Both work terribly. Here\'s what actually works.' },
      { type: 'content', title: 'The Truth About CBO vs ABO', body: 'These are not alternatives. They are phases. ABO = your testing lab. You test concepts, hooks, angles, formats. You learn what resonates. CBO = your scaling engine. You feed it winning creatives, high budgets, and let Andromeda\'s prediction AI do the heavy lifting. Mixing these roles is where you bleed cash.' },
      { type: 'comparison-battle', title: 'ABO vs CBO: Different Jobs', left: { label: 'ABO', subtitle: 'Testing Lab', color: '#EF4444', features: ['Small budgets ($20-50/day)', 'Test one concept at a time', 'Controlled experiments', 'Learn what resonates', '40-50 creatives weekly'] }, right: { label: 'CBO', subtitle: 'Scaling Engine', color: '#10B981', features: ['High budgets ($500+/day)', 'Feed 12-30 winners', 'Dynamic optimization', 'Andromeda distributes spend', 'Let AI find buyers'] } },
      { type: 'testing-scaling-toggle', title: 'The Complete Campaign Structure' },
      { type: 'decision-tree', title: 'When to Use Which?', question: 'What stage are you at?', paths: [
        { condition: 'Testing new concepts', recommendation: 'Use ABO', explanation: 'Small budgets, controlled tests, learn what resonates', color: '#EF4444' },
        { condition: 'Have 5+ winning creatives', recommendation: 'Switch to CBO', explanation: 'Feed all winners into one campaign, let Andromeda optimize', color: '#10B981' },
        { condition: 'Campaign is profitable', recommendation: 'Never shut it off', explanation: 'Even if ROAS dips slightly, profit is profit', color: '#3B82F6' }
      ]},
      { type: 'attribution-problem', title: 'The Attribution Problem', body: 'Here\'s the trap: Platform reporting lies. Meta shows your CBO at 2.1x ROAS. You panic, cut budget. But the reality? It was actually 3.2x. iOS14+ destroyed cookie tracking. You\'re making decisions on incomplete data. This is why so many stores kill their best campaigns - they can\'t see the truth.' },
      { type: 'content', title: 'Why This Works Under Andromeda', body: 'Andromeda is a prediction engine. It doesn\'t need you to tell it which audience to target. It needs creative diversity and accurate conversion data. When you feed CBO 12-30 diverse winning creatives and high-value audience signals, Andromeda finds the buyers. That\'s the entire system.' },
      { type: 'quiz', question: 'You have 5 winning ad creatives from ABO testing. What should you do next?', options: ['Keep running them in separate ABO campaigns to maintain control', 'Feed all 5 into one CBO campaign and let Andromeda optimize distribution', 'Pick the best one and scale it alone in a new CBO', 'Turn them all off and test 5 new creatives'], correctIndex: 1, feedback: { correct: 'Exactly! Feed all diverse winners into CBO. Andromeda needs volume + diversity to predict who will buy. One creative = limited signal. Multiple winners = powerful scaling engine.', incorrect: 'Not quite. The winning move: Feed all 5 winners into one CBO campaign. Andromeda thrives on creative diversity. Give it multiple proven winners and let the prediction AI distribute spend to find buyers. That\'s how you scale profitably under Andromeda.' }},
      // ========== PART 2: PRACTICAL - HOW TO BUILD YOURS ==========
      { type: 'section-divider' },
      { type: 'step-setup-tracking' },
      { type: 'step-build-abo' },
      { type: 'step-scale-cbo' },
      { type: 'step-results' },
      { type: 'completion' }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      ExternalLink: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>,
      TrendingUp: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      BarChart: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="20" x2="12" y2="10"/><line x1="18" y1="20" x2="18" y2="4"/><line x1="6" y1="20" x2="6" y2="16"/></svg>,
      Layers: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 2 7 12 12 22 7 12 2"/><polyline points="2 17 12 22 22 17"/><polyline points="2 12 12 17 22 12"/></svg>,
    };

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
      </div>
    );

    const ContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10">
        <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl lg:text-4xl text-black mb-6">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-base md:text-lg text-neutral-600 leading-relaxed">{data.body}</motion.p>
      </div>
    );

    const TestingScalingToggleSlide = ({ data }) => {
      const [activeMode, setActiveMode] = useState('testing');

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-6">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="flex justify-center mb-6">
            <div className="bg-neutral-100 rounded-xl p-1 flex gap-1">
              <button onClick={() => setActiveMode('testing')} className={`px-6 py-3 rounded-lg font-bold text-sm transition-all ${activeMode === 'testing' ? 'bg-red-500 text-white shadow-lg' : 'text-neutral-600 hover:bg-neutral-200'}`}>TESTING</button>
              <button onClick={() => setActiveMode('scaling')} className={`px-6 py-3 rounded-lg font-bold text-sm transition-all ${activeMode === 'scaling' ? 'bg-green-500 text-white shadow-lg' : 'text-neutral-600 hover:bg-neutral-200'}`}>SCALING</button>
            </div>
          </motion.div>

          <AnimatePresence mode="wait">
            {activeMode === 'testing' ? (
              <motion.div key="testing" initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: 20 }} className="space-y-4">
                <div className="bg-white border border-neutral-300 rounded-xl p-4 text-center">
                  <p className="text-neutral-500 text-xs uppercase tracking-wider mb-2">Strategy</p>
                  <p className="text-neutral-900 font-semibold">Creative testing is the only priority</p>
                </div>
                <div className="bg-white border border-neutral-300 rounded-xl p-4">
                  <div className="text-center mb-4">
                    <span className="bg-red-100 text-red-700 px-3 py-1 rounded-full text-xs font-bold">1 ABO Campaign</span>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                    {[1, 2, 3, 4].map(num => (
                      <div key={num} className="bg-white border border-neutral-300 rounded-lg p-3 text-center">
                        <p className="text-neutral-500 text-xs mb-1">Adset {num}</p>
                        <p className="text-neutral-400 text-[10px] mb-2">Identical settings, broad</p>
                        <div className="bg-neutral-50 border border-dashed border-neutral-300 rounded p-2">
                          <p className="text-neutral-700 text-xs font-medium">Creative {num}</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="bg-neutral-900 rounded-xl p-4 text-center">
                  <p className="text-neutral-300 text-sm">"Test as many signals as possible."</p>
                </div>
              </motion.div>
            ) : (
              <motion.div key="scaling" initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} className="space-y-4">
                <div className="bg-white border border-neutral-300 rounded-xl p-4">
                  <div className="text-center mb-4">
                    <span className="bg-green-100 text-green-700 px-3 py-1 rounded-full text-xs font-bold">1 CBO Campaign</span>
                  </div>
                  <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                    {[
                      { name: 'Top 10% Spenders' },
                      { name: 'Top 25% Spenders' },
                      { name: 'RFM Segments' },
                      { name: '5% Purchase LLA' },
                      { name: '6-8 Interests' },
                      { name: 'Open Targeting' }
                    ].map((adset, i) => (
                      <div key={i} className="bg-white border border-neutral-300 rounded-lg p-3">
                        <p className="text-neutral-700 text-xs font-medium mb-2 text-center">{adset.name}</p>
                        <div className="bg-neutral-50 border border-dashed border-neutral-300 rounded p-2 text-center">
                          <p className="text-neutral-600 text-[10px]">All Winning Creatives</p>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>
                <div className="bg-neutral-900 rounded-xl p-4 text-center">
                  <p className="text-neutral-300 text-sm">Feed Andromeda diverse signals. Let it find the buyers.</p>
                </div>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    const ComparisonBattleSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
        <div className="grid md:grid-cols-2 gap-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 }} className="relative">
            <div className="absolute -top-2 -left-2 w-full h-full rounded-2xl opacity-20" style={{ background: data.left.color }}></div>
            <div className="relative bg-white border-4 rounded-2xl p-6" style={{ borderColor: data.left.color }}>
              <div className="text-center mb-4">
                <h3 className="text-3xl font-bold mb-1" style={{ color: data.left.color }}>{data.left.label}</h3>
                <p className="text-sm text-neutral-600">{data.left.subtitle}</p>
              </div>
              <ul className="space-y-3">
                {data.left.features.map((feature, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 + i * 0.05 }} className="flex items-start gap-2">
                    <span className="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0 mt-0.5" style={{ background: data.left.color }}>&#10003;</span>
                    <span className="text-neutral-700 text-sm">{feature}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.15 }} className="relative">
            <div className="absolute -top-2 -right-2 w-full h-full rounded-2xl opacity-20" style={{ background: data.right.color }}></div>
            <div className="relative bg-white border-4 rounded-2xl p-6" style={{ borderColor: data.right.color }}>
              <div className="text-center mb-4">
                <h3 className="text-3xl font-bold mb-1" style={{ color: data.right.color }}>{data.right.label}</h3>
                <p className="text-sm text-neutral-600">{data.right.subtitle}</p>
              </div>
              <ul className="space-y-3">
                {data.right.features.map((feature, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: 10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2">
                    <span className="w-6 h-6 rounded-full flex items-center justify-center text-white text-xs font-bold flex-shrink-0 mt-0.5" style={{ background: data.right.color }}>&#10003;</span>
                    <span className="text-neutral-700 text-sm">{feature}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
        </div>
      </div>
    );

    const DecisionTreeSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto slide-scroll overflow-y-auto py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-2">{data.title}</motion.h2>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.1 }} className="text-center text-neutral-600 mb-8 text-lg">{data.question}</motion.p>
        <div className="space-y-4">
          {data.paths.map((path, i) => (
            <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.15 + i * 0.1 }} className="bg-white border-2 rounded-xl p-5 hover:shadow-lg transition-shadow" style={{ borderColor: path.color }}>
              <div className="flex items-start gap-4">
                <div className="w-12 h-12 rounded-xl flex items-center justify-center text-white font-bold text-lg flex-shrink-0" style={{ background: path.color }}>{i + 1}</div>
                <div className="flex-1">
                  <div className="text-sm text-neutral-500 mb-1">If: {path.condition}</div>
                  <div className="text-lg font-bold mb-2" style={{ color: path.color }}>{path.recommendation}</div>
                  <div className="text-sm text-neutral-600">{path.explanation}</div>
                </div>
              </div>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const AttributionProblemSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(239, 68, 68, 0.1)', color: '#ef4444' }}>The Hidden Problem</span>
          <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
        </motion.div>

        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
          className="rounded-xl p-6 mb-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
          <div className="h-1 w-full rounded-full mb-5" style={{ background: 'linear-gradient(90deg, transparent, #ef4444, transparent)' }} />
          <p className="text-neutral-300 text-base md:text-lg leading-relaxed mb-6">{data.body}</p>

          <div className="grid md:grid-cols-2 gap-4">
            <div className="p-4 rounded-xl" style={{ background: 'rgba(239, 68, 68, 0.1)', border: '1px solid rgba(239, 68, 68, 0.3)' }}>
              <div className="flex items-center gap-2 mb-2">
                <Icons.X />
                <span className="text-red-400 font-bold text-sm">What Platform Shows</span>
              </div>
              <div className="text-3xl font-bold text-red-400 mb-1">2.1x ROAS</div>
              <p className="text-neutral-500 text-xs">You panic. Cut budget.</p>
            </div>
            <div className="p-4 rounded-xl" style={{ background: 'rgba(16, 185, 129, 0.1)', border: '1px solid rgba(16, 185, 129, 0.3)' }}>
              <div className="flex items-center gap-2 mb-2">
                <Icons.Check />
                <span className="text-emerald-400 font-bold text-sm">Actual Reality</span>
              </div>
              <div className="text-3xl font-bold text-emerald-400 mb-1">3.2x ROAS</div>
              <p className="text-neutral-500 text-xs">You just killed your best campaign.</p>
            </div>
          </div>
        </motion.div>

        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
          className="p-4 rounded-xl text-center" style={{ background: 'rgba(var(--accent-rgb), 0.1)', border: '1px solid rgba(var(--accent-rgb), 0.3)' }}>
          <p className="text-sm" style={{ color: 'var(--accent)' }}><strong>The Solution:</strong> First-party attribution shows the truth. You'll learn how to set this up in Part 2.</p>
        </motion.div>
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) { if (isCorrect) { onShowGif(celebrationGif, '60%', gifSide); } else { onShowGif(empathyGif, '60%', gifSide); } } }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>
                      {showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-neutral-700 text-sm md:text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    // ========== PART 2: PRACTICAL SLIDES ==========

    const SectionDividerSlide = () => (
      <div className="h-full flex flex-col items-center justify-center px-6 md:px-12">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} className="text-center max-w-2xl">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="w-20 h-20 rounded-2xl mx-auto mb-8 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 8px 32px rgba(var(--accent-rgb), 0.3)' }}>
            <Icons.Zap />
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-xs uppercase tracking-[0.2em] mb-4" style={{ color: 'var(--accent)' }}>Part 2</motion.p>
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-5xl text-black mb-4">Now Let's Build Yours</motion.h2>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-neutral-500 text-lg">3 steps to master CBO vs ABO under Andromeda</motion.p>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }} className="flex items-center justify-center gap-4 mt-8">
            {[1, 2, 3].map((num) => (
              <div key={num} className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold text-white" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>{num}</div>
                {num < 3 && <div className="w-8 h-0.5 bg-neutral-200 rounded" />}
              </div>
            ))}
          </motion.div>
        </motion.div>
      </div>
    );

    // Step 1: Set Up First-Party Tracking
    const StepSetupTrackingSlide = () => {
      const comparisons = [
        { platform: 'Meta Ads Manager', data: '7-day click only', issue: 'Misses 40%+ conversions', color: '#ef4444' },
        { platform: 'First-Party Tracking', data: 'Server-side, iOS-proof', issue: 'See true ROAS', color: '#10b981' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>1</div>
              <div>
                <span className="text-xs uppercase tracking-wider text-neutral-400">Step 1</span>
                <h2 className="slide-title text-2xl md:text-3xl text-black">Set Up First-Party Attribution</h2>
              </div>
            </div>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-4 mb-6">
            {comparisons.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
                className="p-5 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: `2px solid ${item.color}40` }}>
                <div className="h-1 w-full mb-4 rounded-full" style={{ background: `linear-gradient(90deg, transparent, ${item.color}, transparent)` }} />
                <div className="text-white font-bold text-sm mb-2">{item.platform}</div>
                <div className="text-lg font-bold mb-2" style={{ color: item.color }}>{item.data}</div>
                <div className="text-neutral-400 text-xs">{item.issue}</div>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="flex items-center gap-4 p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, rgba(var(--accent-rgb), 0.1), rgba(var(--accent-rgb), 0.05))', border: '1px solid rgba(var(--accent-rgb), 0.2)' }}>
            <img src={TOOL_CONFIG.logo} alt={TOOL_CONFIG.name} className="w-10 h-10 rounded-lg" />
            <div className="flex-1">
              <p className="text-sm font-medium text-neutral-800"><strong>{TOOL_CONFIG.name}</strong> gives you server-side tracking that shows true CBO vs ABO performance.</p>
            </div>
            <a href={TOOL_CONFIG.link} target="_blank" rel="noopener noreferrer" className="px-4 py-2 rounded-lg text-xs font-bold text-white flex items-center gap-1" style={{ background: 'var(--accent)' }}>
              <span>Try Free</span>
              <Icons.ExternalLink />
            </a>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="mt-4 p-4 rounded-xl" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
            <p className="text-sm" style={{ color: 'var(--accent)' }}><strong>Action:</strong> Connect your store to first-party tracking. Without accurate data, you're flying blind.</p>
          </motion.div>
        </div>
      );
    };

    // Step 2: Build Your ABO Testing Lab
    const StepBuildABOSlide = () => {
      const settings = [
        { setting: 'Budget', value: '$20-50/day per adset', note: 'Enough for learning, low risk' },
        { setting: 'Targeting', value: 'Broad (same for all)', note: 'Isolate creative as variable' },
        { setting: 'Creatives', value: '1 per adset', note: 'Test one concept at a time' },
        { setting: 'Duration', value: '3-5 days', note: 'Get statistical significance' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>2</div>
              <div>
                <span className="text-xs uppercase tracking-wider text-neutral-400">Step 2</span>
                <h2 className="slide-title text-2xl md:text-3xl text-black">Build Your ABO Testing Lab</h2>
              </div>
            </div>
          </motion.div>

          <div className="grid md:grid-cols-2 gap-3 mb-6">
            {settings.map((item, i) => (
              <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.08 }}
                className="p-4 rounded-xl" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
                <div className="flex items-center justify-between mb-2">
                  <span className="text-neutral-400 text-xs uppercase tracking-wider">{item.setting}</span>
                  <span className="px-2 py-0.5 rounded text-[10px] font-bold" style={{ background: 'rgba(239, 68, 68, 0.2)', color: '#ef4444' }}>ABO</span>
                </div>
                <div className="text-white font-bold text-sm mb-1">{item.value}</div>
                <div className="text-neutral-500 text-xs">{item.note}</div>
              </motion.div>
            ))}
          </div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="p-4 rounded-xl" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
            <p className="text-sm" style={{ color: 'var(--accent)' }}><strong>Action:</strong> Create 1 ABO campaign with 4 adsets. Same targeting, different creatives. Run for 3-5 days. Identify winners.</p>
          </motion.div>
        </div>
      );
    };

    // Step 3: Scale with CBO
    const StepScaleCBOSlide = () => {
      const adsets = [
        { name: 'Top 10% Spenders', type: 'Value-Based' },
        { name: 'Top 25% Spenders', type: 'Value-Based' },
        { name: 'RFM Segments', type: 'Behavioral' },
        { name: '5% Purchase LLA', type: 'Lookalike' },
        { name: '6-8 Interests', type: 'Interest Stack' },
        { name: 'Open Targeting', type: 'Broad' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <div className="flex items-center gap-3 mb-4">
              <div className="w-10 h-10 rounded-xl flex items-center justify-center text-white font-bold" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))' }}>3</div>
              <div>
                <span className="text-xs uppercase tracking-wider text-neutral-400">Step 3</span>
                <h2 className="slide-title text-2xl md:text-3xl text-black">Scale Winners with CBO</h2>
              </div>
            </div>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }}
            className="p-5 rounded-xl mb-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="h-1 w-full rounded-full mb-4" style={{ background: 'linear-gradient(90deg, transparent, #10b981, transparent)' }} />
            <div className="text-center mb-4">
              <span className="px-3 py-1 rounded-full text-xs font-bold text-white" style={{ background: '#10b981' }}>6-Adset CBO Structure</span>
            </div>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
              {adsets.map((adset, i) => (
                <motion.div key={i} initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 + i * 0.05 }}
                  className="p-3 rounded-lg text-center" style={{ background: 'rgba(16, 185, 129, 0.1)', border: '1px solid rgba(16, 185, 129, 0.3)' }}>
                  <div className="text-white text-xs font-bold mb-1">{adset.name}</div>
                  <div className="text-neutral-500 text-[10px]">{adset.type}</div>
                </motion.div>
              ))}
            </div>
            <div className="mt-4 p-3 rounded-lg text-center" style={{ background: 'rgba(255,255,255,0.05)' }}>
              <span className="text-neutral-300 text-sm">Each adset gets <strong className="text-white">ALL winning creatives</strong> from ABO testing</span>
            </div>
          </motion.div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.5 }} className="p-4 rounded-xl" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
            <p className="text-sm" style={{ color: 'var(--accent)' }}><strong>Action:</strong> Take your 5+ winning creatives from ABO. Feed them ALL into a 6-adset CBO campaign. Budget: $500+/day. Let Andromeda optimize.</p>
          </motion.div>
        </div>
      );
    };

    // Results Slide
    const StepResultsSlide = () => {
      const results = [
        { metric: '3-5x', label: 'True ROAS', desc: 'With accurate attribution', icon: Icons.TrendingUp, color: '#10b981' },
        { metric: '40%', label: 'Less Waste', desc: 'Stop killing winners', icon: Icons.Target, color: '#3b82f6' },
        { metric: '2x', label: 'Scale Speed', desc: 'Confident budget decisions', icon: Icons.BarChart, color: '#f59e0b' }
      ];

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-8">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(var(--accent-rgb), 0.1)', color: 'var(--accent)' }}>Expected Results</span>
            <h2 className="slide-title text-2xl md:text-3xl text-black">What You Can Expect</h2>
          </motion.div>

          <div className="grid md:grid-cols-3 gap-4 mb-6">
            {results.map((result, i) => {
              const Icon = result.icon;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }} className="p-6 rounded-xl text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
                  <div className="h-1 w-full mb-4 rounded-full" style={{ background: `linear-gradient(90deg, transparent, ${result.color}, transparent)` }} />
                  <div className="w-12 h-12 rounded-xl mx-auto mb-4 flex items-center justify-center" style={{ background: `${result.color}20`, color: result.color }}>
                    <Icon />
                  </div>
                  <div className="text-3xl font-bold mb-2" style={{ color: result.color }}>{result.metric}</div>
                  <div className="text-white font-bold text-sm mb-1">{result.label}</div>
                  <div className="text-neutral-400 text-xs">{result.desc}</div>
                </motion.div>
              );
            })}
          </div>

          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="p-4 rounded-xl text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)' }}>
            <div className="h-0.5 w-full mb-3 rounded-full" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <p className="text-neutral-300 text-sm">Results typically visible within <span className="text-white font-bold">2-4 weeks</span> of implementation</p>
          </motion.div>
        </div>
      );
    };

    // Completion Slide - Clean, no pushy CTA
    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-16 h-16 rounded-xl flex items-center justify-center mb-4 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-2xl md:text-3xl text-black mb-3">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-sm mb-5 max-w-md leading-relaxed">
          You now understand: ABO tests, CBO scales. They're phases, not alternatives. Accurate data is the foundation.
        </motion.p>

        {/* Key Takeaways - Clean summary */}
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
          className="bg-neutral-50 rounded-xl p-5 max-w-md w-full mb-4 border border-neutral-100">
          <div className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Key Takeaways</div>
          <div className="space-y-2 text-left">
            <div className="flex items-start gap-2">
              <span className="w-5 h-5 rounded flex-shrink-0 flex items-center justify-center mt-0.5" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
                <span className="text-xs font-bold" style={{ color: 'var(--accent)' }}>1</span>
              </span>
              <span className="text-sm text-neutral-600">ABO = Testing lab. CBO = Scaling engine. Different jobs.</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="w-5 h-5 rounded flex-shrink-0 flex items-center justify-center mt-0.5" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
                <span className="text-xs font-bold" style={{ color: 'var(--accent)' }}>2</span>
              </span>
              <span className="text-sm text-neutral-600">Feed CBO 12-30 diverse winners from ABO testing</span>
            </div>
            <div className="flex items-start gap-2">
              <span className="w-5 h-5 rounded flex-shrink-0 flex items-center justify-center mt-0.5" style={{ background: 'rgba(var(--accent-rgb), 0.1)' }}>
                <span className="text-xs font-bold" style={{ color: 'var(--accent)' }}>3</span>
              </span>
              <span className="text-sm text-neutral-600">First-party attribution shows true ROAS - stop flying blind</span>
            </div>
          </div>
        </motion.div>

        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="bg-neutral-100 rounded-xl p-4 max-w-md w-full">
          <p className="text-neutral-400 text-[10px] uppercase tracking-wider mb-1">Up Next</p>
          <h3 className="text-neutral-900 font-bold text-base mb-1">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-500 text-xs">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const [direction, setDirection] = useState(1);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE', slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = {
        enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }),
        center: { x: 0, opacity: 1 },
        exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 })
      };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'testing-scaling-toggle': return <TestingScalingToggleSlide data={slide} />;
          case 'comparison-battle': return <ComparisonBattleSlide data={slide} />;
          case 'decision-tree': return <DecisionTreeSlide data={slide} />;
          case 'attribution-problem': return <AttributionProblemSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          // Part 2: Practical slides
          case 'section-divider': return <SectionDividerSlide />;
          case 'step-setup-tracking': return <StepSetupTrackingSlide />;
          case 'step-build-abo': return <StepBuildABOSlide />;
          case 'step-scale-cbo': return <StepScaleCBOSlide />;
          case 'step-results': return <StepResultsSlide />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-2 md:left-5 top-1/2 -translate-y-1/2 w-8 h-8 md:w-12 md:h-12 rounded-full bg-neutral-100/80 md:bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-400 md:text-neutral-500 hover:text-neutral-700 transition-all z-10 backdrop-blur-sm md:backdrop-blur-none"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-2 md:right-5 top-1/2 -translate-y-1/2 w-8 h-8 md:w-12 md:h-12 rounded-full bg-neutral-100/80 md:bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-400 md:text-neutral-500 hover:text-neutral-700 transition-all z-10 backdrop-blur-sm md:backdrop-blur-none"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>
                  <source src={gifConfig.url} type="video/mp4" />
                </video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
