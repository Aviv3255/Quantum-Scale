<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The 6:1 Problem | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #8B5CF6; --accent-dark: #7C3AED; --accent-light: #A78BFA; --accent-rgb: 139, 92, 246; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'biz-6-to-1-problem',
      title: 'The 6:1 Problem',
      description: 'When your ratio is too good, you are leaving money on the table',
      accentColor: '#8B5CF6',
      duration: '5 min',
      nextLesson: { id: 'biz-survival-cycle', title: 'The Survival Cycle', teaser: 'Breaking the doom loop that kills most stores.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_standing_and_clapping_enthusiastically_mouth_o_992ac4fd-9a0e-4963-bbcc-a5271f25f4fd_3.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why a 6:1 ratio is actually a problem', 'The opportunity cost of underspending', 'How to find your optimal ratio'] },
      { type: 'hook', headline: 'Your 6:1 LTV:CAC ratio is not a flex. It is a failure.', subtext: 'Most founders celebrate a high ratio. "We have 6:1 LTV:CAC!" they brag. But here is what that actually means: You are dramatically underspending on growth. You are leaving customers on the table. Your competitors are eating market share you could have owned. A ratio that high means you are playing too safe. And in business, playing too safe is the riskiest move of all.' },
      { type: 'ratio-spectrum', title: 'The LTV:CAC Spectrum', ranges: [
        { range: '1:1', label: 'Danger Zone', description: 'Breaking even at best', color: '#EF4444', position: 10 },
        { range: '2:1', label: 'Survival', description: 'Thin margins, fragile', color: '#F59E0B', position: 25 },
        { range: '3:1', label: 'Healthy', description: 'The golden ratio', color: '#22C55E', position: 45, highlight: true },
        { range: '4:1', label: 'Strong', description: 'Room to push harder', color: '#3B82F6', position: 60 },
        { range: '6:1+', label: 'Underspending', description: 'Leaving money on table', color: '#8B5CF6', position: 85 }
      ]},
      { type: 'content', title: 'The Hidden Cost of Safety', body: 'When your ratio is 6:1, you have massive headroom to spend more and still be profitable. Every dollar you do not spend is a customer you do not acquire. Every customer you do not acquire is market share you do not own. Your competitors with 3:1 ratios are outspending you 2x. They are building brand awareness. They are locking in customers. They are creating switching costs. By the time you decide to spend, they have already won.' },
      { type: 'math-comparison', title: 'The 6:1 vs 3:1 Reality', scenarios: [
        { name: 'Your Store (6:1)', cac: 50, ltv: 300, margin: 250, customers: 100, revenue: 30000, profit: 25000, color: '#8B5CF6' },
        { name: 'Competitor (3:1)', cac: 100, ltv: 300, margin: 200, customers: 200, revenue: 60000, profit: 40000, color: '#22C55E' }
      ], insight: 'Same LTV. But 2x the customers. 2x the revenue. And still healthy margins.' },
      { type: 'stat-countdown', title: 'The Numbers Tell The Story', stats: [
        { value: 2, suffix: 'x', label: 'Fewer Customers', subtext: 'At 6:1 vs 3:1 ratio' },
        { value: 50, suffix: '%', label: 'Market Share Lost', subtext: 'To aggressive competitors' },
        { value: 0, suffix: '', label: 'Second Chances', subtext: 'Once market is captured' }
      ]},
      { type: 'content', title: 'Market Share Is Finite', body: 'Here is the brutal truth: market share is not infinite. Every customer has a ceiling of attention and budget. When a competitor captures them first, they build loyalty, collect emails, create habits. Switching costs stack up. The customer you could have acquired for $50 now costs $200 to steal back. Or they are gone forever. High ratios feel safe. But they are slowly killing your growth.' },
      { type: 'opportunity-cost', title: 'What You Are Really Losing', lostItems: [
        { item: 'Customer Emails', value: '10,000+', description: 'Future marketing asset', color: '#3B82F6' },
        { item: 'Market Position', value: '#1 vs #5', description: 'Brand recognition gap', color: '#8B5CF6' },
        { item: 'Economies of Scale', value: '15-30%', description: 'Volume discounts lost', color: '#22C55E' },
        { item: 'Word of Mouth', value: 'Exponential', description: 'Referral network effect', color: '#F59E0B' }
      ]},
      { type: 'strategy-steps', title: 'Find Your Optimal Ratio', steps: [
        { number: 1, title: 'KNOW YOUR FLOOR', icon: 'Target', color: '#EF4444', description: 'Never go below 2.5:1. That is your breakeven after overhead. Anything below that loses money long-term.' },
        { number: 2, title: 'TARGET 3:1', icon: 'Crosshair', color: '#22C55E', description: 'The golden ratio for growth. Profitable enough to reinvest. Aggressive enough to capture market. Sustainable for scale.' },
        { number: 3, title: 'SPEND THE DELTA', icon: 'TrendingUp', color: '#8B5CF6', description: 'If you are at 6:1, you have room to double ad spend and still hit 3:1. Use that headroom. Grow faster. Capture more.' }
      ]},
      { type: 'before-after', title: 'Conservative vs Aggressive Growth', before: [
        '6:1 ratio - "We\'re crushing it!"',
        '$5,000/month ad spend',
        '100 customers/month',
        'Slow, steady growth',
        'Competitors outpacing you'
      ], after: [
        '3:1 ratio - "We\'re growing!"',
        '$10,000/month ad spend',
        '200 customers/month',
        'Capturing market share',
        'Building competitive moat'
      ]},
      { type: 'highlight-box', title: 'The Counterintuitive Truth', body: 'A lower LTV:CAC ratio is often better than a higher one. It means you are investing in growth. It means you are capturing market share. It means you are building an asset. The founders celebrating their 6:1 ratio are the same ones wondering why their competitor with 3:1 just raised $10M and is everywhere they look. The race goes to the bold. Not the cautious.', highlight: 'A lower ratio often beats a higher one. It means you are investing in growth, not hiding from it.' },
      { type: 'quiz', question: 'Why is a 6:1 LTV:CAC ratio actually a problem?', options: ['It means your ads are not working', 'It means you are overspending on marketing', 'It means you are underspending and losing market share', 'It means your LTV is too high'], correctIndex: 2, feedback: { correct: 'Exactly right. A 6:1 ratio means you have massive room to spend more and still be profitable. Every dollar you do not spend is a customer your competitor acquires instead. The optimal ratio is around 3:1 - aggressive enough to grow, sustainable enough to scale.', incorrect: 'Not quite. A 6:1 ratio actually means you are underspending on growth. You have room to double your ad spend and still maintain a healthy 3:1 ratio. That caution is costing you customers and market share.' }},
      { type: 'completion', sources: [] }
    ];

    // Icons
    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Target: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Crosshair: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2"><circle cx="12" cy="12" r="10"/><line x1="22" y1="12" x2="18" y2="12"/><line x1="6" y1="12" x2="2" y2="12"/><line x1="12" y1="6" x2="12" y2="2"/><line x1="12" y1="22" x2="12" y2="18"/></svg>,
      TrendingUp: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      AlertTriangle: ({ size = 24, color = 'currentColor' }) => <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
    };

    const AnimatedCounter = ({ target, suffix = '', prefix = '', duration = 2000 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const increment = target / (duration / 16);
        const timer = setInterval(() => {
          start += increment;
          if (start >= target) { setCount(target); clearInterval(timer); }
          else { setCount(Math.floor(start)); }
        }, 16);
        return () => clearInterval(timer);
      }, [target, duration]);
      return <span>{prefix}{count}{suffix}</span>;
    };

    // Welcome Slide with GIF overlay
    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);

      useEffect(() => {
        onShowGif(welcomeData.gif, '65%', gifSide);
        return () => onHideGif();
      }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-3xl mx-auto py-8">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}>
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-6" style={{ background: 'rgba(139, 92, 246, 0.1)', color: '#8B5CF6' }}>
              <Icons.Zap />
              <span>Growth Strategy</span>
            </div>

            <h1 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black mb-4">
              {formatGreeting(welcomeData.greeting, userName)}
            </h1>

            <p className="text-neutral-500 text-lg mb-8">Here's what you'll discover:</p>

            <div className="space-y-3">
              {data.learningGoals.map((goal, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-center gap-3 p-4 rounded-xl" style={{ background: '#fafafa', border: '1px solid #eee' }}>
                  <div className="w-8 h-8 rounded-full flex items-center justify-center text-white text-sm font-bold" style={{ background: '#8B5CF6' }}>
                    {i + 1}
                  </div>
                  <span className="text-neutral-700 font-medium">{goal}</span>
                </motion.div>
              ))}
            </div>

            <motion.button
              initial={{ opacity: 0, y: 20 }}
              animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.6 }}
              onClick={onStart}
              className="mt-8 px-8 py-4 rounded-xl font-semibold text-white flex items-center gap-2 transition-all hover:scale-105"
              style={{ background: 'linear-gradient(135deg, #8B5CF6, #7C3AED)' }}
            >
              Let's find your optimal ratio
              <Icons.ArrowRight />
            </motion.button>
          </motion.div>
        </div>
      );
    };

    // Hook Slide
    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-8 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-3xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-lg md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }}
            className="absolute bottom-0 right-0 z-0 pointer-events-none" style={{ height: '30%', maxHeight: '200px', marginRight: '3%', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );
      const totalSlides = slides.length;
      const userName = getUserName();

      const showGif = useCallback((src, maxHeight = '60%', side = 'right') => {
        setGifConfig({ visible: true, src, maxHeight, side });
      }, []);

      const hideGif = useCallback(() => {
        setGifConfig(prev => ({ ...prev, visible: false }));
      }, []);

      const goNext = useCallback(() => { if (currentSlide < totalSlides - 1) { hideGif(); setCurrentSlide(prev => prev + 1); } }, [currentSlide, totalSlides, hideGif]);
      const goPrev = useCallback(() => { if (currentSlide > 0) { hideGif(); setCurrentSlide(prev => prev - 1); } }, [currentSlide, hideGif]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); goNext(); }
          else if (e.key === 'ArrowLeft') { e.preventDefault(); goPrev(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [goNext, goPrev]);

      const renderSlide = () => {
        const slide = slides[currentSlide];
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={goNext} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'ratio-spectrum': return <RatioSpectrumSlide data={slide} />;
          case 'content': return <ContentSlide data={slide} />;
          case 'math-comparison': return <MathComparisonSlide data={slide} />;
          case 'stat-countdown': return <StatCountdownSlide data={slide} />;
          case 'opportunity-cost': return <OpportunityCostSlide data={slide} />;
          case 'strategy-steps': return <StrategyStepsSlide data={slide} />;
          case 'before-after': return <BeforeAfterSlide data={slide} />;
          case 'highlight-box': return <HighlightBoxSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide data={slide} userName={userName} />;
          default: return <ContentSlide data={slide} />;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < totalSlides - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide()}
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={goPrev} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={goNext} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => { hideGif(); setCurrentSlide(i); }} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? LESSON_CONFIG.accentColor : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig.visible && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, maxHeight: gifConfig.maxHeight }}>
                <video src={gifConfig.src} autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none', maxHeight: gifConfig.maxHeight }} />
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.render(<LessonApp />, document.getElementById('root'));
  </script>
</body>
</html>
