<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Borrowed Trust | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #88da1c; --accent-dark: #6fb816; --accent-light: #a3e635; --accent-rgb: 136, 218, 28; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };

    const LESSON_CONFIG = {
      id: 'borrowed-trust',
      title: 'Borrowed Trust',
      description: 'Why strangers in white coats sell better than your best sales copy.',
      accentColor: '#88da1c',
      duration: '8 min',
      nextLesson: { id: 'herd-instinct', title: 'The Herd Instinct', teaser: 'Why 1,000 strangers are more convincing than your best ad copy.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why strangers in uniforms get instant trust (and you don\'t)', 'The psychology of borrowed authority and liking', 'How to ethically borrow credibility for your store'] },
      { type: 'hook', headline: 'A security guard tells you to move. You move. A random person tells you? You ignore them.', subtext: 'Same command. Same situation. Different uniform. The uniform alone changes everything. Because your brain has a shortcut: Authority = Trust. And trust = sales.' },
      { type: 'bar-chart' },
      { type: 'split-content', title: 'Why This Matters For Your Store', content: 'We are conditioned from birth to defer to authority. Doctors. Police. Scientists. We don\'t verify credentials every time - we use shortcuts.\n\n"Lab coat = trust the advice"\n"Badge = obey the command"\n"As Seen In Forbes = trust the product"\n\nIf your brand LOOKS credible, customers assume it IS credible.', media: { type: 'video', src: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_reading_intently_with_glasses_book_in_hand_--a_fae4f829-ea0b-4a5a-8fb0-3de395a6b6ee_2.mp4' }, reversed: false },
      { type: 'customer-journey' },
      { type: 'icon-grid', title: '3 Ways to Borrow Authority', items: [
        { icon: 'Award', title: 'Media Mentions', description: '"As Seen In..." badges from reputable sources. Even a tiny mention. The logo alone signals credibility.' },
        { icon: 'Shield', title: 'Expert Endorsements', description: 'Dermatologist-tested. Certified organic. The expert\'s credibility transfers to your product.' },
        { icon: 'Star', title: 'Credentials & Awards', description: 'Industry awards, certifications. "Winner of 2024 Innovation Award" - the award EXISTS. That\'s what matters.' }
      ]},
      { type: 'heatmap' },
      { type: 'before-after', scenario: 'Coffee Brand Product Description', before: { label: 'No Authority', text: '"Premium Organic Coffee Beans - Ethically Sourced, Expertly Roasted"' }, after: { label: 'Authority Borrowed', text: '"As Seen In: Forbes | TechCrunch | Food & Wine. Certified Organic. Award-Winning Roasters Since 2018."' }, insight: 'Same coffee. Different trust level. The logos do the heavy lifting.' },
      { type: 'quote', quote: 'People don\'t buy from companies they understand. They buy from companies they trust.', author: 'Robert Cialdini', role: 'Author of Influence' },
      { type: 'radar-chart' },
      { type: 'split-content', title: 'The Liking Principle', content: 'A 1970s insurance study found customers bought more from salespeople who were LIKE them - same age, hobbies, even smoking habits.\n\nWhy? Because similarity = safety = trust.\n\n"If they\'re like me, they GET me. They won\'t screw me over."\n\nThis is the Liking Principle. And it\'s lethal in ecommerce.', media: { type: 'video', src: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_connecting_the_dots_drawing_lines_between_poin_66a88945-b2d0-442a-b48e-0c20060e3fcf_2.mp4' }, reversed: true },
      { type: 'funnel-chart' },
      { type: 'before-after', scenario: 'Fashion Brand Ad', before: { label: 'Polished, No Similarity', text: 'Professional model (age 23) in perfect lighting, flawless makeup, studio background' }, after: { label: 'Relatable UGC', text: 'Real customer (age 38) in her kitchen, natural lighting, wearing the outfit while making breakfast' }, insight: 'Target is 30-45 moms. Who do they trust more? The model or someone exactly like them?' },
      { type: 'sankey-diagram' },
      { type: 'process-steps', title: 'Stack Authority + Liking Together', steps: [
        { title: 'Authority First', description: '"As Seen In Forbes" stops the scroll' },
        { title: 'Liking Second', description: 'Real customer testimonial keeps them reading' },
        { title: 'Stack Them', description: 'Dermatologist-tested + UGC video = maximum trust' },
        { title: 'Convert', description: 'Both work better together than either alone' }
      ]},
      { type: 'performance-matrix' },
      { type: 'quiz', question: 'Which ad combines Authority + Liking most effectively?', options: ['"Premium Yoga Mats - Free Shipping Today Only!"', '"As Seen In Women\'s Health | Yoga Journal - Trusted by 10,000+ Instructors"', '"Meet Sarah, 52, Who Does Yoga Daily on Our Mat (As Seen In Yoga Journal)"', '"Top-Rated Yoga Mats - Check Our 5-Star Reviews"'], correctIndex: 2, feedback: { correct: 'Exactly! It stacks Authority ("As Seen In Yoga Journal") with Liking (Sarah, 52 - a real, relatable person). Both working together = maximum trust.', incorrect: 'The winner stacks BOTH principles: Authority (media mention) + Liking (relatable person). Authority stops the scroll. Liking keeps them reading. You need both.' }},
      { type: 'completion' }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      ArrowDown: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="12" y1="5" x2="12" y2="19"/><polyline points="19 12 12 19 5 12"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Award: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
      Star: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Quote: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/></svg>,
    };

    // ============ BAR CHART - HORIZONTAL (FROM LIBRARY) ============
    const BarChartSlide = ({ data }) => {
      const barData = [
        { label: 'Security Guard', value: 92, color: '#88da1c' },
        { label: 'Doctor in Lab Coat', value: 88, color: '#22C55E' },
        { label: 'Business Executive', value: 76, color: '#3B82F6' },
        { label: 'Regular Person', value: 34, color: '#6B7280' },
        { label: 'Casual Clothes', value: 28, color: '#6B7280' },
      ];

      const max = Math.max(...barData.map(d => d.value)) * 1.1;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>The Bickman Study</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Compliance Rate by Appearance</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="space-y-5">
              {barData.map((item, index) => {
                const percentage = (item.value / max) * 100;
                return (
                  <motion.div key={index} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: index * 0.1 }}>
                    <div className="flex items-center justify-between mb-2">
                      <span className="text-sm font-medium text-white">{item.label}</span>
                      <motion.span className="text-sm font-bold text-white"
                        initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 + index * 0.1 }}>
                        {item.value}%
                      </motion.span>
                    </div>
                    <div className="h-3 bg-white/10 rounded-full overflow-hidden">
                      <motion.div className="h-full rounded-full" style={{ backgroundColor: item.color }}
                        initial={{ width: 0 }} animate={{ width: `${percentage}%` }}
                        transition={{ duration: 0.8, delay: 0.2 + index * 0.1, ease: [0.22, 1, 0.36, 1] }} />
                    </div>
                  </motion.div>
                );
              })}
            </div>

            <motion.p className="text-center text-white/60 text-sm mt-6"
              initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 1 }}>
              Same request. Different uniform. Compliance triples with authority signals.
            </motion.p>
          </motion.div>
        </div>
      );
    };

    // ============ CUSTOMER JOURNEY MAP (FROM LIBRARY) ============
    const CustomerJourneySlide = ({ data }) => {
      const stages = [
        { id: 'discover', name: 'Discover', touchpoints: [
          { id: 'd1', label: 'Sees Ad', emotion: 'neutral' },
          { id: 'd2', label: 'No Trust Signals', emotion: 'negative' },
        ]},
        { id: 'research', name: 'Research', touchpoints: [
          { id: 'r1', label: 'Checks Reviews', emotion: 'neutral' },
          { id: 'r2', label: 'Sees "As Seen In"', emotion: 'positive' },
        ]},
        { id: 'consider', name: 'Consider', touchpoints: [
          { id: 'c1', label: 'Expert Endorsement', emotion: 'positive' },
          { id: 'c2', label: 'UGC Testimonial', emotion: 'positive' },
        ]},
        { id: 'decide', name: 'Purchase', touchpoints: [
          { id: 'p1', label: 'Trust Established', emotion: 'positive' },
          { id: 'p2', label: 'Converts!', emotion: 'positive' },
        ]},
      ];

      const emotionColors = { positive: '#22C55E', neutral: '#F59E0B', negative: '#EF4444' };
      const stageColors = ['#88da1c', '#22C55E', '#3B82F6', '#A855F7'];

      const emotionLevels = { positive: 2, neutral: 1, negative: 0 };
      let allPoints = [];
      stages.forEach((stage, stageIndex) => {
        stage.touchpoints.forEach((tp, tpIndex) => {
          const emotion = tp.emotion || 'neutral';
          const x = (stageIndex + (tpIndex + 1) / (stage.touchpoints.length + 1)) / stages.length;
          const y = emotionLevels[emotion];
          allPoints.push({ x, y, emotion });
        });
      });

      const curvePoints = allPoints.map(p => ({ x: 50 + p.x * 500, y: 30 + (2 - p.y) * 35 }));
      const pathD = curvePoints.length > 0 ? `M ${curvePoints.map(p => `${p.x},${p.y}`).join(' L ')}` : '';

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Journey Map</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">The Buyer's Trust Journey</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            {/* Emotion curve */}
            <div className="mb-4">
              <svg viewBox="0 0 600 100" className="w-full h-20">
                {[0, 1, 2].map(level => (
                  <motion.line key={level} initial={{ opacity: 0 }} animate={{ opacity: 0.3 }} transition={{ delay: 0.2 }}
                    x1="50" y1={30 + (2 - level) * 35} x2="550" y2={30 + (2 - level) * 35}
                    stroke="rgba(255,255,255,0.15)" strokeDasharray="4,4" />
                ))}
                {pathD && (
                  <motion.path initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.4, duration: 1.5 }}
                    d={pathD} stroke="#88da1c" strokeWidth="3" fill="none" strokeLinecap="round" strokeLinejoin="round" />
                )}
                {curvePoints.map((point, i) => (
                  <motion.circle key={i} initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.6 + i * 0.1, type: 'spring' }}
                    cx={point.x} cy={point.y} r="5"
                    fill={allPoints[i].emotion === 'positive' ? '#22C55E' : allPoints[i].emotion === 'negative' ? '#EF4444' : '#F59E0B'} />
                ))}
              </svg>
            </div>

            {/* Stages */}
            <div className="flex gap-2">
              {stages.map((stage, stageIndex) => (
                <motion.div key={stage.id} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.3 + stageIndex * 0.1 }} className="flex-1">
                  <div className="p-2 rounded-t-lg text-center" style={{ backgroundColor: `${stageColors[stageIndex]}20` }}>
                    <div className="text-xs font-bold" style={{ color: stageColors[stageIndex] }}>{stage.name}</div>
                  </div>
                  <div className="p-2 rounded-b-lg space-y-1" style={{ backgroundColor: 'rgba(255,255,255,0.05)' }}>
                    {stage.touchpoints.map((tp, tpIndex) => (
                      <motion.div key={tp.id} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }}
                        transition={{ delay: 0.5 + stageIndex * 0.1 + tpIndex * 0.05 }}
                        className="flex items-center gap-1.5 p-1.5 rounded" style={{ backgroundColor: 'rgba(255,255,255,0.05)' }}>
                        <div className="w-3 h-3 rounded-full" style={{ backgroundColor: emotionColors[tp.emotion] }} />
                        <p className="text-xs font-medium text-white">{tp.label}</p>
                      </motion.div>
                    ))}
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ HEATMAP (FROM LIBRARY) ============
    const HeatmapSlide = ({ data }) => {
      const rows = ['Media Badge', 'Expert Quote', 'UGC Video', 'Certification'];
      const cols = ['Awareness', 'Interest', 'Desire', 'Action'];
      const heatmapData = [
        { row: 'Media Badge', col: 'Awareness', value: 95 },
        { row: 'Media Badge', col: 'Interest', value: 75 },
        { row: 'Media Badge', col: 'Desire', value: 55 },
        { row: 'Media Badge', col: 'Action', value: 40 },
        { row: 'Expert Quote', col: 'Awareness', value: 70 },
        { row: 'Expert Quote', col: 'Interest', value: 85 },
        { row: 'Expert Quote', col: 'Desire', value: 80 },
        { row: 'Expert Quote', col: 'Action', value: 65 },
        { row: 'UGC Video', col: 'Awareness', value: 50 },
        { row: 'UGC Video', col: 'Interest', value: 70 },
        { row: 'UGC Video', col: 'Desire', value: 90 },
        { row: 'UGC Video', col: 'Action', value: 85 },
        { row: 'Certification', col: 'Awareness', value: 60 },
        { row: 'Certification', col: 'Interest', value: 65 },
        { row: 'Certification', col: 'Desire', value: 75 },
        { row: 'Certification', col: 'Action', value: 70 },
      ];

      const values = heatmapData.map(d => d.value);
      const maxValue = Math.max(...values);
      const minValue = Math.min(...values);
      const valueRange = maxValue - minValue || 1;

      const getValue = (row, col) => {
        const cell = heatmapData.find(d => d.row === row && d.col === col);
        return cell?.value || 0;
      };

      const getColor = (value) => {
        const normalized = (value - minValue) / valueRange;
        const r = Math.round(26 + (136 - 26) * normalized);
        const g = Math.round(26 + (218 - 26) * normalized);
        const b = Math.round(26 + (28 - 26) * normalized);
        return `rgb(${r}, ${g}, ${b})`;
      };

      const getTextColor = (value) => {
        const normalized = (value - minValue) / valueRange;
        return normalized > 0.5 ? '#000000' : '#ffffff';
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Trust Matrix</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Trust Tactics Effectiveness</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="overflow-x-auto">
              <div className="inline-block">
                <div className="flex" style={{ marginLeft: 100 }}>
                  {cols.map((col, i) => (
                    <motion.div key={col} className="flex items-center justify-center text-xs font-medium text-white/50"
                      style={{ width: 70, height: 32 }}
                      initial={{ opacity: 0, y: -10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: i * 0.05 }}>
                      {col}
                    </motion.div>
                  ))}
                </div>

                {rows.map((row, rowIndex) => (
                  <div key={row} className="flex items-center">
                    <motion.div className="text-xs font-medium text-white/50 pr-3" style={{ width: 100 }}
                      initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: rowIndex * 0.05 }}>
                      {row}
                    </motion.div>
                    {cols.map((col, colIndex) => {
                      const value = getValue(row, col);
                      const color = getColor(value);
                      const textColor = getTextColor(value);
                      return (
                        <motion.div key={`${row}-${col}`}
                          className="flex items-center justify-center rounded-md m-0.5 font-semibold text-sm"
                          style={{ width: 66, height: 52, backgroundColor: color, color: textColor }}
                          initial={{ opacity: 0, scale: 0.8 }} animate={{ opacity: 1, scale: 1 }}
                          transition={{ delay: 0.1 + rowIndex * 0.05 + colIndex * 0.03, type: 'spring', stiffness: 200 }}>
                          {value}
                        </motion.div>
                      );
                    })}
                  </div>
                ))}
              </div>
            </div>

            <motion.div className="mt-6 flex items-center justify-center gap-3"
              initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.8 }}>
              <span className="text-xs text-white/50">Low Impact</span>
              <div className="w-32 h-3 rounded-full" style={{ background: 'linear-gradient(90deg, #1a1a1a, #88da1c)' }} />
              <span className="text-xs text-white/50">High Impact</span>
            </motion.div>
          </motion.div>
        </div>
      );
    };

    // ============ RADAR CHART (FROM LIBRARY) ============
    const RadarChartSlide = ({ data }) => {
      const radarData = [
        { axis: 'Trust Speed', value: 95 },
        { axis: 'Conversion', value: 85 },
        { axis: 'Retention', value: 70 },
        { axis: 'Referrals', value: 65 },
        { axis: 'Price Tolerance', value: 80 },
        { axis: 'Brand Recall', value: 90 },
      ];

      const size = 300;
      const center = size / 2;
      const radius = (size / 2) - 50;
      const levels = 5;
      const angleSlice = (Math.PI * 2) / radarData.length;
      const maxValue = 100;
      const accentColor = '#88da1c';

      const calculatePoint = (value, index) => {
        const normalizedValue = value / maxValue;
        const angle = angleSlice * index - Math.PI / 2;
        return { x: center + radius * normalizedValue * Math.cos(angle), y: center + radius * normalizedValue * Math.sin(angle) };
      };

      const dataPoints = radarData.map((d, i) => calculatePoint(d.value, i));
      const polygonPath = dataPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';

      const labelPoints = radarData.map((_, i) => {
        const angle = angleSlice * i - Math.PI / 2;
        const labelRadius = radius + 30;
        return { x: center + labelRadius * Math.cos(angle), y: center + labelRadius * Math.sin(angle) };
      });

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Multi-Factor Analysis</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Authority + Liking Impact</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width={size} height={size} className="overflow-visible">
                <defs>
                  <radialGradient id="radarGradientTrust" cx="50%" cy="50%" r="50%">
                    <stop offset="0%" stopColor={accentColor} stopOpacity="0.4" />
                    <stop offset="100%" stopColor={accentColor} stopOpacity="0.1" />
                  </radialGradient>
                  <filter id="radarGlowTrust">
                    <feGaussianBlur stdDeviation="3" result="coloredBlur" />
                    <feMerge><feMergeNode in="coloredBlur" /><feMergeNode in="SourceGraphic" /></feMerge>
                  </filter>
                </defs>

                {Array.from({ length: levels }).map((_, levelIndex) => {
                  const levelRadius = (radius / levels) * (levelIndex + 1);
                  const levelPoints = radarData.map((_, i) => {
                    const angle = angleSlice * i - Math.PI / 2;
                    return { x: center + levelRadius * Math.cos(angle), y: center + levelRadius * Math.sin(angle) };
                  });
                  const levelPath = levelPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
                  return (
                    <motion.path key={levelIndex} d={levelPath} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={1}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: levelIndex * 0.1 }} />
                  );
                })}

                {radarData.map((_, i) => {
                  const angle = angleSlice * i - Math.PI / 2;
                  const endX = center + radius * Math.cos(angle);
                  const endY = center + radius * Math.sin(angle);
                  return (
                    <motion.line key={i} x1={center} y1={center} x2={endX} y2={endY} stroke="rgba(255,255,255,0.1)" strokeWidth={1}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.05 }} />
                  );
                })}

                <motion.path d={polygonPath} fill="url(#radarGradientTrust)"
                  initial={{ opacity: 0, scale: 0.5 }} animate={{ opacity: 1, scale: 1 }}
                  transition={{ delay: 0.5, duration: 0.6, ease: 'backOut' }} style={{ transformOrigin: 'center' }} />

                <motion.path d={polygonPath} fill="none" stroke={accentColor} strokeWidth={2.5} strokeLinejoin="round" filter="url(#radarGlowTrust)"
                  initial={{ pathLength: 0 }} animate={{ pathLength: 1 }} transition={{ delay: 0.3, duration: 1, ease: [0.22, 1, 0.36, 1] }} />

                {dataPoints.map((point, i) => (
                  <motion.circle key={i} cx={point.x} cy={point.y} r={5} fill={accentColor} stroke="#000" strokeWidth={2}
                    initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.8 + i * 0.08, type: 'spring', stiffness: 200 }} />
                ))}

                {labelPoints.map((point, i) => (
                  <motion.text key={i} x={point.x} y={point.y} textAnchor="middle" dominantBaseline="middle"
                    className="text-xs font-medium" style={{ fill: '#fff' }}
                    initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.6 + i * 0.05 }}>
                    {radarData[i].axis}
                  </motion.text>
                ))}
              </svg>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ FUNNEL CHART (FROM LIBRARY) ============
    const FunnelChartSlide = ({ data }) => {
      const funnelData = [
        { label: 'See Your Ad', value: 10000, color: '#6B7280' },
        { label: 'Without Trust Signals', value: 2000, color: '#EF4444' },
        { label: 'With Authority + Liking', value: 6500, color: '#88da1c' },
        { label: 'Purchase', value: 1950, color: '#22C55E' },
      ];

      const maxValue = funnelData[0].value;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Trust Conversion</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Trust Signals Triple Conversions</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="max-w-md mx-auto space-y-2">
              {funnelData.map((stage, index) => {
                const widthPercent = (stage.value / maxValue) * 100;
                const prevValue = index > 0 ? funnelData[index - 1].value : stage.value;
                const conversionRate = ((stage.value / prevValue) * 100).toFixed(1);

                return (
                  <motion.div key={index} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: index * 0.15 }} className="relative">
                    <div className="flex justify-center">
                      <motion.div className="relative h-14 rounded-lg flex items-center justify-center overflow-hidden"
                        style={{ backgroundColor: stage.color }}
                        initial={{ width: 0 }} animate={{ width: `${widthPercent}%` }}
                        transition={{ duration: 0.8, delay: 0.2 + index * 0.15, ease: [0.22, 1, 0.36, 1] }}>
                        <div className="absolute inset-0 opacity-30" style={{ background: 'linear-gradient(180deg, rgba(255,255,255,0.3) 0%, transparent 50%, rgba(0,0,0,0.1) 100%)' }} />
                        <motion.div className="relative z-10 flex items-center gap-3 px-4" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 + index * 0.15 }}>
                          <span className="text-white font-bold text-lg drop-shadow-sm">{stage.value.toLocaleString()}</span>
                          <span className="text-white/90 text-sm font-medium drop-shadow-sm">{stage.label}</span>
                        </motion.div>
                      </motion.div>
                    </div>
                    {index > 0 && (
                      <motion.div className="flex justify-center items-center gap-2 py-1" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.7 + index * 0.15 }}>
                        <Icons.ArrowDown />
                        <span className={`text-xs font-medium ${stage.color === '#88da1c' ? 'text-[#88da1c]' : 'text-amber-500'}`}>
                          {conversionRate}%
                        </span>
                      </motion.div>
                    )}
                  </motion.div>
                );
              })}
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ SANKEY DIAGRAM (FROM LIBRARY) ============
    const SankeyDiagramSlide = ({ data }) => {
      const nodes = [
        { id: 'visitor', label: 'Visitor', color: '#6B7280' },
        { id: 'authority', label: 'Authority Signals', color: '#3B82F6' },
        { id: 'liking', label: 'Liking Signals', color: '#F59E0B' },
        { id: 'trust', label: 'Trust Built', color: '#88da1c' },
        { id: 'convert', label: 'Purchase', color: '#22C55E' },
      ];

      const links = [
        { source: 'visitor', target: 'authority', value: 50 },
        { source: 'visitor', target: 'liking', value: 50 },
        { source: 'authority', target: 'trust', value: 45 },
        { source: 'liking', target: 'trust', value: 45 },
        { source: 'trust', target: 'convert', value: 80 },
      ];

      const width = 550;
      const height = 300;
      const padding = 40;
      const nodeWidth = 20;

      const sourceIds = new Set(links.map(l => l.source));
      const targetIds = new Set(links.map(l => l.target));
      const leftNodes = nodes.filter(n => sourceIds.has(n.id) && !targetIds.has(n.id));
      const middleNodes = nodes.filter(n => sourceIds.has(n.id) && targetIds.has(n.id));
      const rightNodes = nodes.filter(n => !sourceIds.has(n.id) && targetIds.has(n.id));

      const nodePositions = new Map();

      const positionColumn = (columnNodes, xPos) => {
        const totalValue = columnNodes.reduce((sum, node) => {
          const nodeValue = links.filter(l => l.source === node.id || l.target === node.id).reduce((s, l) => s + l.value, 0);
          return sum + nodeValue;
        }, 0);
        let currentY = padding;
        const availableHeight = height - 2 * padding;
        columnNodes.forEach((node) => {
          const nodeValue = links.filter(l => l.source === node.id || l.target === node.id).reduce((s, l) => s + l.value, 0);
          const nodeHeight = (nodeValue / totalValue) * availableHeight * 0.8;
          nodePositions.set(node.id, { x: xPos, y: currentY, height: nodeHeight });
          currentY += nodeHeight + 15;
        });
      };

      positionColumn(leftNodes, padding);
      positionColumn(middleNodes, width / 2 - nodeWidth / 2);
      positionColumn(rightNodes, width - padding - nodeWidth);

      const createLinkPath = (link) => {
        const sourcePos = nodePositions.get(link.source);
        const targetPos = nodePositions.get(link.target);
        if (!sourcePos || !targetPos) return '';

        const sourceLinks = links.filter(l => l.source === link.source);
        const targetLinks = links.filter(l => l.target === link.target);
        const sourceLinkIndex = sourceLinks.findIndex(l => l === link);
        const targetLinkIndex = targetLinks.findIndex(l => l === link);
        const sourceTotal = sourceLinks.reduce((s, l) => s + l.value, 0);
        const targetTotal = targetLinks.reduce((s, l) => s + l.value, 0);
        const sourceOffset = sourceLinks.slice(0, sourceLinkIndex).reduce((s, l) => s + l.value, 0);
        const targetOffset = targetLinks.slice(0, targetLinkIndex).reduce((s, l) => s + l.value, 0);
        const linkHeight = (link.value / sourceTotal) * sourcePos.height;
        const targetLinkHeight = (link.value / targetTotal) * targetPos.height;

        const x0 = sourcePos.x + nodeWidth;
        const y0 = sourcePos.y + (sourceOffset / sourceTotal) * sourcePos.height;
        const x1 = targetPos.x;
        const y1 = targetPos.y + (targetOffset / targetTotal) * targetPos.height;
        const xi = (x0 + x1) * 0.5;

        return `M ${x0} ${y0} C ${xi} ${y0}, ${xi} ${y1}, ${x1} ${y1} L ${x1} ${y1 + targetLinkHeight} C ${xi} ${y1 + targetLinkHeight}, ${xi} ${y0 + linkHeight}, ${x0} ${y0 + linkHeight} Z`;
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Flow Visualization</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">How Trust Flows to Conversions</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {links.map((link, i) => {
                const sourceNode = nodes.find(n => n.id === link.source);
                const color = sourceNode?.color || '#888';
                return (
                  <motion.path key={`link-${i}`} initial={{ opacity: 0 }} animate={{ opacity: 0.4 }} transition={{ delay: 0.3 + i * 0.05 }}
                    d={createLinkPath(link)} fill={color} />
                );
              })}

              {nodes.map((node, i) => {
                const pos = nodePositions.get(node.id);
                if (!pos) return null;
                return (
                  <motion.g key={node.id}>
                    <motion.rect initial={{ scaleY: 0 }} animate={{ scaleY: 1 }} transition={{ delay: 0.1 + i * 0.03 }}
                      x={pos.x} y={pos.y} width={nodeWidth} height={pos.height} fill={node.color} rx="4"
                      style={{ transformOrigin: `${pos.x}px ${pos.y}px` }} />
                    <motion.text initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.03 }}
                      x={pos.x < width / 2 ? pos.x - 5 : pos.x + nodeWidth + 5} y={pos.y + pos.height / 2 + 4}
                      textAnchor={pos.x < width / 2 ? 'end' : 'start'} fill="rgba(255,255,255,0.8)" fontSize="11">
                      {node.label}
                    </motion.text>
                  </motion.g>
                );
              })}
            </svg>
          </motion.div>
        </div>
      );
    };

    // ============ PERFORMANCE MATRIX (FROM LIBRARY) ============
    const PerformanceMatrixSlide = ({ data }) => {
      const items = [
        { label: 'Media Badge', x: 85, y: 85, size: 22, color: '#88da1c' },
        { label: 'UGC Video', x: 75, y: 90, size: 20, color: '#22C55E' },
        { label: 'Expert Quote', x: 60, y: 70, size: 18, color: '#3B82F6' },
        { label: 'Certification', x: 45, y: 55, size: 16, color: '#A855F7' },
        { label: 'Stock Photos', x: 25, y: 30, size: 14, color: '#6B7280' },
      ];

      const size = 320;
      const padding = 40;
      const chartSize = size - padding * 2;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Strategic Matrix</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">Trust Tactics: Impact vs Effort</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative overflow-hidden"
            style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333', boxShadow: '0 0 60px rgba(136, 218, 28, 0.1)' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width={size} height={size} className="overflow-visible">
                <rect x={padding} y={padding} width={chartSize} height={chartSize} fill="none" stroke="rgba(255,255,255,0.1)" strokeWidth={1} />
                <line x1={padding + chartSize / 2} y1={padding} x2={padding + chartSize / 2} y2={padding + chartSize} stroke="rgba(255,255,255,0.3)" strokeWidth={1} strokeDasharray="4 4" />
                <line x1={padding} y1={padding + chartSize / 2} x2={padding + chartSize} y2={padding + chartSize / 2} stroke="rgba(255,255,255,0.3)" strokeWidth={1} strokeDasharray="4 4" />

                {['Low Priority', 'Quick Wins', 'Avoid', 'Major Projects'].map((label, i) => {
                  const positions = [
                    { x: padding + chartSize * 0.25, y: padding + chartSize * 0.25 },
                    { x: padding + chartSize * 0.75, y: padding + chartSize * 0.25 },
                    { x: padding + chartSize * 0.25, y: padding + chartSize * 0.75 },
                    { x: padding + chartSize * 0.75, y: padding + chartSize * 0.75 },
                  ];
                  return (
                    <motion.text key={i} x={positions[i].x} y={positions[i].y} textAnchor="middle" dominantBaseline="middle"
                      className="text-xs" style={{ fill: 'rgba(255,255,255,0.3)' }}
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.1 }}>
                      {label}
                    </motion.text>
                  );
                })}

                {items.map((item, i) => {
                  const cx = padding + (item.x / 100) * chartSize;
                  const cy = padding + ((100 - item.y) / 100) * chartSize;
                  return (
                    <motion.g key={i}>
                      <motion.circle cx={cx} cy={cy} r={item.size} fill={item.color} fillOpacity={0.3}
                        stroke={item.color} strokeWidth={2}
                        initial={{ scale: 0, opacity: 0 }} animate={{ scale: 1, opacity: 1 }}
                        transition={{ delay: 0.5 + i * 0.1, type: 'spring', stiffness: 200 }} />
                      <motion.text x={cx} y={cy} textAnchor="middle" dominantBaseline="middle"
                        className="text-xs font-medium" style={{ fill: '#fff' }}
                        initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.7 + i * 0.1 }}>
                        {item.label}
                      </motion.text>
                    </motion.g>
                  );
                })}

                <motion.text x={size / 2} y={size - 5} textAnchor="middle" className="text-sm" style={{ fill: '#fff' }}
                  initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>
                  Effort Required →
                </motion.text>
                <motion.text x={15} y={size / 2} textAnchor="middle" className="text-sm" style={{ fill: '#fff' }}
                  transform={`rotate(-90, 15, ${size / 2})`}
                  initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>
                  Trust Impact →
                </motion.text>
              </svg>
            </div>
          </motion.div>
        </div>
      );
    };

    // ============ STANDARD SLIDE COMPONENTS ============
    const WelcomeSlide = ({ data }) => {
      const userName = getUserName();
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} transition={{ duration: 0.6 }} className="text-center mb-8">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-4" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>{LESSON_CONFIG.duration} lesson</span>
            </div>
            <h1 className="text-4xl md:text-5xl text-black mb-4 title-font">{LESSON_CONFIG.title}</h1>
            <p className="text-lg text-gray-600">{window.getGreeting ? window.getGreeting(userName) : `Hey ${userName}!`}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl p-6 md:p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <h3 className="text-white font-semibold mb-4 flex items-center gap-2">
              <Icons.Star />
              <span>What you'll learn</span>
            </h3>
            <ul className="space-y-3">
              {data.learningGoals.map((goal, i) => (
                <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.4 + i * 0.1 }} className="flex items-start gap-3 text-white/80">
                  <div className="w-5 h-5 rounded-full flex items-center justify-center mt-0.5" style={{ background: 'var(--accent)' }}>
                    <Icons.Check />
                  </div>
                  <span>{goal}</span>
                </motion.li>
              ))}
            </ul>
          </motion.div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="text-center">
          <motion.h1 initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }}
            className="text-3xl md:text-4xl lg:text-5xl text-black mb-6 title-font leading-tight">
            {data.headline}
          </motion.h1>
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="text-lg text-gray-600 leading-relaxed max-w-2xl mx-auto">
            {data.subtext}
          </motion.p>
        </motion.div>
      </div>
    );

    const SplitContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
          <h2 className="text-2xl md:text-3xl text-black title-font">{data.title}</h2>
        </motion.div>
        <div className={`grid md:grid-cols-2 gap-6 ${data.reversed ? 'md:flex-row-reverse' : ''}`}>
          <motion.div initial={{ opacity: 0, x: data.reversed ? 20 : -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <p className="text-white/90 text-sm leading-relaxed whitespace-pre-line">{data.content}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: data.reversed ? -20 : 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl overflow-hidden aspect-video">
            {data.media?.type === 'video' && (
              <video src={data.media.src} autoPlay loop muted playsInline className="w-full h-full object-cover" />
            )}
          </motion.div>
        </div>
      </div>
    );

    const IconGridSlide = ({ data }) => {
      const iconMap = { Award: Icons.Award, Shield: Icons.Shield, Star: Icons.Star };
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <h2 className="text-2xl md:text-3xl text-black title-font">{data.title}</h2>
          </motion.div>
          <div className="grid md:grid-cols-3 gap-4">
            {data.items.map((item, i) => {
              const IconComponent = iconMap[item.icon] || Icons.Zap;
              return (
                <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }}
                  className="rounded-xl p-5 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
                  <div className="w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)' }}>
                    <div style={{ color: 'var(--accent)' }}><IconComponent /></div>
                  </div>
                  <h3 className="text-white font-semibold mb-2">{item.title}</h3>
                  <p className="text-white/70 text-sm">{item.description}</p>
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
            <Icons.Zap />
            <span>Real Example</span>
          </div>
          <h2 className="text-2xl md:text-3xl text-black title-font">{data.scenario}</h2>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-4">
          <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <div className="text-red-400 font-semibold mb-3 flex items-center gap-2">
              <Icons.X />
              <span>{data.before.label}</span>
            </div>
            <p className="text-white/80">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid var(--accent)' }}>
            <div className="font-semibold mb-3 flex items-center gap-2" style={{ color: 'var(--accent)' }}>
              <Icons.Check />
              <span>{data.after.label}</span>
            </div>
            <p className="text-white/80">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} className="mt-4 text-center">
          <p className="text-gray-600 italic">💡 {data.insight}</p>
        </motion.div>
      </div>
    );

    const QuoteSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-4xl mx-auto py-6 text-center">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}
          className="rounded-2xl p-8 md:p-12" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
          <div className="mb-6" style={{ color: 'var(--accent)' }}><Icons.Quote /></div>
          <blockquote className="text-xl md:text-2xl text-white font-medium mb-6 italic">"{data.quote}"</blockquote>
          <div className="text-white/60">
            <p className="font-semibold text-white">{data.author}</p>
            <p className="text-sm">{data.role}</p>
          </div>
        </motion.div>
      </div>
    );

    const ProcessStepsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
          <h2 className="text-2xl md:text-3xl text-black title-font">{data.title}</h2>
        </motion.div>
        <div className="grid md:grid-cols-4 gap-4">
          {data.steps.map((step, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
              transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-4 text-center relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <div className="w-8 h-8 rounded-full flex items-center justify-center mx-auto mb-3 text-sm font-bold text-black" style={{ background: 'var(--accent)' }}>
                {i + 1}
              </div>
              <h3 className="text-white font-semibold mb-2">{step.title}</h3>
              <p className="text-white/70 text-sm">{step.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuizSlide = ({ data, onAnswer }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const isCorrect = selected === data.correctIndex;

      const handleSelect = (index) => {
        if (showFeedback) return;
        setSelected(index);
        setShowFeedback(true);
        setTimeout(() => onAnswer?.(index === data.correctIndex), 2000);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Quick Check</span>
            </div>
            <h2 className="text-xl md:text-2xl text-black title-font">{data.question}</h2>
          </motion.div>
          <div className="space-y-3">
            {data.options.map((option, i) => {
              let borderColor = '#333';
              let bg = 'linear-gradient(135deg, #1a1a1a, #2d2d2d)';
              if (showFeedback && i === data.correctIndex) {
                borderColor = '#22C55E';
                bg = 'linear-gradient(135deg, rgba(34, 197, 94, 0.2), rgba(34, 197, 94, 0.1))';
              } else if (showFeedback && i === selected && !isCorrect) {
                borderColor = '#EF4444';
                bg = 'linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.1))';
              }
              return (
                <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }}
                  transition={{ delay: 0.1 + i * 0.1 }} onClick={() => handleSelect(i)}
                  className="w-full text-left rounded-xl p-4 text-white transition-all"
                  style={{ background: bg, border: `2px solid ${borderColor}` }}>
                  <span className="flex items-center gap-3">
                    <span className="w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold" style={{ background: 'rgba(255,255,255,0.1)' }}>
                      {String.fromCharCode(65 + i)}
                    </span>
                    <span className="text-sm">{option}</span>
                  </span>
                </motion.button>
              );
            })}
          </div>
          {showFeedback && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
              className="mt-6 rounded-xl p-4" style={{ background: isCorrect ? 'rgba(34, 197, 94, 0.1)' : 'rgba(239, 68, 68, 0.1)',
                border: `1px solid ${isCorrect ? '#22C55E' : '#EF4444'}` }}>
              <p className={`text-sm ${isCorrect ? 'text-green-400' : 'text-red-400'}`}>
                {isCorrect ? data.feedback.correct : data.feedback.incorrect}
              </p>
            </motion.div>
          )}
        </div>
      );
    };

    const CompletionSlide = ({ data }) => {
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      return (
        <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 max-w-4xl mx-auto py-6 text-center">
          <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ type: 'spring', stiffness: 200 }}
            className="w-32 h-32 rounded-full flex items-center justify-center mb-6" style={{ background: 'var(--accent)' }}>
            <Icons.Check />
          </motion.div>
          <motion.h2 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }}
            className="text-3xl md:text-4xl text-black title-font mb-4">
            Lesson Complete!
          </motion.h2>
          <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.3 }}
            className="text-gray-600 mb-8">
            You now understand how to ethically borrow authority and liking for your store.
          </motion.p>
          <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.4 }}
            className="w-48 h-48 rounded-2xl overflow-hidden">
            <video src={celebrationGif} autoPlay loop muted playsInline className="w-full h-full object-cover" />
          </motion.div>
        </div>
      );
    };

    // ============ MAIN APP ============
    const LessonApp = () => {
      const [currentSlide, setCurrentSlide] = useState(() => {
        const params = new URLSearchParams(window.location.search);
        return parseInt(params.get('slide')) || 0;
      });

      const goNext = useCallback(() => {
        if (currentSlide < slides.length - 1) setCurrentSlide(prev => prev + 1);
      }, [currentSlide]);

      const goPrev = useCallback(() => {
        if (currentSlide > 0) setCurrentSlide(prev => prev - 1);
      }, [currentSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') goNext();
          if (e.key === 'ArrowLeft') goPrev();
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [goNext, goPrev]);

      const renderSlide = (slide, index) => {
        const slideComponents = {
          'welcome': WelcomeSlide,
          'hook': HookSlide,
          'split-content': SplitContentSlide,
          'icon-grid': IconGridSlide,
          'before-after': BeforeAfterSlide,
          'quote': QuoteSlide,
          'process-steps': ProcessStepsSlide,
          'quiz': QuizSlide,
          'completion': CompletionSlide,
          'bar-chart': BarChartSlide,
          'customer-journey': CustomerJourneySlide,
          'heatmap': HeatmapSlide,
          'radar-chart': RadarChartSlide,
          'funnel-chart': FunnelChartSlide,
          'sankey-diagram': SankeyDiagramSlide,
          'performance-matrix': PerformanceMatrixSlide,
        };
        const Component = slideComponents[slide.type];
        return Component ? <Component data={slide} onAnswer={goNext} /> : null;
      };

      const slide = slides[currentSlide];
      const progress = ((currentSlide + 1) / slides.length) * 100;

      return (
        <div className="h-screen flex flex-col bg-white relative">
          <div className="absolute top-0 left-0 right-0 h-1 bg-gray-200 z-50">
            <motion.div className="h-full" style={{ background: 'var(--accent)' }}
              initial={{ width: 0 }} animate={{ width: `${progress}%` }} transition={{ duration: 0.3 }} />
          </div>

          <div className="flex-1 overflow-auto slide-scroll relative">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }}
                exit={{ opacity: 0, x: -20 }} transition={{ duration: 0.3 }} className="h-full">
                {renderSlide(slide, currentSlide)}
              </motion.div>
            </AnimatePresence>
          </div>

          <div className="flex items-center justify-between px-6 py-4 border-t border-gray-100">
            <button onClick={goPrev} disabled={currentSlide === 0}
              className="flex items-center gap-2 px-4 py-2 rounded-lg transition-all disabled:opacity-30"
              style={{ background: currentSlide > 0 ? 'rgba(136, 218, 28, 0.1)' : 'transparent' }}>
              <Icons.ArrowLeft />
              <span className="text-sm font-medium">Back</span>
            </button>
            <span className="text-sm text-gray-400">{currentSlide + 1} / {slides.length}</span>
            <button onClick={goNext} disabled={currentSlide === slides.length - 1}
              className="flex items-center gap-2 px-4 py-2 rounded-lg transition-all disabled:opacity-30"
              style={{ background: 'var(--accent)', color: 'black' }}>
              <span className="text-sm font-medium">Next</span>
              <Icons.ArrowRight />
            </button>
          </div>
        </div>
      );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<LessonApp />);
  </script>
</body>
</html>
