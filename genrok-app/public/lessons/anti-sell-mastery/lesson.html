<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Anti-Sell | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root { --accent: #88da1c; --accent-dark: #6fb816; --accent-light: #a3e635; --accent-rgb: 136, 218, 28; }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => { const params = new URLSearchParams(window.location.search); return params.get('userName') || 'Builder'; };
    const getInitialSlide = () => { const params = new URLSearchParams(window.location.search); const slide = params.get('slide'); return slide ? parseInt(slide, 10) : 0; };

    const LESSON_CONFIG = {
      id: 'anti-sell-mastery',
      title: 'The Anti-Sell',
      description: 'Why pushing harder kills sales - and how pulling back can make customers chase YOU instead.',
      accentColor: '#88da1c',
      duration: '8 min',
      nextLesson: { id: 'three-brains-wallet', title: 'The 3 Brains Controlling Your Customer\'s Wallet', teaser: 'Your customer has THREE brains making buying decisions. Learn which one controls the wallet.' }
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_clapping_very_fast_huge_smile_extreme_exciteme_9a4dde09-55ca-4173-a47d-613bc2924230_2.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];

    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_covering_face_with_palm_facepalm_gesture_disap_211b0566-078f-4d42-9c41-547b14f5827c_0.mp4'
    ];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    const slides = [
      { type: 'welcome', learningGoals: ['Why "Psychological Reactance" makes customers resist your pitch', 'The counter-intuitive power of pulling AWAY instead of pushing', 'How to make customers convince THEMSELVES to buy'] },
      { type: 'hook', headline: '"This product probably isn\'t for you." That one sentence increased conversions by 31%.', subtext: 'Every marketing instinct says PUSH harder. "Buy now!" "Don\'t miss out!" But the harder you push, the harder they resist. It\'s called Psychological Reactance. The solution? Stop pushing. Start pulling away. Make them CHASE you.' },

      // TIER 1: Sankey Diagram - Flow visualization
      { type: 'sankey-flow', title: 'Two Paths: Push vs Pull' },

      // TIER 2: Radar Chart - Multi-axis comparison
      { type: 'radar-comparison', title: 'Push vs Pull Effectiveness' },

      { type: 'split-content', title: 'The Science of Resistance', content: 'Psychological Reactance is the brain\'s automatic defense mechanism. When you feel your freedom is being threatened - when someone is trying to control your decision - your brain rebels.\n\nYou don\'t just ignore the pitch. You actively move in the OPPOSITE direction.\n\n"Buy now!" makes you want to wait.\n"You need this!" makes you skeptical.\n"Last chance!" makes you walk away.', media: { type: 'video', src: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_building_something_with_tools_constructing_100_52683f04-d09a-47c4-89a1-84b57476d150_2.mp4' }, reversed: false },

      // TIER 1: Pyramid Chart - Hierarchy of anti-sell tactics
      { type: 'pyramid-tactics', title: 'The Anti-Sell Hierarchy' },

      { type: 'before-after', scenario: 'Product Page Copy', before: { label: 'Push Selling', text: '"LIMITED TIME! Only 3 left! Buy NOW before it\'s gone forever! You NEED this!"' }, after: { label: 'Anti-Sell', text: '"This isn\'t for everyone. If you\'re serious about results and willing to put in the work, it might be right for you."' }, insight: 'The anti-sell copy converts 31% better because it respects the customer\'s autonomy.' },

      // TIER 2: Tree Map - Where anti-sell works best
      { type: 'treemap-applications', title: 'Where Anti-Sell Works Best' },

      { type: 'icon-grid', title: '4 Anti-Sell Triggers', items: [
        { icon: 'Shield', title: 'Autonomy', description: '"It\'s completely your decision" - Removes pressure, increases trust' },
        { icon: 'Target', title: 'Scarcity of Fit', description: '"Not for everyone" - Creates exclusivity without pressure' },
        { icon: 'Clock', title: 'Permission to Wait', description: '"Take your time" - Counterintuitively speeds up decisions' },
        { icon: 'Award', title: 'Honest Limitations', description: '"This won\'t work if..." - Builds credibility through transparency' }
      ]},

      { type: 'quote', quote: 'The moment you tell someone they might not be ready for something, they start proving to themselves that they ARE ready.', author: 'Robert Cialdini', role: 'Author of Influence' },

      // TIER 1: Performance Matrix - When to use which approach
      { type: 'performance-matrix', title: 'Push vs Pull: Strategic Positioning' },

      { type: 'process-steps', title: 'Implementing Anti-Sell', steps: [
        { title: 'Acknowledge Choice', description: '"You might not be ready for this yet, and that\'s okay."' },
        { title: 'Set Expectations', description: '"This only works if you\'re willing to [specific requirement]."' },
        { title: 'Offer Exit', description: '"If this doesn\'t feel right, no pressure to continue."' },
        { title: 'Let Them Convince', description: 'Watch as they argue FOR buying instead of against it.' }
      ]},

      { type: 'funnel-chart', title: 'Anti-Sell Conversion Impact', data: [
        { label: 'Page Views', value: 10000 },
        { label: 'Push Approach Engaged', value: 4000 },
        { label: 'Push Approach Converted', value: 400 },
        { label: 'Anti-Sell Approach Engaged', value: 6500 },
        { label: 'Anti-Sell Converted', value: 845 }
      ]},

      { type: 'quiz', question: 'A customer is hesitating on a $500 course. Which response uses anti-sell correctly?', options: ['"This is your LAST chance - price goes up tomorrow!"', '"Honestly, if you\'re not sure, you\'re probably not ready. Take your time."', '"Everyone who bought this saw amazing results - you will too!"', '"I\'ll throw in 3 bonuses if you buy right now!"'], correctIndex: 1, feedback: { correct: 'Perfect! This removes pressure and triggers the customer to prove to THEMSELVES they ARE ready. It respects their autonomy while creating psychological curiosity.', incorrect: 'The anti-sell approach removes pressure entirely. When you give someone permission to NOT buy, their brain stops resisting and starts genuinely evaluating.' }},
      { type: 'completion' }
    ];

    const Icons = {
      Clock: () => <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      ArrowLeft: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="19" y1="12" x2="5" y2="12"/><polyline points="12 19 5 12 12 5"/></svg>,
      ArrowRight: () => <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/></svg>,
      Zap: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Star: () => <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>,
      Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
      Target: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      Award: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="8" r="7"/><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"/></svg>,
      TrendingUp: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/></svg>,
      TrendingDown: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"/><polyline points="17 18 23 18 23 12"/></svg>,
      Users: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>,
    };

    // ==================== TIER 1: SANKEY DIAGRAM ====================
    const SankeyFlowSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      const nodes = [
        { id: 'visitor', label: 'Visitor', x: 50, color: '#6B7280' },
        { id: 'push', label: 'Push Tactics', x: 200, color: '#EF4444' },
        { id: 'pull', label: 'Anti-Sell', x: 200, color: 'var(--accent)' },
        { id: 'resistance', label: 'Resistance', x: 350, color: '#EF4444' },
        { id: 'curiosity', label: 'Curiosity', x: 350, color: 'var(--accent)' },
        { id: 'bounce', label: 'Bounced', x: 500, color: '#EF4444' },
        { id: 'convert', label: 'Converted', x: 500, color: '#22C55E' },
      ];

      const links = [
        { from: 'visitor', to: 'push', value: 50, color: '#EF444480' },
        { from: 'visitor', to: 'pull', value: 50, color: 'rgba(136, 218, 28, 0.5)' },
        { from: 'push', to: 'resistance', value: 45, color: '#EF444480' },
        { from: 'push', to: 'convert', value: 5, color: '#22C55E80' },
        { from: 'pull', to: 'curiosity', value: 40, color: 'rgba(136, 218, 28, 0.5)' },
        { from: 'pull', to: 'bounce', value: 10, color: '#6B728080' },
        { from: 'resistance', to: 'bounce', value: 45, color: '#EF444480' },
        { from: 'curiosity', to: 'convert', value: 40, color: '#22C55E80' },
      ];

      const nodePositions = {
        visitor: { y: 150 },
        push: { y: 80 }, pull: { y: 220 },
        resistance: { y: 60 }, curiosity: { y: 200 },
        bounce: { y: 80 }, convert: { y: 220 },
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Flow Analysis</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox="0 0 550 300" className="w-full">
              {/* Links */}
              {links.map((link, i) => {
                const fromNode = nodes.find(n => n.id === link.from);
                const toNode = nodes.find(n => n.id === link.to);
                const fromY = nodePositions[link.from].y;
                const toY = nodePositions[link.to].y;
                const thickness = link.value / 5;

                return (
                  <motion.path
                    key={i}
                    initial={{ pathLength: 0, opacity: 0 }}
                    animate={animated ? { pathLength: 1, opacity: 0.6 } : {}}
                    transition={{ delay: 0.3 + i * 0.1, duration: 0.8 }}
                    d={`M ${fromNode.x + 40} ${fromY} C ${(fromNode.x + toNode.x) / 2} ${fromY}, ${(fromNode.x + toNode.x) / 2} ${toY}, ${toNode.x - 40} ${toY}`}
                    stroke={link.color}
                    strokeWidth={thickness}
                    fill="none"
                    strokeLinecap="round"
                  />
                );
              })}

              {/* Nodes */}
              {nodes.map((node, i) => (
                <motion.g key={node.id} initial={{ opacity: 0, scale: 0 }} animate={animated ? { opacity: 1, scale: 1 } : {}} transition={{ delay: 0.1 + i * 0.08, type: 'spring' }}>
                  <rect x={node.x - 40} y={nodePositions[node.id].y - 20} width="80" height="40" rx="8" fill={node.color} />
                  <text x={node.x} y={nodePositions[node.id].y + 5} textAnchor="middle" fill="white" fontSize="11" fontWeight="bold">{node.label}</text>
                </motion.g>
              ))}

              {/* Percentage labels */}
              <motion.text initial={{ opacity: 0 }} animate={animated ? { opacity: 1 } : {}} transition={{ delay: 1.2 }} x="500" y="250" fill="#22C55E" fontSize="14" fontWeight="bold" textAnchor="middle">45 converted</motion.text>
              <motion.text initial={{ opacity: 0 }} animate={animated ? { opacity: 1 } : {}} transition={{ delay: 1.2 }} x="500" y="50" fill="#EF4444" fontSize="14" fontWeight="bold" textAnchor="middle">55 bounced</motion.text>
            </svg>

            <div className="flex justify-center gap-8 mt-4">
              <div className="flex items-center gap-2 text-xs">
                <div className="w-3 h-3 rounded-full" style={{ background: '#EF4444' }}></div>
                <span className="text-neutral-400">Push path (10% convert)</span>
              </div>
              <div className="flex items-center gap-2 text-xs">
                <div className="w-3 h-3 rounded-full" style={{ background: 'var(--accent)' }}></div>
                <span className="text-neutral-400">Anti-sell path (80% convert)</span>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // ==================== TIER 2: RADAR CHART ====================
    const RadarComparisonSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      const axes = ['Trust', 'Engagement', 'Conversion', 'Retention', 'Referrals', 'Satisfaction'];
      const pushData = [30, 45, 20, 25, 15, 35];
      const pullData = [85, 75, 65, 80, 70, 90];

      const center = 150;
      const radius = 100;
      const angleStep = (Math.PI * 2) / axes.length;

      const getPoint = (value, index) => {
        const angle = angleStep * index - Math.PI / 2;
        const r = (value / 100) * radius;
        return { x: center + r * Math.cos(angle), y: center + r * Math.sin(angle) };
      };

      const pushPoints = pushData.map((v, i) => getPoint(v, i));
      const pullPoints = pullData.map((v, i) => getPoint(v, i));
      const pushPath = pushPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
      const pullPath = pullPoints.map((p, i) => `${i === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Target />
              <span>Effectiveness Analysis</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width="300" height="300" className="overflow-visible">
                {/* Grid levels */}
                {[20, 40, 60, 80, 100].map((level, i) => {
                  const levelPoints = axes.map((_, idx) => getPoint(level, idx));
                  const levelPath = levelPoints.map((p, idx) => `${idx === 0 ? 'M' : 'L'} ${p.x} ${p.y}`).join(' ') + ' Z';
                  return <motion.path key={i} d={levelPath} fill="none" stroke="rgba(255,255,255,0.1)" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: i * 0.1 }} />;
                })}

                {/* Axis lines */}
                {axes.map((_, i) => {
                  const endPoint = getPoint(100, i);
                  return <motion.line key={i} x1={center} y1={center} x2={endPoint.x} y2={endPoint.y} stroke="rgba(255,255,255,0.1)" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 + i * 0.05 }} />;
                })}

                {/* Push data polygon */}
                <motion.path d={pushPath} fill="rgba(239, 68, 68, 0.2)" stroke="#EF4444" strokeWidth="2"
                  initial={{ scale: 0, opacity: 0 }} animate={animated ? { scale: 1, opacity: 1 } : {}} transition={{ delay: 0.5, duration: 0.6 }} style={{ transformOrigin: 'center' }} />

                {/* Pull data polygon */}
                <motion.path d={pullPath} fill="rgba(136, 218, 28, 0.2)" stroke="var(--accent)" strokeWidth="2"
                  initial={{ scale: 0, opacity: 0 }} animate={animated ? { scale: 1, opacity: 1 } : {}} transition={{ delay: 0.7, duration: 0.6 }} style={{ transformOrigin: 'center' }} />

                {/* Data points */}
                {pullPoints.map((p, i) => (
                  <motion.circle key={i} cx={p.x} cy={p.y} r="5" fill="var(--accent)" stroke="#000" strokeWidth="2"
                    initial={{ scale: 0 }} animate={animated ? { scale: 1 } : {}} transition={{ delay: 0.9 + i * 0.05, type: 'spring' }} />
                ))}

                {/* Axis labels */}
                {axes.map((axis, i) => {
                  const labelPoint = getPoint(120, i);
                  return (
                    <motion.text key={i} x={labelPoint.x} y={labelPoint.y} textAnchor="middle" dominantBaseline="middle" fill="white" fontSize="11" fontWeight="500"
                      initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 + i * 0.05 }}>
                      {axis}
                    </motion.text>
                  );
                })}
              </svg>
            </div>

            <div className="flex justify-center gap-8 mt-6">
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 rounded" style={{ background: '#EF4444' }}></div>
                <span className="text-white text-sm">Push Tactics</span>
              </div>
              <div className="flex items-center gap-2">
                <div className="w-4 h-4 rounded" style={{ background: 'var(--accent)' }}></div>
                <span className="text-white text-sm">Anti-Sell</span>
              </div>
            </div>
          </motion.div>
        </div>
      );
    };

    // ==================== TIER 1: PYRAMID CHART ====================
    const PyramidTacticsSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      const levels = [
        { label: 'Honest Limitations', value: 90, desc: '"This won\'t work if..."', color: 'var(--accent)' },
        { label: 'Permission to Wait', value: 70, desc: '"Take your time deciding"', color: '#22C55E' },
        { label: 'Scarcity of Fit', value: 50, desc: '"Not for everyone"', color: '#3B82F6' },
        { label: 'Autonomy Signals', value: 30, desc: '"Your choice entirely"', color: '#A855F7' },
      ];

      const width = 400;
      const height = 280;
      const segmentHeight = height / levels.length;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.TrendingUp />
              <span>Tactic Hierarchy</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex items-center justify-center gap-8">
              <svg viewBox={`0 0 ${width} ${height}`} className="w-full max-w-md">
                {levels.map((level, i) => {
                  const topWidth = (level.value / 100) * (width - 80) * (1 - i / levels.length);
                  const bottomWidth = (level.value / 100) * (width - 80) * (1 - (i + 1) / levels.length);
                  const y = i * segmentHeight;
                  const cx = width / 2;

                  const path = `M ${cx - topWidth/2} ${y} L ${cx + topWidth/2} ${y} L ${cx + bottomWidth/2} ${y + segmentHeight} L ${cx - bottomWidth/2} ${y + segmentHeight} Z`;

                  return (
                    <motion.g key={i}>
                      <motion.path
                        d={path}
                        fill={level.color}
                        stroke="#000"
                        strokeWidth="2"
                        initial={{ scaleY: 0, opacity: 0 }}
                        animate={animated ? { scaleY: 1, opacity: 1 } : {}}
                        transition={{ delay: 0.2 + i * 0.15, duration: 0.4 }}
                        style={{ transformOrigin: `${cx}px ${y}px` }}
                      />
                      <motion.text
                        x={cx}
                        y={y + segmentHeight / 2}
                        textAnchor="middle"
                        dominantBaseline="middle"
                        fill="white"
                        fontSize="13"
                        fontWeight="bold"
                        initial={{ opacity: 0 }}
                        animate={animated ? { opacity: 1 } : {}}
                        transition={{ delay: 0.4 + i * 0.15 }}
                      >
                        {level.label}
                      </motion.text>
                    </motion.g>
                  );
                })}
              </svg>

              <div className="hidden md:flex flex-col gap-3">
                {levels.map((level, i) => (
                  <motion.div
                    key={i}
                    initial={{ opacity: 0, x: 20 }}
                    animate={animated ? { opacity: 1, x: 0 } : {}}
                    transition={{ delay: 0.5 + i * 0.1 }}
                    className="flex items-center gap-3"
                  >
                    <div className="w-3 h-3 rounded-full" style={{ background: level.color }}></div>
                    <span className="text-white text-sm">{level.desc}</span>
                  </motion.div>
                ))}
              </div>
            </div>

            <motion.p initial={{ opacity: 0 }} animate={animated ? { opacity: 1 } : {}} transition={{ delay: 1 }}
              className="text-center text-neutral-400 text-sm mt-6">Higher levels = stronger anti-sell effect</motion.p>
          </motion.div>
        </div>
      );
    };

    // ==================== TIER 2: TREE MAP ====================
    const TreemapApplicationsSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      const items = [
        { label: 'High-Ticket', value: 35, color: 'var(--accent)', desc: 'Courses, coaching, luxury' },
        { label: 'B2B Sales', value: 25, color: '#22C55E', desc: 'Enterprise, SaaS' },
        { label: 'Premium Products', value: 20, color: '#3B82F6', desc: 'Quality-focused buyers' },
        { label: 'Expert Services', value: 12, color: '#A855F7', desc: 'Consulting, agencies' },
        { label: 'Membership', value: 8, color: '#F59E0B', desc: 'Communities, subscriptions' },
      ];

      const total = items.reduce((sum, item) => sum + item.value, 0);
      const width = 500;
      const height = 250;

      // Simple treemap layout
      let rects = [];
      let x = 0;
      items.forEach((item, i) => {
        const w = (item.value / total) * width;
        rects.push({ ...item, x, y: 0, w, h: height });
        x += w;
      });

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Users />
              <span>Best Applications</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <svg viewBox={`0 0 ${width} ${height}`} className="w-full">
              {rects.map((rect, i) => (
                <motion.g key={i}>
                  <motion.rect
                    x={rect.x + 2}
                    y={rect.y + 2}
                    width={rect.w - 4}
                    height={rect.h - 4}
                    rx="8"
                    fill={rect.color}
                    initial={{ scale: 0, opacity: 0 }}
                    animate={animated ? { scale: 1, opacity: 1 } : {}}
                    transition={{ delay: 0.1 + i * 0.1, type: 'spring' }}
                  />
                  {rect.w > 60 && (
                    <>
                      <motion.text
                        x={rect.x + rect.w / 2}
                        y={rect.h / 2 - 10}
                        textAnchor="middle"
                        fill="white"
                        fontSize="14"
                        fontWeight="bold"
                        initial={{ opacity: 0 }}
                        animate={animated ? { opacity: 1 } : {}}
                        transition={{ delay: 0.3 + i * 0.1 }}
                      >
                        {rect.label}
                      </motion.text>
                      <motion.text
                        x={rect.x + rect.w / 2}
                        y={rect.h / 2 + 10}
                        textAnchor="middle"
                        fill="rgba(255,255,255,0.7)"
                        fontSize="11"
                        initial={{ opacity: 0 }}
                        animate={animated ? { opacity: 1 } : {}}
                        transition={{ delay: 0.35 + i * 0.1 }}
                      >
                        {rect.value}%
                      </motion.text>
                      <motion.text
                        x={rect.x + rect.w / 2}
                        y={rect.h / 2 + 28}
                        textAnchor="middle"
                        fill="rgba(255,255,255,0.5)"
                        fontSize="9"
                        initial={{ opacity: 0 }}
                        animate={animated ? { opacity: 1 } : {}}
                        transition={{ delay: 0.4 + i * 0.1 }}
                      >
                        {rect.desc}
                      </motion.text>
                    </>
                  )}
                </motion.g>
              ))}
            </svg>
          </motion.div>
        </div>
      );
    };

    // ==================== TIER 1: PERFORMANCE MATRIX ====================
    const PerformanceMatrixSlide = ({ data }) => {
      const [animated, setAnimated] = useState(false);
      useEffect(() => { const timer = setTimeout(() => setAnimated(true), 300); return () => clearTimeout(timer); }, []);

      const items = [
        { label: 'Flash Sales', x: 80, y: 20, color: '#EF4444' },
        { label: 'Urgency Emails', x: 70, y: 30, color: '#EF4444' },
        { label: 'Anti-Sell Copy', x: 30, y: 85, color: 'var(--accent)' },
        { label: 'Honest Disclaimers', x: 25, y: 75, color: 'var(--accent)' },
        { label: 'Standard Ads', x: 50, y: 50, color: '#6B7280' },
      ];

      const size = 280;
      const padding = 40;
      const chartSize = size - padding * 2;

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Target />
              <span>Strategic Matrix</span>
            </div>
            <h2 className="slide-title text-2xl md:text-3xl text-black">{data.title}</h2>
          </motion.div>

          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8 relative" style={{ background: 'linear-gradient(135deg, #0a0a0a, #1a1a1a)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />

            <div className="flex justify-center">
              <svg width={size} height={size} className="overflow-visible">
                {/* Grid */}
                <rect x={padding} y={padding} width={chartSize} height={chartSize} fill="none" stroke="rgba(255,255,255,0.1)" />
                <line x1={padding + chartSize/2} y1={padding} x2={padding + chartSize/2} y2={padding + chartSize} stroke="rgba(255,255,255,0.2)" strokeDasharray="4 4" />
                <line x1={padding} y1={padding + chartSize/2} x2={padding + chartSize} y2={padding + chartSize/2} stroke="rgba(255,255,255,0.2)" strokeDasharray="4 4" />

                {/* Quadrant labels */}
                <motion.text x={padding + chartSize * 0.25} y={padding + chartSize * 0.25} textAnchor="middle" fill="rgba(255,255,255,0.3)" fontSize="10" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }}>Low Pressure</motion.text>
                <motion.text x={padding + chartSize * 0.25} y={padding + chartSize * 0.25 + 12} textAnchor="middle" fill="rgba(255,255,255,0.3)" fontSize="10" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.3 }}>Low Trust</motion.text>
                <motion.text x={padding + chartSize * 0.75} y={padding + chartSize * 0.25} textAnchor="middle" fill="rgba(255,255,255,0.3)" fontSize="10" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }}>High Pressure</motion.text>
                <motion.text x={padding + chartSize * 0.75} y={padding + chartSize * 0.25 + 12} textAnchor="middle" fill="rgba(255,255,255,0.3)" fontSize="10" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }}>Low Trust</motion.text>
                <motion.text x={padding + chartSize * 0.25} y={padding + chartSize * 0.75} textAnchor="middle" fill="var(--accent)" fontSize="10" fontWeight="bold" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}>SWEET SPOT</motion.text>
                <motion.text x={padding + chartSize * 0.25} y={padding + chartSize * 0.75 + 12} textAnchor="middle" fill="var(--accent)" fontSize="10" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }}>High Trust</motion.text>

                {/* Items */}
                {items.map((item, i) => {
                  const cx = padding + (item.x / 100) * chartSize;
                  const cy = padding + ((100 - item.y) / 100) * chartSize;
                  return (
                    <motion.g key={i}>
                      <motion.circle cx={cx} cy={cy} r="20" fill={item.color} fillOpacity="0.3" stroke={item.color} strokeWidth="2"
                        initial={{ scale: 0 }} animate={animated ? { scale: 1 } : {}} transition={{ delay: 0.5 + i * 0.1, type: 'spring' }} />
                      <motion.text x={cx} y={cy} textAnchor="middle" dominantBaseline="middle" fill="white" fontSize="8" fontWeight="bold"
                        initial={{ opacity: 0 }} animate={animated ? { opacity: 1 } : {}} transition={{ delay: 0.7 + i * 0.1 }}>
                        {item.label.split(' ').map((word, wi) => <tspan key={wi} x={cx} dy={wi === 0 ? 0 : 10}>{word}</tspan>)}
                      </motion.text>
                    </motion.g>
                  );
                })}

                {/* Axis labels */}
                <motion.text x={size/2} y={size - 5} textAnchor="middle" fill="white" fontSize="11" initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>Pressure Level →</motion.text>
                <motion.text x={10} y={size/2} textAnchor="middle" fill="white" fontSize="11" transform={`rotate(-90, 10, ${size/2})`} initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.2 }}>Trust Level →</motion.text>
              </svg>
            </div>
          </motion.div>
        </div>
      );
    };

    // Standard slide components
    const WelcomeSlide = ({ data }) => {
      const userName = getUserName();
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-center">
            <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full text-sm font-medium mb-6" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>{LESSON_CONFIG.duration} lesson</span>
            </div>
            <h1 className="slide-title text-4xl md:text-5xl text-black mb-4">{LESSON_CONFIG.title}</h1>
            <p className="text-lg text-neutral-600 mb-8">{LESSON_CONFIG.description}</p>
            <div className="rounded-2xl p-6 text-left" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
              <h3 className="text-white font-bold mb-4">What you'll learn:</h3>
              <ul className="space-y-3">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-start gap-3">
                    <div className="w-5 h-5 rounded-full flex items-center justify-center flex-shrink-0 mt-0.5" style={{ background: 'var(--accent)' }}>
                      <Icons.Check />
                    </div>
                    <span className="text-white/80">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </div>
          </motion.div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} className="text-center">
          <h2 className="slide-title text-3xl md:text-4xl text-black mb-6 leading-tight">{data.headline}</h2>
          <p className="text-lg text-neutral-600 leading-relaxed">{data.subtext}</p>
        </motion.div>
      </div>
    );

    const SplitContentSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className={`grid md:grid-cols-2 gap-6 items-center ${data.reversed ? 'md:grid-flow-dense' : ''}`}>
          <motion.div initial={{ opacity: 0, x: data.reversed ? 30 : -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className={`rounded-2xl p-6 ${data.reversed ? 'md:col-start-2' : ''}`} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
            <p className="text-white/90 whitespace-pre-line leading-relaxed">{data.content}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: data.reversed ? -30 : 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className={`rounded-2xl overflow-hidden ${data.reversed ? 'md:col-start-1' : ''}`} style={{ background: '#0a0a0a' }}>
            {data.media?.type === 'video' && (
              <video src={data.media.src} autoPlay loop muted playsInline className="w-full h-full object-cover" style={{ maxHeight: '300px' }} />
            )}
          </motion.div>
        </div>
      </div>
    );

    const BeforeAfterSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-4">
          <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
            <span>{data.scenario}</span>
          </div>
        </motion.div>
        <div className="grid md:grid-cols-2 gap-6">
          <motion.div initial={{ opacity: 0, x: -30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #EF4444' }}>
            <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: '#EF4444' }} />
            <div className="flex items-center gap-2 mb-4">
              <Icons.X />
              <span className="text-white font-bold">{data.before.label}</span>
            </div>
            <p className="text-white/70">{data.before.text}</p>
          </motion.div>
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }}
            className="rounded-2xl p-6 relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid var(--accent)' }}>
            <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: 'var(--accent)' }} />
            <div className="flex items-center gap-2 mb-4" style={{ color: 'var(--accent)' }}>
              <Icons.Check />
              <span className="text-white font-bold">{data.after.label}</span>
            </div>
            <p className="text-white/90">{data.after.text}</p>
          </motion.div>
        </div>
        <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.5 }} className="text-center text-neutral-600 mt-4 text-sm">{data.insight}</motion.p>
      </div>
    );

    const IconGridSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {data.items.map((item, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-4 text-center" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <div className="w-12 h-12 rounded-xl mx-auto mb-3 flex items-center justify-center" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
                {Icons[item.icon] && React.createElement(Icons[item.icon])}
              </div>
              <h4 className="text-white font-bold text-sm mb-1">{item.title}</h4>
              <p className="text-white/60 text-xs">{item.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const QuoteSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }}
          className="rounded-2xl p-8 md:p-12 text-center relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
          <div className="absolute top-0 left-0 right-0 h-1 rounded-t-2xl" style={{ background: 'linear-gradient(90deg, transparent, var(--accent), transparent)' }} />
          <div className="text-6xl mb-4" style={{ color: 'var(--accent)' }}>"</div>
          <p className="text-white text-xl md:text-2xl font-medium mb-6 leading-relaxed">{data.quote}</p>
          <div className="text-white/60">
            <span className="font-bold text-white">{data.author}</span>
            {data.role && <span className="block text-sm mt-1">{data.role}</span>}
          </div>
        </motion.div>
      </div>
    );

    const ProcessStepsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-5xl mx-auto py-6">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          {data.steps.map((step, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 + i * 0.1 }}
              className="rounded-xl p-4 relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <div className="absolute -top-3 left-4 w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold text-black" style={{ background: 'var(--accent)' }}>{i + 1}</div>
              <h4 className="text-white font-bold text-sm mb-2 mt-2">{step.title}</h4>
              <p className="text-white/60 text-xs">{step.description}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    const FunnelChartSlide = ({ data }) => {
      const maxValue = Math.max(...data.data.map(d => d.value));
      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-6">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }}
            className="rounded-2xl p-6 md:p-8" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
            <div className="space-y-3">
              {data.data.map((stage, i) => {
                const width = (stage.value / maxValue) * 100;
                const isAntiSell = stage.label.includes('Anti-Sell');
                const color = isAntiSell || i >= 3 ? 'var(--accent)' : '#6B7280';
                return (
                  <motion.div key={i} initial={{ opacity: 0, width: 0 }} animate={{ opacity: 1, width: `${width}%` }} transition={{ delay: 0.2 + i * 0.1, duration: 0.6 }}
                    className="rounded-lg p-3 flex justify-between items-center" style={{ background: color, minWidth: '200px' }}>
                    <span className="text-white font-medium text-sm">{stage.label}</span>
                    <span className="text-white font-bold">{stage.value.toLocaleString()}</span>
                  </motion.div>
                );
              })}
            </div>
          </motion.div>
        </div>
      );
    };

    const QuizSlide = ({ data }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const isCorrect = selected === data.correctIndex;

      const handleSelect = (index) => {
        if (showFeedback) return;
        setSelected(index);
        setShowFeedback(true);
      };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto py-6">
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
            <div className="inline-flex items-center gap-2 px-3 py-1 rounded-full text-xs font-semibold mb-3" style={{ background: 'rgba(136, 218, 28, 0.1)', color: 'var(--accent)' }}>
              <Icons.Zap />
              <span>Quick Check</span>
            </div>
            <h2 className="slide-title text-xl md:text-2xl text-black">{data.question}</h2>
          </motion.div>
          <div className="space-y-3">
            {data.options.map((option, i) => (
              <motion.button key={i} initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.1 + i * 0.05 }}
                onClick={() => handleSelect(i)}
                className={`w-full text-left p-4 rounded-xl transition-all ${showFeedback ? (i === data.correctIndex ? 'ring-2 ring-green-500' : i === selected ? 'ring-2 ring-red-500' : '') : 'hover:scale-[1.02]'}`}
                style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
                <span className="text-white">{option}</span>
              </motion.button>
            ))}
          </div>
          {showFeedback && (
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }}
              className={`mt-6 p-4 rounded-xl ${isCorrect ? 'bg-green-500/20 border border-green-500/30' : 'bg-red-500/20 border border-red-500/30'}`}>
              <p className={`text-sm ${isCorrect ? 'text-green-400' : 'text-red-400'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
            </motion.div>
          )}
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col justify-center px-6 md:px-12 max-w-4xl mx-auto text-center">
        <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }}>
          <div className="w-20 h-20 rounded-2xl mx-auto mb-6 flex items-center justify-center" style={{ background: 'linear-gradient(135deg, var(--accent), var(--accent-dark))', boxShadow: '0 10px 40px rgba(136, 218, 28, 0.3)' }}>
            <Icons.Check />
          </div>
          <h2 className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete!</h2>
          <p className="text-neutral-600 mb-8">You've mastered the Anti-Sell approach. Remember: pulling back creates more pull than pushing forward.</p>
          {LESSON_CONFIG.nextLesson && (
            <div className="rounded-2xl p-6" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', border: '1px solid #333' }}>
              <p className="text-white/60 text-sm mb-2">Up Next</p>
              <h3 className="text-white font-bold text-lg">{LESSON_CONFIG.nextLesson.title}</h3>
              <p className="text-white/70 text-sm mt-2">{LESSON_CONFIG.nextLesson.teaser}</p>
            </div>
          )}
        </motion.div>
      </div>
    );

    const renderSlide = (slide, index) => {
      switch (slide.type) {
        case 'welcome': return <WelcomeSlide data={slide} />;
        case 'hook': return <HookSlide data={slide} />;
        case 'sankey-flow': return <SankeyFlowSlide data={slide} />;
        case 'radar-comparison': return <RadarComparisonSlide data={slide} />;
        case 'pyramid-tactics': return <PyramidTacticsSlide data={slide} />;
        case 'treemap-applications': return <TreemapApplicationsSlide data={slide} />;
        case 'performance-matrix': return <PerformanceMatrixSlide data={slide} />;
        case 'split-content': return <SplitContentSlide data={slide} />;
        case 'before-after': return <BeforeAfterSlide data={slide} />;
        case 'icon-grid': return <IconGridSlide data={slide} />;
        case 'quote': return <QuoteSlide data={slide} />;
        case 'process-steps': return <ProcessStepsSlide data={slide} />;
        case 'funnel-chart': return <FunnelChartSlide data={slide} />;
        case 'quiz': return <QuizSlide data={slide} />;
        case 'completion': return <CompletionSlide />;
        default: return <div className="text-center text-neutral-500">Unknown slide type: {slide.type}</div>;
      }
    };

    const LessonPlayer = () => {
      const [currentSlide, setCurrentSlide] = useState(getInitialSlide());
      const totalSlides = slides.length;

      const goNext = () => setCurrentSlide(prev => Math.min(prev + 1, totalSlides - 1));
      const goPrev = () => setCurrentSlide(prev => Math.max(prev - 1, 0));

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') goNext();
          if (e.key === 'ArrowLeft') goPrev();
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, []);

      useEffect(() => {
        if (window.parent !== window) {
          window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE', slideIndex: currentSlide, totalSlides, lessonId: LESSON_CONFIG.id }, '*');
        }
      }, [currentSlide]);

      return (
        <div className="h-screen flex flex-col bg-[#FAFAFA]">
          {/* Progress bar */}
          <div className="h-1 bg-neutral-200">
            <motion.div className="h-full" style={{ background: 'var(--accent)' }} initial={{ width: 0 }} animate={{ width: `${((currentSlide + 1) / totalSlides) * 100}%` }} />
          </div>

          {/* Slide content */}
          <div className="flex-1 overflow-hidden">
            <AnimatePresence mode="wait">
              <motion.div key={currentSlide} initial={{ opacity: 0, x: 50 }} animate={{ opacity: 1, x: 0 }} exit={{ opacity: 0, x: -50 }} transition={{ duration: 0.3 }} className="h-full">
                {renderSlide(slides[currentSlide], currentSlide)}
              </motion.div>
            </AnimatePresence>
          </div>

          {/* Navigation */}
          <div className="p-4 flex items-center justify-between border-t border-neutral-200">
            <button onClick={goPrev} disabled={currentSlide === 0} className="p-2 rounded-lg hover:bg-neutral-100 disabled:opacity-30 disabled:cursor-not-allowed">
              <Icons.ArrowLeft />
            </button>
            <span className="text-sm text-neutral-500">{currentSlide + 1} / {totalSlides}</span>
            <button onClick={goNext} disabled={currentSlide === totalSlides - 1} className="p-2 rounded-lg hover:bg-neutral-100 disabled:opacity-30 disabled:cursor-not-allowed">
              <Icons.ArrowRight />
            </button>
          </div>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<LessonPlayer />);
  </script>
</body>
</html>
