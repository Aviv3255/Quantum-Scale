<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>The Three Canons of Craft | Quantum Scale</title>
  <script src="https://cdn.tailwindcss.com" defer></script>
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" defer></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" defer></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js" defer></script>
  <script src="https://unpkg.com/framer-motion@10.16.4/dist/framer-motion.js" defer></script>
  <script src="../shared/greetings.js" defer></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@400;500;600;700;800;900&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --accent: #f59e0b;
      --accent-dark: #d97706;
      --accent-light: #fbbf24;
      --accent-rgb: 245, 158, 11;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'Inter', sans-serif; background: transparent; -webkit-font-smoothing: antialiased; }
    .title-font { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    h1, h2, h3, .slide-title { font-family: 'Fraunces', serif; font-weight: 900; letter-spacing: -0.02em; line-height: 1.1; }
    ::selection { background: var(--accent); color: white; }
    .slide-scroll::-webkit-scrollbar { display: none; }
    .slide-scroll { -ms-overflow-style: none; scrollbar-width: none; }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel">
    const { motion, AnimatePresence } = window.Motion;
    const { useState, useEffect, useCallback, useMemo } = React;

    const getUserName = () => {
      const params = new URLSearchParams(window.location.search);
      return params.get('userName') || 'Builder';
    };

    const LESSON_CONFIG = {
      id: 'three-canons-of-craft',
      title: 'The Three Canons of Craft',
      description: 'Three simple tests that separate forgettable fluff from copy that converts.',
      accentColor: '#f59e0b',
      duration: '5 min',
      nextLesson: { id: 'cpppb-proof-loop', title: 'The CPPPB Proof Loop', teaser: 'Five elements in one sequence that builds bulletproof persuasion.' }
    };

    // ============ ADMIN REPORTER SYSTEM ============
    let __isAdmin = false;
    window.addEventListener('message', function(e) { if (e.data?.type === 'ADMIN_STATUS') __isAdmin = e.data.isAdmin; });
    if (window.parent !== window) window.parent.postMessage({ type: 'CHECK_ADMIN_STATUS' }, '*');

    const AdminSlideReportButton = ({ slideIndex, slideType }) => {
      const handleReport = (e) => {
        e.stopPropagation(); e.preventDefault();
        if (window.parent !== window) window.parent.postMessage({ type: 'ADMIN_REPORT_REQUEST', slideIndex, slideType, lessonSlug: LESSON_CONFIG.id, elementId: slideType + '-' + slideIndex }, '*');
      };
      return (
        <button onClick={handleReport} title={`Report issue on Slide ${slideIndex + 1} (${slideType})`} style={{ position: 'absolute', top: '12px', right: '12px', width: '32px', height: '32px', borderRadius: '8px', backgroundColor: 'rgba(239, 68, 68, 0.9)', color: 'white', border: 'none', cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'center', zIndex: 1000, opacity: 0.6, transition: 'opacity 0.2s, transform 0.2s', boxShadow: '0 2px 8px rgba(0,0,0,0.15)' }} onMouseEnter={(e) => { e.currentTarget.style.opacity = '1'; e.currentTarget.style.transform = 'scale(1.1)'; }} onMouseLeave={(e) => { e.currentTarget.style.opacity = '0.6'; e.currentTarget.style.transform = 'scale(1)'; }}>
          <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m8 2 1.88 1.88"/><path d="M14.12 3.88 16 2"/><path d="M9 7.13v-1a3.003 3.003 0 1 1 6 0v1"/><path d="M12 20c-3.3 0-6-2.7-6-6v-3a4 4 0 0 1 4-4h4a4 4 0 0 1 4 4v3c0 3.3-2.7 6-6 6"/><path d="M12 20v-9"/><path d="M6.53 9C4.6 8.8 3 7.1 3 5"/><path d="M6 13H2"/><path d="M3 21c0-2.1 1.7-3.9 3.8-4"/><path d="M20.97 5c0 2.1-1.6 3.8-3.5 4"/><path d="M22 13h-4"/><path d="M17.2 17c2.1.1 3.8 1.9 3.8 4"/></svg>
        </button>
      );
    };

    const celebrationGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_doing_a_quick_victory_dance_move_high_energy_c_d03b798b-a518-4e6c-bcae-d69b2dd50486_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_jumping_in_the_air_arms_raised_high_YESSS_cele_201477e8-3df4-405a-bc81-81d1747e5c6c_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_playing_air_guitar_light_headbanging_rockstar__0702007e-9e84-4d9e-8f99-8ee23d0b65f8_2.mp4'
    ];
    const empathyGifs = [
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_thumbs_down_with_encouraging_nod_close_keep_go_613e541f-c072-436f-aee7-f99cd6f834fc_2.mp4',
      'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/aviv3255_He_is_shaking_head_side_to_side_sadly_disappointed_e_c4a4be22-6a70-4738-8612-3039454fef37_1.mp4'
    ];
    const getRandomCelebrationGif = () => celebrationGifs[Math.floor(Math.random() * celebrationGifs.length)];
    const getRandomEmpathyGif = () => empathyGifs[Math.floor(Math.random() * empathyGifs.length)];

    // ============================================
    // SLIDE DATA
    // ============================================
    const slides = [
      { type: 'welcome', learningGoals: ['Why 95% of product descriptions sound exactly the same', 'The three-question filter that separates pros from amateurs', 'How to write copy your competitors can\'t steal'] },
      { type: 'hook', headline: 'Harvard professor Gerald Zaltman discovered something shocking: 95% of purchasing decisions are made subconsciously.', subtext: 'Your Shopify product page could have perfect grammar. Gorgeous layout. Compelling benefits. All the emotional triggers firing. And it still says absolutely nothing.', brandImage: 'https://pqvvrljykfvhpyvxmwzb.supabase.co/storage/v1/object/public/images/Allbirds_logo.svg.png', brandName: 'Allbirds' },
      { type: 'canon-reveal', title: 'The Three Canons of Craft', subtitle: 'Harry Dry\'s filter that separates forgettable fluff from copy that converts', canons: [
        { num: 1, title: 'Can I Visualize It?', question: 'Can you picture it in your mind?', icon: 'Eye' },
        { num: 2, title: 'Can I Falsify It?', question: 'Can it be proven or disproven?', icon: 'CheckCircle' },
        { num: 3, title: 'Can Nobody Else Say It?', question: 'Could a competitor steal this?', icon: 'Fingerprint' }
      ]},
      { type: 'brain-speed', title: 'Why Concrete Beats Abstract', stat: '60,000', suffix: 'x', subtext: 'faster', insight: 'Concrete images process 60,000X faster than abstract concepts. Your brain can\'t hold onto "premium quality" because there\'s nothing to grab.' },
      { type: 'canon-detail', canon: { num: 1, title: 'Can I Visualize It?', color: '#f59e0b' }, description: 'Abstract words are invisible to the brain. You can\'t picture "solutions" or "quality." But you CAN picture "a red Ferrari" or "a stack of hundred dollar bills."', before: { label: 'Invisible', text: '"Premium quality skincare with innovative ingredients"' }, after: { label: 'Concrete', text: '"Korean glass skin in 14 days, even if you\'re 40+"' } },
      { type: 'canon-detail', canon: { num: 2, title: 'Can I Falsify It?', color: '#10b981' }, description: '"We\'re the best" is just your opinion. So is "industry-leading" and "world-class." These claims can never be proven or disproven - which makes them worthless.', before: { label: 'Opinion', text: '"Trusted by businesses worldwide for excellence"' }, after: { label: 'Provable', text: '"47,392 Shopify stores. $2.1B processed last year."' } },
      { type: 'canon-detail', canon: { num: 3, title: 'Can Nobody Else Say It?', color: '#8b5cf6' }, description: 'If competitors could swap their name into your copy and it would still make sense, you\'ve failed. Great copy is so specific to YOUR story that nobody else can steal it.', before: { label: 'Generic', text: '"Quality products at competitive prices with fast shipping"' }, after: { label: 'Ownable', text: '"The only yoga mat tested by 200 pregnant women"' } },
      { type: 'copy-battle', title: 'The Copy Battle', genericCopy: '"Premium quality fitness tracker with innovative features and reliable performance..."', specificCopy: '"Track your 10K splits like Eliud Kipchoge. 200-hour battery. Used by 47 Olympic athletes."', genericFails: ['Can\'t visualize "premium quality"', 'Can\'t falsify "innovative"', 'Any competitor could say this'], specificWins: ['You see Kipchoge running', '200-hour battery is measurable', 'Only this brand can claim this'] },
      { type: 'ownership-test', title: 'The Swap Test', testQuestion: 'Could a competitor swap their name into your copy?', badExample: { brand: 'ACME', copy: '"Quality products at competitive prices with fast shipping"', result: 'fails' }, goodExample: { brand: 'Beardbrand', copy: '"Beards so thick you\'ll need to warn TSA"', result: 'passes' } },
      { type: 'three-filter', title: 'The Three-Question Filter', subtitle: 'Before you publish ANY sentence, it must pass all three', questions: ['Can I visualize it?', 'Can I falsify it?', 'Can nobody else say it?'], warning: 'No exceptions. No excuses. This is the filter professionals use.' },
      { type: 'brand-examples', title: 'Real Brands That Pass All Three', brands: [
        { name: 'Allbirds', copy: '"World\'s most comfortable shoe, made from merino wool."', analysis: 'Concrete. Provable. Ownable.' },
        { name: 'Beardbrand', copy: '"Beards so thick you\'ll need to warn TSA."', analysis: 'Visual. Specific. Memorable.' },
        { name: 'Death Wish Coffee', copy: '"World\'s strongest coffee. 200% more caffeine."', analysis: 'Clear. Measurable. Unique.' }
      ]},
      { type: 'impact-stats', title: 'The Impact', stats: [
        { value: '60,000', suffix: 'x', label: 'Faster Processing', desc: 'Concrete vs abstract' },
        { value: '95', suffix: '%', label: 'Copy Sounds Same', desc: 'Why you blend in' },
        { value: '3', suffix: '', label: 'Questions', desc: 'All it takes to stand out' }
      ]},
      { type: 'elite-insight', quote: 'If a competitor could swap their name into your copy, start over. Generic copy isn\'t safe. It\'s invisible.', author: 'Harry Dry', actions: ['Audit your product pages with all 3 canons', 'Rewrite one sentence that fails any test', 'Mine YOUR unique story for details'] },
      { type: 'quiz', question: 'Which product description passes all three canons?', options: ['"Premium quality leggings for active lifestyles"', '"The leggings Olympic gymnasts wear for splits"', '"High-performance athletic wear for everyone"', '"Comfortable, stylish, and affordable leggings"'], correctIndex: 1, feedback: { correct: 'Exactly! It\'s concrete (you see gymnasts doing splits), provable (Olympic gymnasts actually wore them), and ownable (nobody else can claim this specific detail). That\'s what makes copy unforgettable.', incorrect: 'Not quite. The correct answer passes all three: Can you visualize it? (gymnasts in splits). Can you falsify it? (Olympic gymnasts wore them). Can nobody else say it? (specific to this brand). Generic descriptions fail all three.' }},
      { type: 'completion' }
    ];

    // ============================================
    // ICONS
    // ============================================
    const Icons = {
      ArrowLeft: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="15 18 9 12 15 6"/></svg>,
      ArrowRight: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"/></svg>,
      Clock: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
      Check: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><polyline points="20 6 9 17 4 12"/></svg>,
      X: () => <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="3" strokeLinecap="round" strokeLinejoin="round"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>,
      Eye: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0"/><circle cx="12" cy="12" r="3"/></svg>,
      CheckCircle: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>,
      Fingerprint: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 10a2 2 0 0 0-2 2c0 1.02-.1 2.51-.26 4"/><path d="M14 13.12c0 2.38 0 6.38-1 8.88"/><path d="M17.29 21.02c.12-.6.43-2.3.5-3.02"/><path d="M2 12a10 10 0 0 1 18-6"/><path d="M2 16h.01"/><path d="M21.8 16c.2-2 .131-5.354 0-6"/><path d="M5 19.5C5.5 18 6 15 6 12a6 6 0 0 1 .34-2"/><path d="M8.65 22c.21-.66.45-1.32.57-2"/><path d="M9 6.8a6 6 0 0 1 9 5.2v2"/></svg>,
      Brain: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
      Zap: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
      Target: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>,
      XCircle: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></svg>,
      Sparkles: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>,
      AlertTriangle: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>,
      Lightbulb: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5"/><path d="M9 18h6"/><path d="M10 22h4"/></svg>,
      TrendingUp: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>,
      Quote: () => <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2 2s-1 .008-1 1.031V21c0 1 0 1 1 1z"/><path d="M15 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2h.75c0 2.25.25 4-2.75 4v3c0 1 0 1 1 1z"/></svg>
    };

    // ============================================
    // ANIMATED COUNTER
    // ============================================
    const AnimatedCounter = ({ value, duration = 2000, prefix = '', suffix = '', decimals = 0 }) => {
      const [count, setCount] = useState(0);
      useEffect(() => {
        let start = 0;
        const end = parseFloat(value);
        const incrementTime = duration / 60;
        const step = end / 60;
        const timer = setInterval(() => {
          start += step;
          if (start >= end) { setCount(end); clearInterval(timer); }
          else { setCount(start); }
        }, incrementTime);
        return () => clearInterval(timer);
      }, [value, duration]);
      return <span>{prefix}{count.toFixed(decimals).replace(/\B(?=(\d{3})+(?!\d))/g, ',')}{suffix}</span>;
    };

    // ============================================
    // ELITE CUSTOM SLIDE COMPONENTS
    // ============================================

    // 1. Canon Reveal Slide - All 3 canons with auto-cycling highlight
    const CanonRevealSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => {
          setActiveIndex(prev => (prev + 1) % data.canons.length);
        }, 2500);
        return () => clearInterval(timer);
      }, [data.canons.length]);

      const iconColors = ['#f59e0b', '#10b981', '#8b5cf6'];
      const IconComponents = { Eye: Icons.Eye, CheckCircle: Icons.CheckCircle, Fingerprint: Icons.Fingerprint };

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 py-8">
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} className="text-center text-neutral-400 text-sm mb-2">{data.subtitle}</motion.p>
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-3xl md:text-4xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto w-full">
            {data.canons.map((canon, i) => {
              const isActive = i === activeIndex;
              const IconComp = IconComponents[canon.icon];
              return (
                <motion.div key={canon.num} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }} className="relative" style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', boxShadow: isActive ? `0 0 40px rgba(${i === 0 ? '245,158,11' : i === 1 ? '16,185,129' : '139,92,246'}, 0.3)` : 'none', transition: 'box-shadow 0.3s' }}>
                  <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${iconColors[i]}, transparent)`, borderRadius: '16px 16px 0 0' }} />
                  <div className="flex items-center gap-3 mb-4">
                    <div style={{ width: '48px', height: '48px', borderRadius: '12px', background: `linear-gradient(135deg, ${iconColors[i]}, ${iconColors[i]}99)`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '20px', fontWeight: 'bold' }}>{canon.num}</div>
                    <div style={{ color: iconColors[i] }}>{IconComp && <IconComp />}</div>
                  </div>
                  <h3 className="text-white font-bold text-lg mb-2">{canon.title}</h3>
                  <p className="text-neutral-400 text-sm">{canon.question}</p>
                  {isActive && (
                    <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} style={{ position: 'absolute', top: '-8px', right: '-8px', background: iconColors[i], color: 'white', padding: '4px 10px', borderRadius: '12px', fontSize: '11px', fontWeight: '600' }}>ACTIVE</motion.div>
                  )}
                </motion.div>
              );
            })}
          </div>
        </div>
      );
    };

    // 2. Brain Speed Slide - 60,000X faster visualization
    const BrainSpeedSlide = ({ data }) => {
      const [showInsight, setShowInsight] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowInsight(true), 1500);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0, scale: 0.9 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '48px', boxShadow: '0 0 60px rgba(245, 158, 11, 0.25)', position: 'relative', overflow: 'hidden' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #f59e0b, transparent)' }} />
            <div className="flex items-baseline justify-center gap-2">
              <span style={{ fontSize: '80px', fontWeight: '900', fontFamily: 'Fraunces, serif', color: '#f59e0b', lineHeight: 1 }}><AnimatedCounter value={data.stat} duration={2500} /></span>
              <span style={{ fontSize: '48px', fontWeight: '700', color: '#f59e0b' }}>{data.suffix}</span>
            </div>
            <p className="text-neutral-300 text-xl text-center mt-2">{data.subtext}</p>
            <div className="flex items-center justify-center gap-4 mt-6">
              <div style={{ color: '#f59e0b' }}><Icons.Brain /></div>
              <div style={{ color: '#f59e0b' }}><Icons.Zap /></div>
            </div>
          </motion.div>
          <AnimatePresence>
            {showInsight && (
              <motion.p initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="text-neutral-500 text-center max-w-md mt-8 leading-relaxed">{data.insight}</motion.p>
            )}
          </AnimatePresence>
        </div>
      );
    };

    // 3. Canon Detail Slide - Individual canon with before/after
    const CanonDetailSlide = ({ data }) => {
      const [showAfter, setShowAfter] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowAfter(true), 1800);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 py-8">
          <div className="max-w-3xl mx-auto w-full">
            <motion.div initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} className="flex items-center gap-3 mb-4">
              <div style={{ width: '40px', height: '40px', borderRadius: '10px', background: `linear-gradient(135deg, ${data.canon.color}, ${data.canon.color}99)`, display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontWeight: 'bold' }}>{data.canon.num}</div>
              <span style={{ color: data.canon.color, fontSize: '12px', fontWeight: '600', textTransform: 'uppercase', letterSpacing: '0.1em' }}>Canon {data.canon.num}</span>
            </motion.div>
            <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-2xl md:text-3xl text-black mb-4">{data.canon.title}</motion.h2>
            <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-neutral-600 leading-relaxed mb-8">{data.description}</motion.p>
            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
              <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.4 }} style={{ background: '#fef2f2', border: '2px solid #fecaca', borderRadius: '16px', padding: '20px' }}>
                <div className="flex items-center gap-2 mb-3">
                  <div style={{ color: '#ef4444' }}><Icons.XCircle /></div>
                  <span style={{ color: '#ef4444', fontSize: '12px', fontWeight: '600', textTransform: 'uppercase' }}>{data.before.label}</span>
                </div>
                <p className="text-neutral-600 italic">"{data.before.text}"</p>
              </motion.div>
              <AnimatePresence>
                {showAfter && (
                  <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '20px', position: 'relative', boxShadow: `0 0 30px ${data.canon.color}40` }}>
                    <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: `linear-gradient(90deg, transparent, ${data.canon.color}, transparent)`, borderRadius: '16px 16px 0 0' }} />
                    <div className="flex items-center gap-2 mb-3">
                      <div style={{ color: data.canon.color }}><Icons.CheckCircle /></div>
                      <span style={{ color: data.canon.color, fontSize: '12px', fontWeight: '600', textTransform: 'uppercase' }}>{data.after.label}</span>
                    </div>
                    <p className="text-white italic">"{data.after.text}"</p>
                    <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }} transition={{ delay: 0.5 }} style={{ position: 'absolute', top: '-10px', right: '-10px', background: data.canon.color, color: 'white', padding: '4px 12px', borderRadius: '12px', fontSize: '11px', fontWeight: '700' }}>WINS</motion.div>
                  </motion.div>
                )}
              </AnimatePresence>
            </div>
          </div>
        </div>
      );
    };

    // 4. Copy Battle Slide - Generic vs Specific with analysis
    const CopyBattleSlide = ({ data }) => {
      const [showWinner, setShowWinner] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowWinner(true), 2000);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto w-full">
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} style={{ background: '#f5f5f5', borderRadius: '16px', padding: '24px', border: '2px solid #e5e5e5' }}>
              <div className="flex items-center gap-2 mb-4">
                <div style={{ color: '#ef4444' }}><Icons.XCircle /></div>
                <span style={{ color: '#ef4444', fontSize: '12px', fontWeight: '600', textTransform: 'uppercase' }}>Fails All Three</span>
              </div>
              <p className="text-neutral-600 italic mb-6">{data.genericCopy}</p>
              <div className="space-y-2">
                {data.genericFails.map((fail, i) => (
                  <div key={i} className="flex items-center gap-2">
                    <div style={{ width: '6px', height: '6px', borderRadius: '50%', background: '#ef4444' }} />
                    <span className="text-neutral-500 text-sm">{fail}</span>
                  </div>
                ))}
              </div>
            </motion.div>
            <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.4 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', boxShadow: showWinner ? '0 0 40px rgba(16, 185, 129, 0.3)' : 'none', transition: 'box-shadow 0.3s' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #10b981, transparent)', borderRadius: '16px 16px 0 0' }} />
              <div className="flex items-center gap-2 mb-4">
                <div style={{ color: '#10b981' }}><Icons.CheckCircle /></div>
                <span style={{ color: '#10b981', fontSize: '12px', fontWeight: '600', textTransform: 'uppercase' }}>Passes All Three</span>
              </div>
              <p className="text-white italic mb-6">{data.specificCopy}</p>
              <div className="space-y-2">
                {data.specificWins.map((win, i) => (
                  <div key={i} className="flex items-center gap-2">
                    <div style={{ width: '6px', height: '6px', borderRadius: '50%', background: '#10b981' }} />
                    <span className="text-neutral-300 text-sm">{win}</span>
                  </div>
                ))}
              </div>
              {showWinner && (
                <motion.div initial={{ scale: 0, rotate: -10 }} animate={{ scale: 1, rotate: 0 }} style={{ position: 'absolute', top: '-12px', right: '-12px', background: 'linear-gradient(135deg, #10b981, #059669)', color: 'white', padding: '6px 14px', borderRadius: '12px', fontSize: '12px', fontWeight: '700', boxShadow: '0 4px 12px rgba(16, 185, 129, 0.4)' }}>WINNER</motion.div>
              )}
            </motion.div>
          </div>
        </div>
      );
    };

    // 5. Ownership Test Slide - Swap test visualization
    const OwnershipTestSlide = ({ data }) => {
      const [showResult, setShowResult] = useState(false);
      useEffect(() => {
        const timer = setTimeout(() => setShowResult(true), 1500);
        return () => clearTimeout(timer);
      }, []);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-4">{data.title}</motion.h2>
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-500 text-center mb-8">{data.testQuestion}</motion.p>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-3xl mx-auto w-full">
            <motion.div initial={{ opacity: 0, x: -20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 }} style={{ background: '#fef2f2', borderRadius: '16px', padding: '24px', border: '2px solid #fecaca', position: 'relative' }}>
              <div style={{ background: '#ef4444', color: 'white', padding: '4px 12px', borderRadius: '8px', fontSize: '12px', fontWeight: '600', display: 'inline-block', marginBottom: '12px' }}>{data.badExample.brand}</div>
              <p className="text-neutral-600 italic mb-4">"{data.badExample.copy}"</p>
              {showResult && (
                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="flex items-center gap-2 pt-3 border-t border-red-200">
                  <div style={{ color: '#ef4444' }}><Icons.XCircle /></div>
                  <span style={{ color: '#ef4444', fontWeight: '600', textTransform: 'uppercase', fontSize: '12px' }}>Anyone could say this</span>
                </motion.div>
              )}
            </motion.div>
            <motion.div initial={{ opacity: 0, x: 20 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.5 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', boxShadow: '0 0 30px rgba(139, 92, 246, 0.25)' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #8b5cf6, transparent)', borderRadius: '16px 16px 0 0' }} />
              <div style={{ background: '#8b5cf6', color: 'white', padding: '4px 12px', borderRadius: '8px', fontSize: '12px', fontWeight: '600', display: 'inline-block', marginBottom: '12px' }}>{data.goodExample.brand}</div>
              <p className="text-white italic mb-4">"{data.goodExample.copy}"</p>
              {showResult && (
                <motion.div initial={{ opacity: 0 }} animate={{ opacity: 1 }} className="flex items-center gap-2 pt-3 border-t border-neutral-700">
                  <div style={{ color: '#8b5cf6' }}><Icons.Fingerprint /></div>
                  <span style={{ color: '#8b5cf6', fontWeight: '600', textTransform: 'uppercase', fontSize: '12px' }}>Only they can claim this</span>
                </motion.div>
              )}
            </motion.div>
          </div>
        </div>
      );
    };

    // 6. Three Filter Slide - 3 checkboxes visualization
    const ThreeFilterSlide = ({ data }) => {
      const [checkedItems, setCheckedItems] = useState([false, false, false]);
      useEffect(() => {
        const timers = data.questions.map((_, i) =>
          setTimeout(() => setCheckedItems(prev => { const next = [...prev]; next[i] = true; return next; }), 800 + i * 600)
        );
        return () => timers.forEach(clearTimeout);
      }, [data.questions]);

      const colors = ['#f59e0b', '#10b981', '#8b5cf6'];

      return (
        <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 py-8">
          <motion.p initial={{ opacity: 0, y: 10 }} animate={{ opacity: 1, y: 0 }} className="text-neutral-400 text-sm text-center mb-2">{data.subtitle}</motion.p>
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} transition={{ delay: 0.2 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '32px', boxShadow: '0 0 50px rgba(0,0,0,0.2)', position: 'relative', maxWidth: '400px', width: '100%' }}>
            <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, #f59e0b, #10b981, #8b5cf6)', borderRadius: '24px 24px 0 0' }} />
            <div className="space-y-4">
              {data.questions.map((q, i) => (
                <motion.div key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3 + i * 0.1 }} className="flex items-center gap-4" style={{ padding: '12px', borderRadius: '12px', background: checkedItems[i] ? `${colors[i]}15` : 'transparent', transition: 'background 0.3s' }}>
                  <div style={{ width: '28px', height: '28px', borderRadius: '8px', border: `2px solid ${checkedItems[i] ? colors[i] : '#555'}`, display: 'flex', alignItems: 'center', justifyContent: 'center', background: checkedItems[i] ? colors[i] : 'transparent', transition: 'all 0.3s' }}>
                    {checkedItems[i] && <motion.div initial={{ scale: 0 }} animate={{ scale: 1 }}><Icons.Check /></motion.div>}
                  </div>
                  <span className="text-white font-medium">{q}</span>
                </motion.div>
              ))}
            </div>
          </motion.div>
          <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 1 }} className="flex items-center gap-2 mt-8">
            <div style={{ color: '#f59e0b' }}><Icons.AlertTriangle /></div>
            <span className="text-neutral-500 text-sm">{data.warning}</span>
          </motion.div>
        </div>
      );
    };

    // 7. Brand Examples Slide
    const BrandExamplesSlide = ({ data }) => {
      const [activeIndex, setActiveIndex] = useState(0);
      useEffect(() => {
        const timer = setInterval(() => {
          setActiveIndex(prev => (prev + 1) % data.brands.length);
        }, 3000);
        return () => clearInterval(timer);
      }, [data.brands.length]);

      return (
        <div className="h-full flex flex-col justify-center px-6 md:px-12 py-8">
          <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-8">{data.title}</motion.h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-4 max-w-4xl mx-auto w-full">
            {data.brands.map((brand, i) => (
              <motion.div key={brand.name} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.1 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '16px', padding: '24px', position: 'relative', boxShadow: i === activeIndex ? '0 0 40px rgba(245, 158, 11, 0.3)' : 'none', transition: 'box-shadow 0.3s' }}>
                <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: i === activeIndex ? 'linear-gradient(90deg, transparent, #f59e0b, transparent)' : 'transparent', borderRadius: '16px 16px 0 0', transition: 'background 0.3s' }} />
                <h3 className="text-white font-bold text-lg mb-3">{brand.name}</h3>
                <p className="text-neutral-300 italic text-sm mb-4">"{brand.copy}"</p>
                <div className="flex items-center gap-2">
                  <div style={{ color: '#10b981' }}><Icons.CheckCircle /></div>
                  <span className="text-neutral-400 text-xs">{brand.analysis}</span>
                </div>
              </motion.div>
            ))}
          </div>
        </div>
      );
    };

    // 8. Impact Stats Slide
    const ImpactStatsSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 py-8">
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="slide-title text-2xl md:text-3xl text-black text-center mb-10">{data.title}</motion.h2>
        <div className="grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl w-full">
          {data.stats.map((stat, i) => (
            <motion.div key={i} initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 + i * 0.15 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '20px', padding: '32px', textAlign: 'center', position: 'relative', boxShadow: '0 0 30px rgba(245, 158, 11, 0.15)' }}>
              <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '3px', background: 'linear-gradient(90deg, transparent, #f59e0b, transparent)', borderRadius: '20px 20px 0 0' }} />
              <div style={{ fontSize: '48px', fontWeight: '900', fontFamily: 'Fraunces, serif', color: '#f59e0b', lineHeight: 1 }}><AnimatedCounter value={stat.value} suffix={stat.suffix} duration={2000} /></div>
              <p className="text-white font-semibold mt-2">{stat.label}</p>
              <p className="text-neutral-400 text-sm mt-1">{stat.desc}</p>
            </motion.div>
          ))}
        </div>
      </div>
    );

    // 9. Elite Insight Slide
    const EliteInsightSlide = ({ data }) => (
      <div className="h-full flex flex-col justify-center items-center px-6 md:px-12 py-8">
        <motion.div initial={{ opacity: 0, scale: 0.95 }} animate={{ opacity: 1, scale: 1 }} style={{ background: 'linear-gradient(135deg, #1a1a1a, #2d2d2d)', borderRadius: '24px', padding: '40px', maxWidth: '600px', width: '100%', position: 'relative', boxShadow: '0 0 60px rgba(245, 158, 11, 0.2)' }}>
          <div style={{ position: 'absolute', top: 0, left: 0, right: 0, height: '4px', background: 'linear-gradient(90deg, transparent, #f59e0b, transparent)', borderRadius: '24px 24px 0 0' }} />
          <div className="flex justify-center mb-6">
            <div style={{ width: '56px', height: '56px', borderRadius: '16px', background: 'linear-gradient(135deg, #f59e0b, #d97706)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white' }}><Icons.Quote /></div>
          </div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="text-white text-xl md:text-2xl text-center leading-relaxed mb-4">"{data.quote}"</motion.p>
          <motion.p initial={{ opacity: 0 }} animate={{ opacity: 1 }} transition={{ delay: 0.4 }} style={{ color: '#f59e0b' }} className="text-center font-semibold">â€” {data.author}</motion.p>
          <motion.div initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.6 }} className="mt-8 pt-6 border-t border-neutral-700">
            <p className="text-neutral-400 text-xs uppercase tracking-wider mb-4 text-center">Your Action Items</p>
            <div className="space-y-3">
              {data.actions.map((action, i) => (
                <div key={i} className="flex items-center gap-3">
                  <div style={{ width: '24px', height: '24px', borderRadius: '6px', background: 'linear-gradient(135deg, #f59e0b, #d97706)', display: 'flex', alignItems: 'center', justifyContent: 'center', color: 'white', fontSize: '12px', fontWeight: '700' }}>{i + 1}</div>
                  <span className="text-neutral-300 text-sm">{action}</span>
                </div>
              ))}
            </div>
          </motion.div>
        </motion.div>
      </div>
    );

    // ============================================
    // STANDARD SLIDE COMPONENTS
    // ============================================

    const WelcomeSlide = ({ data, onStart, userName, onShowGif, onHideGif }) => {
      const welcomeData = useMemo(() => getTimeBasedWelcome(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      useEffect(() => { onShowGif(welcomeData.gif, '65%', gifSide); return () => onHideGif(); }, [welcomeData.gif, gifSide, onShowGif, onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col items-center justify-center text-center px-6 py-4 relative z-20">
            <motion.h1 initial={{ opacity: 0, y: 20 }} animate={{ opacity: 1, y: 0 }} className="title-font text-3xl sm:text-4xl md:text-5xl lg:text-6xl text-black mb-2 md:mb-3">{LESSON_CONFIG.title}</motion.h1>
            <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.1 }} className="text-neutral-600 text-base md:text-lg lg:text-xl mb-2 md:mb-3 max-w-lg leading-relaxed" dangerouslySetInnerHTML={{ __html: formatGreeting(welcomeData.greeting, `<span class="font-bold text-neutral-900">${userName}</span>`) }} />
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="flex items-center justify-center gap-1.5 text-neutral-400 text-[10px] md:text-xs mb-2 md:mb-3"><Icons.Clock /><span>{LESSON_CONFIG.duration}</span></motion.div>
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.2 }} className="bg-neutral-900 rounded-xl md:rounded-2xl p-3 md:p-5 mb-3 md:mb-4 max-w-sm w-full mx-auto">
              <p className="text-neutral-500 text-[9px] md:text-[11px] uppercase tracking-wider mb-2 md:mb-3">In this lesson</p>
              <ul className="space-y-1.5 md:space-y-2">
                {data.learningGoals.map((goal, i) => (
                  <motion.li key={i} initial={{ opacity: 0, x: -10 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.25 + i * 0.05 }} className="flex items-start gap-2 text-left">
                    <span className="w-5 h-5 rounded-md flex items-center justify-center text-[9px] font-bold text-white flex-shrink-0 mt-0.5" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>{i + 1}</span>
                    <span className="text-neutral-300 text-[11px] md:text-sm leading-snug">{goal}</span>
                  </motion.li>
                ))}
              </ul>
            </motion.div>
            <motion.button initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.45 }} onClick={onStart} whileHover={{ scale: 1.02 }} whileTap={{ scale: 0.98 }} className="px-6 md:px-7 py-2.5 md:py-3 rounded-xl text-white font-semibold text-sm md:text-base" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))` }}>Let's Go</motion.button>
          </div>
        </div>
      );
    };

    const HookSlide = ({ data }) => (
      <div className="h-full relative overflow-hidden">
        <div className="h-full flex flex-col justify-center px-6 md:px-16 max-w-3xl mx-auto slide-scroll overflow-y-auto py-8 md:py-10 relative z-10">
          <motion.div initial={{ opacity: 0, y: 40 }} animate={{ opacity: 1, y: 0 }} className="mb-4 md:mb-6">
            <span className="inline-block px-3 py-1 rounded-full text-xs font-semibold mb-3 md:mb-4" style={{ background: `rgba(var(--accent-rgb), 0.1)`, color: 'var(--accent)' }}>The Hook</span>
            <h2 className="slide-title text-2xl md:text-4xl lg:text-5xl text-black leading-tight">{data.headline}</h2>
          </motion.div>
          <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="text-base md:text-xl text-neutral-600 leading-relaxed">{data.subtext}</motion.p>
        </div>
        {data.brandImage && (
          <motion.div initial={{ opacity: 0, x: 30 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.3, duration: 0.5 }} className="absolute bottom-0 right-0 z-0 pointer-events-none hidden md:block" style={{ height: '30%', maxHeight: '200px', marginRight: '80px', marginBottom: '5%' }}>
            <img src={data.brandImage} alt={data.brandName || ''} className="h-full w-auto object-contain" style={{ opacity: 1 }} />
          </motion.div>
        )}
      </div>
    );

    const QuizSlide = ({ data, onShowGif, onHideGif }) => {
      const [selected, setSelected] = useState(null);
      const [showFeedback, setShowFeedback] = useState(false);
      const celebrationGif = useMemo(() => getRandomCelebrationGif(), []);
      const empathyGif = useMemo(() => getRandomEmpathyGif(), []);
      const gifSide = useMemo(() => Math.random() > 0.5 ? 'left' : 'right', []);
      const handleSelect = (index) => { if (showFeedback) return; setSelected(index); setShowFeedback(true); };
      const isCorrect = selected === data.correctIndex;

      useEffect(() => { if (showFeedback) onShowGif(isCorrect ? celebrationGif : empathyGif, '60%', gifSide); }, [showFeedback, isCorrect, celebrationGif, empathyGif, gifSide, onShowGif]);
      useEffect(() => { return () => onHideGif(); }, [onHideGif]);

      return (
        <div className="h-full w-full relative overflow-hidden">
          <div className="h-full flex flex-col justify-center px-8 md:px-12 max-w-2xl mx-auto slide-scroll overflow-y-auto py-10 relative z-30">
            <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className="text-center mb-6">
              <p className="text-xs uppercase tracking-wider text-neutral-400 mb-3">Quick Check</p>
              <h2 className="slide-title text-xl md:text-2xl text-black leading-tight">{data.question}</h2>
            </motion.div>
            <div className="space-y-3 mb-6">
              {data.options.map((option, i) => (
                <motion.button key={i} initial={{ opacity: 0, x: -15 }} animate={{ opacity: 1, x: 0 }} transition={{ delay: 0.08 + i * 0.06 }} onClick={() => handleSelect(i)} disabled={showFeedback} className={`w-full p-4 rounded-xl text-left transition-all border-2 ${showFeedback ? i === data.correctIndex ? 'border-green-500 bg-green-50' : i === selected ? 'border-red-400 bg-red-50' : 'border-neutral-200 bg-white opacity-40' : 'border-neutral-200 bg-white hover:border-neutral-300'}`}>
                  <div className="flex items-center gap-3">
                    <span className={`w-8 h-8 rounded-lg flex items-center justify-center text-sm font-bold transition-all ${showFeedback && i === data.correctIndex ? 'bg-green-500 text-white' : showFeedback && i === selected && !isCorrect ? 'bg-red-400 text-white' : 'bg-neutral-100 text-neutral-500'}`}>{showFeedback && i === data.correctIndex ? <Icons.Check /> : showFeedback && i === selected && !isCorrect ? <Icons.X /> : String.fromCharCode(65 + i)}</span>
                    <span className="text-neutral-700 text-base">{option}</span>
                  </div>
                </motion.button>
              ))}
            </div>
            <AnimatePresence>
              {showFeedback && (
                <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} className={`p-5 rounded-xl ${isCorrect ? 'bg-green-50 border border-green-200' : 'bg-amber-50 border border-amber-200'}`}>
                  <p className={`text-sm leading-relaxed ${isCorrect ? 'text-green-800' : 'text-amber-800'}`}>{isCorrect ? data.feedback.correct : data.feedback.incorrect}</p>
                </motion.div>
              )}
            </AnimatePresence>
          </div>
        </div>
      );
    };

    const CompletionSlide = () => (
      <div className="h-full flex flex-col items-center justify-center text-center px-8 slide-scroll overflow-y-auto py-10">
        <motion.div initial={{ opacity: 0, scale: 0 }} animate={{ opacity: 1, scale: 1 }} transition={{ type: 'spring', duration: 0.5 }} className="w-20 h-20 rounded-xl flex items-center justify-center mb-6 text-white" style={{ background: `linear-gradient(135deg, var(--accent), var(--accent-dark))`, boxShadow: `0 6px 24px rgba(var(--accent-rgb), 0.35)` }}><Icons.Check /></motion.div>
        <motion.h2 initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.15 }} className="slide-title text-3xl md:text-4xl text-black mb-4">Lesson Complete</motion.h2>
        <motion.p initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.25 }} className="text-neutral-500 text-base mb-8 max-w-md leading-relaxed">You now have the filter that separates pros from amateurs. Three questions. Every sentence. No exceptions.</motion.p>
        <motion.div initial={{ opacity: 0, y: 15 }} animate={{ opacity: 1, y: 0 }} transition={{ delay: 0.35 }} className="bg-neutral-900 rounded-xl p-6 max-w-md w-full">
          <p className="text-neutral-500 text-xs uppercase tracking-wider mb-3">Up Next</p>
          <h3 className="text-white font-bold text-xl mb-2">{LESSON_CONFIG.nextLesson.title}</h3>
          <p className="text-neutral-400 text-sm">{LESSON_CONFIG.nextLesson.teaser}</p>
        </motion.div>
      </div>
    );

    // ============================================
    // MAIN APP
    // ============================================
    const App = () => {
      const [currentSlide, setCurrentSlide] = useState(0);
      const [direction, setDirection] = useState(0);
      const userName = useMemo(() => getUserName(), []);
      const currentSlideRef = React.useRef(0);
      const [gifConfig, setGifConfig] = useState(null);
      const [isAnimating, setIsAnimating] = useState(false);

      const showGif = useCallback((url, height, side) => setGifConfig({ url, height, side }), []);
      const hideGif = useCallback(() => setGifConfig(null), []);

      React.useEffect(() => { currentSlideRef.current = currentSlide; }, [currentSlide]);

      useEffect(() => {
        window.parent.postMessage({ type: 'LESSON_SLIDE_UPDATE',
          totalSlides: slides.length, slideIndex: currentSlide, slideType: slides[currentSlide]?.type, lessonSlug: LESSON_CONFIG.id }, '*');
      }, [currentSlide]);

      const goToSlide = useCallback((newSlide) => {
        if (isAnimating || newSlide < 0 || newSlide >= slides.length) return;
        setIsAnimating(true);
        setDirection(newSlide > currentSlideRef.current ? 1 : -1);
        setCurrentSlide(newSlide);
      }, [isAnimating]);

      const nextSlide = useCallback(() => { if (currentSlideRef.current + 1 < slides.length) goToSlide(currentSlideRef.current + 1); }, [goToSlide]);
      const prevSlide = useCallback(() => { if (currentSlideRef.current - 1 >= 0) goToSlide(currentSlideRef.current - 1); }, [goToSlide]);

      useEffect(() => {
        const handleKeyDown = (e) => {
          if (e.key === 'ArrowRight' || e.key === ' ') { e.preventDefault(); nextSlide(); }
          if (e.key === 'ArrowLeft') { e.preventDefault(); prevSlide(); }
        };
        window.addEventListener('keydown', handleKeyDown);
        return () => window.removeEventListener('keydown', handleKeyDown);
      }, [nextSlide, prevSlide]);

      const slideVariants = { enter: (dir) => ({ x: dir > 0 ? '100%' : '-100%', opacity: 0 }), center: { x: 0, opacity: 1 }, exit: (dir) => ({ x: dir > 0 ? '-100%' : '100%', opacity: 0 }) };

      const renderSlide = (slide) => {
        switch (slide.type) {
          case 'welcome': return <WelcomeSlide data={slide} onStart={nextSlide} userName={userName} onShowGif={showGif} onHideGif={hideGif} />;
          case 'hook': return <HookSlide data={slide} />;
          case 'canon-reveal': return <CanonRevealSlide data={slide} />;
          case 'brain-speed': return <BrainSpeedSlide data={slide} />;
          case 'canon-detail': return <CanonDetailSlide data={slide} />;
          case 'copy-battle': return <CopyBattleSlide data={slide} />;
          case 'ownership-test': return <OwnershipTestSlide data={slide} />;
          case 'three-filter': return <ThreeFilterSlide data={slide} />;
          case 'brand-examples': return <BrandExamplesSlide data={slide} />;
          case 'impact-stats': return <ImpactStatsSlide data={slide} />;
          case 'elite-insight': return <EliteInsightSlide data={slide} />;
          case 'quiz': return <QuizSlide data={slide} onShowGif={showGif} onHideGif={hideGif} />;
          case 'completion': return <CompletionSlide />;
          default: return null;
        }
      };

      const showPrev = currentSlide > 0;
      const showNext = currentSlide < slides.length - 1 && slides[currentSlide].type !== 'welcome';

      return (
        <div className="w-full h-screen bg-white flex flex-col relative">
          <div className="flex-1 relative overflow-hidden z-20">
            <AnimatePresence mode="wait" custom={direction} onExitComplete={() => setIsAnimating(false)}>
              <motion.div key={currentSlide} custom={direction} variants={slideVariants} initial="enter" animate="center" exit="exit" transition={{ duration: 0.3, ease: [0.25, 0.1, 0.25, 1] }} className="absolute inset-0">
                {renderSlide(slides[currentSlide])}
                <AdminSlideReportButton slideIndex={currentSlide} slideType={slides[currentSlide].type} />
              </motion.div>
            </AnimatePresence>
            {showPrev && <button onClick={prevSlide} className="absolute left-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowLeft /></button>}
            {showNext && <button onClick={nextSlide} className="absolute right-5 top-1/2 -translate-y-1/2 w-12 h-12 rounded-full bg-neutral-100 hover:bg-neutral-200 flex items-center justify-center text-neutral-500 hover:text-neutral-700 transition-all z-10"><Icons.ArrowRight /></button>}
          </div>
          <div className="px-6 md:px-8 py-5 border-t border-neutral-100 flex-shrink-0 relative z-10">
            <div className="flex items-center justify-center gap-2.5">
              {slides.map((_, i) => <button key={i} onClick={() => goToSlide(i)} className="w-2.5 h-2.5 rounded-full transition-all duration-300" style={{ background: i === currentSlide ? 'var(--accent)' : '#d4d4d4', transform: i === currentSlide ? 'scale(1.3)' : 'scale(1)' }} />)}
            </div>
          </div>
          <AnimatePresence>
            {gifConfig && (
              <motion.div initial={{ opacity: 0, y: 30 }} animate={{ opacity: 1, y: 0 }} exit={{ opacity: 0, y: 30 }} transition={{ type: 'spring', stiffness: 100 }} className={`absolute ${gifConfig.side === 'left' ? 'left-4 md:left-8' : 'right-4 md:right-8'} bottom-0 pointer-events-none`} style={{ zIndex: 15, height: gifConfig.height }}>
                <video autoPlay loop muted playsInline className="h-full w-auto object-contain object-bottom" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}><source src={gifConfig.url} type="video/mp4" /></video>
              </motion.div>
            )}
          </AnimatePresence>
        </div>
      );
    };

    ReactDOM.createRoot(document.getElementById('root')).render(<App />);
  </script>
</body>
</html>
