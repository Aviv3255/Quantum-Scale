# ğŸš€ Quantum Scale - ULTIMATE QA Pipeline
# ××›×•× ×ª ×‘×“×™×§×•×ª ××•×˜×•× ×•××™×ª ×©×œ× ×¢×•×¦×¨×ª ×¢×“ ×©××•×©×œ×
# Zero bugs, Zero UI issues, Zero problems!

name: Ultimate QA Pipeline

on:
  push:
    branches: [main, master, develop]
  pull_request:
    branches: [main, master, develop]

env:
  NODE_VERSION: '20'
  NEXT_TELEMETRY_DISABLED: 1

# ğŸ”§ ×”×’×“×¨×” ×’×œ×•×‘×œ×™×ª - ×›×œ ×”×¤×§×•×“×•×ª ×¨×¦×•×ª ××ª×™×§×™×™×ª genrok-app
defaults:
  run:
    working-directory: genrok-app

jobs:
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“¦ ×©×œ×‘ 0: ×”×ª×§× ×” ×•×”×›× ×”
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  setup:
    name: ğŸ“¦ Setup & Install
    runs-on: ubuntu-latest
    outputs:
      cache-key: ${{ steps.cache-key.outputs.key }}

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ”‘ Generate cache key
        id: cache-key
        run: echo "key=${{ runner.os }}-node-${{ hashFiles('genrok-app/package-lock.json') }}" >> $GITHUB_OUTPUT

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ’¾ Cache node_modules
        uses: actions/cache@v4
        with:
          path: |
            genrok-app/node_modules
            ~/.npm
          key: ${{ steps.cache-key.outputs.key }}
          restore-keys: |
            ${{ runner.os }}-node-

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ”§ ×©×œ×‘ 1: ×‘×“×™×§×•×ª ×§×•×“ ×¡×˜×˜×™×•×ª
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  code-quality:
    name: ğŸ”§ Code Quality
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Restore cache
        uses: actions/cache@v4
        with:
          path: |
            genrok-app/node_modules
            ~/.npm
          key: ${{ runner.os }}-node-${{ hashFiles('genrok-app/package-lock.json') }}
          restore-keys: |
            ${{ runner.os }}-node-

      - name: ğŸ“š Install dependencies
        run: npm ci

      # ESLint - ×‘×“×™×§×ª ×¡×’× ×•×Ÿ ×•×˜×¢×•×™×•×ª
      - name: ğŸ” ESLint - Code Style & Errors
        id: eslint
        run: |
          npm run lint 2>&1 | tee eslint-output.txt || echo "lint_failed=true" >> $GITHUB_OUTPUT
          echo "## ğŸ” ESLint Results" >> $GITHUB_STEP_SUMMARY
          cat eslint-output.txt >> $GITHUB_STEP_SUMMARY || echo "No issues found" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      # TypeScript - ×‘×“×™×§×ª types
      - name: ğŸ“˜ TypeScript - Type Checking
        id: typescript
        run: |
          npm run type-check 2>&1 | tee typescript-output.txt || echo "ts_failed=true" >> $GITHUB_OUTPUT
          echo "## ğŸ“˜ TypeScript Results" >> $GITHUB_STEP_SUMMARY
          cat typescript-output.txt >> $GITHUB_STEP_SUMMARY || echo "No type errors" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      # Prettier - ×‘×“×™×§×ª ×¤×•×¨××˜
      - name: âœ¨ Prettier - Code Formatting
        run: |
          npm run format:check 2>&1 | tee prettier-output.txt || true
          echo "## âœ¨ Prettier Results" >> $GITHUB_STEP_SUMMARY
          cat prettier-output.txt >> $GITHUB_STEP_SUMMARY || echo "All files formatted" >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      # Build - ×œ×•×•×“× ×©×”×¤×¨×•×™×§×˜ ×‘×•× ×”
      - name: ğŸ—ï¸ Build Project
        run: npm run build

      # ×©××™×¨×ª artifacts
      - name: ğŸ’¾ Save build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: build-output
          path: |
            genrok-app/.next
            genrok-app/out
          retention-days: 1

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§ª ×©×œ×‘ 2: ×‘×“×™×§×•×ª E2E ×¢× Playwright
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  e2e-tests:
    name: ğŸ§ª E2E Tests (Playwright)
    runs-on: ubuntu-latest
    needs: code-quality

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ­ Install Playwright browsers
        run: npx playwright install --with-deps chromium firefox webkit

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸ§ª Run Playwright tests
        run: |
          npm run test:e2e -- --reporter=html 2>&1 | tee playwright-output.txt || true
          echo "## ğŸ§ª E2E Test Results" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          tail -50 playwright-output.txt >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      - name: ğŸ“Š Upload Playwright report
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: playwright-report
          path: genrok-app/playwright-report/
          retention-days: 30

      - name: ğŸ“¸ Upload test screenshots
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: test-screenshots
          path: genrok-app/test-results/
          retention-days: 7

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ‘ï¸ ×©×œ×‘ 3: ×‘×“×™×§×•×ª ×•×™×–×•××œ×™×•×ª ×¢× Percy
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  visual-tests:
    name: ğŸ‘ï¸ Visual Tests (Percy)
    runs-on: ubuntu-latest
    needs: code-quality
    # ×™×¨×•×¥ ×¢×œ ×›×œ push ×•-PR - ×œ×œ× ×ª× ××™ ××’×‘×™×œ

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ­ Install Playwright for Percy
        run: npx playwright install chromium

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸš€ Start server
        run: npm run start &
        env:
          PORT: 3000

      - name: â³ Wait for server
        run: npx wait-on http://localhost:3000 --timeout 60000

      - name: ğŸ‘ï¸ Percy Visual Snapshots
        run: |
          if [ -n "$PERCY_TOKEN" ]; then
            echo "## ğŸ‘ï¸ Percy Visual Testing" >> $GITHUB_STEP_SUMMARY

            # ×¦×œ× ××¡×¤×¨ ×“×¤×™× ×—×©×•×‘×™×
            cat << 'EOF' > percy-snapshot.js
            const { chromium } = require('playwright');
            const percySnapshot = require('@percy/playwright');

            const pages = [
              { path: '/', name: 'Homepage' },
              { path: '/login', name: 'Login' },
              { path: '/signup', name: 'Signup' },
              { path: '/courses', name: 'Courses' },
              { path: '/dashboard', name: 'Dashboard' },
              { path: '/onboarding', name: 'Onboarding' },
            ];

            (async () => {
              const browser = await chromium.launch();
              const page = await browser.newPage();

              for (const p of pages) {
                try {
                  await page.goto('http://localhost:3000' + p.path, { waitUntil: 'networkidle', timeout: 30000 });
                  await percySnapshot(page, p.name);
                  console.log('âœ… Captured: ' + p.name);
                } catch (e) {
                  console.log('âš ï¸ Skipped: ' + p.name + ' - ' + e.message);
                }
              }

              await browser.close();
            })();
            EOF

            npx percy exec -- node percy-snapshot.js || echo "Percy completed with warnings"
            echo "âœ… Percy snapshots captured and uploaded" >> $GITHUB_STEP_SUMMARY
            echo "View results at: https://percy.io" >> $GITHUB_STEP_SUMMARY
          else
            echo "## ğŸ‘ï¸ Percy" >> $GITHUB_STEP_SUMMARY
            echo "âš ï¸ PERCY_TOKEN not configured. Add it to repository secrets to enable visual testing." >> $GITHUB_STEP_SUMMARY
          fi
        env:
          PERCY_TOKEN: ${{ secrets.PERCY_TOKEN }}
        continue-on-error: true

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # âš¡ ×©×œ×‘ 4: ×‘×“×™×§×•×ª ×‘×™×¦×•×¢×™× ×¢× Lighthouse
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  performance-tests:
    name: âš¡ Performance (Lighthouse)
    runs-on: ubuntu-latest
    needs: code-quality

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸš€ Start server
        run: npm run start &
        env:
          PORT: 3000

      - name: â³ Wait for server
        run: npx wait-on http://localhost:3000 --timeout 60000

      - name: âš¡ Run Lighthouse CI
        uses: treosh/lighthouse-ci-action@v11
        with:
          urls: |
            http://localhost:3000
            http://localhost:3000/login
            http://localhost:3000/courses
          configPath: genrok-app/lighthouserc.json
          uploadArtifacts: true
          temporaryPublicStorage: true
        continue-on-error: true

      - name: ğŸ“Š Lighthouse Summary
        run: |
          echo "## âš¡ Lighthouse Performance" >> $GITHUB_STEP_SUMMARY
          echo "Check artifacts for detailed Lighthouse reports" >> $GITHUB_STEP_SUMMARY

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # â™¿ ×©×œ×‘ 5: ×‘×“×™×§×•×ª × ×’×™×©×•×ª (Accessibility)
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  accessibility-tests:
    name: â™¿ Accessibility (a11y)
    runs-on: ubuntu-latest
    needs: code-quality

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸš€ Start server
        run: npm run start &
        env:
          PORT: 3000

      - name: â³ Wait for server
        run: npx wait-on http://localhost:3000 --timeout 60000

      - name: â™¿ Run axe accessibility tests
        run: |
          echo "## â™¿ Accessibility Report" >> $GITHUB_STEP_SUMMARY
          npx @axe-core/cli http://localhost:3000 --exit 2>&1 | tee axe-output.txt || true
          echo '```' >> $GITHUB_STEP_SUMMARY
          cat axe-output.txt >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ”’ ×©×œ×‘ 6: ×‘×“×™×§×•×ª ××‘×˜×—×”
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  security-tests:
    name: ğŸ”’ Security Scan
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      # Snyk - ×¡×¨×™×§×ª ×¤×’×™×¢×•×™×•×ª
      - name: ğŸ”’ Snyk Security Scan
        if: ${{ secrets.SNYK_TOKEN != '' }}
        uses: snyk/actions/node@master
        continue-on-error: true
        env:
          SNYK_TOKEN: ${{ secrets.SNYK_TOKEN }}
        with:
          args: --severity-threshold=high
          command: test

      # npm audit
      - name: ğŸ” npm audit
        run: |
          echo "## ğŸ”’ Security Audit" >> $GITHUB_STEP_SUMMARY
          npm audit --audit-level=moderate 2>&1 | tee audit-output.txt || true
          echo '```' >> $GITHUB_STEP_SUMMARY
          cat audit-output.txt >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      # ×‘×“×™×§×ª secrets ×—×©×•×¤×™×
      - name: ğŸ•µï¸ Check for exposed secrets
        uses: trufflesecurity/trufflehog@main
        continue-on-error: true
        with:
          path: ./genrok-app
          base: ${{ github.event.repository.default_branch }}
          head: HEAD
          extra_args: --only-verified

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“± ×©×œ×‘ 7: ×‘×“×™×§×•×ª Mobile/Responsive
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  responsive-tests:
    name: ğŸ“± Responsive Design Tests
    runs-on: ubuntu-latest
    needs: code-quality

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ“¦ Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: ${{ env.NODE_VERSION }}
          cache: 'npm'
          cache-dependency-path: genrok-app/package-lock.json

      - name: ğŸ“š Install dependencies
        run: npm ci

      - name: ğŸ­ Install Playwright
        run: npx playwright install chromium

      - name: ğŸ—ï¸ Build project
        run: npm run build

      - name: ğŸš€ Start server
        run: npm run start &
        env:
          PORT: 3000

      - name: â³ Wait for server
        run: npx wait-on http://localhost:3000 --timeout 60000

      - name: ğŸ“± Test responsive breakpoints
        run: |
          cat << 'EOF' > responsive-test.js
          const { chromium } = require('playwright');
          const fs = require('fs');

          const viewports = [
            { name: 'Mobile-S', width: 320, height: 568 },
            { name: 'Mobile-M', width: 375, height: 667 },
            { name: 'Mobile-L', width: 425, height: 812 },
            { name: 'Tablet', width: 768, height: 1024 },
            { name: 'Laptop', width: 1024, height: 768 },
            { name: 'Desktop', width: 1440, height: 900 },
            { name: '4K', width: 2560, height: 1440 },
          ];

          const pages = ['/', '/login', '/courses'];

          (async () => {
            const browser = await chromium.launch();
            const results = [];

            fs.mkdirSync('screenshots', { recursive: true });

            for (const viewport of viewports) {
              const context = await browser.newContext({ viewport });
              const page = await context.newPage();

              for (const pagePath of pages) {
                try {
                  await page.goto('http://localhost:3000' + pagePath, { waitUntil: 'networkidle', timeout: 30000 });

                  const screenshotName = viewport.name + '-' + (pagePath === '/' ? 'home' : pagePath.slice(1)) + '.png';
                  await page.screenshot({
                    path: 'screenshots/' + screenshotName,
                    fullPage: true
                  });

                  const hasHorizontalScroll = await page.evaluate(() => {
                    return document.documentElement.scrollWidth > document.documentElement.clientWidth;
                  });

                  results.push({
                    viewport: viewport.name,
                    page: pagePath,
                    width: viewport.width,
                    horizontalScroll: hasHorizontalScroll ? 'âŒ' : 'âœ…',
                    status: !hasHorizontalScroll ? 'âœ… PASS' : 'âš ï¸ SCROLL'
                  });

                } catch (error) {
                  results.push({
                    viewport: viewport.name,
                    page: pagePath,
                    width: viewport.width,
                    status: 'âŒ ERROR'
                  });
                }
              }

              await context.close();
            }

            await browser.close();

            console.log('\nğŸ“± Responsive Test Results:\n');
            console.table(results);

            const passed = results.filter(r => r.status.includes('PASS')).length;
            const total = results.length;
            console.log('\nâœ… Passed: ' + passed + '/' + total);

            // Write summary for GitHub
            const summary = results.map(r => '| ' + r.viewport + ' | ' + r.page + ' | ' + r.status + ' |').join('\n');
            fs.writeFileSync('responsive-summary.md',
              '## ğŸ“± Responsive Test Results\n\n| Viewport | Page | Status |\n|----------|------|--------|\n' + summary + '\n\nâœ… Passed: ' + passed + '/' + total
            );
          })();
          EOF

          node responsive-test.js
          cat responsive-summary.md >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      - name: ğŸ“¸ Upload responsive screenshots
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: responsive-screenshots
          path: genrok-app/screenshots/
          retention-days: 7

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ§  ×©×œ×‘ 8: ×‘×“×™×§×•×ª ×œ×•×’×™×§×” ×•×ª×•×›×Ÿ
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  content-logic-tests:
    name: ğŸ§  Content & Logic Review
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ“ Check for content files
        run: |
          echo "## ğŸ§  Content Analysis" >> $GITHUB_STEP_SUMMARY

          # ××¦× ×§×‘×¦×™ ×ª×•×›×Ÿ ×©×”×©×ª× ×•
          CHANGED_CONTENT=$(git diff --name-only ${{ github.event.before || 'HEAD~1' }} ${{ github.sha }} 2>/dev/null | grep -E '\.(md|mdx|json|tsx|jsx)$' | head -20 || echo "")
          echo "### Changed content files:" >> $GITHUB_STEP_SUMMARY
          if [ -n "$CHANGED_CONTENT" ]; then
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "$CHANGED_CONTENT" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "No content files changed" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ğŸ”— Check for broken internal links
        run: |
          echo "### ğŸ”— Internal Links" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          grep -roh 'href="\/[^"]*"' --include="*.tsx" --include="*.jsx" src/ 2>/dev/null | sort | uniq -c | sort -rn | head -15 >> $GITHUB_STEP_SUMMARY || echo "No internal links found" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

      - name: ğŸ“ Content Quality Checks
        run: |
          echo "### ğŸ“ Content Quality" >> $GITHUB_STEP_SUMMARY

          # ×—×¤×© alt texts ×—×¡×¨×™×
          echo "#### Missing Alt Texts:" >> $GITHUB_STEP_SUMMARY
          MISSING_ALT=$(grep -rn '<img\|<Image' --include="*.tsx" --include="*.jsx" src/ 2>/dev/null | grep -v 'alt=' | head -10 || echo "")
          if [ -n "$MISSING_ALT" ]; then
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "$MISSING_ALT" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… All images have alt text" >> $GITHUB_STEP_SUMMARY
          fi

          # ×—×¤×© TODO/FIXME
          echo "#### TODOs & FIXMEs:" >> $GITHUB_STEP_SUMMARY
          TODOS=$(grep -rn "TODO\|FIXME" --include="*.tsx" --include="*.ts" src/ 2>/dev/null | head -10 || echo "")
          if [ -n "$TODOS" ]; then
            echo '```' >> $GITHUB_STEP_SUMMARY
            echo "$TODOS" >> $GITHUB_STEP_SUMMARY
            echo '```' >> $GITHUB_STEP_SUMMARY
          else
            echo "âœ… No TODOs or FIXMEs found" >> $GITHUB_STEP_SUMMARY
          fi
        continue-on-error: true

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ¨ ×©×œ×‘ 9: ×‘×“×™×§×•×ª ×¢×™×¦×•×‘ ×•×§×•× ×¡×™×¡×˜× ×˜×™×•×ª
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  design-consistency-tests:
    name: ğŸ¨ Design Consistency
    runs-on: ubuntu-latest
    needs: setup

    steps:
      - name: ğŸ“¥ Checkout code
        uses: actions/checkout@v4

      - name: ğŸ¨ Check Tailwind consistency
        run: |
          echo "## ğŸ¨ Design Consistency Report" >> $GITHUB_STEP_SUMMARY

          # ×‘×“×•×§ ×¦×‘×¢×™× custom
          echo "### Custom Colors (arbitrary values):" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          grep -roh 'bg-\[[^]]*\]\|text-\[[^]]*\]\|border-\[[^]]*\]' --include="*.tsx" --include="*.jsx" src/ 2>/dev/null | sort | uniq -c | sort -rn | head -15 >> $GITHUB_STEP_SUMMARY || echo "No custom colors" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

          # ×‘×“×•×§ spacing custom
          echo "### Custom Spacing:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          grep -roh 'p-\[[^]]*\]\|m-\[[^]]*\]\|gap-\[[^]]*\]\|w-\[[^]]*\]\|h-\[[^]]*\]' --include="*.tsx" --include="*.jsx" src/ 2>/dev/null | sort | uniq -c | sort -rn | head -10 >> $GITHUB_STEP_SUMMARY || echo "No custom spacing" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY

          # ×¡×¤×•×¨ components
          echo "### Component Usage:" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
          echo "Pages: $(find src/app -name 'page.tsx' | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo "Components: $(find src/components -name '*.tsx' 2>/dev/null | wc -l)" >> $GITHUB_STEP_SUMMARY
          echo '```' >> $GITHUB_STEP_SUMMARY
        continue-on-error: true

  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  # ğŸ“Š ×©×œ×‘ 10: ×“×•"×— ×¡×•×¤×™ ××§×™×£
  # â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  final-report:
    name: ğŸ“Š Final QA Report
    runs-on: ubuntu-latest
    needs: [
      code-quality,
      e2e-tests,
      visual-tests,
      performance-tests,
      accessibility-tests,
      security-tests,
      responsive-tests,
      content-logic-tests,
      design-consistency-tests
    ]
    if: always()

    steps:
      - name: ğŸ“Š Generate Comprehensive Report
        run: |
          echo "# ğŸ” Quantum Scale - QA Pipeline Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Info | Value |" >> $GITHUB_STEP_SUMMARY
          echo "|------|-------|" >> $GITHUB_STEP_SUMMARY
          echo "| **Run** | #${{ github.run_number }} |" >> $GITHUB_STEP_SUMMARY
          echo "| **Commit** | \`${{ github.sha }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Branch** | \`${{ github.ref_name }}\` |" >> $GITHUB_STEP_SUMMARY
          echo "| **Triggered by** | @${{ github.actor }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "## ğŸ“‹ Test Results Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "| Category | Test | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|----------|------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ”§ Code | ESLint + TypeScript + Build | ${{ needs.code-quality.result == 'success' && 'âœ… PASS' || needs.code-quality.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âŒ FAIL' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ§ª E2E | Playwright Tests | ${{ needs.e2e-tests.result == 'success' && 'âœ… PASS' || needs.e2e-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ‘ï¸ Visual | Percy Snapshots | ${{ needs.visual-tests.result == 'success' && 'âœ… PASS' || needs.visual-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| âš¡ Performance | Lighthouse CI | ${{ needs.performance-tests.result == 'success' && 'âœ… PASS' || needs.performance-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| â™¿ Accessibility | axe-core | ${{ needs.accessibility-tests.result == 'success' && 'âœ… PASS' || needs.accessibility-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ”’ Security | Snyk + npm audit | ${{ needs.security-tests.result == 'success' && 'âœ… PASS' || needs.security-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ“± Responsive | Multi-viewport | ${{ needs.responsive-tests.result == 'success' && 'âœ… PASS' || needs.responsive-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ§  Content | Logic & Quality | ${{ needs.content-logic-tests.result == 'success' && 'âœ… PASS' || needs.content-logic-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "| ğŸ¨ Design | Consistency | ${{ needs.design-consistency-tests.result == 'success' && 'âœ… PASS' || needs.design-consistency-tests.result == 'skipped' && 'â­ï¸ SKIPPED' || 'âš ï¸ CHECK' }} |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          # Overall status
          if [[ "${{ needs.code-quality.result }}" == "success" ]]; then
            echo "## âœ… Pipeline Status: READY FOR REVIEW" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "All critical checks passed. This PR is ready for code review." >> $GITHUB_STEP_SUMMARY
          else
            echo "## âŒ Pipeline Status: NEEDS FIXES" >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "Critical checks failed. Please fix the issues before merging." >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "---" >> $GITHUB_STEP_SUMMARY
          echo "*ğŸ¤– Powered by Quantum Scale QA Pipeline*" >> $GITHUB_STEP_SUMMARY
        working-directory: .

      - name: ğŸš¨ Fail if critical tests failed
        if: needs.code-quality.result == 'failure'
        run: |
          echo "âŒ Critical tests failed. Please fix the issues before merging."
          exit 1
